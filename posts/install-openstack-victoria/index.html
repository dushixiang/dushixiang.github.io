<!DOCTYPE html>
<html lang="zh">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Language" content="zh">
    <meta name="color-scheme" content="light dark">
    
    

    <meta name="author" content="dushixiang">
    <meta name="description" content="近期公司业务需求，需要安装一套Openstack环境学习，看了一下现在已经出了wallaby版了，我果断选择了上一个版本victoria。因为没有足够多的物理服务器了，只好找了一台64核256G内存6T硬盘的机器来创建几台虚拟机来搭环境了。
实验环境    此次实验使用到了三台虚拟机，都是使用centos8系统，一台机器当作控制和网络节点，另外两台当作计算节点，使用OVS&#43;VLAN的网络模式，eth0作为管理网络，eth1互相连接到OVS网桥上模拟trunk网卡，controller多增加一个eth2用于访问外部网络。
   节点 作用 eth0 eth1 eth2     controller 控制节点、网络节点 172.16.10.100 无IP 桥接，无IP   compute-101 计算节点 172.16.10.101 无IP ❌   compute-102 计算节点 172.16.10.102 无IP ❌    安装虚拟机    安装依赖    安装KVM和Linux网桥
yum install -y qemu-kvm libvirt virt-install bridge-utils virt-manager dejavu-lgc-sans-fonts  dejavu-lgc-sans-fonts用于解决 virt-manaer 乱码
 启动
systemctl enable libvirtd &amp;&amp; systemctl start libvirtd 安装OVS">
    <meta name="keywords" content="blog,desenvolvedor,pessoal">

    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="openstack victoria版安装"/>
<meta name="twitter:description" content="近期公司业务需求，需要安装一套Openstack环境学习，看了一下现在已经出了wallaby版了，我果断选择了上一个版本victoria。因为没有足够多的物理服务器了，只好找了一台64核256G内存6T硬盘的机器来创建几台虚拟机来搭环境了。
实验环境    此次实验使用到了三台虚拟机，都是使用centos8系统，一台机器当作控制和网络节点，另外两台当作计算节点，使用OVS&#43;VLAN的网络模式，eth0作为管理网络，eth1互相连接到OVS网桥上模拟trunk网卡，controller多增加一个eth2用于访问外部网络。
   节点 作用 eth0 eth1 eth2     controller 控制节点、网络节点 172.16.10.100 无IP 桥接，无IP   compute-101 计算节点 172.16.10.101 无IP ❌   compute-102 计算节点 172.16.10.102 无IP ❌    安装虚拟机    安装依赖    安装KVM和Linux网桥
yum install -y qemu-kvm libvirt virt-install bridge-utils virt-manager dejavu-lgc-sans-fonts  dejavu-lgc-sans-fonts用于解决 virt-manaer 乱码
 启动
systemctl enable libvirtd &amp;&amp; systemctl start libvirtd 安装OVS"/>

    <meta property="og:title" content="openstack victoria版安装" />
<meta property="og:description" content="近期公司业务需求，需要安装一套Openstack环境学习，看了一下现在已经出了wallaby版了，我果断选择了上一个版本victoria。因为没有足够多的物理服务器了，只好找了一台64核256G内存6T硬盘的机器来创建几台虚拟机来搭环境了。
实验环境    此次实验使用到了三台虚拟机，都是使用centos8系统，一台机器当作控制和网络节点，另外两台当作计算节点，使用OVS&#43;VLAN的网络模式，eth0作为管理网络，eth1互相连接到OVS网桥上模拟trunk网卡，controller多增加一个eth2用于访问外部网络。
   节点 作用 eth0 eth1 eth2     controller 控制节点、网络节点 172.16.10.100 无IP 桥接，无IP   compute-101 计算节点 172.16.10.101 无IP ❌   compute-102 计算节点 172.16.10.102 无IP ❌    安装虚拟机    安装依赖    安装KVM和Linux网桥
yum install -y qemu-kvm libvirt virt-install bridge-utils virt-manager dejavu-lgc-sans-fonts  dejavu-lgc-sans-fonts用于解决 virt-manaer 乱码
 启动
systemctl enable libvirtd &amp;&amp; systemctl start libvirtd 安装OVS" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://typesafe.cn/posts/install-openstack-victoria/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-06-12T00:00:00&#43;08:00" />
<meta property="article:modified_time" content="2021-06-12T00:00:00&#43;08:00" /><meta property="og:site_name" content="没有理想的人不伤心" />



    <title>
  openstack victoria版安装 · 没有理想的人不伤心
</title>

    
      <link rel="canonical" href="https://typesafe.cn/posts/install-openstack-victoria/">
    

    
    
    <link rel="preload" href="/fonts/forkawesome-webfont.woff2?v=1.1.7" as="font" type="font/woff2" integrity="sha256-hEIt6X6xzye8ubyk8/uxjz68cRZHsJxoKS9fQ8idUGQ=" crossorigin>

    
      
      
      <link rel="stylesheet" href="/css/coder.min.abe8b6775d85a01169c10329309df501aa8a008ab354002f7858f077cae76020.css" integrity="sha256-q&#43;i2d12FoBFpwQMpMJ31AaqKAIqzVAAveFjwd8rnYCA=" crossorigin="anonymous" media="screen" />
    

    

    
      
        
        
        <link rel="stylesheet" href="/css/coder-dark.min.89c82b6022b96f77aeb521b240daec4f87ea029d84d1c78b8acd0735b91b3c92.css" integrity="sha256-icgrYCK5b3eutSGyQNrsT4fqAp2E0ceLis0HNbkbPJI=" crossorigin="anonymous" media="screen" />
      
    

    

    

    <link rel="icon" type="image/png" href="/images/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/images/favicon-16x16.png" sizes="16x16">

    <link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

    
      <script defer src="https://twemoji.maxcdn.com/v/13.0.1/twemoji.min.js"
        integrity="sha384-5f4X0lBluNY/Ib4VhGx0Pf6iDCF99VGXJIyYy7dDLY5QlEd7Ap0hICSSZA1XYbc4" crossorigin="anonymous"></script>
    

    <meta name="generator" content="Hugo 0.81.0" />
  </head>

  
  
    
  
  <body class="colorscheme-auto"
        onload=" twemoji.parse(document.body); "
  >
    
<div class="float-container">
    <a id="dark-mode-toggle" class="colorscheme-toggle">
        <i class="fa fa-adjust fa-fw" aria-hidden="true"></i>
    </a>
</div>


    <main class="wrapper">
      <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="/">
      没有理想的人不伤心
    </a>
    
      <input type="checkbox" id="menu-toggle" />
      <label class="menu-button float-right" for="menu-toggle">
        <i class="fa fa-bars fa-fw" aria-hidden="true"></i>
      </label>
      <ul class="navigation-list">
        
          
            <li class="navigation-item">
              <a class="navigation-link" href="/posts/">文章</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link" href="/categories/">分类</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link" href="/tags/">标签</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link" href="/about/">关于</a>
            </li>
          
        
        
      </ul>
    
  </section>
</nav>


      <div class="content">
        
  <section class="container post">
    <article>
      <header>
        <div class="post-title">
          <h1 class="title">
            <a class="title-link" href="https://typesafe.cn/posts/install-openstack-victoria/">
              openstack victoria版安装
            </a>
          </h1>
        </div>
        <div class="post-meta">
          <div class="date">
            <span class="posted-on">
              <i class="fa fa-calendar" aria-hidden="true"></i>
              <time datetime='2021-06-12T00:00:00&#43;08:00'>
                June 12, 2021
              </time>
            </span>
            <span class="reading-time">
              <i class="fa fa-clock-o" aria-hidden="true"></i>
              
            </span>
          </div>
          
          <div class="categories">
  <i class="fa fa-folder" aria-hidden="true"></i>
    <a href="/categories/openstack/">openstack</a></div>

          <div class="tags">
  <i class="fa fa-tag" aria-hidden="true"></i>
    <a href="/tags/openstack/">openstack</a></div>

        </div>
      </header>

      <div>
        
        <p>近期公司业务需求，需要安装一套Openstack环境学习，看了一下现在已经出了<code>wallaby</code>版了，我果断选择了上一个版本<code>victoria</code>。因为没有足够多的物理服务器了，只好找了一台64核256G内存6T硬盘的机器来创建几台虚拟机来搭环境了。</p>
<h1 id="实验环境">
  实验环境
  <a class="heading-link" href="#%e5%ae%9e%e9%aa%8c%e7%8e%af%e5%a2%83">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h1>
<p>此次实验使用到了三台虚拟机，都是使用centos8系统，一台机器当作控制和网络节点，另外两台当作计算节点，使用OVS+VLAN的网络模式，eth0作为管理网络，eth1互相连接到OVS网桥上模拟trunk网卡，controller多增加一个eth2用于访问外部网络。</p>
<table>
<thead>
<tr>
<th>节点</th>
<th>作用</th>
<th>eth0</th>
<th>eth1</th>
<th>eth2</th>
</tr>
</thead>
<tbody>
<tr>
<td>controller</td>
<td>控制节点、网络节点</td>
<td>172.16.10.100</td>
<td>无IP</td>
<td>桥接，无IP</td>
</tr>
<tr>
<td>compute-101</td>
<td>计算节点</td>
<td>172.16.10.101</td>
<td>无IP</td>
<td>❌</td>
</tr>
<tr>
<td>compute-102</td>
<td>计算节点</td>
<td>172.16.10.102</td>
<td>无IP</td>
<td>❌</td>
</tr>
</tbody>
</table>
<h1 id="安装虚拟机">
  安装虚拟机
  <a class="heading-link" href="#%e5%ae%89%e8%a3%85%e8%99%9a%e6%8b%9f%e6%9c%ba">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h1>
<h2 id="安装依赖">
  安装依赖
  <a class="heading-link" href="#%e5%ae%89%e8%a3%85%e4%be%9d%e8%b5%96">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h2>
<p>安装KVM和Linux网桥</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">yum install -y qemu-kvm libvirt virt-install bridge-utils virt-manager dejavu-lgc-sans-fonts
</code></pre></div><blockquote>
<p><code>dejavu-lgc-sans-fonts</code>用于解决 <code>virt-manaer</code> 乱码</p>
</blockquote>
<p>启动</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">systemctl <span style="color:#fff;font-weight:bold">enable</span> libvirtd &amp;&amp; systemctl start libvirtd
</code></pre></div><p>安装OVS</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">yum install openvswitch
</code></pre></div><p>启动OVS</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">systemctl <span style="color:#fff;font-weight:bold">enable</span> openvswitch &amp;&amp; systemctl start openvswitch
</code></pre></div><h3 id="创建虚拟机">
  创建虚拟机
  <a class="heading-link" href="#%e5%88%9b%e5%bb%ba%e8%99%9a%e6%8b%9f%e6%9c%ba">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h3>
<p>使用 virt-manager 创建三台虚拟机</p>
<p><img src="https://oss.typesafe.cn/vm-nodes.png" alt="image-20210604140054913"></p>
<h3 id="配置网络">
  配置网络
  <a class="heading-link" href="#%e9%85%8d%e7%bd%ae%e7%bd%91%e7%bb%9c">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h3>
<h4 id="配置管理网卡">
  配置管理网卡
  <a class="heading-link" href="#%e9%85%8d%e7%bd%ae%e7%ae%a1%e7%90%86%e7%bd%91%e5%8d%a1">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h4>
<p>给虚拟机配置桥接网络，参考<a href="https://typesafe.cn/posts/linux-kvm/">Linux虚拟化技术KVM</a>，效果如图</p>
<p><img src="https://oss.typesafe.cn/vm-manage-port-config.png" alt=""></p>
<h4 id="配置trunk网卡">
  配置trunk网卡
  <a class="heading-link" href="#%e9%85%8d%e7%bd%aetrunk%e7%bd%91%e5%8d%a1">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h4>
<p>使用ovs创建一个虚拟网桥。</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ovs-vsctl add-br br-vlan
</code></pre></div><p>此时网桥<code>br-vlan</code>上是没有任何虚拟网卡的，然后关闭虚拟机，在<code>virt-manager</code>上添加一个网络设备</p>
<p><img src="https://oss.typesafe.cn/kvm-ovs-trunk-port-config.png" alt=""></p>
<p>使用命令找到虚拟机并编辑虚拟机XML文件。</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">virsh list --all
virsh edit controller
</code></pre></div><p>找到对应的 <code>interface</code> 元素，在 <code>source</code> 和 <code>model</code>中间添加一行。</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">&lt;virtualport type=<span style="color:#0ff;font-weight:bold">&#39;openvswitch&#39;</span> /&gt;
</code></pre></div><p>然后保存退出，启动虚拟机，启动成功之后会 <code>virtualport</code> 中间生成一个新的元素。</p>
<p><img src="https://oss.typesafe.cn/kvm-ovs-trunk-port-xml.png" alt=""></p>
<p>确认是否添加成功。</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ovs-vsctl show
</code></pre></div><p>成功的话可以在网桥上看到自动生成的几个虚拟网卡。</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">Bridge br-vlan
    Port br-vlan
        Interface br-vlan
            type: internal
    Port <span style="color:#0ff;font-weight:bold">&#34;vnet1&#34;</span>
        Interface <span style="color:#0ff;font-weight:bold">&#34;vnet1&#34;</span>
    Port <span style="color:#0ff;font-weight:bold">&#34;vnet2&#34;</span>
        Interface <span style="color:#0ff;font-weight:bold">&#34;vnet2&#34;</span>
    Port <span style="color:#0ff;font-weight:bold">&#34;vnet3&#34;</span>
        Interface <span style="color:#0ff;font-weight:bold">&#34;vnet3&#34;</span>
ovs_version: <span style="color:#0ff;font-weight:bold">&#34;2.9.0&#34;</span>
</code></pre></div><p>以上步骤重复几次以完成其他虚拟机的配置。</p>
<h1 id="安装openstack">
  安装Openstack
  <a class="heading-link" href="#%e5%ae%89%e8%a3%85openstack">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h1>
<h2 id="配置环境">
  配置环境
  <a class="heading-link" href="#%e9%85%8d%e7%bd%ae%e7%8e%af%e5%a2%83">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h2>
<p>全部节点都需要操作。</p>
<h4 id="切换网络服务为-network-scripts">
  切换网络服务为 <code>network-scripts</code>
  <a class="heading-link" href="#%e5%88%87%e6%8d%a2%e7%bd%91%e7%bb%9c%e6%9c%8d%e5%8a%a1%e4%b8%ba-network-scripts">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h4>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#007f7f"># 安装Network服务</span>
yum install network-scripts -y
<span style="color:#007f7f"># 停用NetworkManager并禁止开机启动</span>
systemctl stop NetworkManager &amp;&amp; systemctl disable NetworkManager
<span style="color:#007f7f"># 启用Network并设置开机启动</span>
systemctl <span style="color:#fff;font-weight:bold">enable</span> network &amp;&amp; systemctl start network
</code></pre></div><h4 id="设置静态ip">
  设置静态IP
  <a class="heading-link" href="#%e8%ae%be%e7%bd%ae%e9%9d%99%e6%80%81ip">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h4>
<p>编辑网卡配置文件</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">vim /etc/sysconfig/network-scripts/ifcfg-eth0
</code></pre></div><p>修改并添加以下内容</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">BOOTPROTO=static
ONBOOT=yes
IPADDR=172.16.10.100
NETMASK=255.255.255.0
GATEWAY=172.16.0.1
</code></pre></div><p>重启网络</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">systemctl restart network
</code></pre></div><h4 id="修改主机名称">
  修改主机名称
  <a class="heading-link" href="#%e4%bf%ae%e6%94%b9%e4%b8%bb%e6%9c%ba%e5%90%8d%e7%a7%b0">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h4>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#007f7f"># 修改控制节点</span>
hostnamectl set-hostname controller
<span style="color:#007f7f"># 修改计算节点compute-101</span>
hostnamectl set-hostname compute-101
<span style="color:#007f7f"># 修改计算节点compute-102</span>
hostnamectl set-hostname compute-102
</code></pre></div><h3 id="修改hosts文件">
  修改hosts文件
  <a class="heading-link" href="#%e4%bf%ae%e6%94%b9hosts%e6%96%87%e4%bb%b6">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h3>
<p>添加以下内容</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">172.16.10.100 controller
172.16.10.101 compute-101
172.16.10.102 compute-102
</code></pre></div><h3 id="关闭防火墙">
  关闭防火墙
  <a class="heading-link" href="#%e5%85%b3%e9%97%ad%e9%98%b2%e7%81%ab%e5%a2%99">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h3>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">systemctl stop firewalld &amp;&amp; systemctl disable firewalld
</code></pre></div><h2 id="安装基础服务">
  安装基础服务
  <a class="heading-link" href="#%e5%ae%89%e8%a3%85%e5%9f%ba%e7%a1%80%e6%9c%8d%e5%8a%a1">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h2>
<p>全部节点都需要操作。</p>
<h3 id="升级软件包">
  升级软件包
  <a class="heading-link" href="#%e5%8d%87%e7%ba%a7%e8%bd%af%e4%bb%b6%e5%8c%85">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h3>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">yum upgrade -y
</code></pre></div><h3 id="安装时间同步服务chronyd-">
  安装时间同步服务<code>chronyd </code>
  <a class="heading-link" href="#%e5%ae%89%e8%a3%85%e6%97%b6%e9%97%b4%e5%90%8c%e6%ad%a5%e6%9c%8d%e5%8a%a1chronyd-">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h3>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">yum install chrony -y
</code></pre></div><p>计算节点修改配置文件 <code>/etc/chrony.conf</code> 中的 <code>pool 2.centos.pool.ntp.org iburst</code> 为 <code>server controller iburst</code> 直接与控制节点同步时间。</p>
<p>重启chrony服务并开机自启</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">systemctl restart chronyd &amp;&amp; systemctl <span style="color:#fff;font-weight:bold">enable</span> chronyd
</code></pre></div><h3 id="安装openstack存储库">
  安装openstack存储库
  <a class="heading-link" href="#%e5%ae%89%e8%a3%85openstack%e5%ad%98%e5%82%a8%e5%ba%93">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h3>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">yum config-manager --enable powertools
yum install centos-release-openstack-victoria -y
</code></pre></div><h3 id="安装openstack客户端和openstack-selinux">
  安装openstack客户端和openstack-selinux
  <a class="heading-link" href="#%e5%ae%89%e8%a3%85openstack%e5%ae%a2%e6%88%b7%e7%ab%af%e5%92%8copenstack-selinux">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h3>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">yum install python3-openstackclient openstack-selinux -y
</code></pre></div><h3 id="禁用selinux">
  禁用selinux
  <a class="heading-link" href="#%e7%a6%81%e7%94%a8selinux">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h3>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">cat&gt;/etc/selinux/config<span style="color:#0ff;font-weight:bold">&lt;&lt;EOF
</span><span style="color:#0ff;font-weight:bold">SELINUX=permissive
</span><span style="color:#0ff;font-weight:bold">SELINUXTYPE=targeted
</span><span style="color:#0ff;font-weight:bold">setenforce 0
</span><span style="color:#0ff;font-weight:bold">EOF</span>
</code></pre></div><h3 id="修改用户权限">
  修改用户权限
  <a class="heading-link" href="#%e4%bf%ae%e6%94%b9%e7%94%a8%e6%88%b7%e6%9d%83%e9%99%90">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h3>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#fff;font-weight:bold">echo</span> <span style="color:#0ff;font-weight:bold">&#34;neutron ALL = (root) NOPASSWD: ALL&#34;</span> &gt; /etc/sudoers.d/neutron
<span style="color:#fff;font-weight:bold">echo</span> <span style="color:#0ff;font-weight:bold">&#34;nova ALL = (root) NOPASSWD: ALL&#34;</span> &gt; /etc/sudoers.d/nova
</code></pre></div><h1 id="控制节点">
  控制节点
  <a class="heading-link" href="#%e6%8e%a7%e5%88%b6%e8%8a%82%e7%82%b9">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h1>
<h2 id="安装数据库">
  安装数据库
  <a class="heading-link" href="#%e5%ae%89%e8%a3%85%e6%95%b0%e6%8d%ae%e5%ba%93">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h2>
<ol>
<li>
<p>安装Mariadb数据库，也可安装MySQL数据库。</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">yum install mariadb mariadb-server python3-PyMySQL -y
</code></pre></div></li>
<li>
<p>创建和编辑<code>vim /etc/my.cnf.d/openstack.cnf</code>文件，添加如下信息</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">[mysqld]
bind-address = 0.0.0.0
default-storage-engine = innodb
innodb_file_per_table = on
max_connections = <span style="color:#ff0;font-weight:bold">4096</span>
collation-server = utf8_general_ci
character-set-server = utf8
</code></pre></div></li>
<li>
<p>启动数据库并设置为开机自启</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">systemctl start mariadb &amp;&amp; systemctl <span style="color:#fff;font-weight:bold">enable</span> mariadb
</code></pre></div></li>
<li>
<p>配置数据库</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">mysql_secure_installation
   
<span style="color:#007f7f"># 输入当前用户root密码，若为空直接回车</span>
Enter current password <span style="color:#fff;font-weight:bold">for</span> root (enter <span style="color:#fff;font-weight:bold">for</span> none):
OK, successfully used password, moving on...
<span style="color:#007f7f"># 是否设置root密码</span>
Set root password? [Y/n] y
<span style="color:#007f7f"># 输入新密码</span>
New password:
<span style="color:#007f7f"># 再次输入新密码</span>
Re-enter new password:
<span style="color:#007f7f"># 是否删除匿名用户</span>
Remove anonymous users? [Y/n] y
<span style="color:#007f7f"># 是否禁用远程登录</span>
Disallow root login remotely? [Y/n] n
<span style="color:#007f7f"># 是否删除测试数据库</span>
Remove <span style="color:#fff;font-weight:bold">test</span> database and access to it? [Y/n] y
<span style="color:#007f7f"># 是否重新加载权限表</span>
Reload privilege tables now? [Y/n] y
   
<span style="color:#007f7f"># 以上步骤根据实际情况做配置即可，不一定要与此处保持一致</span>
</code></pre></div></li>
</ol>
<h2 id="安装消息队列">
  安装消息队列
  <a class="heading-link" href="#%e5%ae%89%e8%a3%85%e6%b6%88%e6%81%af%e9%98%9f%e5%88%97">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h2>
<ol>
<li>
<p>安装软件包</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">yum install rabbitmq-server -y
</code></pre></div></li>
<li>
<p>启动消息队列服务并设置为开机自启</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">systemctl start rabbitmq-server &amp;&amp; systemctl <span style="color:#fff;font-weight:bold">enable</span> rabbitmq-server
</code></pre></div></li>
<li>
<p>添加openstack用户并设置密码</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">rabbitmqctl add_user openstack RABBIT_PASS
</code></pre></div></li>
<li>
<p>给openstack用户可读可写可配置权限</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">rabbitmqctl set_permissions openstack <span style="color:#0ff;font-weight:bold">&#34;.*&#34;</span> <span style="color:#0ff;font-weight:bold">&#34;.*&#34;</span> <span style="color:#0ff;font-weight:bold">&#34;.*&#34;</span>
</code></pre></div></li>
<li>
<p>为了方便监控，启用Web界面管理插件</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">rabbitmq-plugins <span style="color:#fff;font-weight:bold">enable</span> rabbitmq_management
</code></pre></div></li>
<li>
<p>浏览器访问 IP:15672，使用 guest/guest 登录rabbitmq</p>
</li>
</ol>
<h2 id="安装memcached缓存">
  安装Memcached缓存
  <a class="heading-link" href="#%e5%ae%89%e8%a3%85memcached%e7%bc%93%e5%ad%98">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h2>
<ol>
<li>
<p>安装软件包</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">yum install memcached python3-memcached -y
</code></pre></div></li>
<li>
<p>编辑<code>vim /etc/sysconfig/memcached</code>文件，将OPTTONS行修改成如下信息</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">OPTIONS=<span style="color:#0ff;font-weight:bold">&#34;-l 127.0.0.1,::1,controller&#34;</span>
</code></pre></div></li>
<li>
<p>启动Memcached服务并设置开机自启</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">systemctl start memcached &amp;&amp; systemctl <span style="color:#fff;font-weight:bold">enable</span> memcached
</code></pre></div></li>
</ol>
<h2 id="安装keystone服务">
  安装KeyStone服务
  <a class="heading-link" href="#%e5%ae%89%e8%a3%85keystone%e6%9c%8d%e5%8a%a1">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h2>
<h3 id="创建数据库">
  创建数据库
  <a class="heading-link" href="#%e5%88%9b%e5%bb%ba%e6%95%b0%e6%8d%ae%e5%ba%93">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h3>
<ol>
<li>
<p>连接数据库</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql">mysql -u root -p
</code></pre></div></li>
<li>
<p>创建keystone数据库</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#fff;font-weight:bold">CREATE</span> <span style="color:#fff;font-weight:bold">DATABASE</span> keystone;
</code></pre></div></li>
<li>
<p>授予keystone数据库权限，然后退出</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#fff;font-weight:bold">GRANT</span> <span style="color:#fff;font-weight:bold">ALL</span> <span style="color:#fff;font-weight:bold">PRIVILEGES</span> <span style="color:#fff;font-weight:bold">ON</span> keystone.* <span style="color:#fff;font-weight:bold">TO</span> <span style="color:#0ff;font-weight:bold">&#39;keystone&#39;</span>@<span style="color:#0ff;font-weight:bold">&#39;localhost&#39;</span> <span style="color:#fff;font-weight:bold">IDENTIFIED</span> <span style="color:#fff;font-weight:bold">BY</span> <span style="color:#0ff;font-weight:bold">&#39;KEYSTONE_DBPASS&#39;</span>;
<span style="color:#fff;font-weight:bold">GRANT</span> <span style="color:#fff;font-weight:bold">ALL</span> <span style="color:#fff;font-weight:bold">PRIVILEGES</span> <span style="color:#fff;font-weight:bold">ON</span> keystone.* <span style="color:#fff;font-weight:bold">TO</span> <span style="color:#0ff;font-weight:bold">&#39;keystone&#39;</span>@<span style="color:#0ff;font-weight:bold">&#39;%&#39;</span> <span style="color:#fff;font-weight:bold">IDENTIFIED</span> <span style="color:#fff;font-weight:bold">BY</span> <span style="color:#0ff;font-weight:bold">&#39;KEYSTONE_DBPASS&#39;</span>;
<span style="color:#fff;font-weight:bold">exit</span>;
</code></pre></div></li>
</ol>
<h3 id="安装软件包">
  安装软件包
  <a class="heading-link" href="#%e5%ae%89%e8%a3%85%e8%bd%af%e4%bb%b6%e5%8c%85">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h3>
<ol>
<li>
<p>安装软件</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">yum install openstack-keystone httpd python3-mod_wsgi -y
</code></pre></div></li>
<li>
<p>修改配置文件</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">cat &gt; /etc/keystone/keystone.conf <span style="color:#0ff;font-weight:bold">&lt;&lt;EOF
</span><span style="color:#0ff;font-weight:bold">[DEFAULT]
</span><span style="color:#0ff;font-weight:bold">[database]
</span><span style="color:#0ff;font-weight:bold">connection = mysql+pymysql://keystone:KEYSTONE_DBPASS@controller/keystone
</span><span style="color:#0ff;font-weight:bold">[token]
</span><span style="color:#0ff;font-weight:bold">provider = fernet
</span><span style="color:#0ff;font-weight:bold">EOF</span>
</code></pre></div></li>
<li>
<p>初始化数据库</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">su -s /bin/sh -c <span style="color:#0ff;font-weight:bold">&#34;keystone-manage db_sync&#34;</span> keystone
</code></pre></div></li>
<li>
<p>初始化Fernet</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">keystone-manage fernet_setup --keystone-user keystone --keystone-group keystone
keystone-manage credential_setup --keystone-user keystone --keystone-group keystone
</code></pre></div></li>
<li>
<p>引导身份认证服务</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">keystone-manage bootstrap --bootstrap-password ADMIN_PASS <span style="color:#0ff;font-weight:bold">\
</span><span style="color:#0ff;font-weight:bold"></span>  --bootstrap-admin-url http://controller:5000/v3/ <span style="color:#0ff;font-weight:bold">\
</span><span style="color:#0ff;font-weight:bold"></span>  --bootstrap-internal-url http://controller:5000/v3/ <span style="color:#0ff;font-weight:bold">\
</span><span style="color:#0ff;font-weight:bold"></span>  --bootstrap-public-url http://controller:5000/v3/ <span style="color:#0ff;font-weight:bold">\
</span><span style="color:#0ff;font-weight:bold"></span>  --bootstrap-region-id RegionOne
</code></pre></div></li>
</ol>
<h2 id="配置apache-http服务">
  配置Apache HTTP服务
  <a class="heading-link" href="#%e9%85%8d%e7%bd%aeapache-http%e6%9c%8d%e5%8a%a1">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h2>
<ol>
<li>
<p>修改<code>vim /etc/httpd/conf/httpd.conf</code>文件，添加如下信息</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ServerName controller
</code></pre></div></li>
<li>
<p>创建软链接</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ln -s /usr/share/keystone/wsgi-keystone.conf /etc/httpd/conf.d/
</code></pre></div></li>
<li>
<p>启动httpd服务 并设置开机自启</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">systemctl start httpd &amp;&amp; systemctl <span style="color:#fff;font-weight:bold">enable</span> httpd
</code></pre></div></li>
<li>
<p>创建环境变量脚本</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">cat &gt; admin-openrc <span style="color:#0ff;font-weight:bold">&lt;&lt;EOF
</span><span style="color:#0ff;font-weight:bold">export OS_USERNAME=admin
</span><span style="color:#0ff;font-weight:bold">export OS_PASSWORD=ADMIN_PASS
</span><span style="color:#0ff;font-weight:bold">export OS_PROJECT_NAME=admin
</span><span style="color:#0ff;font-weight:bold">export OS_USER_DOMAIN_NAME=Default
</span><span style="color:#0ff;font-weight:bold">export OS_PROJECT_DOMAIN_NAME=Default
</span><span style="color:#0ff;font-weight:bold">export OS_AUTH_URL=http://controller:5000/v3
</span><span style="color:#0ff;font-weight:bold">export OS_IDENTITY_API_VERSION=3
</span><span style="color:#0ff;font-weight:bold">export OS_IMAGE_API_VERSION=2
</span><span style="color:#0ff;font-weight:bold">EOF</span>
</code></pre></div><p>执行命令 <code>source admin-openrc</code> 或者 <code>. admin-openrc</code> 使环境变量生效。</p>
</li>
</ol>
<h2 id="创建域项目用户和角色">
  创建域、项目、用户和角色
  <a class="heading-link" href="#%e5%88%9b%e5%bb%ba%e5%9f%9f%e9%a1%b9%e7%9b%ae%e7%94%a8%e6%88%b7%e5%92%8c%e8%a7%92%e8%89%b2">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h2>
<ol>
<li>
<p>创建域，程序中已存在默认域，此命令只是一个创建域的例子，可以不执行</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">openstack domain create --description <span style="color:#0ff;font-weight:bold">&#34;An Example Domain&#34;</span> example
</code></pre></div></li>
<li>
<p>创建service项目，也叫做租户</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">openstack project create --domain default --description <span style="color:#0ff;font-weight:bold">&#34;Service Project&#34;</span> service
</code></pre></div></li>
<li>
<p>验证token令牌</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">openstack token issue
</code></pre></div></li>
</ol>
<h2 id="安装glance服务">
  安装Glance服务
  <a class="heading-link" href="#%e5%ae%89%e8%a3%85glance%e6%9c%8d%e5%8a%a1">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h2>
<h3 id="创建数据库-1">
  创建数据库
  <a class="heading-link" href="#%e5%88%9b%e5%bb%ba%e6%95%b0%e6%8d%ae%e5%ba%93-1">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h3>
<ol>
<li>
<p>连接数据库</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql">mysql -u root -p
</code></pre></div></li>
<li>
<p>创建glance数据库</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#fff;font-weight:bold">CREATE</span> <span style="color:#fff;font-weight:bold">DATABASE</span> glance;
</code></pre></div></li>
<li>
<p>授予glance数据库权限，然后退出</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#fff;font-weight:bold">GRANT</span> <span style="color:#fff;font-weight:bold">ALL</span> <span style="color:#fff;font-weight:bold">PRIVILEGES</span> <span style="color:#fff;font-weight:bold">ON</span> glance.* <span style="color:#fff;font-weight:bold">TO</span> <span style="color:#0ff;font-weight:bold">&#39;glance&#39;</span>@<span style="color:#0ff;font-weight:bold">&#39;localhost&#39;</span> <span style="color:#fff;font-weight:bold">IDENTIFIED</span> <span style="color:#fff;font-weight:bold">BY</span> <span style="color:#0ff;font-weight:bold">&#39;GLANCE_DBPASS&#39;</span>;
<span style="color:#fff;font-weight:bold">GRANT</span> <span style="color:#fff;font-weight:bold">ALL</span> <span style="color:#fff;font-weight:bold">PRIVILEGES</span> <span style="color:#fff;font-weight:bold">ON</span> glance.* <span style="color:#fff;font-weight:bold">TO</span> <span style="color:#0ff;font-weight:bold">&#39;glance&#39;</span>@<span style="color:#0ff;font-weight:bold">&#39;%&#39;</span> <span style="color:#fff;font-weight:bold">IDENTIFIED</span> <span style="color:#fff;font-weight:bold">BY</span> <span style="color:#0ff;font-weight:bold">&#39;GLANCE_DBPASS&#39;</span>;
<span style="color:#fff;font-weight:bold">exit</span>;
</code></pre></div></li>
</ol>
<h3 id="创建glance用户并关联角色">
  创建glance用户并关联角色
  <a class="heading-link" href="#%e5%88%9b%e5%bb%baglance%e7%94%a8%e6%88%b7%e5%b9%b6%e5%85%b3%e8%81%94%e8%a7%92%e8%89%b2">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h3>
<ol>
<li>
<p>创建glance用户并设置密码为GLANCE_PASS，此处与上面创建用户的不同之处是未使用交互式的方式，直接将密码放入了命令中</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">openstack user create --domain default --password GLANCE_PASS glance
</code></pre></div></li>
<li>
<p>使用admin角色将Glance用户添加到服务项目中</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#007f7f"># 在service的项目上给glance用户关联admin角色</span>
openstack role add --project service --user glance admin
</code></pre></div></li>
</ol>
<h3 id="创建glance服务并注册api">
  创建glance服务并注册API
  <a class="heading-link" href="#%e5%88%9b%e5%bb%baglance%e6%9c%8d%e5%8a%a1%e5%b9%b6%e6%b3%a8%e5%86%8capi">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h3>
<ol>
<li>
<p>创建glance服务</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">openstack service create --name glance --description <span style="color:#0ff;font-weight:bold">&#34;OpenStack Image&#34;</span> image
</code></pre></div></li>
<li>
<p>注册API，也就是创建镜像服务的API终端endpoints</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">openstack endpoint create --region RegionOne image public http://controller:9292
openstack endpoint create --region RegionOne image internal http://controller:9292
openstack endpoint create --region RegionOne image admin http://controller:9292
</code></pre></div></li>
</ol>
<h3 id="安装并配置glance">
  安装并配置glance
  <a class="heading-link" href="#%e5%ae%89%e8%a3%85%e5%b9%b6%e9%85%8d%e7%bd%aeglance">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h3>
<ol>
<li>
<p>安装软件包</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">dnf install openstack-glance -y
</code></pre></div></li>
<li>
<p>修改配置文件</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">cat &gt; /etc/glance/glance-api.conf<span style="color:#0ff;font-weight:bold">&lt;&lt;EOF
</span><span style="color:#0ff;font-weight:bold">[database]
</span><span style="color:#0ff;font-weight:bold">connection = mysql+pymysql://glance:GLANCE_DBPASS@controller/glance
</span><span style="color:#0ff;font-weight:bold">   
</span><span style="color:#0ff;font-weight:bold">[keystone_authtoken]
</span><span style="color:#0ff;font-weight:bold">www_authenticate_uri  = http://controller:5000
</span><span style="color:#0ff;font-weight:bold">auth_url = http://controller:5000
</span><span style="color:#0ff;font-weight:bold">memcached_servers = controller:11211
</span><span style="color:#0ff;font-weight:bold">auth_type = password
</span><span style="color:#0ff;font-weight:bold">project_domain_name = Default
</span><span style="color:#0ff;font-weight:bold">user_domain_name = Default
</span><span style="color:#0ff;font-weight:bold">project_name = service
</span><span style="color:#0ff;font-weight:bold">username = glance
</span><span style="color:#0ff;font-weight:bold">password = GLANCE_PASS
</span><span style="color:#0ff;font-weight:bold">   
</span><span style="color:#0ff;font-weight:bold">[paste_deploy]
</span><span style="color:#0ff;font-weight:bold">flavor = keystone
</span><span style="color:#0ff;font-weight:bold">   
</span><span style="color:#0ff;font-weight:bold">[glance_store]
</span><span style="color:#0ff;font-weight:bold">stores = file,http
</span><span style="color:#0ff;font-weight:bold">default_store = file
</span><span style="color:#0ff;font-weight:bold">filesystem_store_datadir = /var/lib/glance/images/
</span><span style="color:#0ff;font-weight:bold">EOF</span>
</code></pre></div></li>
<li>
<p>同步数据库</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">su -s /bin/sh -c <span style="color:#0ff;font-weight:bold">&#34;glance-manage db_sync&#34;</span> glance
</code></pre></div></li>
<li>
<p>启动glance服务并设置开机自启</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">systemctl start openstack-glance-api &amp;&amp; systemctl <span style="color:#fff;font-weight:bold">enable</span> openstack-glance-api
</code></pre></div></li>
</ol>
<h2 id="安装placement服务">
  安装Placement服务
  <a class="heading-link" href="#%e5%ae%89%e8%a3%85placement%e6%9c%8d%e5%8a%a1">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h2>
<h3 id="创建数据库-2">
  创建数据库
  <a class="heading-link" href="#%e5%88%9b%e5%bb%ba%e6%95%b0%e6%8d%ae%e5%ba%93-2">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h3>
<ol>
<li>
<p>连接数据库</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql">mysql -u root -p
</code></pre></div></li>
<li>
<p>创建Plancement数据库</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#fff;font-weight:bold">CREATE</span> <span style="color:#fff;font-weight:bold">DATABASE</span> placement;
</code></pre></div></li>
<li>
<p>授予Plancement数据库权限，然后退出</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#fff;font-weight:bold">GRANT</span> <span style="color:#fff;font-weight:bold">ALL</span> <span style="color:#fff;font-weight:bold">PRIVILEGES</span> <span style="color:#fff;font-weight:bold">ON</span> placement.* <span style="color:#fff;font-weight:bold">TO</span> <span style="color:#0ff;font-weight:bold">&#39;placement&#39;</span>@<span style="color:#0ff;font-weight:bold">&#39;localhost&#39;</span> <span style="color:#fff;font-weight:bold">IDENTIFIED</span> <span style="color:#fff;font-weight:bold">BY</span> <span style="color:#0ff;font-weight:bold">&#39;PLACEMENT_DBPASS&#39;</span>;
<span style="color:#fff;font-weight:bold">GRANT</span> <span style="color:#fff;font-weight:bold">ALL</span> <span style="color:#fff;font-weight:bold">PRIVILEGES</span> <span style="color:#fff;font-weight:bold">ON</span> placement.* <span style="color:#fff;font-weight:bold">TO</span> <span style="color:#0ff;font-weight:bold">&#39;placement&#39;</span>@<span style="color:#0ff;font-weight:bold">&#39;%&#39;</span> <span style="color:#fff;font-weight:bold">IDENTIFIED</span> <span style="color:#fff;font-weight:bold">BY</span> <span style="color:#0ff;font-weight:bold">&#39;PLACEMENT_DBPASS&#39;</span>;
<span style="color:#fff;font-weight:bold">exit</span>;
</code></pre></div></li>
</ol>
<h3 id="配置用户和endpoint">
  配置用户和Endpoint
  <a class="heading-link" href="#%e9%85%8d%e7%bd%ae%e7%94%a8%e6%88%b7%e5%92%8cendpoint">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h3>
<ol>
<li>
<p>创建一个plancement用户并设置密码为PLACEMENT_PASS</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">openstack user create --domain default --password PLACEMENT_PASS placement
</code></pre></div></li>
<li>
<p>使用admin角色将Placement用户添加到服务项目中</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#007f7f"># 在service的项目上给placement用户关联admin角色</span>
openstack role add --project service --user placement admin
</code></pre></div></li>
</ol>
<h3 id="创建placement服务并注册api">
  创建Placement服务并注册API
  <a class="heading-link" href="#%e5%88%9b%e5%bb%baplacement%e6%9c%8d%e5%8a%a1%e5%b9%b6%e6%b3%a8%e5%86%8capi">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h3>
<ol>
<li>
<p>创建Plancement服务</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">openstack service create --name placement --description <span style="color:#0ff;font-weight:bold">&#34;Placement API&#34;</span> placement
</code></pre></div></li>
<li>
<p>创建Plancement服务API端口</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">openstack endpoint create --region RegionOne placement public http://controller:8778
openstack endpoint create --region RegionOne placement internal http://controller:8778
openstack endpoint create --region RegionOne placement admin http://controller:8778
</code></pre></div></li>
</ol>
<h3 id="安装placement服务-1">
  安装Placement服务
  <a class="heading-link" href="#%e5%ae%89%e8%a3%85placement%e6%9c%8d%e5%8a%a1-1">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h3>
<ol>
<li>
<p>安装Plancement软件包</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">yum install openstack-placement-api -y
</code></pre></div></li>
<li>
<p>修改配置文件</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">cat &gt; /etc/placement/placement.conf <span style="color:#0ff;font-weight:bold">&lt;&lt;EOF
</span><span style="color:#0ff;font-weight:bold">[placement_database]
</span><span style="color:#0ff;font-weight:bold">connection = mysql+pymysql://placement:PLACEMENT_DBPASS@controller/placement
</span><span style="color:#0ff;font-weight:bold">   
</span><span style="color:#0ff;font-weight:bold">[api]
</span><span style="color:#0ff;font-weight:bold">auth_strategy = keystone
</span><span style="color:#0ff;font-weight:bold">   
</span><span style="color:#0ff;font-weight:bold">[keystone_authtoken]
</span><span style="color:#0ff;font-weight:bold">auth_url = http://controller:5000/v3
</span><span style="color:#0ff;font-weight:bold">memcached_servers = controller:11211
</span><span style="color:#0ff;font-weight:bold">auth_type = password
</span><span style="color:#0ff;font-weight:bold">project_domain_name = Default
</span><span style="color:#0ff;font-weight:bold">user_domain_name = Default
</span><span style="color:#0ff;font-weight:bold">project_name = service
</span><span style="color:#0ff;font-weight:bold">username = placement
</span><span style="color:#0ff;font-weight:bold">password = PLACEMENT_PASS
</span><span style="color:#0ff;font-weight:bold">EOF</span>
</code></pre></div></li>
<li>
<p>同步数据库</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">su -s /bin/sh -c <span style="color:#0ff;font-weight:bold">&#34;placement-manage db sync&#34;</span> placement
</code></pre></div></li>
<li>
<p>重启httpd服务</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">systemctl restart httpd
</code></pre></div></li>
<li>
<p>检查Placement服务状态</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">placement-status upgrade check
</code></pre></div></li>
</ol>
<h2 id="安装nova服务">
  安装Nova服务
  <a class="heading-link" href="#%e5%ae%89%e8%a3%85nova%e6%9c%8d%e5%8a%a1">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h2>
<h3 id="创建数据库-3">
  创建数据库
  <a class="heading-link" href="#%e5%88%9b%e5%bb%ba%e6%95%b0%e6%8d%ae%e5%ba%93-3">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h3>
<ol>
<li>
<p>连接数据库</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql">mysql -u root -p
</code></pre></div></li>
<li>
<p>创建nova_api，nova和nova_cell0数据库</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#fff;font-weight:bold">CREATE</span> <span style="color:#fff;font-weight:bold">DATABASE</span> nova_api;
<span style="color:#fff;font-weight:bold">CREATE</span> <span style="color:#fff;font-weight:bold">DATABASE</span> nova;
<span style="color:#fff;font-weight:bold">CREATE</span> <span style="color:#fff;font-weight:bold">DATABASE</span> nova_cell0;
</code></pre></div></li>
<li>
<p>分别授予三个数据库权限，然后退出</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#007f7f"># 授权nova_api数据库
</span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">GRANT</span> <span style="color:#fff;font-weight:bold">ALL</span> <span style="color:#fff;font-weight:bold">PRIVILEGES</span> <span style="color:#fff;font-weight:bold">ON</span> nova_api.* <span style="color:#fff;font-weight:bold">TO</span> <span style="color:#0ff;font-weight:bold">&#39;nova&#39;</span>@<span style="color:#0ff;font-weight:bold">&#39;localhost&#39;</span> <span style="color:#fff;font-weight:bold">IDENTIFIED</span> <span style="color:#fff;font-weight:bold">BY</span> <span style="color:#0ff;font-weight:bold">&#39;NOVA_DBPASS&#39;</span>;
<span style="color:#fff;font-weight:bold">GRANT</span> <span style="color:#fff;font-weight:bold">ALL</span> <span style="color:#fff;font-weight:bold">PRIVILEGES</span> <span style="color:#fff;font-weight:bold">ON</span> nova_api.* <span style="color:#fff;font-weight:bold">TO</span> <span style="color:#0ff;font-weight:bold">&#39;nova&#39;</span>@<span style="color:#0ff;font-weight:bold">&#39;%&#39;</span> <span style="color:#fff;font-weight:bold">IDENTIFIED</span> <span style="color:#fff;font-weight:bold">BY</span> <span style="color:#0ff;font-weight:bold">&#39;NOVA_DBPASS&#39;</span>;
<span style="color:#007f7f"># 授权nova数据库
</span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">GRANT</span> <span style="color:#fff;font-weight:bold">ALL</span> <span style="color:#fff;font-weight:bold">PRIVILEGES</span> <span style="color:#fff;font-weight:bold">ON</span> nova.* <span style="color:#fff;font-weight:bold">TO</span> <span style="color:#0ff;font-weight:bold">&#39;nova&#39;</span>@<span style="color:#0ff;font-weight:bold">&#39;localhost&#39;</span> <span style="color:#fff;font-weight:bold">IDENTIFIED</span> <span style="color:#fff;font-weight:bold">BY</span> <span style="color:#0ff;font-weight:bold">&#39;NOVA_DBPASS&#39;</span>;
<span style="color:#fff;font-weight:bold">GRANT</span> <span style="color:#fff;font-weight:bold">ALL</span> <span style="color:#fff;font-weight:bold">PRIVILEGES</span> <span style="color:#fff;font-weight:bold">ON</span> nova.* <span style="color:#fff;font-weight:bold">TO</span> <span style="color:#0ff;font-weight:bold">&#39;nova&#39;</span>@<span style="color:#0ff;font-weight:bold">&#39;%&#39;</span> <span style="color:#fff;font-weight:bold">IDENTIFIED</span> <span style="color:#fff;font-weight:bold">BY</span> <span style="color:#0ff;font-weight:bold">&#39;NOVA_DBPASS&#39;</span>;
<span style="color:#007f7f"># 授权nova_cell0数据库
</span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">GRANT</span> <span style="color:#fff;font-weight:bold">ALL</span> <span style="color:#fff;font-weight:bold">PRIVILEGES</span> <span style="color:#fff;font-weight:bold">ON</span> nova_cell0.* <span style="color:#fff;font-weight:bold">TO</span> <span style="color:#0ff;font-weight:bold">&#39;nova&#39;</span>@<span style="color:#0ff;font-weight:bold">&#39;localhost&#39;</span> <span style="color:#fff;font-weight:bold">IDENTIFIED</span> <span style="color:#fff;font-weight:bold">BY</span> <span style="color:#0ff;font-weight:bold">&#39;NOVA_DBPASS&#39;</span>;
<span style="color:#fff;font-weight:bold">GRANT</span> <span style="color:#fff;font-weight:bold">ALL</span> <span style="color:#fff;font-weight:bold">PRIVILEGES</span> <span style="color:#fff;font-weight:bold">ON</span> nova_cell0.* <span style="color:#fff;font-weight:bold">TO</span> <span style="color:#0ff;font-weight:bold">&#39;nova&#39;</span>@<span style="color:#0ff;font-weight:bold">&#39;%&#39;</span> <span style="color:#fff;font-weight:bold">IDENTIFIED</span> <span style="color:#fff;font-weight:bold">BY</span> <span style="color:#0ff;font-weight:bold">&#39;NOVA_DBPASS&#39;</span>;
<span style="color:#fff;font-weight:bold">exit</span>;
</code></pre></div></li>
</ol>
<h3 id="配置用户和endpoint-1">
  配置用户和Endpoint
  <a class="heading-link" href="#%e9%85%8d%e7%bd%ae%e7%94%a8%e6%88%b7%e5%92%8cendpoint-1">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h3>
<ol>
<li>
<p>创建nova用户并设置密码为NOVA_PASS</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">openstack user create --domain default --password NOVA_PASS nova
</code></pre></div></li>
<li>
<p>使用admin角色将nova用户添加到服务项目中</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#007f7f"># 在service的项目上给nova用户关联admin角色</span>
openstack role add --project service --user nova admin
</code></pre></div></li>
</ol>
<h3 id="创建nova服务并注册api">
  创建Nova服务并注册API
  <a class="heading-link" href="#%e5%88%9b%e5%bb%banova%e6%9c%8d%e5%8a%a1%e5%b9%b6%e6%b3%a8%e5%86%8capi">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h3>
<ol>
<li>
<p>创建Nova服务</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">openstack service create --name nova --description <span style="color:#0ff;font-weight:bold">&#34;OpenStack Compute&#34;</span> compute
</code></pre></div></li>
<li>
<p>创建Nova服务API端口</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">openstack endpoint create --region RegionOne compute public http://controller:8774/v2.1
openstack endpoint create --region RegionOne compute internal http://controller:8774/v2.1
openstack endpoint create --region RegionOne compute admin http://controller:8774/v2.1
</code></pre></div></li>
</ol>
<h3 id="安装并配置nova">
  安装并配置Nova
  <a class="heading-link" href="#%e5%ae%89%e8%a3%85%e5%b9%b6%e9%85%8d%e7%bd%aenova">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h3>
<ol>
<li>
<p>安装nova相关软件包</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">yum install openstack-nova-api openstack-nova-conductor openstack-nova-novncproxy openstack-nova-scheduler -y
</code></pre></div></li>
<li>
<p>修改配置文件</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">cat &gt; /etc/nova/nova.conf <span style="color:#0ff;font-weight:bold">&lt;&lt;EOF
</span><span style="color:#0ff;font-weight:bold">[DE</span>FAULT]
enabled_apis = osapi_compute,metadata
transport_url = rabbit://openstack:RABBIT_PASS@controller:5672/
my_ip = 172.16.10.100
   
[api_database]
connection = mysql+pymysql://nova:NOVA_DBPASS@controller/nova_api
   
[database]
connection = mysql+pymysql://nova:NOVA_DBPASS@controller/nova
   
[api]
auth_strategy = keystone
   
[keystone_authtoken]
www_authenticate_uri = http://controller:5000/
auth_url = http://controller:5000/
memcached_servers = controller:11211
auth_type = password
project_domain_name = Default
user_domain_name = Default
project_name = service
username = nova
password = NOVA_PASS
   
[vnc]
enabled = <span style="color:#fff;font-weight:bold">true</span>
server_listen = $my_ip
server_proxyclient_address = $my_ip
   
[glance]
api_servers = http://controller:9292
   
[oslo_concurrency]
lock_path = /var/lib/nova/tmp
   
[placement]
region_name = RegionOne
project_domain_name = Default
project_name = service
auth_type = password
user_domain_name = Default
auth_url = http://controller:5000/v3
username = placement
password = PLACEMENT_PASS
</code></pre></div></li>
<li>
<p>同步数据库</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#007f7f"># 同步nova_api数据库</span>
su -s /bin/sh -c <span style="color:#0ff;font-weight:bold">&#34;nova-manage api_db sync&#34;</span> nova
<span style="color:#007f7f"># 同步nova_cell0数据库</span>
su -s /bin/sh -c <span style="color:#0ff;font-weight:bold">&#34;nova-manage cell_v2 map_cell0&#34;</span> nova
<span style="color:#007f7f"># 创建cell1</span>
su -s /bin/sh -c <span style="color:#0ff;font-weight:bold">&#34;nova-manage cell_v2 create_cell --name=cell1 --verbose&#34;</span> nova
<span style="color:#007f7f"># 同步nova数据库</span>
su -s /bin/sh -c <span style="color:#0ff;font-weight:bold">&#34;nova-manage db sync&#34;</span> nova
</code></pre></div><p>验证nova_cell0和cell1是否添加成功</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">su -s /bin/sh -c <span style="color:#0ff;font-weight:bold">&#34;nova-manage cell_v2 list_cells&#34;</span> nova
</code></pre></div></li>
<li>
<p>启动服务并设为开机自启</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">systemctl <span style="color:#fff;font-weight:bold">enable</span> openstack-nova-api openstack-nova-scheduler openstack-nova-conductor openstack-nova-novncproxy
systemctl start openstack-nova-api openstack-nova-scheduler openstack-nova-conductor openstack-nova-novncproxy
</code></pre></div></li>
<li>
<p>使用命令<code>nova service-list</code>验证服务是否启动成功</p>
</li>
</ol>
<h2 id="安装neutron服务">
  安装neutron服务
  <a class="heading-link" href="#%e5%ae%89%e8%a3%85neutron%e6%9c%8d%e5%8a%a1">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h2>
<h3 id="创建数据库-4">
  创建数据库
  <a class="heading-link" href="#%e5%88%9b%e5%bb%ba%e6%95%b0%e6%8d%ae%e5%ba%93-4">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h3>
<ol>
<li>
<p>连接数据库</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql">mysql -u root -p
</code></pre></div></li>
<li>
<p>创建neutron数据库</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#fff;font-weight:bold">CREATE</span> <span style="color:#fff;font-weight:bold">DATABASE</span> neutron;
</code></pre></div></li>
<li>
<p>授予数据库权限，然后退出</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">GRANT ALL PRIVILEGES ON neutron.* TO <span style="color:#0ff;font-weight:bold">&#39;neutron&#39;</span>@<span style="color:#0ff;font-weight:bold">&#39;localhost&#39;</span> IDENTIFIED BY <span style="color:#0ff;font-weight:bold">&#39;NEUTRON_DBPASS&#39;</span>;
GRANT ALL PRIVILEGES ON neutron.* TO <span style="color:#0ff;font-weight:bold">&#39;neutron&#39;</span>@<span style="color:#0ff;font-weight:bold">&#39;%&#39;</span> IDENTIFIED BY <span style="color:#0ff;font-weight:bold">&#39;NEUTRON_DBPASS&#39;</span>;
exit;
</code></pre></div></li>
</ol>
<h3 id="配置用户和endpoint-2">
  配置用户和Endpoint
  <a class="heading-link" href="#%e9%85%8d%e7%bd%ae%e7%94%a8%e6%88%b7%e5%92%8cendpoint-2">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h3>
<ol>
<li>
<p>创建neutron用户并设置密码为NEUTRON_PASS</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">openstack user create --domain default --password NEUTRON_PASS neutron
</code></pre></div></li>
<li>
<p>使用admin角色将neutron用户添加到服务项目中</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#007f7f"># 在service的项目上给neutron用户关联admin角色</span>
openstack role add --project service --user neutron admin
</code></pre></div></li>
</ol>
<h3 id="创建neutron服务并注册api">
  创建Neutron服务并注册API
  <a class="heading-link" href="#%e5%88%9b%e5%bb%baneutron%e6%9c%8d%e5%8a%a1%e5%b9%b6%e6%b3%a8%e5%86%8capi">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h3>
<ol>
<li>
<p>创建Neutron服务</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">openstack service create --name neutron --description <span style="color:#0ff;font-weight:bold">&#34;OpenStack Networking&#34;</span> network
</code></pre></div></li>
<li>
<p>创建Neutron服务API端口</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">openstack endpoint create --region RegionOne network public http://controller:9696
openstack endpoint create --region RegionOne network internal http://controller:9696
openstack endpoint create --region RegionOne network admin http://controller:9696
</code></pre></div></li>
</ol>
<h3 id="安装并配置neutron服务">
  安装并配置neutron服务
  <a class="heading-link" href="#%e5%ae%89%e8%a3%85%e5%b9%b6%e9%85%8d%e7%bd%aeneutron%e6%9c%8d%e5%8a%a1">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h3>
<ol>
<li>
<p>安装neutron相关软件包</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">yum install openstack-neutron openstack-neutron-ml2 openstack-neutron-openvswitch python-neutronclient openstack-neutron-fwaas -y
</code></pre></div></li>
<li>
<p>修改配置文件</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">cat &gt; /etc/neutron/neutron.conf <span style="color:#0ff;font-weight:bold">&lt;&lt;EOF
</span><span style="color:#0ff;font-weight:bold">[database]
</span><span style="color:#0ff;font-weight:bold">connection = mysql+pymysql://neutron:NEUTRON_DBPASS@controller/neutron
</span><span style="color:#0ff;font-weight:bold">   
</span><span style="color:#0ff;font-weight:bold">[DEFAULT]
</span><span style="color:#0ff;font-weight:bold">core_plugin = ml2
</span><span style="color:#0ff;font-weight:bold">service_plugins =
</span><span style="color:#0ff;font-weight:bold">transport_url = rabbit://openstack:RABBIT_PASS@controller
</span><span style="color:#0ff;font-weight:bold">auth_strategy = keystone
</span><span style="color:#0ff;font-weight:bold">notify_nova_on_port_status_changes = true
</span><span style="color:#0ff;font-weight:bold">notify_nova_on_port_data_changes = true
</span><span style="color:#0ff;font-weight:bold">   
</span><span style="color:#0ff;font-weight:bold">[keystone_authtoken]
</span><span style="color:#0ff;font-weight:bold">www_authenticate_uri = http://controller:5000
</span><span style="color:#0ff;font-weight:bold">auth_url = http://controller:5000
</span><span style="color:#0ff;font-weight:bold">memcached_servers = controller:11211
</span><span style="color:#0ff;font-weight:bold">auth_type = password
</span><span style="color:#0ff;font-weight:bold">project_domain_name = default
</span><span style="color:#0ff;font-weight:bold">user_domain_name = default
</span><span style="color:#0ff;font-weight:bold">project_name = service
</span><span style="color:#0ff;font-weight:bold">username = neutron
</span><span style="color:#0ff;font-weight:bold">password = NEUTRON_PASS
</span><span style="color:#0ff;font-weight:bold">   
</span><span style="color:#0ff;font-weight:bold">[nova]
</span><span style="color:#0ff;font-weight:bold">auth_url = http://controller:5000
</span><span style="color:#0ff;font-weight:bold">auth_type = password
</span><span style="color:#0ff;font-weight:bold">project_domain_name = default
</span><span style="color:#0ff;font-weight:bold">user_domain_name = default
</span><span style="color:#0ff;font-weight:bold">region_name = RegionOne
</span><span style="color:#0ff;font-weight:bold">project_name = service
</span><span style="color:#0ff;font-weight:bold">username = nova
</span><span style="color:#0ff;font-weight:bold">password = NOVA_PASS
</span><span style="color:#0ff;font-weight:bold">   
</span><span style="color:#0ff;font-weight:bold">[oslo_concurrency]
</span><span style="color:#0ff;font-weight:bold">lock_path = /var/lib/neutron/tmp
</span><span style="color:#0ff;font-weight:bold">EOF</span>
</code></pre></div></li>
<li>
<p>配置ML2组件</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">cat &gt; /etc/neutron/plugins/ml2/ml2_conf.ini <span style="color:#0ff;font-weight:bold">&lt;&lt;EOF
</span><span style="color:#0ff;font-weight:bold">[ml2]
</span><span style="color:#0ff;font-weight:bold">type_drivers = flat,vlan
</span><span style="color:#0ff;font-weight:bold">tenant_network_types = vlan
</span><span style="color:#0ff;font-weight:bold">mechanism_drivers = openvswitch
</span><span style="color:#0ff;font-weight:bold">debug=True
</span><span style="color:#0ff;font-weight:bold">[ml2_type_flat]
</span><span style="color:#0ff;font-weight:bold">[ml2_type_vlan]
</span><span style="color:#0ff;font-weight:bold">network_vlan_ranges =physnet1:1000:1999,physnet2
</span><span style="color:#0ff;font-weight:bold">[ml2_type_vxlan]
</span><span style="color:#0ff;font-weight:bold">[securitygroup]
</span><span style="color:#0ff;font-weight:bold">enable_security_group = True
</span><span style="color:#0ff;font-weight:bold">enable_ipset = True
</span><span style="color:#0ff;font-weight:bold">firewall_driver = neutron.agent.linux.iptables_firewall.OVSHybridIptablesFirewallDriver
</span><span style="color:#0ff;font-weight:bold">[ovs]
</span><span style="color:#0ff;font-weight:bold">tenant_network_type = vlan
</span><span style="color:#0ff;font-weight:bold">bridge_mappings = physnet1:br-vlan,physnet2:br-ex
</span><span style="color:#0ff;font-weight:bold">EOF</span>
</code></pre></div></li>
<li>
<p>配置L3代理商</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">cat&gt; /etc/neutron/l3_agent.ini<span style="color:#0ff;font-weight:bold">&lt;&lt;EOF
</span><span style="color:#0ff;font-weight:bold">[DEFAULT]
</span><span style="color:#0ff;font-weight:bold">interface_driver = neutron.agent.linux.interface.OVSInterfaceDriver
</span><span style="color:#0ff;font-weight:bold">router_delete_namespaces = True
</span><span style="color:#0ff;font-weight:bold">external_network_bridge =
</span><span style="color:#0ff;font-weight:bold">verbose = True
</span><span style="color:#0ff;font-weight:bold">[fwaas]
</span><span style="color:#0ff;font-weight:bold">driver=neutron_fwaas.services.firewall.drivers.linux.iptables_fwaas.IptablesFwaasDriver
</span><span style="color:#0ff;font-weight:bold">enabled = True
</span><span style="color:#0ff;font-weight:bold">[agent]
</span><span style="color:#0ff;font-weight:bold">extensions = fwaas
</span><span style="color:#0ff;font-weight:bold">[ovs]
</span><span style="color:#0ff;font-weight:bold">EOF</span>
</code></pre></div></li>
<li>
<p>配置DHCP代理商</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">cat&gt;/etc/neutron/dhcp_agent.ini<span style="color:#0ff;font-weight:bold">&lt;&lt;EOF
</span><span style="color:#0ff;font-weight:bold">[DEFAULT]
</span><span style="color:#0ff;font-weight:bold">debug=True
</span><span style="color:#0ff;font-weight:bold">interface_driver = neutron.agent.linux.interface.OVSInterfaceDriver
</span><span style="color:#0ff;font-weight:bold">dhcp_driver = neutron.agent.linux.dhcp.Dnsmasq
</span><span style="color:#0ff;font-weight:bold">enable_isolated_metadata = True
</span><span style="color:#0ff;font-weight:bold">dnsmasq_config_file = /etc/neutron/dnsmasq-neutron.conf
</span><span style="color:#0ff;font-weight:bold">EOF</span>
   
<span style="color:#fff;font-weight:bold">echo</span> <span style="color:#0ff;font-weight:bold">&#34;dhcp-option-force=26,1454&#34;</span> &gt;/etc/neutron/dnsmasq-neutron.conf
</code></pre></div></li>
<li>
<p>配置metadata代理器</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">cat&gt; /etc/neutron/metadata_agent.ini <span style="color:#0ff;font-weight:bold">&lt;&lt;EOF
</span><span style="color:#0ff;font-weight:bold">[DEFAULT]
</span><span style="color:#0ff;font-weight:bold">nova_metadata_host = controller
</span><span style="color:#0ff;font-weight:bold">metadata_proxy_shared_secret = METADATA_SECRET
</span><span style="color:#0ff;font-weight:bold">memcache_servers = controller:11211
</span><span style="color:#0ff;font-weight:bold">EOF</span>
</code></pre></div></li>
<li>
<p>配置OVS组件</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">cat &gt; /etc/neutron/plugins/ml2/openvswitch_agent.ini <span style="color:#0ff;font-weight:bold">&lt;&lt;EOF
</span><span style="color:#0ff;font-weight:bold">[DEFAULT]
</span><span style="color:#0ff;font-weight:bold">[agent]
</span><span style="color:#0ff;font-weight:bold">[ovs]
</span><span style="color:#0ff;font-weight:bold">bridge_mappings = physnet1:br-vlan,physnet2:br-ex
</span><span style="color:#0ff;font-weight:bold">[securitygroup]
</span><span style="color:#0ff;font-weight:bold">firewall_driver=neutron.agent.linux.iptables_firewall.OVSHybridIptablesFirewallDriver
</span><span style="color:#0ff;font-weight:bold">enable_security_group=true
</span><span style="color:#0ff;font-weight:bold">[xenapi]
</span><span style="color:#0ff;font-weight:bold">EOF</span>
</code></pre></div><p>配置OVS交换机</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">systemctl <span style="color:#fff;font-weight:bold">enable</span> openvswitch.service --now
systemctl status openvswitch.service
<span style="color:#007f7f"># 用于联通虚拟机的网桥</span>
ovs-vsctl add-br br-vlan
ovs-vsctl add-port br-vlan eth1
<span style="color:#007f7f"># 用于联通外部网络的网桥</span>
ovs-vsctl add-br br-ex
ovs-vsctl add-port br-ex eth2
</code></pre></div></li>
<li>
<p>配置软链接</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ln -s /etc/neutron/plugins/ml2/ml2_conf.ini /etc/neutron/plugin.ini
</code></pre></div></li>
<li>
<p>启动相关服务</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">systemctl <span style="color:#fff;font-weight:bold">enable</span> neutron-openvswitch-agent neutron-l3-agent neutron-dhcp-agent neutron-metadata-agent neutron-ovs-cleanup openvswitch
systemctl start neutron-openvswitch-agent neutron-l3-agent neutron-dhcp-agent neutron-metadata-agent openvswitch
systemctl status neutron-openvswitch-agent neutron-l3-agent neutron-dhcp-agent neutron-metadata-agent openvswitch
</code></pre></div></li>
<li>
<p>测试</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">. admin-openrc
openstack network agent list
</code></pre></div></li>
<li>
<p>创建提供商网络（外部网络）</p>
<p><code>provider-physical-network</code>表示使用的物理网络，与网络节点<code>/etc/neutron/plugin.ini</code>中的配置一致。</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">. admin-openrc
<span style="color:#007f7f"># 添加默认的端口安全组规则</span>
openstack security group rule create --proto icmp default
openstack security group rule create --proto tcp --dst-port <span style="color:#ff0;font-weight:bold">22</span> default
openstack security group rule create --proto tcp --dst-port <span style="color:#ff0;font-weight:bold">3389</span> default
openstack security group rule create --proto tcp --dst-port <span style="color:#ff0;font-weight:bold">80</span> default
openstack security group rule create --proto tcp --dst-port <span style="color:#ff0;font-weight:bold">443</span> default
openstack security group rule create --proto tcp --dst-port <span style="color:#ff0;font-weight:bold">123</span> default
openstack security group rule create --proto tcp --dst-port <span style="color:#ff0;font-weight:bold">53</span> default
openstack security group rule create --proto udp --dst-port <span style="color:#ff0;font-weight:bold">123</span> default
openstack security group rule create --proto udp --dst-port <span style="color:#ff0;font-weight:bold">53</span> default
    
openstack network create  --share --external <span style="color:#0ff;font-weight:bold">\
</span><span style="color:#0ff;font-weight:bold"></span>  --provider-physical-network physnet2 <span style="color:#0ff;font-weight:bold">\
</span><span style="color:#0ff;font-weight:bold"></span>  --provider-network-type flat provider
    
<span style="color:#007f7f"># 子网需要与真实环境一致</span>
openstack subnet create --network provider <span style="color:#0ff;font-weight:bold">\
</span><span style="color:#0ff;font-weight:bold"></span>  --allocation-pool start=192.168.68.10,end=192.168.68.250 <span style="color:#0ff;font-weight:bold">\
</span><span style="color:#0ff;font-weight:bold"></span>  --dns-nameserver 1.2.4.8 --gateway 192.168.68.1 <span style="color:#0ff;font-weight:bold">\
</span><span style="color:#0ff;font-weight:bold"></span>  --subnet-range 192.168.68.0/24 provider
</code></pre></div></li>
</ol>
<h1 id="计算节点">
  计算节点
  <a class="heading-link" href="#%e8%ae%a1%e7%ae%97%e8%8a%82%e7%82%b9">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h1>
<h3 id="安装nova组件">
  安装nova组件
  <a class="heading-link" href="#%e5%ae%89%e8%a3%85nova%e7%bb%84%e4%bb%b6">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h3>
<ol>
<li>
<p>安装软件包</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">yum install openstack-nova-compute -y
</code></pre></div></li>
<li>
<p>修改配置文件</p>
<blockquote>
<p>需手动修改vnc下的novncproxy_base_url</p>
</blockquote>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">cat &gt; /etc/nova/nova.conf <span style="color:#0ff;font-weight:bold">&lt;&lt;EOF
</span><span style="color:#0ff;font-weight:bold">[DEFAULT]
</span><span style="color:#0ff;font-weight:bold">enabled_apis = osapi_compute,metadata
</span><span style="color:#0ff;font-weight:bold">transport_url = rabbit://openstack:RABBIT_PASS@controller
</span><span style="color:#0ff;font-weight:bold">my_ip = 172.16.10.101
</span><span style="color:#0ff;font-weight:bold">   
</span><span style="color:#0ff;font-weight:bold">[api]
</span><span style="color:#0ff;font-weight:bold">auth_strategy = keystone
</span><span style="color:#0ff;font-weight:bold">   
</span><span style="color:#0ff;font-weight:bold">[keystone_authtoken]
</span><span style="color:#0ff;font-weight:bold">www_authenticate_uri = http://controller:5000/
</span><span style="color:#0ff;font-weight:bold">auth_url = http://controller:5000/
</span><span style="color:#0ff;font-weight:bold">memcached_servers = controller:11211
</span><span style="color:#0ff;font-weight:bold">auth_type = password
</span><span style="color:#0ff;font-weight:bold">project_domain_name = Default
</span><span style="color:#0ff;font-weight:bold">user_domain_name = Default
</span><span style="color:#0ff;font-weight:bold">project_name = service
</span><span style="color:#0ff;font-weight:bold">username = nova
</span><span style="color:#0ff;font-weight:bold">password = NOVA_PASS
</span><span style="color:#0ff;font-weight:bold">   
</span><span style="color:#0ff;font-weight:bold">[neutron]
</span><span style="color:#0ff;font-weight:bold">auth_url = http://controller:5000
</span><span style="color:#0ff;font-weight:bold">auth_type = password
</span><span style="color:#0ff;font-weight:bold">project_domain_name = default
</span><span style="color:#0ff;font-weight:bold">user_domain_name = default
</span><span style="color:#0ff;font-weight:bold">region_name = RegionOne
</span><span style="color:#0ff;font-weight:bold">project_name = service
</span><span style="color:#0ff;font-weight:bold">username = neutron
</span><span style="color:#0ff;font-weight:bold">password = NEUTRON_PASS
</span><span style="color:#0ff;font-weight:bold">service_metadata_proxy = true
</span><span style="color:#0ff;font-weight:bold">metadata_proxy_shared_secret = METADATA_SECRET
</span><span style="color:#0ff;font-weight:bold">   
</span><span style="color:#0ff;font-weight:bold">[vnc]
</span><span style="color:#0ff;font-weight:bold">enabled = true
</span><span style="color:#0ff;font-weight:bold">server_listen = 0.0.0.0
</span><span style="color:#0ff;font-weight:bold">server_proxyclient_address = $my_ip
</span><span style="color:#0ff;font-weight:bold">novncproxy_base_url = http://172.16.10.100:6080/vnc_auto.html
</span><span style="color:#0ff;font-weight:bold">   
</span><span style="color:#0ff;font-weight:bold">[glance]
</span><span style="color:#0ff;font-weight:bold">api_servers = http://controller:9292
</span><span style="color:#0ff;font-weight:bold">   
</span><span style="color:#0ff;font-weight:bold">[oslo_concurrency]
</span><span style="color:#0ff;font-weight:bold">lock_path = /var/lib/nova/tmp
</span><span style="color:#0ff;font-weight:bold">   
</span><span style="color:#0ff;font-weight:bold">[placement]
</span><span style="color:#0ff;font-weight:bold">region_name = RegionOne
</span><span style="color:#0ff;font-weight:bold">project_domain_name = Default
</span><span style="color:#0ff;font-weight:bold">project_name = service
</span><span style="color:#0ff;font-weight:bold">auth_type = password
</span><span style="color:#0ff;font-weight:bold">user_domain_name = Default
</span><span style="color:#0ff;font-weight:bold">auth_url = http://controller:5000/v3
</span><span style="color:#0ff;font-weight:bold">username = placement
</span><span style="color:#0ff;font-weight:bold">password = PLACEMENT_PASS
</span><span style="color:#0ff;font-weight:bold">   
</span><span style="color:#0ff;font-weight:bold">[libvirt]
</span><span style="color:#0ff;font-weight:bold">virt_type=qemu
</span><span style="color:#0ff;font-weight:bold">EOF</span>
</code></pre></div></li>
<li>
<p>启动服务</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">systemctl <span style="color:#fff;font-weight:bold">enable</span> libvirtd.service openstack-nova-compute.service --now
systemctl status libvirtd.service openstack-nova-compute.service
</code></pre></div></li>
<li>
<p>控制端验证nova节点信息</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">. admin-openrc
su -s /bin/sh -c <span style="color:#0ff;font-weight:bold">&#34;nova-manage cell_v2 discover_hosts --verbose&#34;</span> nova
openstack hypervisor list
openstack compute service list
openstack catalog list
nova-status upgrade check
</code></pre></div></li>
</ol>
<h3 id="安装neutron组件">
  安装neutron组件
  <a class="heading-link" href="#%e5%ae%89%e8%a3%85neutron%e7%bb%84%e4%bb%b6">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h3>
<ol>
<li>
<p>安装软件包</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">yum install -y openstack-neutron openstack-neutron-ml2 openstack-neutron-openvswitch
</code></pre></div></li>
<li>
<p>修改配置文件</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">cat &gt; /etc/neutron/neutron.conf <span style="color:#0ff;font-weight:bold">&lt;&lt;EOF
</span><span style="color:#0ff;font-weight:bold">[DEFAULT]
</span><span style="color:#0ff;font-weight:bold">transport_url = rabbit://openstack:RABBIT_PASS@controller
</span><span style="color:#0ff;font-weight:bold">auth_strategy = keystone
</span><span style="color:#0ff;font-weight:bold">   
</span><span style="color:#0ff;font-weight:bold">[keystone_authtoken]
</span><span style="color:#0ff;font-weight:bold">www_authenticate_uri = http://controller:5000
</span><span style="color:#0ff;font-weight:bold">auth_url = http://controller:5000
</span><span style="color:#0ff;font-weight:bold">memcached_servers = controller:11211
</span><span style="color:#0ff;font-weight:bold">auth_type = password
</span><span style="color:#0ff;font-weight:bold">project_domain_name = default
</span><span style="color:#0ff;font-weight:bold">user_domain_name = default
</span><span style="color:#0ff;font-weight:bold">project_name = service
</span><span style="color:#0ff;font-weight:bold">username = neutron
</span><span style="color:#0ff;font-weight:bold">password = NEUTRON_PASS
</span><span style="color:#0ff;font-weight:bold">   
</span><span style="color:#0ff;font-weight:bold">[oslo_concurrency]
</span><span style="color:#0ff;font-weight:bold">lock_path = /var/lib/neutron/tmp
</span><span style="color:#0ff;font-weight:bold">EOF</span>
</code></pre></div></li>
<li>
<p>配置OVS网桥</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">systemctl <span style="color:#fff;font-weight:bold">enable</span> openvswitch --now
systemctl status openvswitch
ovs-vsctl add-br br-vlan
ovs-vsctl add-port br-vlan eth1
</code></pre></div></li>
<li>
<p>配置neutron ovs组件</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">cat&gt;/etc/neutron/plugins/ml2/openvswitch_agent.ini<span style="color:#0ff;font-weight:bold">&lt;&lt;EOF
</span><span style="color:#0ff;font-weight:bold">[DEFAULT]
</span><span style="color:#0ff;font-weight:bold">[agent]
</span><span style="color:#0ff;font-weight:bold">[ovs]
</span><span style="color:#0ff;font-weight:bold">bridge_mappings = physnet1:br-vlan
</span><span style="color:#0ff;font-weight:bold">[securitygroup]
</span><span style="color:#0ff;font-weight:bold">firewall_driver=neutron.agent.linux.iptables_firewall.OVSHybridIptablesFirewallDriver
</span><span style="color:#0ff;font-weight:bold">enable_security_group=True
</span><span style="color:#0ff;font-weight:bold">[xenapi]
</span><span style="color:#0ff;font-weight:bold">EOF</span>
</code></pre></div></li>
<li>
<p>启动服务</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#007f7f"># 重启nova-compute</span>
systemctl restart openstack-nova-compute
systemctl <span style="color:#fff;font-weight:bold">enable</span> neutron-openvswitch-agent --now
systemctl status neutron-openvswitch-agent
</code></pre></div></li>
</ol>
<h2 id="访问dashboard">
  访问dashboard
  <a class="heading-link" href="#%e8%ae%bf%e9%97%aedashboard">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h2>
<p>使用浏览器访问 http://172.16.10.100/dashboard，使用admin/ADMIN_PASS登录系统。</p>

      </div>


      <footer>
        


        
        
        <script src="https://utteranc.es/client.js"
    repo= "dushixiang/hugo-comment"
    issue-term="pathname"
    label="评论"
    theme="github-light"
    crossorigin="anonymous"
    async>
  </script>
      </footer>
    </article>

    
  </section>

      </div>

      
  <footer class="footer">
    <section class="container">
      
        <p><a href='https://beian.miit.gov.cn/'>豫ICP备16012145号-3</a></p>
      
      
        ©
        
          2020 -
        
        2021
         dushixiang 
      
      
         · 
         <a href="https://gohugo.io/">Hugo</a> & <a href="https://github.com/luizdepra/hugo-coder/">Coder</a>.
      
      
        
      
    </section>
  </footer>


    </main>

    
      
        
        <script src="/js/dark-mode.min.aee9c8a464eb7b3534c7110f7c5e169e7039e2fd92710e0626d451d6725af137.js" integrity="sha256-runIpGTrezU0xxEPfF4WnnA54v2ScQ4GJtRR1nJa8Tc="></script>
      
    

    

    

    

    

    

    

    

    
  </body>

</html>
