<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Linux Bridge 详解
Linux Bridge（网桥）是用纯软件实现的虚拟交换机，有着和物理交换机相同的功能，例如二层交换，MAC地址学习等。因此我们可以把tun/tap，veth pair等设备绑定到网桥上，就像是把设备连接到物理交换机上一样。此外它和veth pair、tun/tap一样，也是一种虚拟网络设备，具有虚拟设备的所有特性，例如配置IP，MAC地址等。
Linux Bridge通常是搭配KVM、docker等虚拟化技术一起使用的，用于构建虚拟网络，因为此教程不涉及虚拟化技术，我们就使用前面学习过的netns来模拟虚拟设备。
如何使用Linux Bridge？
操作网桥有多种方式，在这里我们介绍一下通过bridge-utils来操作，由于它不是Linux系统自带的工具，因此需要我们手动来安装它。
# centos
yum install -y bridge-utils
# ubuntu
apt-get install -y bridge-utils
使用brctl help查看使用帮助
never heard of command [help]
Usage: brctl [commands]
commands:
	addbr     	<bridge>		add bridge
	delbr     	<bridge>		delete bridge
	addif     	<bridge> <device>	add interface to bridge
	delif     	<bridge> <device>	delete interface from bridge
	hairpin   	<bridge> <port> {on|off}	turn hairpin on/off
	setageing 	<bridge> <time>		set ageing time
	setbridgeprio	<bridge> <prio>		set bridge priority
	setfd     	<bridge> <time>		set bridge forward delay
	sethello  	<bridge> <time>		set hello time
	setmaxage 	<bridge> <time>		set max message age
	setpathcost	<bridge> <port> <cost>	set path cost
	setportprio	<bridge> <port> <prio>	set port priority
	show      	[ <bridge> ]		show a list of bridges
	showmacs  	<bridge>		show a list of mac addrs
	showstp   	<bridge>		show bridge stp info
	stp       	<bridge> {on|off}	turn stp on/off
常用命令如"><title>Linux Bridge 详解</title><link rel="shortcut icon" type=image/x-icon href=/><link rel=stylesheet href=/css/main.0568d3f70e9896300444ff10565468b82c2dace6b1b82bc72fba6ae51bfb0849887e0eb4ccb3cdb1c915fbe68c7000fbea631be9322fd5d0bcab56732ce7293f.css integrity="sha512-BWjT9w6YljAERP8QVlRouCwtrOaxuCvHL7pq5Rv7CEmIfg60zLPNsckV++aMcAD76mMb6TIv1dC8q1ZzLOcpPw=="></head><body a=auto><main class=page-content aria-label=Content><div class=w><div class=post-meta><a href=/>..</a><p><time datetime="2020-11-13 21:47:00 +0000 UTC">2020-11-13</time></p></div><article><h1>Linux Bridge 详解</h1><h1 id=linux-bridge-详解>Linux Bridge 详解</h1><p>Linux Bridge（网桥）是用纯软件实现的虚拟交换机，有着和物理交换机相同的功能，例如二层交换，MAC地址学习等。因此我们可以把tun/tap，veth pair等设备绑定到网桥上，就像是把设备连接到物理交换机上一样。此外它和veth pair、tun/tap一样，也是一种虚拟网络设备，具有虚拟设备的所有特性，例如配置IP，MAC地址等。</p><p>Linux Bridge通常是搭配KVM、docker等虚拟化技术一起使用的，用于构建虚拟网络，因为此教程不涉及虚拟化技术，我们就使用前面学习过的netns来模拟虚拟设备。</p><h2 id=如何使用linux-bridge>如何使用Linux Bridge？</h2><p>操作网桥有多种方式，在这里我们介绍一下通过<strong>bridge-utils</strong>来操作，由于它不是Linux系统自带的工具，因此需要我们手动来安装它。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#6272a4># centos</span>
</span></span><span style=display:flex><span>yum install -y bridge-utils
</span></span><span style=display:flex><span><span style=color:#6272a4># ubuntu</span>
</span></span><span style=display:flex><span>apt-get install -y bridge-utils
</span></span></code></pre></div><p>使用<code>brctl help</code>查看使用帮助</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>never heard of <span style=color:#8be9fd;font-style:italic>command</span> <span style=color:#ff79c6>[</span>help<span style=color:#ff79c6>]</span>
</span></span><span style=display:flex><span>Usage: brctl <span style=color:#ff79c6>[</span>commands<span style=color:#ff79c6>]</span>
</span></span><span style=display:flex><span>commands:
</span></span><span style=display:flex><span>	addbr     	&lt;bridge&gt;		add bridge
</span></span><span style=display:flex><span>	delbr     	&lt;bridge&gt;		delete bridge
</span></span><span style=display:flex><span>	addif     	&lt;bridge&gt; &lt;device&gt;	add interface to bridge
</span></span><span style=display:flex><span>	delif     	&lt;bridge&gt; &lt;device&gt;	delete interface from bridge
</span></span><span style=display:flex><span>	hairpin   	&lt;bridge&gt; &lt;port&gt; <span style=color:#ff79c6>{</span>on|off<span style=color:#ff79c6>}</span>	turn hairpin on/off
</span></span><span style=display:flex><span>	setageing 	&lt;bridge&gt; &lt;time&gt;		<span style=color:#8be9fd;font-style:italic>set</span> ageing <span style=color:#8be9fd;font-style:italic>time</span>
</span></span><span style=display:flex><span>	setbridgeprio	&lt;bridge&gt; &lt;prio&gt;		<span style=color:#8be9fd;font-style:italic>set</span> bridge priority
</span></span><span style=display:flex><span>	setfd     	&lt;bridge&gt; &lt;time&gt;		<span style=color:#8be9fd;font-style:italic>set</span> bridge forward delay
</span></span><span style=display:flex><span>	sethello  	&lt;bridge&gt; &lt;time&gt;		<span style=color:#8be9fd;font-style:italic>set</span> hello <span style=color:#8be9fd;font-style:italic>time</span>
</span></span><span style=display:flex><span>	setmaxage 	&lt;bridge&gt; &lt;time&gt;		<span style=color:#8be9fd;font-style:italic>set</span> max message age
</span></span><span style=display:flex><span>	setpathcost	&lt;bridge&gt; &lt;port&gt; &lt;cost&gt;	<span style=color:#8be9fd;font-style:italic>set</span> path cost
</span></span><span style=display:flex><span>	setportprio	&lt;bridge&gt; &lt;port&gt; &lt;prio&gt;	<span style=color:#8be9fd;font-style:italic>set</span> port priority
</span></span><span style=display:flex><span>	show      	<span style=color:#ff79c6>[</span> &lt;bridge&gt; <span style=color:#ff79c6>]</span>		show a list of bridges
</span></span><span style=display:flex><span>	showmacs  	&lt;bridge&gt;		show a list of mac addrs
</span></span><span style=display:flex><span>	showstp   	&lt;bridge&gt;		show bridge stp info
</span></span><span style=display:flex><span>	stp       	&lt;bridge&gt; <span style=color:#ff79c6>{</span>on|off<span style=color:#ff79c6>}</span>	turn stp on/off
</span></span></code></pre></div><p>常用命令如</p><p>新建一个网桥：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>brctl addbr &lt;bridge&gt;
</span></span></code></pre></div><p>添加一个设备（例如<code>eth0</code>）到网桥：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>brctl addif &lt;bridge&gt; eth0
</span></span></code></pre></div><p>显示当前存在的网桥及其所连接的网络端口：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>brctl show
</span></span></code></pre></div><p>启动网桥：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ip link <span style=color:#8be9fd;font-style:italic>set</span> &lt;bridge&gt; up
</span></span></code></pre></div><p>删除网桥，需要先关闭它：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ip link <span style=color:#8be9fd;font-style:italic>set</span> &lt;bridge&gt; down
</span></span><span style=display:flex><span>brctl delbr &lt;bridge&gt;
</span></span></code></pre></div><p>或者使用<code>ip link del</code> 命令直接删除网桥</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ip link del &lt;bridge&gt;
</span></span></code></pre></div><blockquote><p>增加Linux Bridge时会自动增加一个同名虚拟网卡在宿主机器上，因此我们可以通过<code>ip link</code>命令操作这个虚拟网卡，实际上也就是操作网桥，并且只有当这个虚拟网卡状态处于<strong>up</strong>的时候，网桥才会转发数据。</p></blockquote><h2 id=实验>实验</h2><p>在上一节《Linux veth pair详解》我们使用veth pair将两个隔离的netns连接在了一起，在现实世界里等同于用一根网线把两台电脑连接在了一起，但是在现实世界里往往很少会有人这样使用。因为一台设备不仅仅只需要和另一台设备通信，它需要和很多很多的网络设备进行通信，如果还使用这样的方式，需要十分复杂的网络接线，并且现实世界中的普通网络设备也没有那么多网络接口。</p><p>那么，想要让某一台设备和很多网络设备都可以通信需要如何去做呢？在我们的日常生活中，除了手机和电脑，最常见的网络设备就是路由器了，我们的手机连上WI-FI，电脑插到路由器上，等待从路由器的DHCP服务器上获取到IP，他们就可以相互通信了，这便是路由器的二层交换功能在工作。Linux Bridge最主要的功能就是二层交换，是对现实世界二层交换机的模拟，我们稍微改动一下网络拓扑，如下图：</p><p><img src=https://oss.typesafe.cn/bridge0.png alt=bridge></p><p>我们建立了一个网桥，三个netns，三对veth pair，分别一端在netns中，另一端连接在网桥上，为了简化拓扑，我去除了netns中的tap设备，将IP直接配置在veth上。</p><blockquote><p>veth设备不仅仅可以可以充当“网线”，同时它也可以当作虚拟网卡来使用。</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#6272a4># 添加网桥</span>
</span></span><span style=display:flex><span>brctl addbr br0
</span></span><span style=display:flex><span><span style=color:#6272a4># 启动网桥</span>
</span></span><span style=display:flex><span>ip link <span style=color:#8be9fd;font-style:italic>set</span> br0 up
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4># 新增三个netns</span>
</span></span><span style=display:flex><span>ip netns add ns0
</span></span><span style=display:flex><span>ip netns add ns1
</span></span><span style=display:flex><span>ip netns add ns2
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4># 新增两对veth</span>
</span></span><span style=display:flex><span>ip link add veth0-ns <span style=color:#8be9fd;font-style:italic>type</span> veth peer name veth0-br
</span></span><span style=display:flex><span>ip link add veth1-ns <span style=color:#8be9fd;font-style:italic>type</span> veth peer name veth1-br
</span></span><span style=display:flex><span>ip link add veth2-ns <span style=color:#8be9fd;font-style:italic>type</span> veth peer name veth2-br
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4># 将veth的一端移动到netns中</span>
</span></span><span style=display:flex><span>ip link <span style=color:#8be9fd;font-style:italic>set</span> veth0-ns netns ns0
</span></span><span style=display:flex><span>ip link <span style=color:#8be9fd;font-style:italic>set</span> veth1-ns netns ns1
</span></span><span style=display:flex><span>ip link <span style=color:#8be9fd;font-style:italic>set</span> veth2-ns netns ns2
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4># 将netns中的本地环回和veth启动并配置IP</span>
</span></span><span style=display:flex><span>ip netns <span style=color:#8be9fd;font-style:italic>exec</span> ns0 ip link <span style=color:#8be9fd;font-style:italic>set</span> lo up
</span></span><span style=display:flex><span>ip netns <span style=color:#8be9fd;font-style:italic>exec</span> ns0 ip link <span style=color:#8be9fd;font-style:italic>set</span> veth0-ns up
</span></span><span style=display:flex><span>ip netns <span style=color:#8be9fd;font-style:italic>exec</span> ns0 ip addr add 10.0.0.1/24 dev veth0-ns
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ip netns <span style=color:#8be9fd;font-style:italic>exec</span> ns1 ip link <span style=color:#8be9fd;font-style:italic>set</span> lo up
</span></span><span style=display:flex><span>ip netns <span style=color:#8be9fd;font-style:italic>exec</span> ns1 ip link <span style=color:#8be9fd;font-style:italic>set</span> veth1-ns up
</span></span><span style=display:flex><span>ip netns <span style=color:#8be9fd;font-style:italic>exec</span> ns1 ip addr add 10.0.0.2/24 dev veth1-ns
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ip netns <span style=color:#8be9fd;font-style:italic>exec</span> ns2 ip link <span style=color:#8be9fd;font-style:italic>set</span> lo up
</span></span><span style=display:flex><span>ip netns <span style=color:#8be9fd;font-style:italic>exec</span> ns2 ip link <span style=color:#8be9fd;font-style:italic>set</span> veth2-ns up
</span></span><span style=display:flex><span>ip netns <span style=color:#8be9fd;font-style:italic>exec</span> ns2 ip addr add 10.0.0.3/24 dev veth2-ns
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4># 将veth的另一端启动并挂载到网桥上</span>
</span></span><span style=display:flex><span>ip link <span style=color:#8be9fd;font-style:italic>set</span> veth0-br up
</span></span><span style=display:flex><span>ip link <span style=color:#8be9fd;font-style:italic>set</span> veth1-br up
</span></span><span style=display:flex><span>ip link <span style=color:#8be9fd;font-style:italic>set</span> veth2-br up
</span></span><span style=display:flex><span>brctl addif br0 veth0-br
</span></span><span style=display:flex><span>brctl addif br0 veth1-br
</span></span><span style=display:flex><span>brctl addif br0 veth2-br
</span></span></code></pre></div><p>测试网络连通性</p><p>使用<code>ip netns exec ns0 ping 10.0.0.2</code>在命名空间ns0中测试与ns1的10.0.0.2的网络连通性</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>PING 10.0.0.2 <span style=color:#ff79c6>(</span>10.0.0.2<span style=color:#ff79c6>)</span> 56<span style=color:#ff79c6>(</span>84<span style=color:#ff79c6>)</span> bytes of data.
</span></span><span style=display:flex><span><span style=color:#bd93f9>64</span> bytes from 10.0.0.2: <span style=color:#8be9fd;font-style:italic>icmp_seq</span><span style=color:#ff79c6>=</span><span style=color:#bd93f9>1</span> <span style=color:#8be9fd;font-style:italic>ttl</span><span style=color:#ff79c6>=</span><span style=color:#bd93f9>64</span> <span style=color:#8be9fd;font-style:italic>time</span><span style=color:#ff79c6>=</span>0.032 ms
</span></span><span style=display:flex><span><span style=color:#bd93f9>64</span> bytes from 10.0.0.2: <span style=color:#8be9fd;font-style:italic>icmp_seq</span><span style=color:#ff79c6>=</span><span style=color:#bd93f9>2</span> <span style=color:#8be9fd;font-style:italic>ttl</span><span style=color:#ff79c6>=</span><span style=color:#bd93f9>64</span> <span style=color:#8be9fd;font-style:italic>time</span><span style=color:#ff79c6>=</span>0.058 ms
</span></span><span style=display:flex><span><span style=color:#bd93f9>64</span> bytes from 10.0.0.2: <span style=color:#8be9fd;font-style:italic>icmp_seq</span><span style=color:#ff79c6>=</span><span style=color:#bd93f9>3</span> <span style=color:#8be9fd;font-style:italic>ttl</span><span style=color:#ff79c6>=</span><span style=color:#bd93f9>64</span> <span style=color:#8be9fd;font-style:italic>time</span><span style=color:#ff79c6>=</span>0.052 ms
</span></span><span style=display:flex><span><span style=color:#bd93f9>64</span> bytes from 10.0.0.2: <span style=color:#8be9fd;font-style:italic>icmp_seq</span><span style=color:#ff79c6>=</span><span style=color:#bd93f9>4</span> <span style=color:#8be9fd;font-style:italic>ttl</span><span style=color:#ff79c6>=</span><span style=color:#bd93f9>64</span> <span style=color:#8be9fd;font-style:italic>time</span><span style=color:#ff79c6>=</span>0.044 ms
</span></span><span style=display:flex><span>^C
</span></span><span style=display:flex><span>--- 10.0.0.2 ping statistics ---
</span></span><span style=display:flex><span><span style=color:#bd93f9>4</span> packets transmitted, <span style=color:#bd93f9>4</span> received, 0% packet loss, <span style=color:#8be9fd;font-style:italic>time</span> 54ms
</span></span><span style=display:flex><span>rtt min/avg/max/mdev <span style=color:#ff79c6>=</span> 0.032/0.046/0.058/0.011 ms
</span></span></code></pre></div><p>使用<code>ip netns exec ns0 ping 10.0.0.3</code>在命名空间ns0中测试与ns2的10.0.0.3的网络连通性</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>PING 10.0.0.3 <span style=color:#ff79c6>(</span>10.0.0.3<span style=color:#ff79c6>)</span> 56<span style=color:#ff79c6>(</span>84<span style=color:#ff79c6>)</span> bytes of data.
</span></span><span style=display:flex><span><span style=color:#bd93f9>64</span> bytes from 10.0.0.3: <span style=color:#8be9fd;font-style:italic>icmp_seq</span><span style=color:#ff79c6>=</span><span style=color:#bd93f9>1</span> <span style=color:#8be9fd;font-style:italic>ttl</span><span style=color:#ff79c6>=</span><span style=color:#bd93f9>64</span> <span style=color:#8be9fd;font-style:italic>time</span><span style=color:#ff79c6>=</span>0.054 ms
</span></span><span style=display:flex><span><span style=color:#bd93f9>64</span> bytes from 10.0.0.3: <span style=color:#8be9fd;font-style:italic>icmp_seq</span><span style=color:#ff79c6>=</span><span style=color:#bd93f9>2</span> <span style=color:#8be9fd;font-style:italic>ttl</span><span style=color:#ff79c6>=</span><span style=color:#bd93f9>64</span> <span style=color:#8be9fd;font-style:italic>time</span><span style=color:#ff79c6>=</span>0.045 ms
</span></span><span style=display:flex><span><span style=color:#bd93f9>64</span> bytes from 10.0.0.3: <span style=color:#8be9fd;font-style:italic>icmp_seq</span><span style=color:#ff79c6>=</span><span style=color:#bd93f9>3</span> <span style=color:#8be9fd;font-style:italic>ttl</span><span style=color:#ff79c6>=</span><span style=color:#bd93f9>64</span> <span style=color:#8be9fd;font-style:italic>time</span><span style=color:#ff79c6>=</span>0.058 ms
</span></span><span style=display:flex><span><span style=color:#bd93f9>64</span> bytes from 10.0.0.3: <span style=color:#8be9fd;font-style:italic>icmp_seq</span><span style=color:#ff79c6>=</span><span style=color:#bd93f9>4</span> <span style=color:#8be9fd;font-style:italic>ttl</span><span style=color:#ff79c6>=</span><span style=color:#bd93f9>64</span> <span style=color:#8be9fd;font-style:italic>time</span><span style=color:#ff79c6>=</span>0.064 ms
</span></span><span style=display:flex><span>^C
</span></span><span style=display:flex><span>--- 10.0.0.3 ping statistics ---
</span></span><span style=display:flex><span><span style=color:#bd93f9>4</span> packets transmitted, <span style=color:#bd93f9>4</span> received, 0% packet loss, <span style=color:#8be9fd;font-style:italic>time</span> 81ms
</span></span><span style=display:flex><span>rtt min/avg/max/mdev <span style=color:#ff79c6>=</span> 0.045/0.055/0.064/0.008 ms
</span></span></code></pre></div><p>使用<code>ip netns exec ns1 ping 10.0.0.1</code>在命名空间ns1中测试与ns0的10.0.0.1的网络连通性</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>PING 10.0.0.1 <span style=color:#ff79c6>(</span>10.0.0.1<span style=color:#ff79c6>)</span> 56<span style=color:#ff79c6>(</span>84<span style=color:#ff79c6>)</span> bytes of data.
</span></span><span style=display:flex><span><span style=color:#bd93f9>64</span> bytes from 10.0.0.1: <span style=color:#8be9fd;font-style:italic>icmp_seq</span><span style=color:#ff79c6>=</span><span style=color:#bd93f9>1</span> <span style=color:#8be9fd;font-style:italic>ttl</span><span style=color:#ff79c6>=</span><span style=color:#bd93f9>64</span> <span style=color:#8be9fd;font-style:italic>time</span><span style=color:#ff79c6>=</span>0.031 ms
</span></span><span style=display:flex><span><span style=color:#bd93f9>64</span> bytes from 10.0.0.1: <span style=color:#8be9fd;font-style:italic>icmp_seq</span><span style=color:#ff79c6>=</span><span style=color:#bd93f9>2</span> <span style=color:#8be9fd;font-style:italic>ttl</span><span style=color:#ff79c6>=</span><span style=color:#bd93f9>64</span> <span style=color:#8be9fd;font-style:italic>time</span><span style=color:#ff79c6>=</span>0.046 ms
</span></span><span style=display:flex><span><span style=color:#bd93f9>64</span> bytes from 10.0.0.1: <span style=color:#8be9fd;font-style:italic>icmp_seq</span><span style=color:#ff79c6>=</span><span style=color:#bd93f9>3</span> <span style=color:#8be9fd;font-style:italic>ttl</span><span style=color:#ff79c6>=</span><span style=color:#bd93f9>64</span> <span style=color:#8be9fd;font-style:italic>time</span><span style=color:#ff79c6>=</span>0.038 ms
</span></span><span style=display:flex><span><span style=color:#bd93f9>64</span> bytes from 10.0.0.1: <span style=color:#8be9fd;font-style:italic>icmp_seq</span><span style=color:#ff79c6>=</span><span style=color:#bd93f9>4</span> <span style=color:#8be9fd;font-style:italic>ttl</span><span style=color:#ff79c6>=</span><span style=color:#bd93f9>64</span> <span style=color:#8be9fd;font-style:italic>time</span><span style=color:#ff79c6>=</span>0.041 ms
</span></span><span style=display:flex><span>^C
</span></span><span style=display:flex><span>--- 10.0.0.1 ping statistics ---
</span></span><span style=display:flex><span><span style=color:#bd93f9>4</span> packets transmitted, <span style=color:#bd93f9>4</span> received, 0% packet loss, <span style=color:#8be9fd;font-style:italic>time</span> 81ms
</span></span><span style=display:flex><span>rtt min/avg/max/mdev <span style=color:#ff79c6>=</span> 0.031/0.039/0.046/0.005 ms
</span></span></code></pre></div><p>使用<code>ip netns exec ns1 ping 10.0.0.3</code>在命名空间ns1中测试与ns2的10.0.0.3的网络连通性</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>PING 10.0.0.3 <span style=color:#ff79c6>(</span>10.0.0.3<span style=color:#ff79c6>)</span> 56<span style=color:#ff79c6>(</span>84<span style=color:#ff79c6>)</span> bytes of data.
</span></span><span style=display:flex><span><span style=color:#bd93f9>64</span> bytes from 10.0.0.3: <span style=color:#8be9fd;font-style:italic>icmp_seq</span><span style=color:#ff79c6>=</span><span style=color:#bd93f9>1</span> <span style=color:#8be9fd;font-style:italic>ttl</span><span style=color:#ff79c6>=</span><span style=color:#bd93f9>64</span> <span style=color:#8be9fd;font-style:italic>time</span><span style=color:#ff79c6>=</span>0.060 ms
</span></span><span style=display:flex><span><span style=color:#bd93f9>64</span> bytes from 10.0.0.3: <span style=color:#8be9fd;font-style:italic>icmp_seq</span><span style=color:#ff79c6>=</span><span style=color:#bd93f9>2</span> <span style=color:#8be9fd;font-style:italic>ttl</span><span style=color:#ff79c6>=</span><span style=color:#bd93f9>64</span> <span style=color:#8be9fd;font-style:italic>time</span><span style=color:#ff79c6>=</span>0.059 ms
</span></span><span style=display:flex><span><span style=color:#bd93f9>64</span> bytes from 10.0.0.3: <span style=color:#8be9fd;font-style:italic>icmp_seq</span><span style=color:#ff79c6>=</span><span style=color:#bd93f9>3</span> <span style=color:#8be9fd;font-style:italic>ttl</span><span style=color:#ff79c6>=</span><span style=color:#bd93f9>64</span> <span style=color:#8be9fd;font-style:italic>time</span><span style=color:#ff79c6>=</span>0.044 ms
</span></span><span style=display:flex><span><span style=color:#bd93f9>64</span> bytes from 10.0.0.3: <span style=color:#8be9fd;font-style:italic>icmp_seq</span><span style=color:#ff79c6>=</span><span style=color:#bd93f9>4</span> <span style=color:#8be9fd;font-style:italic>ttl</span><span style=color:#ff79c6>=</span><span style=color:#bd93f9>64</span> <span style=color:#8be9fd;font-style:italic>time</span><span style=color:#ff79c6>=</span>0.065 ms
</span></span><span style=display:flex><span>^C
</span></span><span style=display:flex><span>--- 10.0.0.3 ping statistics ---
</span></span><span style=display:flex><span><span style=color:#bd93f9>4</span> packets transmitted, <span style=color:#bd93f9>4</span> received, 0% packet loss, <span style=color:#8be9fd;font-style:italic>time</span> 65ms
</span></span><span style=display:flex><span>rtt min/avg/max/mdev <span style=color:#ff79c6>=</span> 0.044/0.057/0.065/0.007 ms
</span></span></code></pre></div><p>使用<code>ip netns exec ns2 ping 10.0.0.1</code>在命名空间ns2中测试与ns0的10.0.0.1的网络连通性</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>PING 10.0.0.1 <span style=color:#ff79c6>(</span>10.0.0.1<span style=color:#ff79c6>)</span> 56<span style=color:#ff79c6>(</span>84<span style=color:#ff79c6>)</span> bytes of data.
</span></span><span style=display:flex><span><span style=color:#bd93f9>64</span> bytes from 10.0.0.1: <span style=color:#8be9fd;font-style:italic>icmp_seq</span><span style=color:#ff79c6>=</span><span style=color:#bd93f9>1</span> <span style=color:#8be9fd;font-style:italic>ttl</span><span style=color:#ff79c6>=</span><span style=color:#bd93f9>64</span> <span style=color:#8be9fd;font-style:italic>time</span><span style=color:#ff79c6>=</span>0.032 ms
</span></span><span style=display:flex><span><span style=color:#bd93f9>64</span> bytes from 10.0.0.1: <span style=color:#8be9fd;font-style:italic>icmp_seq</span><span style=color:#ff79c6>=</span><span style=color:#bd93f9>2</span> <span style=color:#8be9fd;font-style:italic>ttl</span><span style=color:#ff79c6>=</span><span style=color:#bd93f9>64</span> <span style=color:#8be9fd;font-style:italic>time</span><span style=color:#ff79c6>=</span>0.056 ms
</span></span><span style=display:flex><span><span style=color:#bd93f9>64</span> bytes from 10.0.0.1: <span style=color:#8be9fd;font-style:italic>icmp_seq</span><span style=color:#ff79c6>=</span><span style=color:#bd93f9>3</span> <span style=color:#8be9fd;font-style:italic>ttl</span><span style=color:#ff79c6>=</span><span style=color:#bd93f9>64</span> <span style=color:#8be9fd;font-style:italic>time</span><span style=color:#ff79c6>=</span>0.043 ms
</span></span><span style=display:flex><span><span style=color:#bd93f9>64</span> bytes from 10.0.0.1: <span style=color:#8be9fd;font-style:italic>icmp_seq</span><span style=color:#ff79c6>=</span><span style=color:#bd93f9>4</span> <span style=color:#8be9fd;font-style:italic>ttl</span><span style=color:#ff79c6>=</span><span style=color:#bd93f9>64</span> <span style=color:#8be9fd;font-style:italic>time</span><span style=color:#ff79c6>=</span>0.060 ms
</span></span><span style=display:flex><span>^C
</span></span><span style=display:flex><span>--- 10.0.0.1 ping statistics ---
</span></span><span style=display:flex><span><span style=color:#bd93f9>4</span> packets transmitted, <span style=color:#bd93f9>4</span> received, 0% packet loss, <span style=color:#8be9fd;font-style:italic>time</span> 69ms
</span></span><span style=display:flex><span>rtt min/avg/max/mdev <span style=color:#ff79c6>=</span> 0.032/0.047/0.060/0.013 ms
</span></span></code></pre></div><p>使用<code>ip netns exec ns2 ping 10.0.0.2</code>在命名空间ns2中测试与ns1的10.0.0.2的网络连通性</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>PING 10.0.0.2 <span style=color:#ff79c6>(</span>10.0.0.2<span style=color:#ff79c6>)</span> 56<span style=color:#ff79c6>(</span>84<span style=color:#ff79c6>)</span> bytes of data.
</span></span><span style=display:flex><span><span style=color:#bd93f9>64</span> bytes from 10.0.0.2: <span style=color:#8be9fd;font-style:italic>icmp_seq</span><span style=color:#ff79c6>=</span><span style=color:#bd93f9>1</span> <span style=color:#8be9fd;font-style:italic>ttl</span><span style=color:#ff79c6>=</span><span style=color:#bd93f9>64</span> <span style=color:#8be9fd;font-style:italic>time</span><span style=color:#ff79c6>=</span>0.030 ms
</span></span><span style=display:flex><span><span style=color:#bd93f9>64</span> bytes from 10.0.0.2: <span style=color:#8be9fd;font-style:italic>icmp_seq</span><span style=color:#ff79c6>=</span><span style=color:#bd93f9>2</span> <span style=color:#8be9fd;font-style:italic>ttl</span><span style=color:#ff79c6>=</span><span style=color:#bd93f9>64</span> <span style=color:#8be9fd;font-style:italic>time</span><span style=color:#ff79c6>=</span>0.055 ms
</span></span><span style=display:flex><span><span style=color:#bd93f9>64</span> bytes from 10.0.0.2: <span style=color:#8be9fd;font-style:italic>icmp_seq</span><span style=color:#ff79c6>=</span><span style=color:#bd93f9>3</span> <span style=color:#8be9fd;font-style:italic>ttl</span><span style=color:#ff79c6>=</span><span style=color:#bd93f9>64</span> <span style=color:#8be9fd;font-style:italic>time</span><span style=color:#ff79c6>=</span>0.044 ms
</span></span><span style=display:flex><span><span style=color:#bd93f9>64</span> bytes from 10.0.0.2: <span style=color:#8be9fd;font-style:italic>icmp_seq</span><span style=color:#ff79c6>=</span><span style=color:#bd93f9>4</span> <span style=color:#8be9fd;font-style:italic>ttl</span><span style=color:#ff79c6>=</span><span style=color:#bd93f9>64</span> <span style=color:#8be9fd;font-style:italic>time</span><span style=color:#ff79c6>=</span>0.042 ms
</span></span><span style=display:flex><span>^C
</span></span><span style=display:flex><span>--- 10.0.0.2 ping statistics ---
</span></span><span style=display:flex><span><span style=color:#bd93f9>4</span> packets transmitted, <span style=color:#bd93f9>4</span> received, 0% packet loss, <span style=color:#8be9fd;font-style:italic>time</span> 114ms
</span></span><span style=display:flex><span>rtt min/avg/max/mdev <span style=color:#ff79c6>=</span> 0.030/0.042/0.055/0.011 ms
</span></span></code></pre></div><p>可以看到我们通过网桥的方式把三个隔离的netns连接在了一起，通过这种方式，我们还可以很方便的添加第四个netns，第五个netns&mldr;在这里我们就不展开了，感兴趣的同学可以尝试一下。</p><p>接下来我们来讲解一下docker的几种网络模式。</p></article></div></main></body></html>