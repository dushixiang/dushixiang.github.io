<!doctype html><html lang=zh dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>Linux Bridge 详解 | 没有理想的人不伤心</title>
<meta name=keywords content="linux,network,bridge">
<meta name=description content="Linux Bridge 详解 Linux Bridge（网桥）是用纯软件实现的虚拟交换机，有着和物理交换机相同的功能，例如二层交换，MAC地址学习等。因此我们可以把tun/tap，veth pair等设备绑定到网桥上，就像是把设备连接到物理交换机上一样。此外它和veth pair、tun/tap一样，也是一种虚拟网络设备，具有虚拟设备的所有特性，例如配置IP，MAC地址等。
Linux Bridge通常是搭配KVM、docker等虚拟化技术一起使用的，用于构建虚拟网络，因为此教程不涉及虚拟化技术，我们就使用前面学习过的netns来模拟虚拟设备。
如何使用Linux Bridge？ 操作网桥有多种方式，在这里我们介绍一下通过bridge-utils来操作，由于它不是Linux系统自带的工具，因此需要我们手动来安装它。
# centos yum install -y bridge-utils # ubuntu apt-get install -y bridge-utils 使用brctl help查看使用帮助
never heard of command [help] Usage: brctl [commands] commands: addbr <bridge>	add bridge delbr <bridge>	delete bridge addif <bridge> <device>	add interface to bridge delif <bridge> <device>	delete interface from bridge hairpin <bridge> <port> {on|off}	turn hairpin on/off setageing <bridge> <time>	set ageing time setbridgeprio	<bridge> <prio>	set bridge priority setfd <bridge> <time>	set bridge forward delay sethello <bridge> <time>	set hello time setmaxage <bridge> <time>	set max message age setpathcost	<bridge> <port> <cost>	set path cost setportprio	<bridge> <port> <prio>	set port priority show [ <bridge> ]	show a list of bridges showmacs <bridge>	show a list of mac addrs showstp <bridge>	show bridge stp info stp <bridge> {on|off}	turn stp on/off 常用命令如">
<meta name=author content="dushixiang">
<link rel=canonical href=https://typesafe.cn/posts/linux-bridge/>
<link crossorigin=anonymous href=/assets/css/stylesheet.min.c88963fe2d79462000fd0fb1b3737783c32855d340583e4523343f8735c787f0.css integrity="sha256-yIlj/i15RiAA/Q+xs3N3g8MoVdNAWD5FIzQ/hzXHh/A=" rel="preload stylesheet" as=style>
<script defer crossorigin=anonymous src=/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5+kdJvBz5iKbt6B5PJI=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://typesafe.cn/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=https://typesafe.cn/favicon-16x16.png>
<link rel=icon type=image/png sizes=32x32 href=https://typesafe.cn/favicon-32x32.png>
<link rel=apple-touch-icon href=https://typesafe.cn/apple-touch-icon.png>
<link rel=mask-icon href=https://typesafe.cn/safari-pinned-tab.svg>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<meta name=generator content="Hugo 0.91.0">
<noscript>
<style>#theme-toggle,.top-link{display:none}</style>
<style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style>
</noscript><meta property="og:title" content="Linux Bridge 详解">
<meta property="og:description" content="Linux Bridge 详解 Linux Bridge（网桥）是用纯软件实现的虚拟交换机，有着和物理交换机相同的功能，例如二层交换，MAC地址学习等。因此我们可以把tun/tap，veth pair等设备绑定到网桥上，就像是把设备连接到物理交换机上一样。此外它和veth pair、tun/tap一样，也是一种虚拟网络设备，具有虚拟设备的所有特性，例如配置IP，MAC地址等。
Linux Bridge通常是搭配KVM、docker等虚拟化技术一起使用的，用于构建虚拟网络，因为此教程不涉及虚拟化技术，我们就使用前面学习过的netns来模拟虚拟设备。
如何使用Linux Bridge？ 操作网桥有多种方式，在这里我们介绍一下通过bridge-utils来操作，由于它不是Linux系统自带的工具，因此需要我们手动来安装它。
# centos yum install -y bridge-utils # ubuntu apt-get install -y bridge-utils 使用brctl help查看使用帮助
never heard of command [help] Usage: brctl [commands] commands: addbr <bridge>	add bridge delbr <bridge>	delete bridge addif <bridge> <device>	add interface to bridge delif <bridge> <device>	delete interface from bridge hairpin <bridge> <port> {on|off}	turn hairpin on/off setageing <bridge> <time>	set ageing time setbridgeprio	<bridge> <prio>	set bridge priority setfd <bridge> <time>	set bridge forward delay sethello <bridge> <time>	set hello time setmaxage <bridge> <time>	set max message age setpathcost	<bridge> <port> <cost>	set path cost setportprio	<bridge> <port> <prio>	set port priority show [ <bridge> ]	show a list of bridges showmacs <bridge>	show a list of mac addrs showstp <bridge>	show bridge stp info stp <bridge> {on|off}	turn stp on/off 常用命令如">
<meta property="og:type" content="article">
<meta property="og:url" content="https://typesafe.cn/posts/linux-bridge/"><meta property="og:image" content="https://typesafe.cn/papermod-cover.png"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2020-11-13T21:47:00+00:00">
<meta property="article:modified_time" content="2020-11-13T21:47:00+00:00">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://typesafe.cn/papermod-cover.png">
<meta name=twitter:title content="Linux Bridge 详解">
<meta name=twitter:description content="Linux Bridge 详解 Linux Bridge（网桥）是用纯软件实现的虚拟交换机，有着和物理交换机相同的功能，例如二层交换，MAC地址学习等。因此我们可以把tun/tap，veth pair等设备绑定到网桥上，就像是把设备连接到物理交换机上一样。此外它和veth pair、tun/tap一样，也是一种虚拟网络设备，具有虚拟设备的所有特性，例如配置IP，MAC地址等。
Linux Bridge通常是搭配KVM、docker等虚拟化技术一起使用的，用于构建虚拟网络，因为此教程不涉及虚拟化技术，我们就使用前面学习过的netns来模拟虚拟设备。
如何使用Linux Bridge？ 操作网桥有多种方式，在这里我们介绍一下通过bridge-utils来操作，由于它不是Linux系统自带的工具，因此需要我们手动来安装它。
# centos yum install -y bridge-utils # ubuntu apt-get install -y bridge-utils 使用brctl help查看使用帮助
never heard of command [help] Usage: brctl [commands] commands: addbr <bridge>	add bridge delbr <bridge>	delete bridge addif <bridge> <device>	add interface to bridge delif <bridge> <device>	delete interface from bridge hairpin <bridge> <port> {on|off}	turn hairpin on/off setageing <bridge> <time>	set ageing time setbridgeprio	<bridge> <prio>	set bridge priority setfd <bridge> <time>	set bridge forward delay sethello <bridge> <time>	set hello time setmaxage <bridge> <time>	set max message age setpathcost	<bridge> <port> <cost>	set path cost setportprio	<bridge> <port> <prio>	set port priority show [ <bridge> ]	show a list of bridges showmacs <bridge>	show a list of mac addrs showstp <bridge>	show bridge stp info stp <bridge> {on|off}	turn stp on/off 常用命令如">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://typesafe.cn/posts/"},{"@type":"ListItem","position":3,"name":"Linux Bridge 详解","item":"https://typesafe.cn/posts/linux-bridge/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Linux Bridge 详解","name":"Linux Bridge 详解","description":"Linux Bridge 详解 Linux Bridge（网桥）是用纯软件实现的虚拟交换机，有着和物理交换机相同的功能，例如二层交换，MAC地址学习等。因此我们可以把tun/tap，veth pair等设备绑定到网桥上，就像是把设备连接到物理交换机上一样。此外它和veth pair、tun/tap一样，也是一种虚拟网络设备，具有虚拟设备的所有特性，例如配置IP，MAC地址等。\nLinux Bridge通常是搭配KVM、docker等虚拟化技术一起使用的，用于构建虚拟网络，因为此教程不涉及虚拟化技术，我们就使用前面学习过的netns来模拟虚拟设备。\n如何使用Linux Bridge？ 操作网桥有多种方式，在这里我们介绍一下通过bridge-utils来操作，由于它不是Linux系统自带的工具，因此需要我们手动来安装它。\n# centos yum install -y bridge-utils # ubuntu apt-get install -y bridge-utils 使用brctl help查看使用帮助\nnever heard of command [help] Usage: brctl [commands] commands: addbr \u0026lt;bridge\u0026gt;\tadd bridge delbr \u0026lt;bridge\u0026gt;\tdelete bridge addif \u0026lt;bridge\u0026gt; \u0026lt;device\u0026gt;\tadd interface to bridge delif \u0026lt;bridge\u0026gt; \u0026lt;device\u0026gt;\tdelete interface from bridge hairpin \u0026lt;bridge\u0026gt; \u0026lt;port\u0026gt; {on|off}\tturn hairpin on/off setageing \u0026lt;bridge\u0026gt; \u0026lt;time\u0026gt;\tset ageing time setbridgeprio\t\u0026lt;bridge\u0026gt; \u0026lt;prio\u0026gt;\tset bridge priority setfd \u0026lt;bridge\u0026gt; \u0026lt;time\u0026gt;\tset bridge forward delay sethello \u0026lt;bridge\u0026gt; \u0026lt;time\u0026gt;\tset hello time setmaxage \u0026lt;bridge\u0026gt; \u0026lt;time\u0026gt;\tset max message age setpathcost\t\u0026lt;bridge\u0026gt; \u0026lt;port\u0026gt; \u0026lt;cost\u0026gt;\tset path cost setportprio\t\u0026lt;bridge\u0026gt; \u0026lt;port\u0026gt; \u0026lt;prio\u0026gt;\tset port priority show [ \u0026lt;bridge\u0026gt; ]\tshow a list of bridges showmacs \u0026lt;bridge\u0026gt;\tshow a list of mac addrs showstp \u0026lt;bridge\u0026gt;\tshow bridge stp info stp \u0026lt;bridge\u0026gt; {on|off}\tturn stp on/off 常用命令如","keywords":["linux","network","bridge"],"articleBody":"Linux Bridge 详解 Linux Bridge（网桥）是用纯软件实现的虚拟交换机，有着和物理交换机相同的功能，例如二层交换，MAC地址学习等。因此我们可以把tun/tap，veth pair等设备绑定到网桥上，就像是把设备连接到物理交换机上一样。此外它和veth pair、tun/tap一样，也是一种虚拟网络设备，具有虚拟设备的所有特性，例如配置IP，MAC地址等。\nLinux Bridge通常是搭配KVM、docker等虚拟化技术一起使用的，用于构建虚拟网络，因为此教程不涉及虚拟化技术，我们就使用前面学习过的netns来模拟虚拟设备。\n如何使用Linux Bridge？ 操作网桥有多种方式，在这里我们介绍一下通过bridge-utils来操作，由于它不是Linux系统自带的工具，因此需要我们手动来安装它。\n# centos yum install -y bridge-utils # ubuntu apt-get install -y bridge-utils 使用brctl help查看使用帮助\nnever heard of command [help] Usage: brctl [commands] commands: addbr \tadd bridge delbr \tdelete bridge addif  \tadd interface to bridge delif  \tdelete interface from bridge hairpin   {on|off}\tturn hairpin on/off setageing  \tset ageing time setbridgeprio\t \tset bridge priority setfd  \tset bridge forward delay sethello  \tset hello time setmaxage  \tset max message age setpathcost\t  \tset path cost setportprio\t  \tset port priority show [  ]\tshow a list of bridges showmacs \tshow a list of mac addrs showstp \tshow bridge stp info stp  {on|off}\tturn stp on/off 常用命令如\n新建一个网桥：\nbrctl addbr  添加一个设备（例如eth0）到网桥：\nbrctl addif  eth0 显示当前存在的网桥及其所连接的网络端口：\nbrctl show 启动网桥：\nip link set  up 删除网桥，需要先关闭它：\nip link set  down brctl delbr  或者使用ip link del 命令直接删除网桥\nip link del   增加Linux Bridge时会自动增加一个同名虚拟网卡在宿主机器上，因此我们可以通过ip link命令操作这个虚拟网卡，实际上也就是操作网桥，并且只有当这个虚拟网卡状态处于up的时候，网桥才会转发数据。\n 实验 在上一节《Linux veth pair详解》我们使用veth pair将两个隔离的netns连接在了一起，在现实世界里等同于用一根网线把两台电脑连接在了一起，但是在现实世界里往往很少会有人这样使用。因为一台设备不仅仅只需要和另一台设备通信，它需要和很多很多的网络设备进行通信，如果还使用这样的方式，需要十分复杂的网络接线，并且现实世界中的普通网络设备也没有那么多网络接口。\n那么，想要让某一台设备和很多网络设备都可以通信需要如何去做呢？在我们的日常生活中，除了手机和电脑，最常见的网络设备就是路由器了，我们的手机连上WI-FI，电脑插到路由器上，等待从路由器的DHCP服务器上获取到IP，他们就可以相互通信了，这便是路由器的二层交换功能在工作。Linux Bridge最主要的功能就是二层交换，是对现实世界二层交换机的模拟，我们稍微改动一下网络拓扑，如下图：\n我们建立了一个网桥，三个netns，三对veth pair，分别一端在netns中，另一端连接在网桥上，为了简化拓扑，我去除了netns中的tap设备，将IP直接配置在veth上。\n veth设备不仅仅可以可以充当“网线”，同时它也可以当作虚拟网卡来使用。\n # 添加网桥 brctl addbr br0 # 启动网桥 ip link set br0 up # 新增三个netns ip netns add ns0 ip netns add ns1 ip netns add ns2 # 新增两对veth ip link add veth0-ns type veth peer name veth0-br ip link add veth1-ns type veth peer name veth1-br ip link add veth2-ns type veth peer name veth2-br # 将veth的一端移动到netns中 ip link set veth0-ns netns ns0 ip link set veth1-ns netns ns1 ip link set veth2-ns netns ns2 # 将netns中的本地环回和veth启动并配置IP ip netns exec ns0 ip link set lo up ip netns exec ns0 ip link set veth0-ns up ip netns exec ns0 ip addr add 10.0.0.1/24 dev veth0-ns ip netns exec ns1 ip link set lo up ip netns exec ns1 ip link set veth1-ns up ip netns exec ns1 ip addr add 10.0.0.2/24 dev veth1-ns ip netns exec ns2 ip link set lo up ip netns exec ns2 ip link set veth2-ns up ip netns exec ns2 ip addr add 10.0.0.3/24 dev veth2-ns # 将veth的另一端启动并挂载到网桥上 ip link set veth0-br up ip link set veth1-br up ip link set veth2-br up brctl addif br0 veth0-br brctl addif br0 veth1-br brctl addif br0 veth2-br 测试网络连通性\n使用ip netns exec ns0 ping 10.0.0.2在命名空间ns0中测试与ns1的10.0.0.2的网络连通性\nPING 10.0.0.2 (10.0.0.2) 56(84) bytes of data. 64 bytes from 10.0.0.2: icmp_seq=1 ttl=64 time=0.032 ms 64 bytes from 10.0.0.2: icmp_seq=2 ttl=64 time=0.058 ms 64 bytes from 10.0.0.2: icmp_seq=3 ttl=64 time=0.052 ms 64 bytes from 10.0.0.2: icmp_seq=4 ttl=64 time=0.044 ms ^C --- 10.0.0.2 ping statistics --- 4 packets transmitted, 4 received, 0% packet loss, time 54ms rtt min/avg/max/mdev = 0.032/0.046/0.058/0.011 ms 使用ip netns exec ns0 ping 10.0.0.3在命名空间ns0中测试与ns2的10.0.0.3的网络连通性\nPING 10.0.0.3 (10.0.0.3) 56(84) bytes of data. 64 bytes from 10.0.0.3: icmp_seq=1 ttl=64 time=0.054 ms 64 bytes from 10.0.0.3: icmp_seq=2 ttl=64 time=0.045 ms 64 bytes from 10.0.0.3: icmp_seq=3 ttl=64 time=0.058 ms 64 bytes from 10.0.0.3: icmp_seq=4 ttl=64 time=0.064 ms ^C --- 10.0.0.3 ping statistics --- 4 packets transmitted, 4 received, 0% packet loss, time 81ms rtt min/avg/max/mdev = 0.045/0.055/0.064/0.008 ms 使用ip netns exec ns1 ping 10.0.0.1在命名空间ns1中测试与ns0的10.0.0.1的网络连通性\nPING 10.0.0.1 (10.0.0.1) 56(84) bytes of data. 64 bytes from 10.0.0.1: icmp_seq=1 ttl=64 time=0.031 ms 64 bytes from 10.0.0.1: icmp_seq=2 ttl=64 time=0.046 ms 64 bytes from 10.0.0.1: icmp_seq=3 ttl=64 time=0.038 ms 64 bytes from 10.0.0.1: icmp_seq=4 ttl=64 time=0.041 ms ^C --- 10.0.0.1 ping statistics --- 4 packets transmitted, 4 received, 0% packet loss, time 81ms rtt min/avg/max/mdev = 0.031/0.039/0.046/0.005 ms 使用ip netns exec ns1 ping 10.0.0.3在命名空间ns1中测试与ns2的10.0.0.3的网络连通性\nPING 10.0.0.3 (10.0.0.3) 56(84) bytes of data. 64 bytes from 10.0.0.3: icmp_seq=1 ttl=64 time=0.060 ms 64 bytes from 10.0.0.3: icmp_seq=2 ttl=64 time=0.059 ms 64 bytes from 10.0.0.3: icmp_seq=3 ttl=64 time=0.044 ms 64 bytes from 10.0.0.3: icmp_seq=4 ttl=64 time=0.065 ms ^C --- 10.0.0.3 ping statistics --- 4 packets transmitted, 4 received, 0% packet loss, time 65ms rtt min/avg/max/mdev = 0.044/0.057/0.065/0.007 ms 使用ip netns exec ns2 ping 10.0.0.1在命名空间ns2中测试与ns0的10.0.0.1的网络连通性\nPING 10.0.0.1 (10.0.0.1) 56(84) bytes of data. 64 bytes from 10.0.0.1: icmp_seq=1 ttl=64 time=0.032 ms 64 bytes from 10.0.0.1: icmp_seq=2 ttl=64 time=0.056 ms 64 bytes from 10.0.0.1: icmp_seq=3 ttl=64 time=0.043 ms 64 bytes from 10.0.0.1: icmp_seq=4 ttl=64 time=0.060 ms ^C --- 10.0.0.1 ping statistics --- 4 packets transmitted, 4 received, 0% packet loss, time 69ms rtt min/avg/max/mdev = 0.032/0.047/0.060/0.013 ms 使用ip netns exec ns2 ping 10.0.0.2在命名空间ns2中测试与ns1的10.0.0.2的网络连通性\nPING 10.0.0.2 (10.0.0.2) 56(84) bytes of data. 64 bytes from 10.0.0.2: icmp_seq=1 ttl=64 time=0.030 ms 64 bytes from 10.0.0.2: icmp_seq=2 ttl=64 time=0.055 ms 64 bytes from 10.0.0.2: icmp_seq=3 ttl=64 time=0.044 ms 64 bytes from 10.0.0.2: icmp_seq=4 ttl=64 time=0.042 ms ^C --- 10.0.0.2 ping statistics --- 4 packets transmitted, 4 received, 0% packet loss, time 114ms rtt min/avg/max/mdev = 0.030/0.042/0.055/0.011 ms 可以看到我们通过网桥的方式把三个隔离的netns连接在了一起，通过这种方式，我们还可以很方便的添加第四个netns，第五个netns…在这里我们就不展开了，感兴趣的同学可以尝试一下。\n接下来我们来讲解一下docker的几种网络模式。\n","wordCount":"777","inLanguage":"zh","datePublished":"2020-11-13T21:47:00Z","dateModified":"2020-11-13T21:47:00Z","author":{"@type":"Person","name":"dushixiang"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://typesafe.cn/posts/linux-bridge/"},"publisher":{"@type":"Organization","name":"没有理想的人不伤心","logo":{"@type":"ImageObject","url":"https://typesafe.cn/favicon.ico"}}}</script>
</head>
<body id=top>
<script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=https://typesafe.cn accesskey=h title="没有理想的人不伤心 (Alt + H)">没有理想的人不伤心</a>
<span class=logo-switches>
<button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
</span>
</div>
<ul id=menu>
<li>
<a href=https://typesafe.cn/archives title=文章>
<span>文章</span>
</a>
</li>
<li>
<a href=https://typesafe.cn/categories/ title=分类>
<span>分类</span>
</a>
</li>
<li>
<a href=https://typesafe.cn/search/ title=搜索>
<span>搜索</span>
</a>
</li>
<li>
<a href=https://typesafe.cn/tags/ title=标签>
<span>标签</span>
</a>
</li>
</ul>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-header>
<div class=breadcrumbs><a href=https://typesafe.cn>主页</a>&nbsp;»&nbsp;<a href=https://typesafe.cn/posts/>Posts</a></div>
<h1 class=post-title>
Linux Bridge 详解
</h1>
<div class=post-meta><span title="2020-11-13 21:47:00 +0000 UTC">November 13, 2020</span>&nbsp;·&nbsp;4 分钟&nbsp;·&nbsp;dushixiang&nbsp;|&nbsp;<a href=https://github.com/adityatelange/hugo-PaperMod/tree/exampleSite/content/posts/linux-bridge.md rel="noopener noreferrer" target=_blank>Suggest Changes</a>
</div>
</header> <div class=toc>
<details>
<summary accesskey=c title="(Alt + C)">
<span class=details>目录</span>
</summary>
<div class=inner><ul>
<li>
<a href=#linux-bridge-%e8%af%a6%e8%a7%a3 aria-label="Linux Bridge 详解">Linux Bridge 详解</a><ul>
<li>
<a href=#%e5%a6%82%e4%bd%95%e4%bd%bf%e7%94%a8linux-bridge aria-label="如何使用Linux Bridge？">如何使用Linux Bridge？</a></li>
<li>
<a href=#%e5%ae%9e%e9%aa%8c aria-label=实验>实验</a>
</li>
</ul>
</li>
</ul>
</div>
</details>
</div>
<div class=post-content><h1 id=linux-bridge-详解>Linux Bridge 详解<a hidden class=anchor aria-hidden=true href=#linux-bridge-详解>#</a></h1>
<p>Linux Bridge（网桥）是用纯软件实现的虚拟交换机，有着和物理交换机相同的功能，例如二层交换，MAC地址学习等。因此我们可以把tun/tap，veth pair等设备绑定到网桥上，就像是把设备连接到物理交换机上一样。此外它和veth pair、tun/tap一样，也是一种虚拟网络设备，具有虚拟设备的所有特性，例如配置IP，MAC地址等。</p>
<p>Linux Bridge通常是搭配KVM、docker等虚拟化技术一起使用的，用于构建虚拟网络，因为此教程不涉及虚拟化技术，我们就使用前面学习过的netns来模拟虚拟设备。</p>
<h2 id=如何使用linux-bridge>如何使用Linux Bridge？<a hidden class=anchor aria-hidden=true href=#如何使用linux-bridge>#</a></h2>
<p>操作网桥有多种方式，在这里我们介绍一下通过<strong>bridge-utils</strong>来操作，由于它不是Linux系统自带的工具，因此需要我们手动来安装它。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e># centos</span>
yum install -y bridge-utils
<span style=color:#75715e># ubuntu</span>
apt-get install -y bridge-utils
</code></pre></div><p>使用<code>brctl help</code>查看使用帮助</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>never heard of command <span style=color:#f92672>[</span>help<span style=color:#f92672>]</span>
Usage: brctl <span style=color:#f92672>[</span>commands<span style=color:#f92672>]</span>
commands:
	addbr     	&lt;bridge&gt;		add bridge
	delbr     	&lt;bridge&gt;		delete bridge
	addif     	&lt;bridge&gt; &lt;device&gt;	add interface to bridge
	delif     	&lt;bridge&gt; &lt;device&gt;	delete interface from bridge
	hairpin   	&lt;bridge&gt; &lt;port&gt; <span style=color:#f92672>{</span>on|off<span style=color:#f92672>}</span>	turn hairpin on/off
	setageing 	&lt;bridge&gt; &lt;time&gt;		set ageing time
	setbridgeprio	&lt;bridge&gt; &lt;prio&gt;		set bridge priority
	setfd     	&lt;bridge&gt; &lt;time&gt;		set bridge forward delay
	sethello  	&lt;bridge&gt; &lt;time&gt;		set hello time
	setmaxage 	&lt;bridge&gt; &lt;time&gt;		set max message age
	setpathcost	&lt;bridge&gt; &lt;port&gt; &lt;cost&gt;	set path cost
	setportprio	&lt;bridge&gt; &lt;port&gt; &lt;prio&gt;	set port priority
	show      	<span style=color:#f92672>[</span> &lt;bridge&gt; <span style=color:#f92672>]</span>		show a list of bridges
	showmacs  	&lt;bridge&gt;		show a list of mac addrs
	showstp   	&lt;bridge&gt;		show bridge stp info
	stp       	&lt;bridge&gt; <span style=color:#f92672>{</span>on|off<span style=color:#f92672>}</span>	turn stp on/off
</code></pre></div><p>常用命令如</p>
<p>新建一个网桥：</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>brctl addbr &lt;bridge&gt;
</code></pre></div><p>添加一个设备（例如<code>eth0</code>）到网桥：</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>brctl addif &lt;bridge&gt; eth0
</code></pre></div><p>显示当前存在的网桥及其所连接的网络端口：</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>brctl show
</code></pre></div><p>启动网桥：</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>ip link set &lt;bridge&gt; up
</code></pre></div><p>删除网桥，需要先关闭它：</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>ip link set &lt;bridge&gt; down
brctl delbr &lt;bridge&gt;
</code></pre></div><p>或者使用<code>ip link del</code> 命令直接删除网桥</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>ip link del &lt;bridge&gt;
</code></pre></div><blockquote>
<p>增加Linux Bridge时会自动增加一个同名虚拟网卡在宿主机器上，因此我们可以通过<code>ip link</code>命令操作这个虚拟网卡，实际上也就是操作网桥，并且只有当这个虚拟网卡状态处于<strong>up</strong>的时候，网桥才会转发数据。</p>
</blockquote>
<h2 id=实验>实验<a hidden class=anchor aria-hidden=true href=#实验>#</a></h2>
<p>在上一节《Linux veth pair详解》我们使用veth pair将两个隔离的netns连接在了一起，在现实世界里等同于用一根网线把两台电脑连接在了一起，但是在现实世界里往往很少会有人这样使用。因为一台设备不仅仅只需要和另一台设备通信，它需要和很多很多的网络设备进行通信，如果还使用这样的方式，需要十分复杂的网络接线，并且现实世界中的普通网络设备也没有那么多网络接口。</p>
<p>那么，想要让某一台设备和很多网络设备都可以通信需要如何去做呢？在我们的日常生活中，除了手机和电脑，最常见的网络设备就是路由器了，我们的手机连上WI-FI，电脑插到路由器上，等待从路由器的DHCP服务器上获取到IP，他们就可以相互通信了，这便是路由器的二层交换功能在工作。Linux Bridge最主要的功能就是二层交换，是对现实世界二层交换机的模拟，我们稍微改动一下网络拓扑，如下图：</p>
<p><img loading=lazy src=https://oss.typesafe.cn/bridge0.png alt=bridge>
</p>
<p>我们建立了一个网桥，三个netns，三对veth pair，分别一端在netns中，另一端连接在网桥上，为了简化拓扑，我去除了netns中的tap设备，将IP直接配置在veth上。</p>
<blockquote>
<p>veth设备不仅仅可以可以充当“网线”，同时它也可以当作虚拟网卡来使用。</p>
</blockquote>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e># 添加网桥</span>
brctl addbr br0
<span style=color:#75715e># 启动网桥</span>
ip link set br0 up

<span style=color:#75715e># 新增三个netns</span>
ip netns add ns0
ip netns add ns1
ip netns add ns2

<span style=color:#75715e># 新增两对veth</span>
ip link add veth0-ns type veth peer name veth0-br
ip link add veth1-ns type veth peer name veth1-br
ip link add veth2-ns type veth peer name veth2-br

<span style=color:#75715e># 将veth的一端移动到netns中</span>
ip link set veth0-ns netns ns0
ip link set veth1-ns netns ns1
ip link set veth2-ns netns ns2

<span style=color:#75715e># 将netns中的本地环回和veth启动并配置IP</span>
ip netns exec ns0 ip link set lo up
ip netns exec ns0 ip link set veth0-ns up
ip netns exec ns0 ip addr add 10.0.0.1/24 dev veth0-ns

ip netns exec ns1 ip link set lo up
ip netns exec ns1 ip link set veth1-ns up
ip netns exec ns1 ip addr add 10.0.0.2/24 dev veth1-ns

ip netns exec ns2 ip link set lo up
ip netns exec ns2 ip link set veth2-ns up
ip netns exec ns2 ip addr add 10.0.0.3/24 dev veth2-ns

<span style=color:#75715e># 将veth的另一端启动并挂载到网桥上</span>
ip link set veth0-br up
ip link set veth1-br up
ip link set veth2-br up
brctl addif br0 veth0-br
brctl addif br0 veth1-br
brctl addif br0 veth2-br
</code></pre></div><p>测试网络连通性</p>
<p>使用<code>ip netns exec ns0 ping 10.0.0.2</code>在命名空间ns0中测试与ns1的10.0.0.2的网络连通性</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>PING 10.0.0.2 <span style=color:#f92672>(</span>10.0.0.2<span style=color:#f92672>)</span> 56<span style=color:#f92672>(</span>84<span style=color:#f92672>)</span> bytes of data.
<span style=color:#ae81ff>64</span> bytes from 10.0.0.2: icmp_seq<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> ttl<span style=color:#f92672>=</span><span style=color:#ae81ff>64</span> time<span style=color:#f92672>=</span>0.032 ms
<span style=color:#ae81ff>64</span> bytes from 10.0.0.2: icmp_seq<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span> ttl<span style=color:#f92672>=</span><span style=color:#ae81ff>64</span> time<span style=color:#f92672>=</span>0.058 ms
<span style=color:#ae81ff>64</span> bytes from 10.0.0.2: icmp_seq<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span> ttl<span style=color:#f92672>=</span><span style=color:#ae81ff>64</span> time<span style=color:#f92672>=</span>0.052 ms
<span style=color:#ae81ff>64</span> bytes from 10.0.0.2: icmp_seq<span style=color:#f92672>=</span><span style=color:#ae81ff>4</span> ttl<span style=color:#f92672>=</span><span style=color:#ae81ff>64</span> time<span style=color:#f92672>=</span>0.044 ms
^C
--- 10.0.0.2 ping statistics ---
<span style=color:#ae81ff>4</span> packets transmitted, <span style=color:#ae81ff>4</span> received, 0% packet loss, time 54ms
rtt min/avg/max/mdev <span style=color:#f92672>=</span> 0.032/0.046/0.058/0.011 ms
</code></pre></div><p>使用<code>ip netns exec ns0 ping 10.0.0.3</code>在命名空间ns0中测试与ns2的10.0.0.3的网络连通性</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>PING 10.0.0.3 <span style=color:#f92672>(</span>10.0.0.3<span style=color:#f92672>)</span> 56<span style=color:#f92672>(</span>84<span style=color:#f92672>)</span> bytes of data.
<span style=color:#ae81ff>64</span> bytes from 10.0.0.3: icmp_seq<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> ttl<span style=color:#f92672>=</span><span style=color:#ae81ff>64</span> time<span style=color:#f92672>=</span>0.054 ms
<span style=color:#ae81ff>64</span> bytes from 10.0.0.3: icmp_seq<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span> ttl<span style=color:#f92672>=</span><span style=color:#ae81ff>64</span> time<span style=color:#f92672>=</span>0.045 ms
<span style=color:#ae81ff>64</span> bytes from 10.0.0.3: icmp_seq<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span> ttl<span style=color:#f92672>=</span><span style=color:#ae81ff>64</span> time<span style=color:#f92672>=</span>0.058 ms
<span style=color:#ae81ff>64</span> bytes from 10.0.0.3: icmp_seq<span style=color:#f92672>=</span><span style=color:#ae81ff>4</span> ttl<span style=color:#f92672>=</span><span style=color:#ae81ff>64</span> time<span style=color:#f92672>=</span>0.064 ms
^C
--- 10.0.0.3 ping statistics ---
<span style=color:#ae81ff>4</span> packets transmitted, <span style=color:#ae81ff>4</span> received, 0% packet loss, time 81ms
rtt min/avg/max/mdev <span style=color:#f92672>=</span> 0.045/0.055/0.064/0.008 ms
</code></pre></div><p>使用<code>ip netns exec ns1 ping 10.0.0.1</code>在命名空间ns1中测试与ns0的10.0.0.1的网络连通性</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>PING 10.0.0.1 <span style=color:#f92672>(</span>10.0.0.1<span style=color:#f92672>)</span> 56<span style=color:#f92672>(</span>84<span style=color:#f92672>)</span> bytes of data.
<span style=color:#ae81ff>64</span> bytes from 10.0.0.1: icmp_seq<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> ttl<span style=color:#f92672>=</span><span style=color:#ae81ff>64</span> time<span style=color:#f92672>=</span>0.031 ms
<span style=color:#ae81ff>64</span> bytes from 10.0.0.1: icmp_seq<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span> ttl<span style=color:#f92672>=</span><span style=color:#ae81ff>64</span> time<span style=color:#f92672>=</span>0.046 ms
<span style=color:#ae81ff>64</span> bytes from 10.0.0.1: icmp_seq<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span> ttl<span style=color:#f92672>=</span><span style=color:#ae81ff>64</span> time<span style=color:#f92672>=</span>0.038 ms
<span style=color:#ae81ff>64</span> bytes from 10.0.0.1: icmp_seq<span style=color:#f92672>=</span><span style=color:#ae81ff>4</span> ttl<span style=color:#f92672>=</span><span style=color:#ae81ff>64</span> time<span style=color:#f92672>=</span>0.041 ms
^C
--- 10.0.0.1 ping statistics ---
<span style=color:#ae81ff>4</span> packets transmitted, <span style=color:#ae81ff>4</span> received, 0% packet loss, time 81ms
rtt min/avg/max/mdev <span style=color:#f92672>=</span> 0.031/0.039/0.046/0.005 ms
</code></pre></div><p>使用<code>ip netns exec ns1 ping 10.0.0.3</code>在命名空间ns1中测试与ns2的10.0.0.3的网络连通性</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>PING 10.0.0.3 <span style=color:#f92672>(</span>10.0.0.3<span style=color:#f92672>)</span> 56<span style=color:#f92672>(</span>84<span style=color:#f92672>)</span> bytes of data.
<span style=color:#ae81ff>64</span> bytes from 10.0.0.3: icmp_seq<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> ttl<span style=color:#f92672>=</span><span style=color:#ae81ff>64</span> time<span style=color:#f92672>=</span>0.060 ms
<span style=color:#ae81ff>64</span> bytes from 10.0.0.3: icmp_seq<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span> ttl<span style=color:#f92672>=</span><span style=color:#ae81ff>64</span> time<span style=color:#f92672>=</span>0.059 ms
<span style=color:#ae81ff>64</span> bytes from 10.0.0.3: icmp_seq<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span> ttl<span style=color:#f92672>=</span><span style=color:#ae81ff>64</span> time<span style=color:#f92672>=</span>0.044 ms
<span style=color:#ae81ff>64</span> bytes from 10.0.0.3: icmp_seq<span style=color:#f92672>=</span><span style=color:#ae81ff>4</span> ttl<span style=color:#f92672>=</span><span style=color:#ae81ff>64</span> time<span style=color:#f92672>=</span>0.065 ms
^C
--- 10.0.0.3 ping statistics ---
<span style=color:#ae81ff>4</span> packets transmitted, <span style=color:#ae81ff>4</span> received, 0% packet loss, time 65ms
rtt min/avg/max/mdev <span style=color:#f92672>=</span> 0.044/0.057/0.065/0.007 ms
</code></pre></div><p>使用<code>ip netns exec ns2 ping 10.0.0.1</code>在命名空间ns2中测试与ns0的10.0.0.1的网络连通性</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>PING 10.0.0.1 <span style=color:#f92672>(</span>10.0.0.1<span style=color:#f92672>)</span> 56<span style=color:#f92672>(</span>84<span style=color:#f92672>)</span> bytes of data.
<span style=color:#ae81ff>64</span> bytes from 10.0.0.1: icmp_seq<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> ttl<span style=color:#f92672>=</span><span style=color:#ae81ff>64</span> time<span style=color:#f92672>=</span>0.032 ms
<span style=color:#ae81ff>64</span> bytes from 10.0.0.1: icmp_seq<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span> ttl<span style=color:#f92672>=</span><span style=color:#ae81ff>64</span> time<span style=color:#f92672>=</span>0.056 ms
<span style=color:#ae81ff>64</span> bytes from 10.0.0.1: icmp_seq<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span> ttl<span style=color:#f92672>=</span><span style=color:#ae81ff>64</span> time<span style=color:#f92672>=</span>0.043 ms
<span style=color:#ae81ff>64</span> bytes from 10.0.0.1: icmp_seq<span style=color:#f92672>=</span><span style=color:#ae81ff>4</span> ttl<span style=color:#f92672>=</span><span style=color:#ae81ff>64</span> time<span style=color:#f92672>=</span>0.060 ms
^C
--- 10.0.0.1 ping statistics ---
<span style=color:#ae81ff>4</span> packets transmitted, <span style=color:#ae81ff>4</span> received, 0% packet loss, time 69ms
rtt min/avg/max/mdev <span style=color:#f92672>=</span> 0.032/0.047/0.060/0.013 ms
</code></pre></div><p>使用<code>ip netns exec ns2 ping 10.0.0.2</code>在命名空间ns2中测试与ns1的10.0.0.2的网络连通性</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>PING 10.0.0.2 <span style=color:#f92672>(</span>10.0.0.2<span style=color:#f92672>)</span> 56<span style=color:#f92672>(</span>84<span style=color:#f92672>)</span> bytes of data.
<span style=color:#ae81ff>64</span> bytes from 10.0.0.2: icmp_seq<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> ttl<span style=color:#f92672>=</span><span style=color:#ae81ff>64</span> time<span style=color:#f92672>=</span>0.030 ms
<span style=color:#ae81ff>64</span> bytes from 10.0.0.2: icmp_seq<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span> ttl<span style=color:#f92672>=</span><span style=color:#ae81ff>64</span> time<span style=color:#f92672>=</span>0.055 ms
<span style=color:#ae81ff>64</span> bytes from 10.0.0.2: icmp_seq<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span> ttl<span style=color:#f92672>=</span><span style=color:#ae81ff>64</span> time<span style=color:#f92672>=</span>0.044 ms
<span style=color:#ae81ff>64</span> bytes from 10.0.0.2: icmp_seq<span style=color:#f92672>=</span><span style=color:#ae81ff>4</span> ttl<span style=color:#f92672>=</span><span style=color:#ae81ff>64</span> time<span style=color:#f92672>=</span>0.042 ms
^C
--- 10.0.0.2 ping statistics ---
<span style=color:#ae81ff>4</span> packets transmitted, <span style=color:#ae81ff>4</span> received, 0% packet loss, time 114ms
rtt min/avg/max/mdev <span style=color:#f92672>=</span> 0.030/0.042/0.055/0.011 ms
</code></pre></div><p>可以看到我们通过网桥的方式把三个隔离的netns连接在了一起，通过这种方式，我们还可以很方便的添加第四个netns，第五个netns&mldr;在这里我们就不展开了，感兴趣的同学可以尝试一下。</p>
<p>接下来我们来讲解一下docker的几种网络模式。</p>
</div>
<footer class=post-footer>
<ul class=post-tags>
<li><a href=https://typesafe.cn/tags/linux/>linux</a></li>
<li><a href=https://typesafe.cn/tags/network/>network</a></li>
<li><a href=https://typesafe.cn/tags/bridge/>bridge</a></li>
</ul>
<nav class=paginav>
<a class=prev href=https://typesafe.cn/posts/vctl/>
<span class=title>« 上一页</span>
<br>
<span>Docker？Vmware？小孩子才做选择，打工人我全都要。</span>
</a>
<a class=next href=https://typesafe.cn/posts/linux-veth-pair/>
<span class=title>下一页 »</span>
<br>
<span>Linux veth pair 详解</span>
</a>
</nav>
<div class=share-buttons>
<a target=_blank rel="noopener noreferrer" aria-label="share Linux Bridge 详解 on twitter" href="https://twitter.com/intent/tweet/?text=Linux%20Bridge%20%e8%af%a6%e8%a7%a3&url=https%3a%2f%2ftypesafe.cn%2fposts%2flinux-bridge%2f&hashtags=linux%2cnetwork%2cbridge"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Linux Bridge 详解 on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2ftypesafe.cn%2fposts%2flinux-bridge%2f&title=Linux%20Bridge%20%e8%af%a6%e8%a7%a3&summary=Linux%20Bridge%20%e8%af%a6%e8%a7%a3&source=https%3a%2f%2ftypesafe.cn%2fposts%2flinux-bridge%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Linux Bridge 详解 on reddit" href="https://reddit.com/submit?url=https%3a%2f%2ftypesafe.cn%2fposts%2flinux-bridge%2f&title=Linux%20Bridge%20%e8%af%a6%e8%a7%a3"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Linux Bridge 详解 on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2ftypesafe.cn%2fposts%2flinux-bridge%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Linux Bridge 详解 on whatsapp" href="https://api.whatsapp.com/send?text=Linux%20Bridge%20%e8%af%a6%e8%a7%a3%20-%20https%3a%2f%2ftypesafe.cn%2fposts%2flinux-bridge%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Linux Bridge 详解 on telegram" href="https://telegram.me/share/url?text=Linux%20Bridge%20%e8%af%a6%e8%a7%a3&url=https%3a%2f%2ftypesafe.cn%2fposts%2flinux-bridge%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg>
</a>
</div>
</footer>
</article>
</main>
<footer class=footer>
<span>&copy; 2021 <a href=https://typesafe.cn>没有理想的人不伤心</a></span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a>
</span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a>
<script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script>
<script>document.querySelectorAll('pre > code').forEach(b=>{const c=b.parentNode.parentNode,a=document.createElement('button');a.classList.add('copy-code'),a.innerText='复制';function d(){a.innerText='已复制！',setTimeout(()=>{a.innerText='复制'},2e3)}a.addEventListener('click',e=>{if('clipboard'in navigator){navigator.clipboard.writeText(b.textContent),d();return}const a=document.createRange();a.selectNodeContents(b);const c=window.getSelection();c.removeAllRanges(),c.addRange(a);try{document.execCommand('copy'),d()}catch(a){}c.removeRange(a)}),c.classList.contains("highlight")?c.appendChild(a):c.parentNode.firstChild==c||(b.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?b.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(a):b.parentNode.appendChild(a))})</script>
</body>
</html>