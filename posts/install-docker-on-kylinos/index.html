<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="
银河麒麟高级服务器操作系统 V10 是针对企业级关键业务，适应虚拟化、 云计算、大数据、工业互联网时代对主机系统可靠性、安全性、性能、扩展性和 实时性的需求，依据 CMMI 5 级标准研制的提供内生安全、云原生支持、国产 平台深入优化、高性能、易管理的新一代自主服务器操作系统；同源支持飞腾、 龙芯、申威、兆芯、海光、鲲鹏等自主平台；可支撑构建大型数据中心服务器高 可用集群、负载均衡集群、分布式集群文件系统、虚拟化应用和容器云平台等， 可部署在物理服务器和虚拟化环境、私有云、公有云和混合云环境；应用于政府、 国防、金融、教育、财税、公安、审计、交通、医疗、制造等领域。
公司有个项目需要将系统部署在 kylinos上，刚开始还有点头疼，害怕各种程序无法安装和使用，等安装好服务器进行使用的时候发现这不就是基于centos的嘛，虽然基于哪个版本不知道，但是可以测试的，于是我一顿操作，最后发现它是基于Centos8的，系统内核版本是 4.19，问题不大，既然是基于Centos8的，那Centos8上能跑的程序，在这肯定也能跑，然后我就开始了愉快（痛苦）的安装docker之旅了。
配置阿里云Centos8镜像源
之所以要配置 Centos8 的镜像源是因为在安装docker的时候需要额外的一些依赖，而这些依赖在麒麟官方的源里面是没有的。
curl -o /etc/yum.repos.d/CentOS-Base.repo https://mirrors.aliyun.com/repo/Centos-8.repo
配置阿里云 docker 镜像源
yum-config-manager --add-repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
sed -i 's+download.docker.com+mirrors.aliyun.com/docker-ce+' /etc/yum.repos.d/docker-ce.repo
定义 yum 变量&修改 repo
修改 centos 和 docker repo文件中的 $releasever 为 centos_version ，原因是在麒麟服务器操作系统V10中 $releasever被修改为了 10，而我们需要使用 centos 8的镜像源，如果你不替换，基本上仓库的每一个地址都是404。
echo &#34;8&#34; > /etc/yum/vars/centos_version
sed -i 's/$releasever/$centos_version/g' /etc/yum.repos.d/docker-ce.repo
sed -i 's/$releasever/$centos_version/g' /etc/yum.repos.d/CentOS-Base.repo
建立yum缓存
没啥可说的
yum makecache
查看docker-ce 版本
yum list docker-ce --showduplicates | sort -r

docker-ce.x86_64               3:20.10.9-3.el8                 docker-ce-stable
docker-ce.x86_64               3:20.10.8-3.el8                 docker-ce-stable
docker-ce.x86_64               3:20.10.7-3.el8                 docker-ce-stable
docker-ce.x86_64               3:20.10.6-3.el8                 docker-ce-stable
docker-ce.x86_64               3:20.10.5-3.el8                 docker-ce-stable
docker-ce.x86_64               3:20.10.4-3.el8                 docker-ce-stable
docker-ce.x86_64               3:20.10.3-3.el8                 docker-ce-stable
docker-ce.x86_64               3:20.10.2-3.el8                 docker-ce-stable
docker-ce.x86_64               3:20.10.1-3.el8                 docker-ce-stable
docker-ce.x86_64               3:20.10.12-3.el8                docker-ce-stable
docker-ce.x86_64               3:20.10.11-3.el8                docker-ce-stable
docker-ce.x86_64               3:20.10.10-3.el8                docker-ce-stable
docker-ce.x86_64               3:20.10.0-3.el8                 docker-ce-stable
docker-ce.x86_64               3:19.03.15-3.el8                docker-ce-stable
docker-ce.x86_64               3:19.03.15-3.el8                @docker-ce-stable
docker-ce.x86_64               3:19.03.14-3.el8                docker-ce-stable
docker-ce.x86_64               3:19.03.13-3.el8                docker-ce-stable
安装docker
这里要安装 docker-ce 19.03 版本，因为我在使用最新版 20.10 启动容器时出现了未知的权限问题，而麒麟服务器操作系统资料相对较少，我未能找到相应的解决方案，只好退而求其次，换到上一个稳定版本。"><title>在银河麒麟高级服务器操作系统V10上安装docker</title><link rel="shortcut icon" type=image/x-icon href=/><link rel=stylesheet href=/css/main.0568d3f70e9896300444ff10565468b82c2dace6b1b82bc72fba6ae51bfb0849887e0eb4ccb3cdb1c915fbe68c7000fbea631be9322fd5d0bcab56732ce7293f.css integrity="sha512-BWjT9w6YljAERP8QVlRouCwtrOaxuCvHL7pq5Rv7CEmIfg60zLPNsckV++aMcAD76mMb6TIv1dC8q1ZzLOcpPw=="></head><body a=auto><main class=page-content aria-label=Content><div class=w><div class=post-meta><a href=/>..</a><p><time datetime="2021-12-21 23:39:00 +0800 +0800">2021-12-21</time></p></div><article><h1>在银河麒麟高级服务器操作系统V10上安装docker</h1><blockquote><p>银河麒麟高级服务器操作系统 V10 是针对企业级关键业务，适应虚拟化、 云计算、大数据、工业互联网时代对主机系统可靠性、安全性、性能、扩展性和 实时性的需求，依据 CMMI 5 级标准研制的提供内生安全、云原生支持、国产 平台深入优化、高性能、易管理的新一代自主服务器操作系统；同源支持飞腾、 龙芯、申威、兆芯、海光、鲲鹏等自主平台；可支撑构建大型数据中心服务器高 可用集群、负载均衡集群、分布式集群文件系统、虚拟化应用和容器云平台等， 可部署在物理服务器和虚拟化环境、私有云、公有云和混合云环境；应用于政府、 国防、金融、教育、财税、公安、审计、交通、医疗、制造等领域。</p></blockquote><p>公司有个项目需要将系统部署在 <strong>kylinos</strong>上，刚开始还有点头疼，害怕各种程序无法安装和使用，等安装好服务器进行使用的时候发现这不就是基于centos的嘛，虽然基于哪个版本不知道，但是可以测试的，于是我一顿操作，最后发现它是基于Centos8的，系统内核版本是 4.19，问题不大，既然是基于Centos8的，那Centos8上能跑的程序，在这肯定也能跑，然后我就开始了愉快（痛苦）的安装docker之旅了。</p><h3 id=配置阿里云centos8镜像源>配置阿里云Centos8镜像源</h3><p>之所以要配置 Centos8 的镜像源是因为在安装docker的时候需要额外的一些依赖，而这些依赖在麒麟官方的源里面是没有的。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -o /etc/yum.repos.d/CentOS-Base.repo https://mirrors.aliyun.com/repo/Centos-8.repo
</span></span></code></pre></div><h3 id=配置阿里云-docker-镜像源>配置阿里云 docker 镜像源</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>yum-config-manager --add-repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
</span></span><span style=display:flex><span>sed -i <span style=color:#f1fa8c>&#39;s+download.docker.com+mirrors.aliyun.com/docker-ce+&#39;</span> /etc/yum.repos.d/docker-ce.repo
</span></span></code></pre></div><h3 id=定义-yum-变量修改-repo>定义 yum 变量&修改 repo</h3><p>修改 centos 和 docker <code>repo</code>文件中的 <code>$releasever</code> 为 <code>centos_version</code> ，原因是在麒麟服务器操作系统V10中 <code>$releasever</code>被修改为了 10，而我们需要使用 centos 8的镜像源，如果你不替换，基本上仓库的每一个地址都是404。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>echo</span> <span style=color:#f1fa8c>&#34;8&#34;</span> &gt; /etc/yum/vars/centos_version
</span></span><span style=display:flex><span>sed -i <span style=color:#f1fa8c>&#39;s/$releasever/$centos_version/g&#39;</span> /etc/yum.repos.d/docker-ce.repo
</span></span><span style=display:flex><span>sed -i <span style=color:#f1fa8c>&#39;s/$releasever/$centos_version/g&#39;</span> /etc/yum.repos.d/CentOS-Base.repo
</span></span></code></pre></div><h3 id=建立yum缓存>建立yum缓存</h3><p>没啥可说的</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>yum makecache
</span></span></code></pre></div><h3 id=查看docker-ce-版本>查看docker-ce 版本</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>yum list docker-ce --showduplicates | sort -r
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>docker-ce.x86_64               3:20.10.9-3.el8                 docker-ce-stable
</span></span><span style=display:flex><span>docker-ce.x86_64               3:20.10.8-3.el8                 docker-ce-stable
</span></span><span style=display:flex><span>docker-ce.x86_64               3:20.10.7-3.el8                 docker-ce-stable
</span></span><span style=display:flex><span>docker-ce.x86_64               3:20.10.6-3.el8                 docker-ce-stable
</span></span><span style=display:flex><span>docker-ce.x86_64               3:20.10.5-3.el8                 docker-ce-stable
</span></span><span style=display:flex><span>docker-ce.x86_64               3:20.10.4-3.el8                 docker-ce-stable
</span></span><span style=display:flex><span>docker-ce.x86_64               3:20.10.3-3.el8                 docker-ce-stable
</span></span><span style=display:flex><span>docker-ce.x86_64               3:20.10.2-3.el8                 docker-ce-stable
</span></span><span style=display:flex><span>docker-ce.x86_64               3:20.10.1-3.el8                 docker-ce-stable
</span></span><span style=display:flex><span>docker-ce.x86_64               3:20.10.12-3.el8                docker-ce-stable
</span></span><span style=display:flex><span>docker-ce.x86_64               3:20.10.11-3.el8                docker-ce-stable
</span></span><span style=display:flex><span>docker-ce.x86_64               3:20.10.10-3.el8                docker-ce-stable
</span></span><span style=display:flex><span>docker-ce.x86_64               3:20.10.0-3.el8                 docker-ce-stable
</span></span><span style=display:flex><span>docker-ce.x86_64               3:19.03.15-3.el8                docker-ce-stable
</span></span><span style=display:flex><span>docker-ce.x86_64               3:19.03.15-3.el8                @docker-ce-stable
</span></span><span style=display:flex><span>docker-ce.x86_64               3:19.03.14-3.el8                docker-ce-stable
</span></span><span style=display:flex><span>docker-ce.x86_64               3:19.03.13-3.el8                docker-ce-stable
</span></span></code></pre></div><h3 id=安装docker>安装docker</h3><p>这里要安装 docker-ce 19.03 版本，因为我在使用最新版 20.10 启动容器时出现了未知的权限问题，而麒麟服务器操作系统资料相对较少，我未能找到相应的解决方案，只好退而求其次，换到上一个稳定版本。</p><p>20.10 版本错误信息如下：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker: Error response from daemon: OCI runtime create failed: container_linux.go:318: starting container process caused <span style=color:#f1fa8c>&#34;permission denied&#34;</span>: unknown.
</span></span><span style=display:flex><span>ERRO<span style=color:#ff79c6>[</span>0000<span style=color:#ff79c6>]</span> error waiting <span style=color:#ff79c6>for</span> container: context canceled
</span></span></code></pre></div><p>还是安装 19.03 版本吧。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>yum install docker-ce-19.03.15 docker-ce-cli-19.03.15 containerd.io -y
</span></span></code></pre></div><h3 id=启动docker>启动docker</h3><pre tabindex=0><code>systemctl start docker
systemctl enable docker
</code></pre><h3 id=启动-hello-world-进行测试>启动 hello-world 进行测试</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>root@localhost ~<span style=color:#ff79c6>]</span><span style=color:#6272a4># docker run hello-world</span>
</span></span><span style=display:flex><span>Unable to find image <span style=color:#f1fa8c>&#39;hello-world:latest&#39;</span> locally
</span></span><span style=display:flex><span>latest: Pulling from library/hello-world
</span></span><span style=display:flex><span>2db29710123e: Pull <span style=color:#8be9fd;font-style:italic>complete</span>
</span></span><span style=display:flex><span>Digest: sha256:2498fce14358aa50ead0cc6c19990fc6ff866ce72aeb5546e1d59caac3d0d60f
</span></span><span style=display:flex><span>Status: Downloaded newer image <span style=color:#ff79c6>for</span> hello-world:latest
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Hello from Docker!
</span></span><span style=display:flex><span>This message shows that your installation appears to be working correctly.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>To generate this message, Docker took the following steps:
</span></span><span style=display:flex><span> 1. The Docker client contacted the Docker daemon.
</span></span><span style=display:flex><span> 2. The Docker daemon pulled the <span style=color:#f1fa8c>&#34;hello-world&#34;</span> image from the Docker Hub.
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>(</span>amd64<span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span> 3. The Docker daemon created a new container from that image which runs the
</span></span><span style=display:flex><span>    executable that produces the output you are currently reading.
</span></span><span style=display:flex><span> 4. The Docker daemon streamed that output to the Docker client, which sent it
</span></span><span style=display:flex><span>    to your terminal.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>To try something more ambitious, you can run an Ubuntu container with:
</span></span><span style=display:flex><span> $ docker run -it ubuntu bash
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Share images, automate workflows, and more with a free Docker ID:
</span></span><span style=display:flex><span> https://hub.docker.com/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>For more examples and ideas, visit:
</span></span><span style=display:flex><span> https://docs.docker.com/get-started/
</span></span></code></pre></div><p>完美使用 -:)</p></article></div></main></body></html>