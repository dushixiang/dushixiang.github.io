<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Openstack on 整点Bug</title><link>https://www.typesafe.cn/tags/openstack/</link><description>Recent content in Openstack on 整点Bug</description><generator>Hugo</generator><language>en-us</language><lastBuildDate>Sat, 12 Jun 2021 00:00:00 +0800</lastBuildDate><atom:link href="https://www.typesafe.cn/tags/openstack/index.xml" rel="self" type="application/rss+xml"/><item><title>openstack victoria版安装</title><link>https://www.typesafe.cn/posts/install-openstack-victoria/</link><pubDate>Sat, 12 Jun 2021 00:00:00 +0800</pubDate><guid>https://www.typesafe.cn/posts/install-openstack-victoria/</guid><description>&lt;p>近期公司业务需求，需要安装一套Openstack环境学习，看了一下现在已经出了&lt;code>wallaby&lt;/code>版了，我果断选择了上一个版本&lt;code>victoria&lt;/code>。因为没有足够多的物理服务器了，只好找了一台64核256G内存6T硬盘的机器来创建几台虚拟机来搭环境了。&lt;/p>
&lt;h1 id="实验环境">实验环境&lt;/h1>
&lt;p>此次实验使用到了三台虚拟机，都是使用centos8系统，一台机器当作控制和网络节点，另外两台当作计算节点，使用OVS+VLAN的网络模式，eth0作为管理网络，eth1互相连接到OVS网桥上模拟trunk网卡，controller多增加一个eth2用于访问外部网络。&lt;/p>
&lt;table>
 &lt;thead>
 &lt;tr>
 &lt;th>节点&lt;/th>
 &lt;th>作用&lt;/th>
 &lt;th>eth0&lt;/th>
 &lt;th>eth1&lt;/th>
 &lt;th>eth2&lt;/th>
 &lt;/tr>
 &lt;/thead>
 &lt;tbody>
 &lt;tr>
 &lt;td>controller&lt;/td>
 &lt;td>控制节点、网络节点&lt;/td>
 &lt;td>172.16.10.100&lt;/td>
 &lt;td>无IP&lt;/td>
 &lt;td>桥接，无IP&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>compute-101&lt;/td>
 &lt;td>计算节点&lt;/td>
 &lt;td>172.16.10.101&lt;/td>
 &lt;td>无IP&lt;/td>
 &lt;td>❌&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>compute-102&lt;/td>
 &lt;td>计算节点&lt;/td>
 &lt;td>172.16.10.102&lt;/td>
 &lt;td>无IP&lt;/td>
 &lt;td>❌&lt;/td>
 &lt;/tr>
 &lt;/tbody>
&lt;/table>
&lt;h1 id="安装虚拟机">安装虚拟机&lt;/h1>
&lt;h2 id="安装依赖">安装依赖&lt;/h2>
&lt;p>安装KVM和Linux网桥&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>yum install -y qemu-kvm libvirt virt-install bridge-utils virt-manager dejavu-lgc-sans-fonts
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>&lt;code>dejavu-lgc-sans-fonts&lt;/code>用于解决 &lt;code>virt-manaer&lt;/code> 乱码&lt;/p>&lt;/blockquote>
&lt;p>启动&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>systemctl enable libvirtd &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> systemctl start libvirtd
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>安装OVS&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>yum install openvswitch
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>启动OVS&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>systemctl enable openvswitch &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> systemctl start openvswitch
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="创建虚拟机">创建虚拟机&lt;/h3>
&lt;p>使用 virt-manager 创建三台虚拟机&lt;/p>
&lt;p>&lt;img src="https://oss.typesafe.cn/vm-nodes.png" alt="image-20210604140054913">&lt;/p>
&lt;h3 id="配置网络">配置网络&lt;/h3>
&lt;h4 id="配置管理网卡">配置管理网卡&lt;/h4>
&lt;p>给虚拟机配置桥接网络，参考&lt;a href="https://typesafe.cn/posts/linux-kvm/">Linux虚拟化技术KVM&lt;/a>，效果如图&lt;/p>
&lt;p>&lt;img src="https://oss.typesafe.cn/vm-manage-port-config.png" alt="">&lt;/p>
&lt;h4 id="配置trunk网卡">配置trunk网卡&lt;/h4>
&lt;p>使用ovs创建一个虚拟网桥。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>ovs-vsctl add-br br-vlan
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>此时网桥&lt;code>br-vlan&lt;/code>上是没有任何虚拟网卡的，然后关闭虚拟机，在&lt;code>virt-manager&lt;/code>上添加一个网络设备&lt;/p></description></item></channel></rss>